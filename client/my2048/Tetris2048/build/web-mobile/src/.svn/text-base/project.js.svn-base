require=function r(s,a,l){function c(i,t){if(!a[i]){if(!s[i]){var e="function"==typeof require&&require;if(!t&&e)return e(i,!0);if(d)return d(i,!0);var n=new Error("Cannot find module '"+i+"'");throw n.code="MODULE_NOT_FOUND",n}var o=a[i]={exports:{}};s[i][0].call(o.exports,function(t){var e=s[i][1][t];return c(e||t)},o,o.exports,r,s,a,l)}return a[i].exports}for(var d="function"==typeof require&&require,t=0;t<l.length;t++)c(l[t]);return c}({Game:[function(e,t,i){"use strict";cc._RF.push(t,"41a6d+zz9JLm6SvBYPugiIf","Game"),cc.Class({extends:cc.Component,properties:{girdRoot:{default:null,type:cc.Prefab},bg:{default:null,type:cc.Sprite},battleRootPrefab:{default:null,type:cc.Prefab},uiRootPrefab:{default:null,type:cc.Prefab},rankPrefab:{default:null,type:cc.Prefab}},onLoad:function(){cc._renderType,cc.game.RENDER_TYPE_CANVAS;var t=this;e("LoadAtlas").loadAtlasRes("textures/gridItem/items",function(){e("LoadAtlas");t.startGame()}),Global.game=this.getComponent("Game")},startGame:function(){Global.uiScript||(Global.uiScript=cc.instantiate(this.uiRootPrefab).getComponent("uiRoot")),Global.uiScript.node.parent&&Global.uiScript.node.parent.removeChild(Global.uiScript.node),Global.uiScript.showStartUI(),this.node.addChild(Global.uiScript.node)},showShareUI:function(){Global.uiScript||(Global.uiScript=cc.instantiate(this.uiRootPrefab).getComponent("uiRoot")),Global.uiScript.node.parent&&Global.uiScript.node.parent.removeChild(Global.uiScript.node),this.node.addChild(Global.uiScript.node),Global.uiScript.showShareUI()},showRank:function(){Global.rankui||(Global.rankui=cc.instantiate(this.rankPrefab).getComponent("rankUI")),Global.rankui.node.parent&&Global.rankui.node.parent.removeChild(Global.rankui.node),Global.rankui.initData(),this.node.addChild(Global.rankui.node)},restart:function(){this.enterScene()},enterScene:function(){Global.gridController||(Global.gridController=cc.instantiate(this.girdRoot)),Global.gridController.parent&&Global.gridController.parent.removeChild(Global.gridController),this.node.addChild(Global.gridController),Global.gridController.getComponent("gridController").initGridData()}}),cc._RF.pop()},{LoadAtlas:"LoadAtlas"}],Global:[function(t,e,i){"use strict";cc._RF.push(e,"706f3NfOLBHb7CfrXxA4ezP","Global"),window.Global={hNum:5,vNum:8,itemSize:100,soonItemSize:70,itemSplit:0,screenWidth:960,screenHeight:640,paddingButtom:-100,gridNumSize:24,bornXgridNum:2,gridRandomScores:[2,4,8,16,32,64],gridDownSpeed:350,gridQuickDownSpeed:5e3,gridCombineDownSpeed:1500,moveThreshold:50,moveDownThreshold:150,gridMaxScore:2048,combineTime:300,game:null,gridController:null,startUI:null,shareUI:null,battleRootScript:null,uiScript:null,dataScript:null,rankui:null,fbname:"",fbphoto:"",fbScore:0},cc._RF.pop()},{}],LoadAtlas:[function(t,e,i){"use strict";cc._RF.push(e,"e6954PqwupDA68Ay/f/GhDn","LoadAtlas");var n={spriteAtlas:[],loadAtlasRes:function(s,a){if(-1<this.spriteAtlas.indexOf(s))a();else{var l=this;cc.loader.loadRes(s,cc.SpriteAtlas,function(t,e){for(var i=e.getSpriteFrames(),n=[],o=0;o<i.length;o++){var r=i[o];n[r.name]=r}l.spriteAtlas[s]=n,a()})}},getSpriteFrameFromName:function(t,e){return this.spriteAtlas[t][e]}};e.exports=n,cc._RF.pop()},{}],Util:[function(t,e,i){"use strict";cc._RF.push(e,"907ddwVrcNMFoX1AupADcMj","Util");var n={randomForArray:function(t){return t&&0!=t.length?t[Math.floor(Math.random()*t.length)]:0},randomForMinAndMax:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},clampValue:function(t,e,i){return t<e?e:i<t?i:t}};e.exports=n,cc._RF.pop()},{}],battleRoot:[function(t,e,i){"use strict";cc._RF.push(e,"481f1mhoLRAd5RWbtwlzHVf","battleRoot"),cc.Class({extends:cc.Component,properties:{battle:{default:null,type:cc.Node},bg:{default:null,type:cc.Sprite}},enterBattle:function(){}}),cc._RF.pop()},{}],dataScript:[function(t,e,i){"use strict";cc._RF.push(e,"191c8YcqW9NYql3hC0bgshx","dataScript"),cc.Class({extends:cc.Component,start:function(){Global.dataScript=this.node.getComponent("dataScript"),this.getScore()},getScore:function(t,e){if("undefined"!=typeof FBInstant){Global.fbname=FBInstant.player.getName(),Global.fbphoto=FBInstant.player.getPhoto();FBInstant.getSDKVersion();FBInstant.player.getDataAsync(["maxscore","starnum"]).then(function(t){void 0!==t.maxscore?Global.fbScore=t.maxscore:Global.fbScore=0,Global.startUI&&Global.startUI.updateBestScore()})}},saveScore:function(e){if("undefined"!=typeof FBInstant&&e>Global.fbScore){FBInstant.player.setDataAsync({maxscore:e}).then(function(){Global.fbScore=maxscore});var i=Global.fbname+"_"+Global.fbphoto;FBInstant.getLeaderboardAsync("my_allrank").then(function(t){return t.setScoreAsync(e,i)}).then(function(t){}).catch(function(t){Global.game.addLogStr(t)})}}}),cc._RF.pop()},{}],gridController:[function(i,t,e){"use strict";cc._RF.push(t,"1ba5537UdpN/4pRkFoExyPm","gridController"),cc.Class({extends:cc.Component,properties:{gridPrefab:{default:null,type:cc.Prefab},itemPrefab:{default:null,type:cc.Prefab},randomScore:0,soonGridNum:{default:null,type:cc.Prefab},soonGridInstance:null,startX:0,startY:0,allGrids:[],bornGrid:null,startTouchPosition:null,deleteGrids:[],joinGrids:[],targetGrid:{default:null,type:cc.Node},maxDownTime:0,line:{default:null,type:cc.Sprite},score:{default:null,type:cc.Node},isDown:!1,scoreScript:null},initGridData:function(){var t=Global.hNum*Global.itemSize+(Global.hNum-1)*Global.itemSplit,e=Global.vNum*Global.itemSize+(Global.vNum-1)*Global.itemSplit;this.startX=-Global.screenWidth/2+(Global.screenWidth-t)/2+Global.itemSize/2,this.startY=-Global.screenHeight/2+Global.paddingButtom+e-Global.itemSize,this.scoreScript=this.score.getComponent("score"),this.reset(),this.createAllGrid(),this.setTouchControl(),this.process(),this.setLine(t,e)},setLine:function(t,e){this.line.node.width=t+20,this.line.node.height=e+20;var i=e/2-this.startY-Global.itemSize/2;this.line.node.setPosition(cc.p(0,-i))},process:function(){this.down(),this.isDown=0<this.maxDownTime,this.gridJoin()},down:function(){for(var t=this.maxDownTime=0;t<Global.hNum;t++)for(var e=0;e<Global.vNum;e++){var i=this.resetItemAction(t,e);i>this.maxDownTime&&(this.maxDownTime=i)}},gridJoin:function(){var s=this;.05<this.maxDownTime?this.node.runAction(cc.sequence(cc.delayTime(this.maxDownTime-.05),cc.callFunc(function(){s.bornGrid=null}))):s.bornGrid=null;var t=0;0<this.maxDownTime&&(t=this.maxDownTime+.05),this.node.runAction(cc.sequence(cc.delayTime(t),cc.callFunc(function(){s.clearAllJoin(),s.bornGrid=null;for(var t=0,e=0;e<Global.hNum;e++)for(var i=0;i<Global.vNum;i++){var n=s.allGrids[e][i].getComponent("gridView");if(!s.findDownNum()||s.findDownNum()&&n.isDown){var o=n.startBianli();t<o&&(t=o)}}var r=s.allGrids[Global.bornXgridNum][0];if(0<t)s.node.runAction(cc.sequence(cc.delayTime(t+.05),cc.callFunc(function(){s.maxDownTime=0,null!=s.allGrids[Global.bornXgridNum][0].getComponent("gridView").item&&(s.isDown=!0),s.gridJoin()})));else{if(null!=r.getComponent("gridView").item&&!s.isDown)return s.closeListen(),Global.game.showShareUI(),void Global.shareUI.updateMaxLabel(s.scoreScript.scoreNum);s.isDown?s.process():s.createItem()}})))},findDownNum:function(){for(var t=0;t<Global.hNum;t++)for(var e=0;e<Global.vNum;e++){if(this.allGrids[t][e].getComponent("gridView").isDown)return!0}return!1},clearAllJoin:function(){for(var t=0;t<Global.hNum;t++)for(var e=0;e<Global.vNum;e++){this.allGrids[t][e].getComponent("gridView").isJoin=!1}},createItem:function(){var t=i("Util"),e=this.allGrids[Global.bornXgridNum][0];0==this.randomScore&&(this.randomScore=t.randomForArray(Global.gridRandomScores)),e.getComponent("gridView").item=cc.instantiate(this.itemPrefab),e.getComponent("gridView").item.setPosition(e.getPosition()),e.getComponent("gridView").gridNum=this.randomScore,e.getComponent("gridView").item.getComponent("itemView").initData(this.randomScore,!1),this.node.addChild(e.getComponent("gridView").item),this.bornGrid=e.getComponent("gridView").item,this.setSoonGrid(),this.process()},setSoonGrid:function(){var t=i("Util");this.randomScore=t.randomForArray(Global.gridRandomScores),(!this.soonGridInstance||this.soonGridInstance&&!this.soonGridInstance.parent)&&(this.soonGridInstance=cc.instantiate(this.soonGridNum),this.node.addChild(this.soonGridInstance)),this.soonGridInstance.setPosition(0,400),this.soonGridInstance.getComponent("itemView").initData(this.randomScore,!0)},closeListen:function(){this.node.off(cc.Node.EventType.TOUCH_START,this.nodeStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.nodeMove,this)},createAllGrid:function(){for(var t=0;t<Global.hNum;t++)for(var e=0;e<Global.vNum;e++){var i={hIndex:t,vIndex:e};this.allGrids[t]||(this.allGrids[t]=[]),this.allGrids[t][e]=this.createGrid(i)}},createGrid:function(t){var e=t.hIndex,i=t.vIndex,n=this.startX+e*Global.itemSize+e*Global.itemSplit,o=this.startY-i*Global.itemSize-i*Global.itemSplit,r=cc.instantiate(this.gridPrefab);r.setPosition(cc.p(n,o));var s=r.getComponent("gridView");return s.node.setPosition(n,o),s.setIndex(e,i),this.node.addChild(r),r},getStopPosition:function(t,e){for(var i=0,n=Global.vNum-1;0<=n;n--){var o=this.allGrids[t][n].getComponent("gridView");o&&null==o.item&&o.vIndex>e&&i++}return i},setTouchControl:function(){this.node.parent&&(this.node.on(cc.Node.EventType.TOUCH_START,this.nodeStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.nodeMove,this))},nodeStart:function(t){this.startTouchPosition=t.getLocation()},nodeMove:function(t){var e=this;if(this.bornGrid&&!cc.game.isPaused()){var i=t.getLocation(),n=i.x-e.startTouchPosition.x,o=i.y-e.startTouchPosition.y,r=Math.abs(n)>Global.moveThreshold,s=Math.abs(o)>Global.moveDownThreshold;if(r){var a=i.x<=e.startTouchPosition.x;if(e.startTouchPosition=i,d=e.canMoveGrid(a)){this.bornGrid.x=d.getPosition().x;var l=e.getStopPosition(d.getComponent("gridView").hIndex,d.getComponent("gridView").vIndex),c=e.allGrids[d.getComponent("gridView").hIndex][d.getComponent("gridView").vIndex+l];e.allGrids[d.getComponent("gridView").hIndex][d.getComponent("gridView").vIndex].getComponent("gridView").isDown=!1,c.getComponent("gridView").isDown=!0,this.bornGrid.getComponent("itemView").targetGrid=c,e.maxDownTime=this.bornGrid.getComponent("itemView").startDownForBorn(Global.gridDownSpeed),e.node.stopAllActions(),e.gridJoin()}}else if(s){var d,u=i.y<=e.startTouchPosition.y;if(e.startTouchPosition=i,d=e.canMoveQuickDown(u)){this.bornGrid.x=d.getPosition().x;l=e.getStopPosition(d.getComponent("gridView").hIndex,d.getComponent("gridView").vIndex),c=e.allGrids[d.getComponent("gridView").hIndex][d.getComponent("gridView").vIndex+l];e.allGrids[d.getComponent("gridView").hIndex][d.getComponent("gridView").vIndex].getComponent("gridView").isDown=!1,c.getComponent("gridView").isDown=!0,this.bornGrid.getComponent("itemView").targetGrid=c,e.maxDownTime=this.bornGrid.getComponent("itemView").startDownForBorn(Global.gridQuickDownSpeed),e.node.stopAllActions(),e.gridJoin()}}}},canMoveGrid:function(t){var e,i=Math.ceil(Math.abs((this.bornGrid.x-this.startX)/Global.itemSize)),n=Math.ceil(Math.abs((this.bornGrid.y-this.startY)/Global.itemSize));return t&&i<=0?null:!t&&i>=Global.hNum-1?null:(e=t?this.allGrids[i-1][n]:this.allGrids[i+1][n])&&null==e.getComponent("gridView").item?e:null},canMoveQuickDown:function(t){var e=Math.ceil(Math.abs((this.bornGrid.x-this.startX)/Global.itemSize)),i=Math.ceil(Math.abs((this.bornGrid.y-this.startY)/Global.itemSize));if(!t)return null;if(i>=Global.vNum-1)return null;var n=this.allGrids[e][i+1];return n&&null==n.getComponent("gridView").item?n:null},resetItemAction:function(t,e){if(null==this.allGrids[t][e].getComponent("gridView").item)return 0;var i=this.getStopPosition(t,e);if(0==i)return 0;var n=this.allGrids[t][e+i];n.getComponent("gridView").isDown=!0;var o=this.allGrids[t][e].getComponent("gridView").item.getComponent("itemView");o.targetGrid=n;var r=this.isDown?Global.gridCombineDownSpeed:Global.gridDownSpeed,s=o.startDownForBorn(r),a=this.allGrids[t][e].getComponent("gridView");return a.item=null,a.gridNum=0,s},onPauseOrResume:function(){cc.game.isPaused()?cc.game.resume():cc.game.pause()},onMainScene:function(){this.closeListen(),this.reset(),this.bornGrid&&this.bornGrid.parent&&this.bornGrid.parent.removeChild(this.bornGrid),Global.game.startGame(),cc.game.isPaused()&&cc.game.resume()},reset:function(){if(this.node.stopAllActions(),(this.randomScore=0)<this.allGrids.length){for(var t=0;t<Global.hNum;t++)for(var e=0;e<Global.vNum;e++){var i=this.allGrids[t][e],n=i.getComponent("gridView");n&&null!=n.item&&n.item.getComponent("itemView").toRemove(),i.parent&&i.parent.removeChild(i)}this.clearAllJoin()}this.allGrids=[],this.scoreScript.reset()}}),cc._RF.pop()},{Util:"Util"}],gridView:[function(t,e,i){"use strict";cc._RF.push(e,"2512d9CR5dPU5PDcD210m/E","gridView"),cc.Class({extends:cc.Component,properties:{allGrids:null,hIndex:0,vIndex:0,item:null,gridNum:0,targetGrid:{default:null,type:cc.Node},isDown:!1,moveIndex:0,sameScoreNum:0,deleteGrids:[],isJoin:!1},start:function(){},setIndex:function(t,e){this.hIndex=t,this.vIndex=e},startBianli:function(){var t=this;this.isJoin=!0;var e=Global.gridController.getComponent("gridController");this.allGrids=e.allGrids,this.deleteGrids=[],this.bianliForGrid();var i=this.startJoin();return 0<i&&this.node.runAction(cc.sequence(cc.delayTime(i-.01),cc.callFunc(function(){t.isDown=!1,0<t.deleteGrids.length&&(1==t.deleteGrids.length?t.gridNum*=2:2==t.deleteGrids.length?t.gridNum*=4:3==t.deleteGrids.length&&(t.gridNum*=8),e.scoreScript.addScore(t.gridNum),t.item.getComponent("itemView").bornNum=t.gridNum,t.item.getComponent("itemView").updateNum(),t.item.getComponent("itemView").updateColor())}))),this.isDown=!1,i},bianliForGrid:function(){var t=this.node.getComponent("gridView"),e=t.hIndex,i=t.vIndex;this.hasSameScore(e-1,i),this.hasSameScore(e+1,i),this.hasSameScore(e,i-1),this.hasSameScore(e,i+1)},hasSameScore:function(t,e){if(!(t<0||t>=Global.hNum||e<0||e>=Global.vNum||t==this.hIndex&&e==this.vIndex)){var i=this.allGrids[t][e];if(!(-1<this.deleteGrids.indexOf(i))){var n=i.getComponent("gridView");if(!(i&&null==n.item||n.gridNum>=Global.gridMaxScore||n.isJoin)){var o=this.node.getComponent("gridView");n.gridNum==o.gridNum&&(this.deleteGrids.push(i),n.isDown=!1,this.bianliForGrid(i),n.isJoin=!0)}}}},startJoin:function(){if(this.deleteGrids.length<=0)return 0;for(var t=0,e=0;e<this.deleteGrids.length;e++){var i=this.deleteGrids[e].getComponent("gridView"),n=i.item.getComponent("itemView").toJoin(this.node.getPosition());t<n&&(t=n),i.item=null,i.resetData()}return t},resetData:function(){this.gridNum=0},onJoinComplete:function(){this.deleteGrids=[],Global.gridController.getComponent("gridController").createItem()}}),cc._RF.pop()},{}],itemView:[function(n,t,e){"use strict";cc._RF.push(t,"01c44mKWW1NGoVqCg7+8euj","itemView"),cc.Class({extends:cc.Component,properties:{itemSprite:{default:null,type:cc.Sprite},itemNum:{default:null,type:cc.Prefab},num1:{default:null,type:cc.Sprite},num2:{default:null,type:cc.Sprite},num3:{default:null,type:cc.Sprite},num4:{default:null,type:cc.Sprite},isSoonItem:!1,bornNum:0,targetGrid:null},initData:function(t,e){this.isSoonItem=e,this.bornNum=t,this.setSpriteFrame()},setSpriteFrame:function(){this.updateColor(),this.updateNum()},startDownForBorn:function(t){this.node.stopAllActions();var e=this.node.getPosition(),i=this.targetGrid.getPosition(),n=cc.pDistance(e,i)/t,o=cc.callFunc(this.callBackForJoin,this),r=cc.moveTo(n,i),s=cc.sequence(r,o);return this.node.runAction(s),n},toJoin:function(t){var e=cc.callFunc(this.toRemove,this),i=cc.pDistance(this.node.getPosition(),t)/Global.combineTime,n=cc.moveTo(i,t),o=cc.sequence(n,e);return this.node.runAction(o),i},toRemove:function(){this.node.parent&&this.node.parent.removeChild(this.node)},updateNum:function(){var t=parseInt(this.bornNum/1e3),e=parseInt(this.bornNum/100%10),i=parseInt(this.bornNum%100/10),n=parseInt(this.bornNum%10);if(0<t&&this.getSpriteNum(this.num1,t),(0<e||0<t)&&this.getSpriteNum(this.num2,e),(0<i||0<t||0<e)&&this.getSpriteNum(this.num3,i),(0<n||0<t||0<e||0<i)&&this.getSpriteNum(this.num4,n),0==t&&this.num1.setVisible(!1),0==t&&0==e&&this.num2.setVisible(!1),0==t&&0==e&&0==i&&this.num3.setVisible(!1),0<this.bornNum&&this.bornNum<9)this.num4.node.x=0;else if(10<=this.bornNum&&this.bornNum<99){var o=this.num3.node.width+this.num4.node.width;this.num3.node.x=-o/2+this.num3.node.width/2,this.num4.node.x=this.num3.node.x+this.num3.node.width/2+this.num4.node.width/2}else if(100<=this.bornNum&&this.bornNum<999){o=this.num2.node.width+this.num3.node.width+this.num4.node.width;this.num2.node.x=-o/2+this.num2.node.width/2,this.num3.node.x=this.num2.node.x+this.num2.node.width/2+this.num3.node.width/2,this.num4.node.x=this.num3.node.x+this.num3.node.width/2+this.num4.node.width/2}else if(1e3<=this.bornNum&&this.bornNum<9999){o=this.num1.node.width+this.num2.node.width+this.num3.node.width+this.num4.node.width;this.num1.node.x=-o/2+this.num1.node.width/2+6,this.num2.node.x=this.num1.node.x+this.num1.node.width/2+this.num2.node.width/2-3,this.num3.node.x=this.num2.node.x+this.num2.node.width/2+this.num3.node.width/2-3,this.num4.node.x=this.num3.node.x+this.num3.node.width/2+this.num4.node.width/2-3}},getSpriteNum:function(t,e){var i=n("LoadAtlas").getSpriteFrameFromName("textures/gridItem/items",e);t.spriteFrame=i,t.node.width=i.getRect().width,t.node.height=i.getRect().height,t.node.scaleX=999<this.bornNum||this.isSoonItem?.8:1,t.node.scaleY=999<this.bornNum||this.isSoonItem?.8:1,t.setVisible(!0)},updateColor:function(){var e=this;n("LoadAtlas").loadAtlasRes("textures/gridItem/items",function(){var t=n("LoadAtlas");e.itemSprite.spriteFrame=t.getSpriteFrameFromName("textures/gridItem/items","color1_"+e.bornNum),e.itemSprite.node.width=e.isSoonItem?Global.soonItemSize:Global.itemSize,e.itemSprite.node.height=e.isSoonItem?Global.soonItemSize:Global.itemSize})},setItemSize:function(){this.itemSprite},callBackForJoin:function(){var t=this.targetGrid.getComponent("gridView");t.item=this,cc.log("下落停止 item callBackForJoin ："+t.hIndex+" :: "+t.vIndex),t.gridNum=this.bornNum}}),cc._RF.pop()},{LoadAtlas:"LoadAtlas"}],rankItem:[function(n,t,e){"use strict";cc._RF.push(t,"81f14kuRn5K9LTujk2+2GHB","rankItem"),cc.Class({extends:cc.Component,properties:{photo:{default:null,type:cc.Sprite},fbname:{default:null,type:cc.Label},score:{default:null,type:cc.Label},level:{default:null,type:cc.Label},levelIcon:{default:null,type:cc.Sprite}},hideAll:function(){this.levelIcon.setVisible(!1),this.level.string="",this.score.string="",this.fbname.string="",this.photo.setVisible(!1)},setScore:function(t){this.score.string=t},setNameAndPhoto:function(t){var i=this,e=t.indexOf("_");if(0<e){var n=t.substring(0,e),o=t.substring(e+1);this.photo.setVisible(!0),this.fbname.string=n,cc.loader.load(o,function(t,e){i.photo.spriteFrame=new cc.SpriteFrame(e)})}},setlevel:function(t){this.level.string=t;var e=n("LoadAtlas"),i="";1==t?i="rank_2":2==t?i="rank_3":3==t&&(i="rank_1"),""==i?this.levelIcon.setVisible(!1):(this.levelIcon.setVisible(!0),this.levelIcon.spriteFrame=e.getSpriteFrameFromName("textures/gridItem/items",i))}}),cc._RF.pop()},{LoadAtlas:"LoadAtlas"}],rankUI:[function(t,e,i){"use strict";cc._RF.push(e,"7c4f6Im+E9CPLgq3LIDqUzw","rankUI"),cc.Class({extends:cc.Component,properties:{rankPrefab:{default:null,type:cc.Prefab},content:{default:null,type:cc.Node},entries:null,itemHeight:30,arrItems:[]},start:function(){},initData:function(){if(0==this.arrItems.length)for(var t=0;t<10;t++){var e=cc.instantiate(this.rankPrefab);e.setPosition(cc.p(0,-35-t*this.itemHeight)),this.arrItems[t]=e,this.content.addChild(e)}for(var i=0;i<this.arrItems.length;i++){this.arrItems[i].getComponent("rankItem").hideAll()}this.getRank()},getRank:function(){if("undefined"!=typeof FBInstant){var e=this;FBInstant.getLeaderboardAsync("my_allrank").then(function(t){return t.getEntriesAsync()}).then(function(t){e.updateContent(t),e.getMyRank()}).catch(function(t){})}},updateContent:function(t){this.entries=t;for(var e=0;e<this.entries.length;e++){var i=this.arrItems[e],n=this.entries[e];i.getComponent("rankItem").setScore(n.getScore()),i.getComponent("rankItem").setlevel(n.getRank()),i.getComponent("rankItem").setNameAndPhoto(n.getExtraData())}},updateMyContent:function(t){if(!(parseInt(t.getRank())<=10)){var e=this.entries.length;10==e&&(e=9);var i=this.arrItems[e];i.getComponent("rankItem").setScore(t.getScore()),i.getComponent("rankItem").setlevel(t.getRank()),i.getComponent("rankItem").setNameAndPhoto(t.getExtraData())}},getMyRank:function(){if("undefined"!=typeof FBInstant){var e=this;FBInstant.getLeaderboardAsync("my_allrank").then(function(t){return t.getPlayerEntryAsync()}).then(function(t){e.updateMyContent(t)}).catch(function(t){})}},closeThis:function(){this.node.parent.removeChild(this.node)}}),cc._RF.pop()},{}],score:[function(t,e,i){"use strict";cc._RF.push(e,"125abOQvTlEBpdqjY3ndlF5","score"),cc.Class({extends:cc.Component,properties:{curLabel:{default:null,type:cc.Label},scoreNum:0,showScore:0},start:function(){this.reset()},addScore:function(t){this.scoreNum+=t},update:function(t){this.showScore>=this.scoreNum||(this.scoreNum>this.showScore+20?this.showScore+=10:this.showScore+=1,this.curLabel.string=this.showScore)},reset:function(){this.scoreNum=0,this.showScore=-1}}),cc._RF.pop()},{}],shareUI:[function(t,e,i){"use strict";cc._RF.push(e,"ab6408y4ihGvpo29uPO2m4E","shareUI"),cc.Class({extends:cc.Component,properties:{score:{default:null,type:cc.Label},isStart:!1},start:function(){Global.shareUI=this.getComponent("shareUI"),this.isStart=!0,this.showEffect(),this.updateMaxLabel()},showEffect:function(){if(this.isStart){this.node.setPosition(cc.p(-640,0));var t=cc.moveTo(.6,cc.p(0,0));this.node.runAction(t)}},updateMaxLabel:function(t){(this.score.string=t)>Global.fbScore?(this.score.string=t,Global.dataScript.saveScore(t)):this.score.string=Global.fbScore},play:function(){Global.game.enterScene()},showRankUI:function(){Global.game.showRank()},onShareGame:function(){"undefined"!=typeof FBInstant&&FBInstant.shareAsync({intent:"SHARE",image:this.getImgBase64(),text:"Protect watermelon！",data:{myReplayData:"..."}}).then(function(){})},onChallenge:function(){var t=this.getImgBase64();"undefined"!=typeof FBInstant&&FBInstant.shareAsync({intent:"INVITE",image:t,text:"I just challenged Watermelon ,Join me!",data:{myReplayData:"..."}}).then(function(){})},getImgBase64:function(){var t=cc.find("Canvas"),e=1136,i=new cc.RenderTexture(640,e);i.begin(),t._sgNode.visit(),i.end();var n=document.createElement("canvas"),o=n.getContext("2d");if(n.width=640,n.height=e,cc._renderType===cc.game.RENDER_TYPE_CANVAS){var r=i.getSprite().getTexture().getHtmlElementObj();o.drawImage(r,0,0)}else if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var s=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,s);var a=i.getSprite().getTexture()._glID;gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,a,0);var l=new Uint8Array(2908160);gl.readPixels(0,0,640,e,gl.RGBA,gl.UNSIGNED_BYTE,l),gl.bindFramebuffer(gl.FRAMEBUFFER,null);for(var c=0;c<e;c++){var d=1135-c,u=new Uint8ClampedArray(l.buffer,640*d*4,2560),h=new ImageData(u,640,1);o.putImageData(h,0,c)}}return cc.log("to share"),n.toDataURL("image/png")}}),cc._RF.pop()},{}],startUI:[function(t,e,i){"use strict";cc._RF.push(e,"bca9aXCN59LNZb12NxU6UO1","startUI"),cc.Class({extends:cc.Component,properties:{score:{default:null,type:cc.Label},icon:{default:null,type:cc.Sprite},bg:{default:null,type:cc.Sprite},bg2:{default:null,type:cc.Sprite}},start:function(){this.updateBestScore(),this.icon.spriteFrame.getTexture().setAliasTexParameters(),this.bg.spriteFrame.getTexture().setAliasTexParameters(),this.bg2.spriteFrame.getTexture().setAliasTexParameters()},updateBestScore:function(){this.score.string="High score:"+Global.fbScore},play:function(){Global.game.enterScene()},showRankUI:function(){Global.game.showRank()},onChallenge:function(){Global.shareUI.onChallenge()}}),cc._RF.pop()},{}],uiRoot:[function(t,e,i){"use strict";cc._RF.push(e,"84c41LsrfFPsriorNv8+hdx","uiRoot"),cc.Class({extends:cc.Component,properties:{startUI:{default:null,type:cc.Node},shareUI:{default:null,type:cc.Node}},start:function(){Global.startUI=this.startUI.getComponent("startUI"),Global.shareUI=this.shareUI.getComponent("shareUI")},showStartUI:function(){this.startUI.active=!0,this.shareUI.active=!1},showShareUI:function(){this.startUI.active=!1,this.shareUI.active=!0,Global.shareUI.showEffect()}}),cc._RF.pop()},{}]},{},["Game","Global","LoadAtlas","Util","dataScript","gridController","battleRoot","rankItem","rankUI","shareUI","startUI","uiRoot","gridView","itemView","score"]);
{"version":3,"sources":["Game.js"],"names":["ThirdAPI","require","Tmp","TmpOne","cc","Class","extends","Component","properties","girdRoot","default","type","Prefab","loadingUI","Node","bg","Sprite","btnSound","battleRootPrefab","uiRootPrefab","rankPrefab","storePrefab","revivePrefab","titlePrefab","titleInfoPrefab","propInfoPrefab","tipsNode","onLoad","_renderType","game","RENDER_TYPE_CANVAS","httpUtils","getComponent","active","initGameinfo","self","httpGets","data","startLoadRes","console","log","jsonData","JSON","parse","cdnGameConfig","Global","bannerAdConfig","totalSwith","error","linkImages","cdnShareImages","shareImages","cdnTexts","shareTexts","propShareImages","propShareTexts","LoadAtlas","loadAtlasRes","loadingGame","clearGameInfo","clearFriendGenStoneInfo","d","Date","now","gameinfo","loadFriendGenStoneInfo","shareTimes","shareTotalTimes","shareDate","toDateString","shareTime","shareData1","arrOpenGId","shareData2","shareData3","videoData","videoDate","Num","saveFriendGenStoneInfo","hasInit","clearPropNum","superPropNum","doublePropNum","opacity","runAction","sequence","fadeIn","delayTime","fadeOut","callFunc","startGame","getPorps","retCode","isFromGroup","clearPropLimit","showDialogPropText","superPropLimit","doublePropLimit","uiScript","instantiate","node","parent","removeChild","showStartUI","addChild","initStoreData","initTitleData","initUIData","showShareUI","showRank","rankui","initData","showStore","storeUI","showRevive","reviveUI","showTitle","titleUI","showTitleInfo","titleInfoUI","showPropDialog","isChest","showText","parmaIndex","propInfoUI","onClose","storeData","loadInfo","skinIndex","loadCurrentSkin","titleData","titleDateData","titleUnlockData","shareData","loadShareData","d1","saveShareData","saveScore","wx","loadLocalScore","score","parseInt","maxscore","gold","loadScore","wxGold","text","setLocalZOrder","stopAllActions","label","getChildByName","Label","string","width","find","setTimeout","showDialogText","p","playSound","sname","volume","isBGMPlaying","loader","loadRes","AudioClip","err","clip","sound","audioSource","AudioSource","play","restart","enterScene","gridController","initGridData"],"mappings":"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","file":"Game.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\n// Learn Attribute:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\nlet ThirdAPI = require('./common/ThirdAPI')\nlet Tmp = require('Tmp')\nlet TmpOne = require('TmpOne')\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        girdRoot: {\n            default: null,\n            type: cc.Prefab,\n        },\n        loadingUI: {\n            default: null,\n            type: cc.Node,\n        },\n        bg: {\n            default: null,\n            type: cc.Sprite,\n        },\n        //声音\n        btnSound: {\n            default: null,\n            type: cc.Prefab,\n        },\n\n        //战斗\n        battleRootPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n        //ui\n        uiRootPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n        //排行\n        rankPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n        //商店\n        storePrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n        //复活界面\n        revivePrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n        //成就\n        titlePrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n        //成就查看\n        titleInfoPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n        propInfoPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n        //提示文本\n        tipsNode: {\n            default: null,\n            type: cc.Node,\n        },\n\n    },\n\n    onLoad() {\n        if (cc._renderType === cc.game.RENDER_TYPE_CANVAS) {\n            //cc.renderer.enableDirtyRegion(false);\n        }\n        //请求cdn数据\n        //2048配置测试更新\n        var httpUtils = this.getComponent('httpUtils');\n\n        this.tipsNode.active = false;\n        this.initGameinfo();\n\n        // var wxRewardVideoAd = require('wxRewardVideoAd');\n        // wxRewardVideoAd.initCreateReward();\n\n        //请求cdn数据\n        var httpUtils = this.getComponent('httpUtils');\n        let self = this;\n        httpUtils.httpGets('https://sanxqn.nalrer.cn/tysanxiao/my2048/2048version_14.json', function (data) {\n            try {\n                if (data === -1) {\n                    self.startLoadRes();\n                    console.log('请检查网络！');\n                } else {\n                    var jsonData = JSON.parse(data);\n                    console.log(jsonData);\n                    if (jsonData) {\n\n                        if (jsonData.cdnGameConfig) {\n                            Global.cdnGameConfig = jsonData.cdnGameConfig;\n                        }\n\n                        // banner广告信息\n                        if (jsonData.bannerAdConfig) {\n                            Global.bannerAdConfig = jsonData.bannerAdConfig;\n                            console.log('Banner ad config:', Global.bannerAdConfig);\n                        }\n                    } else {\n                        console.log('读取cdn文件错误，取本地数据');\n                    }\n                    console.log('Global.cdnGameConfig.totalSwith:' + Global.cdnGameConfig.totalSwith);\n                    self.startLoadRes();\n                }\n            } catch (error) {\n                self.startLoadRes();\n                console.log(error);\n            }\n        });\n\n        console.log('startgame', Global.cdnGameConfig);\n\n        //请求内链图\n        httpUtils.httpGets('https://sanxqn.nalrer.cn/tysanxiao/my2048/linkImages/linkImages.json', function (data) {\n            if (data === -1) {\n                console.log('请检查网络！');\n            } else {\n                console.log('从CDN获取内敛图数据');\n                var jsonData = JSON.parse(data);\n                console.log(jsonData);\n                Global.linkImages = jsonData.linkImages;\n                console.log(Global.linkImages);\n            }\n        });\n\n        // 请求cdn分享图数据\n        httpUtils.httpGets('https://sanxqn.nalrer.cn/tysanxiao/my2048/shareInfo.json', function (data) {\n            if (data === -1) {\n                console.log('请检查网络！');\n            } else {\n                console.log('从CDN获取分享图数据');\n                var jsonData = JSON.parse(data);\n                console.log(jsonData);\n                Global.cdnShareImages = jsonData.shareImages;\n                Global.cdnTexts = jsonData.shareTexts;\n\n                if (jsonData.propShareImages) {\n                    Global.propShareImages = jsonData.propShareImages;\n                }\n                if (jsonData.propShareTexts) {\n                    Global.propShareTexts = jsonData.propShareTexts;\n                }\n                console.log('道具分享图片配置文件：', Global.propShareImages);\n\n                console.log(Global.cdnShareImages);\n            }\n        });\n\n\n\n        //var self = this;\n        //Global.LoadAtlas = require(\"LoadAtlas\");\n        //Global.LoadAtlas.loadAtlasRes(\"textures/gridItem/skins\", function () {});\n        //Global.LoadAtlas.loadAtlasRes(\"textures/gridItem/items\", function () {\n        //    self.loadingGame();\n        //});\n\n        Global.game = this.getComponent('Game');\n\n        //每周清空排行榜数据\n        //ThirdAPI.clearRankData();\n    },\n\n    startLoadRes: function () {\n        var self = this;\n        Global.LoadAtlas = require(\"LoadAtlas\");\n        Global.LoadAtlas.loadAtlasRes(\"textures/gridItem/skins\", function () {});\n        Global.LoadAtlas.loadAtlasRes(\"textures/gridItem/items\", function () {\n            //self.startGame();\n            self.loadingGame();\n        });\n    },\n\n    // 清除游戏缓存数据\n    clearGameInfo: function () {\n        ThirdAPI.clearFriendGenStoneInfo();\n    },\n\n    // 加载游戏缓存数据\n    initGameinfo: function () {\n        var d = new Date(Date.now());\n\n        // 加载游戏缓存数据\n        Global.gameinfo = ThirdAPI.loadFriendGenStoneInfo();\n\n        // 没有数据初始化\n        if (!Global.gameinfo) {\n            Global.gameinfo = {\n                shareTimes: 0,\n                shareTotalTimes: 0,\n                shareDate: d.toDateString(),\n                shareTime: 0,\n                shareData1: {\n                    shareDate: d.toDateString(),\n                    arrOpenGId: [],\n                },\n                shareData2: {\n                    shareDate: d.toDateString(),\n                    arrOpenGId: [],\n                },\n                shareData3: {\n                    shareDate: d.toDateString(),\n                    arrOpenGId: [],\n                },\n                videoData: {\n                    videoDate: d.toDateString(),\n                    Num: 0,\n                },\n            }\n            ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n        }\n\n        //判断是否初始化道具数量\n        if (!Global.gameinfo.hasInit) {\n            console.log('not hasInit ')\n            Global.gameinfo.hasInit = true;\n            Global.gameinfo.clearPropNum = 1;\n            Global.gameinfo.superPropNum = 1;\n            Global.gameinfo.doublePropNum = 0;\n            ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n            console.log('not hasInit ', Global.gameinfo);\n        }\n\n\n        //判断是否是当日(向朋友索取)\n        if (Global.gameinfo.shareDate != d.toDateString()) {\n            Global.gameinfo.shareTimes = 0;\n            Global.gameinfo.shareTotalTimes = 0;\n            Global.gameinfo.shareTime = 0;\n            Global.gameinfo.shareDate = d.toDateString();\n            ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n        }\n\n\n        if (!Global.gameinfo.videoData || Global.gameinfo.videoData.videoDate != d.toDateString()) {\n            Global.gameinfo.videoData = {\n                videoDate: d.toDateString(),\n                Num: 0,\n            };\n            ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n        }\n        \n        if (!Global.gameinfo.shareData1 || Global.gameinfo.shareData1.shareDate != d.toDateString()) {\n            Global.gameinfo.shareData1 = {\n                shareDate: d.toDateString(),\n                arrOpenGId: [],\n            };\n            ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n        }\n        if (!Global.gameinfo.shareData2 || Global.gameinfo.shareData2.shareDate != d.toDateString()) {\n            Global.gameinfo.shareData2 = {\n                shareDate: d.toDateString(),\n                arrOpenGId: [],\n            };\n            ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n        }\n        if (!Global.gameinfo.shareData3 || Global.gameinfo.shareData3.shareDate != d.toDateString()) {\n            Global.gameinfo.shareData3 = {\n                shareDate: d.toDateString(),\n                arrOpenGId: [],\n            };\n            ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n        }\n    },\n\n    loadingGame: function () {\n        // 加载界面/ReadyGo\n        this.loadingUI.opacity = 0;\n        this.loadingUI.active = true;\n        var self = this;\n        this.loadingUI.runAction(cc.sequence(\n            cc.fadeIn(1),\n            cc.delayTime(1),\n            cc.fadeOut(1),\n            cc.callFunc(function () {\n                self.loadingUI.active = false;\n                self.startGame();\n                self.getPorps();\n            })\n        ));\n    },\n\n    getPorps: function () {\n        console.log('检测是否从微信群进入...');\n        var retCode = ThirdAPI.isFromGroup();\n        if (retCode != -1) {\n            console.log('是从微信群进入...');\n            //Global.uiScript.startUI.getComponent('startUI').playGetGoldEffect();\n            if (retCode == 1) {\n                //点击得清除道具\n                if (Global.gameinfo.clearPropNum >= Global.clearPropLimit) {\n                    Global.game.showDialogPropText('道具数量已达上限！');\n                } else {\n                    console.log('获得消除锤锤一个');\n                    //Global.game.showPropDialog(true, '恭喜获得消除锤锤道具一个！回赠给好友一个吧！');\n                    Global.game.showDialogPropText('恭喜获得消除锤锤道具一个！回赠给好友一个吧！');\n                    Global.gameinfo.clearPropNum++;\n                    ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n                }\n            } else if (retCode == 2) {\n                //点击得万能道具\n                if (Global.gameinfo.superPropNum >= Global.superPropLimit) {\n                    Global.game.showDialogPropText('道具数量已达上限！');\n                } else {\n                    console.log('获得万能道具一个');\n                    //Global.game.showPropDialog(true, '恭喜获得万能道具一个！回赠给好友一个吧！');\n                    Global.game.showDialogPropText('恭喜获得万能道具一个！回赠给好友一个吧！');\n                    Global.gameinfo.superPropNum++;\n                    ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n                }\n            } else if (retCode == 3) {\n                //点击得双倍道具\n                if (Global.gameinfo.doublePropNum >= Global.doublePropLimit) {\n                    Global.game.showDialogPropText('道具数量已达上限！');\n                } else {\n                    //Global.game.showPropDialog(true, '恭喜获得双倍道具一个！回赠给好友一个吧！');\n                    Global.game.showDialogPropText('恭喜获得双倍道具一个！回赠给好友一个吧！');\n                    Global.gameinfo.doublePropNum++;\n                    ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n                }\n            }\n        } else {\n            console.log('不是从微信群进入...');\n        }\n    },\n\n    //开始游戏\n    startGame: function () {\n        if (!Global.uiScript) {\n            Global.uiScript = cc.instantiate(this.uiRootPrefab).getComponent(\"uiRoot\");\n        }\n        //如果有父节点则删除自身节点\n        if (Global.uiScript.node.parent) {\n            Global.uiScript.node.parent.removeChild(Global.uiScript.node);\n        }\n        Global.uiScript.showStartUI();\n\n        this.node.addChild(Global.uiScript.node);\n\n        this.initStoreData();\n        this.initTitleData();\n\n        this.initUIData();\n    },\n\n    //显示分享界面\n    showShareUI: function () {\n        if (!Global.uiScript) {\n            Global.uiScript = cc.instantiate(this.uiRootPrefab).getComponent(\"uiRoot\");\n        }\n        //如果有父节点则删除自身节点\n        if (Global.uiScript.node.parent) {\n            Global.uiScript.node.parent.removeChild(Global.uiScript.node);\n        }\n        this.node.addChild(Global.uiScript.node);\n        Global.uiScript.showShareUI();\n    },\n\n    //显示排行榜界面\n    showRank: function () {\n        if (!Global.rankui) {\n            Global.rankui = cc.instantiate(this.rankPrefab).getComponent(\"rankUI\");\n        }\n        if (Global.rankui.node.parent) {\n            Global.rankui.node.parent.removeChild(Global.rankui.node);\n        }\n        this.node.addChild(Global.rankui.node);\n        Global.rankui.initData();\n    },\n\n    //显示商店界面\n    showStore: function () {\n        if (!Global.storeUI) {\n            Global.storeUI = cc.instantiate(this.storePrefab).getComponent(\"UIStore\");\n        }\n        if (Global.storeUI.node.parent) {\n            Global.storeUI.node.parent.removeChild(Global.storeUI.node);\n        }\n        this.node.addChild(Global.storeUI.node);\n        Global.storeUI.initData();\n    },\n\n    //显示复活界面\n    showRevive: function () {\n        if (!Global.reviveUI) {\n            Global.reviveUI = cc.instantiate(this.revivePrefab).getComponent(\"reviveUI\");\n        }\n        if (Global.reviveUI.node.parent) {\n            Global.reviveUI.node.parent.removeChild(Global.reviveUI.node);\n        }\n        this.node.addChild(Global.reviveUI.node);\n        Global.reviveUI.initData();\n    },\n\n    //显示成就界面\n    showTitle: function () {\n        if (!Global.titleUI) {\n            Global.titleUI = cc.instantiate(this.titlePrefab).getComponent(\"UITitle\");\n        }\n        if (Global.titleUI.node.parent) {\n            Global.titleUI.node.parent.removeChild(Global.titleUI.node);\n        }\n        this.node.addChild(Global.titleUI.node);\n        Global.titleUI.initData();\n    },\n\n    //显示成就查看界面\n    showTitleInfo: function () {\n        if (!Global.titleInfoUI) {\n            Global.titleInfoUI = cc.instantiate(this.titleInfoPrefab).getComponent(\"UITitleInfo\");\n        }\n        if (Global.titleInfoUI.node.parent) {\n            Global.titleInfoUI.node.parent.removeChild(Global.titleInfoUI.node);\n        }\n        this.node.addChild(Global.titleInfoUI.node);\n        Global.titleInfoUI.initData();\n    },\n\n    //显示道具分享弹框\n    showPropDialog: function (isChest, showText, parmaIndex) {\n        if (!Global.propInfoUI) {\n            Global.propInfoUI = cc.instantiate(this.propInfoPrefab).getComponent(\"UIPropInfo\");\n        }\n        if (Global.propInfoUI.node.parent) {\n            Global.propInfoUI.node.parent.removeChild(Global.propInfoUI.node);\n        }\n        this.node.addChild(Global.propInfoUI.node);\n        Global.propInfoUI.initData(isChest, showText, parmaIndex);\n    },\n\n    //初始化ui信息\n    initUIData: function () {\n        this.showStore();\n        if (Global.storeUI) {\n            Global.storeUI.onClose();\n        }\n\n        this.showTitle();\n        if (Global.titleUI) {\n            Global.titleUI.onClose();\n        }\n\n        //Global.titleUI.updateItemsState(1);\n        //Global.titleUI.updateItemsState(2);\n        //Global.titleUI.updateItemsState(3);\n    },\n\n    //加载已购皮肤数据\n    initStoreData: function () {\n        //ThirdAPI.clearInfo('skinstore');\n        Global.storeData = ThirdAPI.loadInfo('skinstore');\n        if (Global.storeData == null) {\n            Global.storeData = [];\n        }\n\n        //ThirdAPI.saveScore(0, 0);\n\n        //ThirdAPI.clearCurrentSkin();\n        Global.skinIndex = ThirdAPI.loadCurrentSkin();\n        //console.log('current skin index : ', Global.skinIndex);\n    },\n\n    //加载成就数据\n    initTitleData: function () {\n        //ThirdAPI.clearInfo('title');\n        //Global.titleData = ThirdAPI.loadInfo('title');\n        if (Global.titleData == null) {\n            Global.titleData = [];\n        }\n\n        //ThirdAPI.clearInfo('title-date');\n        //Global.titleDateData = ThirdAPI.loadInfo('title-date');\n        if (Global.titleDateData == null) {\n            Global.titleDateData = [];\n        }\n\n        //ThirdAPI.clearInfo('title-unlock');\n        //Global.titleUnlockData = ThirdAPI.loadInfo('title-unlock');\n        if (Global.titleUnlockData == null) {\n            Global.titleUnlockData = [];\n        }\n\n        //ThirdAPI.clearInfo('title-unlock');\n        Global.shareData = ThirdAPI.loadShareData();\n        var d = new Date(Date.now());\n        if (!Global.shareData) {\n            //console.log('无分享限制数据，初始化');\n            var d1 = new Date(Date.now());\n            //console.log(d1.toDateString());\n            Global.shareData = {\n                shareTimes: 0,\n                shareDate: d1.toDateString()\n            }\n            ThirdAPI.saveShareData(Global.shareData.shareTimes, Global.shareData.shareDate);\n        } else if (Global.shareData.shareDate != d.toDateString()) {\n            //console.log('无今日分享限制数据，初始化');\n            Global.shareData = {\n                shareTimes: 0,\n                shareDate: d.toDateString()\n            }\n\n            ThirdAPI.saveShareData(Global.shareData.shareTimes, Global.shareData.shareDate);\n        }\n\n        //获取系统日期\n        //var d1 = new Date(Date.now());\n        //console.log(d1.toDateString());\n    },\n\n    // 存储分数到服务器\n    saveScore: function () {\n        //更新金币并存储\n        if (typeof wx !== 'undefined') {\n            let data = ThirdAPI.loadLocalScore();\n            var score = parseInt(data.maxscore);\n            var gold = parseInt(data.gold);\n            ThirdAPI.loadScore((maxscore, gold) => {\n                score = parseInt(maxscore);\n                gold = parseInt(gold);\n                //console.log('gridController on ThirdAPI loadScore', score, parseInt(gold), Global.wxGold);\n            });\n            ThirdAPI.saveScore(score, Global.wxGold);\n        }\n    },\n\n    //道具提示文本\n    showDialogPropText: function (text) {\n        this.tipsNode.active = true;\n        this.tipsNode.setLocalZOrder(10);\n        this.tipsNode.stopAllActions();\n        var label = this.tipsNode.getChildByName('label');\n        label.getComponent(cc.Label).string = text;\n        this.tipsNode.getChildByName(\"sprite\").width = cc.find('Canvas').width;\n\n        setTimeout(() => {\n            this.tipsNode.active = false;\n        }, 2000);\n    },\n\n    //分享完的提示文字\n    showDialogText: function (text, p) {\n        //总开关判断\n        if (Global.cdnGameConfig.totalSwith) {\n            console.log('开关已打开，不显示文字提示');\n            return;\n        }\n        this.tipsNode.active = true;\n        this.tipsNode.setLocalZOrder(10);\n        this.tipsNode.stopAllActions();\n        // this.tipsNode.x = p.x;\n        // this.tipsNode.y = p.y;\n        var label = this.tipsNode.getChildByName('label');\n        label.getComponent(cc.Label).string = text;\n        this.tipsNode.getChildByName(\"sprite\").width = cc.find('Canvas').width;\n\n        setTimeout(() => {\n            this.tipsNode.active = false;\n        }, 2000);\n    },\n\n    //播放声音\n    playSound: function (sname, volume) {\n        if (!Global.isBGMPlaying) {\n            return;\n        }\n        var self = this;\n        cc.loader.loadRes(\"audio/\" + sname, cc.AudioClip, function (err, clip) {\n            var sound = cc.instantiate(self.btnSound);\n            self.node.addChild(sound);\n            var audioSource = sound.getComponent(cc.AudioSource);\n            audioSource.clip = clip;\n            audioSource.volume = volume;\n            audioSource.play();\n        });\n    },\n\n    //重新开始\n    restart: function () {\n        this.enterScene();\n    },\n\n    //打开游戏战斗界面\n    enterScene: function () {\n        if (!Global.gridController) {\n            Global.gridController = cc.instantiate(this.girdRoot);\n        }\n        if (Global.gridController.parent) {\n            Global.gridController.parent.removeChild(Global.gridController);\n        }\n        this.node.addChild(Global.gridController);\n        Global.gridController.getComponent(\"gridController\").initGridData();\n    },\n});"]}
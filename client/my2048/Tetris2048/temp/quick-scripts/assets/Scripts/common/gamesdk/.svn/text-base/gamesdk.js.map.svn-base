{"version":3,"sources":["gamesdk.js"],"names":["logStatus","timer","orderCode","waitOrderTime","gameSdk","type","text","image","style","_success","_fail","self","info","wx","getSystemInfoSync","SDKVersion","getUserInfo","success","res","options","encryptedData","iv","authorize","fail","err","btn","createUserInfoButton","obj","code","data","msg","e","coin","gameCoin","gameCoinName","param","platform","getPlatForm","http","appId","then","myLog","getCodeImg","midasData","payType","purpose","midasPay","name","time","gameLogin","openId","getStorageSync","setData","checkState","Checkparam","errMsg","JSON","stringify","errData","getErrparamData","console","log","_data","_methods","_url","Promise","resolve","reject","sessionId","request","url","api","method","header","i","login","postData","setStorageSync","isNeedUpdateUserInfo","system","indexOf","length","substring","myData","codeBody","codeUrl","previewImage","current","urls","payObj","buyQuantity","checkOrder","requestMidasPayment","mode","env","offerId","currencyType","zoneId","cancelPay","catch","setInterval","clearInterval","getOrderStatus","pay_status","order_status","errObj"],"mappings":"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","file":"gamesdk.js","sourceRoot":"../../../../../../assets/Scripts/common/gamesdk","sourcesContent":["import config from './gamesdk.config.js';\r\n//logStatus为true打开log，false关闭log\r\nvar logStatus = true\r\n// var logStatus = false\r\n\r\n//定时器\r\nvar timer = null;\r\n//订单\r\nvar orderCode = '';\r\n//等待订单时间\r\nvar waitOrderTime = 1;\r\n\r\nexport default class gameSdk {\r\n    //外部调用创建用户信息按钮\r\n    static createUserInfoBtn(type, text, image, style, _success, _fail) {\r\n        try {\r\n            let self = this;\r\n            let info = wx.getSystemInfoSync();\r\n            if(info.SDKVersion < '2.0.6'){\r\n                wx.getUserInfo({\r\n                    success: function (res) {\r\n                        let options = {\r\n                            encryptedData: res.encryptedData,\r\n                            iv: res.iv\r\n                        };\r\n                        self.authorize(options, _success, _fail);\r\n                    },\r\n                    fail: function (err) {\r\n                        _fail(err);\r\n                    }\r\n                })\r\n                return;\r\n            }\r\n            let btn = wx.createUserInfoButton({\r\n                type: type,\r\n                text: text,\r\n                image: image,\r\n                style: style\r\n            });\r\n            let obj = { code: 1, data: btn, msg: 'success' };\r\n            _success(obj);\r\n        }\r\n        catch (e) {\r\n            _fail(e);\r\n        };\r\n    }\r\n\r\n    //判断支付使用方法(coin必须为整数)\r\n    static pay(coin, gameCoin, gameCoinName, param, _success, _fail) {\r\n        try {\r\n            let platform = getPlatForm();\r\n            let self = this;\r\n            http('', 'GET', 'gamepay/getGamePayType?os=' + platform + '&appId=' + config.appId).then(res => {\r\n                myLog(res);\r\n                let data = res.data;\r\n                if (data == 'wxpay') {\r\n                    getCodeImg(coin, gameCoin, gameCoinName, param, _success, _fail);\r\n                } else if (data == 'midas') {\r\n                    myLog('midasPay');\r\n                    let midasData = {\r\n                        coin: coin,\r\n                        gameCoinName: gameCoinName,\r\n                        gameCoin: gameCoin,\r\n                        param: param,\r\n                        payType: 'midas',\r\n                        purpose: 2,\r\n                        appId: config.appId\r\n                    };\r\n                    midasPay(midasData, _success, _fail);\r\n                } else if (data == 'none') {\r\n                    myLog('pay none')\r\n                } else {\r\n                    _fail(res)\r\n                }\r\n            }, err => {\r\n                _fail(err);\r\n            })\r\n        }\r\n        catch (e) {\r\n            _fail(e)\r\n        }\r\n\r\n    }\r\n\r\n    //外部调用login\r\n    static login(_success, _fail) {\r\n        myLog({\r\n            name: 'logName',\r\n            time: '00:00'\r\n        });\r\n        gameLogin(_success, _fail);\r\n    }\r\n\r\n    //外部调用验证\r\n    static authorize(options, _success, _fail) {\r\n        try {\r\n            let openId = wx.getStorageSync('sdkopenid');\r\n            let setData = {\r\n                encryptedData: options.encryptedData,\r\n                iv: options.iv,\r\n                openId: openId,\r\n                appId: config.appId\r\n            };\r\n            let checkState = Checkparam(setData);\r\n            if (checkState == 1) {\r\n                http(setData, 'POST', 'user/update').then(res => {\r\n                    gameLogin(_success, _fail);\r\n                }, err => {\r\n                    _fail(err);\r\n                })\r\n            } else {\r\n                let errMsg = `前端检查参数不正确${JSON.stringify(setData)}`;\r\n                let errData = getErrparamData(errMsg);\r\n                _fail(errData);\r\n            }\r\n        }\r\n        catch (e) {\r\n            _fail(e);\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\nfunction myLog(data) {\r\n    if (!logStatus) {\r\n        return\r\n    }\r\n    console.log(`${JSON.stringify(data)}`)\r\n}\r\n\r\n\r\n//封装new Promise请求\r\nfunction http(_data, _methods, _url) {\r\n    try {\r\n        return new Promise((resolve, reject) => {\r\n            let sessionId = wx.getStorageSync('sessionId') || '';\r\n            console.log('http promise sessionID: ', sessionId);\r\n            wx.request({\r\n                url: config.api + _url,\r\n                data: _data,\r\n                method: _methods,\r\n                header: {\r\n                    'content-type': 'application/json',\r\n                    'session-id': sessionId,\r\n                },\r\n                success: function (res) {\r\n                    console.log('wx request success!', res);\r\n                    resolve(res.data);\r\n                },\r\n                fail: function (res) {\r\n                    console.log('wx request failed!', res);\r\n                    reject(res);\r\n                }\r\n            })\r\n        })\r\n    } catch (e) {\r\n        myLog(e);\r\n    }\r\n}\r\n\r\n//检查参数\r\nfunction Checkparam(param) {\r\n    myLog(param);\r\n    for (let i in param) {\r\n        if (param[i] == null || param[i] == '' || param[i] == 'undefined') {\r\n            return -1;\r\n        }\r\n    };\r\n    return 1;\r\n}\r\n\r\n//参数不正确\r\nfunction getErrparamData(res) {\r\n    myLog(res);\r\n    return {\r\n        code: -10111,\r\n        data: '',\r\n        msg: res\r\n    }\r\n}\r\n\r\n//游戏登录\r\nfunction gameLogin(_success, _fail) {\r\n    try {\r\n        wx.login({\r\n            success: res => {\r\n                let code = res.code;\r\n                let postData = {\r\n                    code: code,\r\n                    appId: config.appId\r\n                };\r\n                console.log('1--------------------gameLogin success!');\r\n                let checkState = Checkparam(postData);//检测参数\r\n                console.log('checkState', checkState, postData);\r\n                if (checkState == 1) {\r\n                    http(postData, 'POST', 'user/login').then(res => {\r\n                        if (res.code == 0) {\r\n                            wx.setStorageSync('sdkopenid', res.data.openId);\r\n                            if (!res.data.isNeedUpdateUserInfo) {\r\n                                myLog(`保存了sessionId${res.data.sessionId}`);\r\n                                wx.setStorageSync('sessionId', res.data.sessionId);\r\n                            }\r\n                            console.log('2--------------------gameLogin success!');\r\n                            _success(res);\r\n                        } else {\r\n                            console.log('1--------------------gameLogin failed!');\r\n                            _fail(res);\r\n                        }\r\n                    }, err => {\r\n                        console.log('2--------------------gameLogin failed!');\r\n                        _fail(err);\r\n                    })\r\n                } else {\r\n                    console.log('3--------------------gameLogin failed!');\r\n                    let errMsg = `前端检查参数不正确${JSON.stringify(postData)}`;\r\n                    let errData = getErrparamData(errMsg);\r\n                    _fail(errData);\r\n                }\r\n\r\n            },\r\n            fail: function (err) {\r\n                console.log('4--------------------gameLogin failed!');\r\n                _fail(err);\r\n            }\r\n        })\r\n    } catch (e) {\r\n        console.log('5--------------------gameLogin failed!');\r\n        _fail(e);\r\n    }\r\n}\r\n\r\n//获取平台系统\r\nfunction getPlatForm() {\r\n    try {\r\n        let info = wx.getSystemInfoSync();\r\n        myLog({\r\n            name: '当前设备',\r\n            info: info,\r\n        });\r\n        if (info.system.indexOf('iOS') == 0) {\r\n            return 'ios';\r\n        } else if (info.system.indexOf('Android') == 0) {\r\n            return 'android';\r\n        } else {\r\n            if (info.system.length > 10) {\r\n                return info.system.substring(0, 10);\r\n            } else {\r\n                return info.system;\r\n            }\r\n        }\r\n    }\r\n    catch (e) {\r\n        myLog(e);\r\n        return \"error\";\r\n    }\r\n}\r\n//获取二维码\r\nfunction getCodeImg(coin, gameCoin, gameCoinName, param, _success, _fail) {\r\n    try {\r\n        let postData = {\r\n            openId: wx.getStorageSync('sdkopenid'),\r\n            appId: config.appId,\r\n            coin: coin,\r\n            gameCoin: gameCoin,\r\n            gameCoinName: gameCoinName,\r\n            param: param\r\n        };\r\n        let checkState = Checkparam(postData);\r\n        if (checkState == 1) {\r\n            let myData = { codeBody: JSON.stringify(postData) }\r\n            http(myData, 'POST', 'gamepay/createWXACode').then(res => {\r\n                let codeUrl = res.data;\r\n                wx.previewImage({\r\n                    current: codeUrl,\r\n                    urls: [codeUrl],\r\n                    success: function (res) {\r\n                        myLog(res);\r\n                        _success(res);\r\n                    },\r\n                    fail: function (err) {\r\n                        _fail(err);\r\n                    }\r\n                })\r\n            }, err => {\r\n                _fail(err)\r\n            })\r\n        } else {\r\n            let errMsg = `前端检查参数不正确${JSON.stringify(postData)}`;\r\n            let errData = getErrparamData(errMsg);\r\n            _fail(errData);\r\n        }\r\n    }\r\n    catch (e) {\r\n        myLog(e);\r\n    }\r\n}\r\n\r\n//米大师支付\r\nfunction midasPay(data, _success, _fail) {\r\n    try {\r\n        let checkState = Checkparam(data);\r\n        if (checkState == 1) {\r\n            http(data, 'POST', 'gamepay/addCoinOrder').then(res => {\r\n                myLog({\r\n                    name: 'midasPay',\r\n                    res: res\r\n                });\r\n                console.log(res)\r\n                let payObj = res.data;\r\n                orderCode = res.data.orderCode; //订单号\r\n                let buyQuantity = res.data.buyQuantity; //购买数量\r\n                if (buyQuantity == 0) {\r\n                    checkOrder(_success, _fail);\r\n                } else {\r\n                    wx.requestMidasPayment({\r\n                        mode: payObj.mode, //模式小游戏选择game\r\n                        env: payObj.env, //环境配置\r\n                        offerId: payObj.offerId, //米大师侧申请的应用id\r\n                        currencyType: payObj.currencyType,\r\n                        platform: payObj.platform, //平台\r\n                        buyQuantity: buyQuantity, //购买数量   \r\n                        zoneId: payObj.zoneId, //分区id\r\n                        success: function (res) {\r\n                            myLog({\r\n                                name: '成功回调',\r\n                                res: res\r\n                            });\r\n                            checkOrder(_success, _fail);\r\n                        },\r\n                        fail: function (err) {\r\n                            myLog({\r\n                                err: err,\r\n                                name: '用户取消支付'\r\n                            });\r\n                            console.log(err,'用户取消')\r\n                            cancelPay(_success, _fail);\r\n                        }\r\n                    });\r\n                }\r\n\r\n            }).catch(err => {\r\n                myLog(err);\r\n            })\r\n        }\r\n        else {\r\n            let errMsg = `前端检查参数不正确${JSON.stringify(data)}`;\r\n            let errData = getErrparamData(errMsg);\r\n            _fail(errData);\r\n        }\r\n\r\n    } catch (e) {\r\n        _fail(e);\r\n    }\r\n}\r\n\r\n\r\n//查看订单状态\r\nfunction checkOrder(_success, _fail) {\r\n    try {\r\n        timer = setInterval(() => {\r\n            let sessionId = wx.getStorageSync('sessionId')\r\n            myLog(`订单号:${orderCode}--appId:${config.appId}--sessionId:${sessionId}`);\r\n            if (waitOrderTime > 120) {\r\n                myLog('state=5');\r\n                clearInterval(timer);\r\n                let obj = getOrderStatus(10400);\r\n                _success(obj);\r\n            }\r\n            http('', 'GET', 'gamepay/getCoinOrderStatus?orderCode='\r\n                + orderCode + '&appId=' + config.appId).then(res => {\r\n                    myLog({ name: '成功回调', '回调参数': res });\r\n                    let data = res.data;\r\n                    if (res.code == 0) {\r\n                        if (data.pay_status == 1) {\r\n                            myLog('state=1')\r\n                            clearInterval(timer);\r\n                            let obj = getOrderStatus(10401);\r\n                            _success(obj);\r\n\r\n                        } else if (data.pay_status == 0) {\r\n                            myLog('state=0');\r\n                            waitOrderTime += 1;\r\n                        }\r\n                        if (data.order_status == 2) {\r\n                            myLog('state=2');\r\n                            clearInterval(timer);\r\n                            let obj = getOrderStatus(10402);\r\n                            _fail(obj);\r\n                        }\r\n                    } else {\r\n                        myLog('state=3');\r\n                        clearInterval(timer);\r\n                        _fail(res);\r\n                    }\r\n\r\n                }).catch(err => {\r\n                    myLog({ name: '错误回调', '回调参数': err });\r\n                    myLog('state=4');\r\n                    clearInterval(timer);\r\n                    _fail(errObj);\r\n                })\r\n        }, 1000)\r\n    }\r\n    catch (e) {\r\n        _fail(e);\r\n    }\r\n}\r\n\r\n//获取订单码\r\nfunction getOrderStatus(code) {\r\n    try {\r\n        let obj = { code: '', data: '', msg: '' };\r\n        if (code == 10400) {\r\n            obj.code = code;\r\n            obj.msg = '支付成功，到账可能延迟';\r\n        } else if (code == 10401) {\r\n            obj.code = code;\r\n            obj.msg = '支付成功';\r\n        } else if (code == 10402) {\r\n            obj.code = code;\r\n            obj.msg = '订单被取消';\r\n        }\r\n        myLog({ name: '订单状态', obj: obj });\r\n        return obj;\r\n    }\r\n    catch (e) {\r\n        let obj = { code: '', data: '', msg: '' };\r\n        if (code == 10400) {\r\n            obj.code = code;\r\n            obj.msg = '支付成功，到账可能延迟';\r\n        } else if (code == 10401) {\r\n            obj.code = code;\r\n            obj.msg = '支付成功';\r\n        } else if (code == 10402) {\r\n            obj.code = code;\r\n            obj.msg = '订单被取消';\r\n        }\r\n        myLog({ name: '订单状态', obj: obj });\r\n        return obj;\r\n    }\r\n\r\n}\r\n\r\n/* 函数:取消充值 */\r\nfunction cancelPay(_success, _fail) {\r\n    let data = {\r\n        orderCode: orderCode\r\n    };\r\n    let obj = {\r\n        data: '',\r\n        code: 10405,\r\n        msg: '用户点击了取消'\r\n    };\r\n    http(data, 'POST', 'gamepay/cancelCoinOrder').then(res => {\r\n        _fail(obj);\r\n    }, err => {\r\n        _fail(obj);\r\n    })\r\n}\r\n\r\n"]}
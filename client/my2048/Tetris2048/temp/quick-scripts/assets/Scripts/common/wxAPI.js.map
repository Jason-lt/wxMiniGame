{"version":3,"sources":["wxAPI.js"],"names":["WXGlobal","initOnEnter","console","log","options","getLaunchOptionsSync","shareTicket","scene","query","isSticky","queryString","channelPrefix","setShareTicketEnabled","showShareMenu","registShare","registOnShow","registOnHide","registOnError","userInfo","nickName","maxscore","gold","iv","signature","gender","avatarUrl","showGameClub","value","GameClubButton","show","hide","wx","onError","res","message","stack","isFromGroup","helpInfo","parseInt","sourceCode","onShow","info","onShowInfo","msg","data","err","onHide","onHideInfo","gameSdkLogin","gameSdk","require","myBtn","login","isNeedUpdateUserInfo","createUserInfoBtn","left","top","width","height","lineHeight","backgroundColor","color","textAlign","fontSize","borderRadius","code","onTap","authorize","pay","getAuth","callback","getUserInfo","success","setUserCloudStorage","KVDataList","key","fail","errMsg","indexOf","complete","self","myUtil","onShareAppMessage","imageurl","Global","cdnShareImages","length","randomForArray","image","shareImages","text","cdnTexts","shareTexts","setQueryInfo","EChannelPrefix","regular","getShareInfo","shareObj","title","imageUrl","shareType","shareSuccess","complet","onShareAppMsg","sendChannelPrefix","imgUrl","shareGame","imageTag","failcallback","sourcecode","getShareScreenShot","getShareScreenShotForDown","propShareImages","img","propShareTexts","shareTickets","shareTicketEnabled","shareAppMsg","decrypt","crypted","crypto","Buffer","decipher","createDecipheriv","decoded","update","final","setMaxScore","isEnabled","updateShareMenu","withShareTicket","obj","getShareUserInfo","hideShareMenu","shareAppMessage","params","canvas","toTempFilePathSync","x","y","destWidth","destHeight","getScreenShot","getFriendRank","openDataContext","getOpenDataContext","type","rect","postMessage","getGroupRank","openGId","undefined","saveScore","loadScore","shakeShort","vibrateShort","shakeLong","vibrateLong","exit","exitMiniProgram","getSystemInfo","getSystemInfoSync","module","exports"],"mappings":"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","file":"wxAPI.js","sourceRoot":"../../../../../assets/Scripts/common","sourcesContent":["import dataStatistics from './lib_dataStatistics/dataStatistics.js';\n\nlet WXGlobal = {\n\n\n    initOnEnter: function () {\n        console.log('get launch options')\n        let options = this.getLaunchOptionsSync();\n        console.log('launch options', options);\n        this.shareTicket = options.shareTicket;\n        this.scene = options.scene;\n        this.query = options.query;\n        this.isSticky = options.isSticky;\n        this.queryString = '';\n        this.channelPrefix = '';\n\n        this.setShareTicketEnabled(true);\n        this.showShareMenu();\n        // this.getAuth();\n        this.registShare();\n        this.registOnShow();\n        this.registOnHide();\n        this.registOnError();\n\n        this.userInfo = {\n            nickName: '不愿透露姓名的老王',\n            maxscore: 0,\n            gold: 0,\n            iv: '',\n            signature: '',\n            gender: 1,\n            avatarUrl: 'res/raw-assets/resources/textures/gridItem/rank_1.png'\n        }\n\n        /*\n        var sysInfo = wx.getSystemInfoSync();\n        console.log('sysinfo: ', sysInfo, sysInfo.SDKVersion.replace(/\\./g, \"\"));\n        if (sysInfo.SDKVersion.slice(0, 5).replace(/\\./g, \"\") >= 203) {\n            this.GameClubButton = wx.createGameClubButton({\n                icon: 'green',\n                style: {\n                    left: 20,\n                    top: 20,\n                    width: 40,\n                    height: 40\n                }\n            })\n        }*/\n\n        //this.showGameClub();\n    },\n\n    showGameClub: function (value) {\n        if (!this.GameClubButton) return;\n\n        if (value) {\n            console.log('显示游戏圈按钮');\n            this.GameClubButton.show()\n        } else {\n            console.log('隐藏游戏圈按钮');\n            this.GameClubButton.hide()\n        }\n    },\n\n    registOnError: function () {\n        wx.onError((res) => {\n            console.log('wx error:' + res.message + '\\nstack:\\n' + res.stack);\n        })\n    },\n\n    isFromGroup: function () {\n        console.log('global shareticket', WXGlobal.shareTicket);\n        console.log('WXGlobal helpInfo', WXGlobal.helpInfo);\n        console.log('比较分享点是否为送宝箱点：', parseInt(WXGlobal.helpInfo.sourceCode), parseInt(\"3020000006\"), parseInt(WXGlobal.helpInfo.sourceCode) == parseInt(\"3020000006\"));\n\n        if (!WXGlobal.shareTicket) {\n            return -1;\n        }\n        if (!WXGlobal.helpInfo) {\n            return -1;\n        }\n\n        if (parseInt(WXGlobal.helpInfo.sourceCode) === parseInt(\"3010000028\")) {\n            console.log('获得清除道具');\n            return 1;\n        }\n        if (parseInt(WXGlobal.helpInfo.sourceCode) === parseInt(\"3010000029\")) {\n            console.log('获得万能道具');\n            return 2;\n        }\n        if (parseInt(WXGlobal.helpInfo.sourceCode) === parseInt(\"3010000030\")) {\n            console.log('获得双倍道具');\n            return 3;\n        }\n        return -1;\n    },\n\n    registOnShow: function () {\n        wx.onShow((info) => {\n            console.log('wx onShow+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++', info);\n            if (info.shareTicket) {\n                WXGlobal.shareTicket = info.shareTicket;\n            }\n            if (info.query) {\n                WXGlobal.helpInfo = info.query;\n            }\n\n            //let dataStatistics = require(\"dataStatistics\");\n            dataStatistics.onShowInfo(info, res => {\n                console.log('dataStatistics onShowInfo success: ', res)\n                let msg = res.data; // 'success';\n                if (msg == 'success') {\n                    //注意，部分接口需要等待onShowInfo回调成功，如下:\n                    //setKVUserData,getKVUserData,onShareAppMsg,onHideInfo,shareAppMsg,shareSuccess //以下不需要等待:getShareInfo,getGameConfigByAppkey\n\n                    //this.gameSdkLogin(info);\n                }\n            }, err => {\n                console.log(err)\n            });\n        });\n    },\n\n    registOnHide: function () {\n        wx.onHide((res) => {\n            console.log('wx onHide<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<', res);\n            dataStatistics.onHideInfo();\n        });\n    },\n\n    gameSdkLogin: function (info) {\n        let gameSdk = require(\"gamesdk\");\n\n        var myBtn = {};\n        gameSdk.login(res => {\n            console.log('game sdk login...', res)\n            let data = res.data;\n            if (data.isNeedUpdateUserInfo) {\n                //需要登录授权\n                // dosomething...\n                //代码示例:\n                gameSdk.createUserInfoBtn('text', '获取用户信息', '', {\n                    left: 0,\n                    top: 0,\n                    width: 640,\n                    height: 1136,\n                    lineHeight: 40,\n                    backgroundColor: '#ff000000',\n                    color: '#ffffff00',\n                    textAlign: 'center',\n                    fontSize: 16,\n                    borderRadius: 4\n                }, res => {\n                    console.log(res)\n                    if (res.code == 1) {\n                        myBtn = res.data;\n                        //点击刚刚创建的用户按钮,传点击信息 \n                        myBtn.onTap((info) => {\n                            gameSdk.authorize(info, res => {\n                                //授权成功,返回登录信息\n                                // dosomething...\n                                // let userInfo = data.userInfo; \n                                // let sessionId = data.sessionId; \n                                // let openId = data.openId; \n                                console.log('授权成功')\n\n                                //隐藏按钮\n                                myBtn.hide()\n                            }, err => {\n                                console.log(err) //打印错误回调 })\n                            })\n                        })\n                    } else if (res.code == 0) {\n                        //授权成功,返回登录信息\n                        // let userInfo = data.userInfo; \n                        // let sessionId = data.sessionId; \n                        // let openId = data.openId;\n                    }\n                }, err => {\n                    console.log(err)\n                });\n            } else {\n                console.log('第三方SDK:不需要授权！')\n                //不需要授权\n                // dosomething\n                //返回登录信息\n                // let userInfo = data.userInfo; \n                // let sessionId = data.sessionId; \n                // let openId = data.openId;\n            }\n        }, err => {\n            console.log('game sdk login failed :', err) //打印错误回调 \n        });\n    },\n\n    pay: function () {\n        let gameSdk = require(\"gamesdk\");\n\n        //平台点券跟游戏币比例根据具体情况而定 \n        //当选择10人民币兑换100钻石的时候，输入如下代码,coin等于人民币 * 10，即为100 \n        gameSdk.pay(100, 100, '钻石', '...param', res => {\n                console.log(res);\n                if (res.code == 10400) {\n                    //支付成功，到账可能延迟\n                    console.log('10400')\n                } else if (res.code == 10401) {\n                    //支付成功\n                    console.log('10401')\n                }\n            },\n            err => {\n                console.log(err)\n                if (err.code == 0) {\n                    //充值开关没开，另作处理\n                    //err.data == 'audit'\n                } else if (err.code == 10403) { //报错\n                    console.log('10403')\n                } else if (err.code == 10402) {\n                    //订单被取消\n                    console.log('10402')\n                } else if (err.code == 10102) {\n                    //服务器报错\n                    console.log('10102')\n                } else if (err.code == 10405) {\n                    //用户取消支付\n                    console.log('10405')\n                } else {\n                    //其他错误\n                    console.log(err)\n                }\n            })\n    },\n\n    getAuth: function (callback) {\n        wx.getUserInfo({\n            success: function (res) {\n                // iOS 和 Android 对于拒绝授权的回调 errMsg 没有统一，需要做一下兼容处理\n                console.log(res);\n                WXGlobal.userInfo = res.userInfo\n                WXGlobal.setUserCloudStorage({\n                    KVDataList: [{\n                            key: 'name',\n                            value: res.userInfo.nickName\n                        },\n                        {\n                            key: 'gender',\n                            value: res.userInfo.gender + ''\n                        },\n                        {\n                            key: 'avatarUrl',\n                            value: res.userInfo.avatarUrl\n                        },\n                        {\n                            key: 'iv',\n                            value: res.iv\n                        },\n                        {\n                            key: 'signature',\n                            value: res.signature\n                        },\n                    ],\n                    success: function () {\n                        console.log('set User Cloud Storage success');\n                    }\n                })\n            },\n            fail: function (res) {\n                // iOS 和 Android 对于拒绝授权的回调 errMsg 没有统一，需要做一下兼容处理\n                if (res.errMsg.indexOf('auth deny') > -1 || res.errMsg.indexOf('auth denied') > -1) {\n                    // 处理用户拒绝授权的情况\n                    console.log(res);\n                    WXGlobal.userInfo = {\n                        nickName: '不愿透露姓名的老王',\n                        maxscore: 0,\n                        gold: 0,\n                        iv: '',\n                        signature: '',\n                        gender: 1,\n                        avatarUrl: 'res/raw-assets/resources/textures/gridItem/rank_1.png'\n                    }\n                    console.log('set UserInfo default');\n                }\n            },\n            complete: function () {\n                if (callback) {\n                    callback();\n                }\n            }\n        })\n    },\n\n    registShare: function () {\n        var self = this;\n        var myUtil = require(\"myUtil\");\n        this.onShareAppMessage(() => {\n            //self.shareGame('randomImg', null, null, '001');\n\n            //分享图片\n            var imageurl;\n            if (Global.cdnShareImages && Global.cdnShareImages.length > 0) {\n                imageurl = myUtil.randomForArray(Global.cdnShareImages);\n                console.log('从cdn请求分享图：', imageurl);\n            } else {\n                var image = myUtil.randomForArray(Global.shareImages);\n                imageurl = 'res/raw-assets/resources/textures/gridItem/' + image;\n                console.log('从本地请求分享图：', imageurl);\n            }\n\n            //分享文字\n            var text;\n            if (Global.cdnTexts && Global.cdnTexts.length > 0) {\n                text = myUtil.randomForArray(Global.cdnTexts);\n                console.log('从cdn请求分享文字：', text);\n            } else {\n                text = myUtil.randomForArray(Global.shareTexts);\n                console.log('从本地读取分享文字：', text);\n            }\n\n            // var img = myUtil.randomForArray(Global.shareImages);\n            // imageurl = 'res/raw-assets/resources/textures/gridItem/' + img;\n            this.setQueryInfo('001', imageurl);\n\n            console.log('用户点击了右上按钮并分享,query:', WXGlobal.queryString);\n\n            //let dataStatistics = require(\"dataStatistics\");\n\n            //当分享信息需要常规右上角信息的时候 \n            let EChannelPrefix = require(\"EChannelPrefix\");\n            console.log('*********************分享场景值: ', EChannelPrefix.regular);\n            this.channelPrefix = EChannelPrefix.regular;\n            dataStatistics.getShareInfo(EChannelPrefix.regular);\n\n            console.log(\"被动转发\");\n            let shareObj = {\n                title: text,\n                imageUrl: imageurl,\n                query: '',\n                success: (info) => {\n                    console.log(\"被动转发 成功:\", info);\n                    //代码在这里!!!\n                    //需要传的参数:shareType \n                    //passive为右上角分享,initiative为主动分享 \n                    let shareType = 'passive';\n                    dataStatistics.shareSuccess(shareType);\n                },\n                complet: info => {\n                    console.log(\"被动转发完成:\", info);\n                }\n            }\n\n            shareObj = dataStatistics.onShareAppMsg(shareObj)\n            console.log(shareObj)\n            return shareObj\n\n            /*\n            return {\n                title: text,\n                imageUrl: imageurl,\n                query: WXGlobal.queryString\n            }*/\n\n\n            /*\n                        var myUtil = require(\"myUtil\");\n                        var text = myUtil.randomForArray(Global.shareTexts);\n                        console.log('用户点击了右上按钮并分享,query:', WXGlobal.queryString, ' text:' + text);\n                        var img = WXGlobal.getShareScreenShot();\n\n                        self.setQueryInfo(sourcecode, imageurl);\n\n                        WXGlobal.shareAppMessage({\n                            title: text,\n                            imageUrl: img,\n                            query: WXGlobal.queryString\n                        });*/\n        })\n    },\n\n    sendChannelPrefix: function (key) {\n        //let dataStatistics = require(\"dataStatistics\");\n\n        //当分享信息需要常规右上角信息的时候 \n        console.log('*********************分享场景值: ', key);\n        this.channelPrefix = key;\n        dataStatistics.getShareInfo(key,res=>{\n            console.log('======================getShareInfo success!',res)\n            let imgUrl = res.data.data.image; // 分享图片路径 let title = res.data.data.title; // 分享文字信息\n            },err=>{\n                \n            console.log('======================getShareInfo failed!',err)\n            //注意:当小游戏处于断网时,或者其他错误时 console.log(err)\n            let code = err.code; // 错误码10110\n            let data = err.data; // {errMsg: \"request:fail \"} let msg = err.msg; // \"request fail\"\n            })\n    },\n\n    //分享  001点击转发   002点击群排行    003分享界面点击分享  004 复活界面\n    shareGame: function (imageTag, callback, failcallback, sourcecode) {\n        var myUtil = require(\"myUtil\");\n\n        var imageurl;\n        if (imageTag == \"screenshot\") {\n            imageurl = WXGlobal.getShareScreenShot();\n            this.setQueryInfo(sourcecode, 'screenshot');\n        } else if (imageTag == \"screenshotForDown\") {\n            imageurl = WXGlobal.getShareScreenShotForDown();\n            this.setQueryInfo(sourcecode, 'screenshot');\n        } else if ((imageTag == \"01\" || imageTag == \"02\" || imageTag == \"03\") && Global.propShareImages) {\n            console.log('imageTag:', Global.propShareImages, imageTag);\n            imageurl = Global.propShareImages[imageTag];\n            this.setQueryInfo(sourcecode, imageurl);\n        } else {\n            if (Global.cdnShareImages && Global.cdnShareImages.length > 0) {\n                imageurl = myUtil.randomForArray(Global.cdnShareImages);\n                console.log('从cdn请求分享图：', imageurl);\n            } else {\n                var img = myUtil.randomForArray(Global.shareImages);\n                imageurl = 'res/raw-assets/resources/textures/gridItem/' + img;\n                console.log('从本地请求分享图：', imageurl);\n            }\n\n\n            // var img = myUtil.randomForArray(Global.shareImages);\n            // imageurl = 'res/raw-assets/resources/textures/gridItem/' + img;\n            this.setQueryInfo(sourcecode, imageurl);\n        }\n        /*\n                if (!imageurl) {\n                    imageurl = myUtil.randomForArray(Global.shareImages);\n                } else {\n                    imageurl = 'ScreenShot';\n                }*/\n\n\n        //分享文字\n        var text;\n        if (imageTag == \"01\" || imageTag == \"02\" || imageTag == \"03\") {\n            text = Global.propShareTexts[imageTag];\n            console.log('道具分享文字', text);\n        } else if (Global.cdnTexts && Global.cdnTexts.length > 0) {\n            text = myUtil.randomForArray(Global.cdnTexts);\n            console.log('从cdn请求分享文字：', text);\n        } else {\n            text = myUtil.randomForArray(Global.shareTexts);\n            console.log('从本地读取分享文字：', text);\n        }\n        console.log('用户点击分享,query:', WXGlobal.queryString);\n\n        //let dataStatistics = require(\"dataStatistics\");\n        console.log(\"主动转发\");\n        /*\n        let shareObj = {\n            title: text,\n            imageUrl: imageurl,\n            query: '',\n            success: (info) => {\n                console.log(\"主动转发 成功:\", info);\n                //代码在这里!!!\n                //需要传的参数:shareType \n                //passive为右上角分享,initiative为主动分享 \n                let shareType = 'initiative';\n                dataStatistics.shareSuccess(shareType);\n            },\n            complet: info => {\n                console.log(\"主动转发 完成:\", info);\n            }\n        }*/\n\n        let shareObj = {\n            title: text,\n            imageUrl: imageurl,\n            query: WXGlobal.queryString,\n            success: (res) => {\n                console.log('wx分享成功', res);\n\n                console.log(\"主动转发 成功:\", res);\n                //代码在这里!!!\n                //需要传的参数:shareType \n                //passive为右上角分享,initiative为主动分享 \n                let shareType = 'initiative';\n                dataStatistics.shareSuccess(shareType);\n\n                if (res.shareTickets) {\n                    WXGlobal.shareTicketEnabled = true;\n                    WXGlobal.shareTicket = res.shareTickets[0];\n\n                    if (callback != null) {\n                        callback(null, WXGlobal.shareTicket);\n                    }\n                } else {\n                    console.log('wx分享到群失败', failcallback);\n                    if (failcallback) {\n                        failcallback();\n                    }\n                }\n            },\n            fail: () => {\n                console.log('wx分享失败', failcallback);\n                if (failcallback) {\n                    failcallback();\n                }\n            }\n        }\n\n        dataStatistics.shareAppMsg(shareObj);\n\n        /*\n        WXGlobal.shareAppMessage({\n            title: text,\n            imageUrl: imageurl,\n            query: WXGlobal.queryString,\n            success: (res) => {\n                console.log('wx分享成功', res);\n                if (res.shareTickets) {\n                    WXGlobal.shareTicketEnabled = true;\n                    WXGlobal.shareTicket = res.shareTickets[0];\n\n                    wx.getShareInfo({\n                        shareTicket: res.shareTickets[0],\n                        success: function (result) {\n                            console.log('获取分享信息成功', result);\n                            if (result) {\n                                //判断秘钥是否有用\n                                var iv = result.iv;\n                                var encryptedData = result.encryptedData;\n                                console.log('解析分享信息', tywx.UserInfo.wxgame_session_key, iv, encryptedData);\n                                var resultString = WXGlobal.decrypt(tywx.UserInfo.wxgame_session_key, iv, encryptedData);\n                                console.log(resultString);\n                                if (resultString) {\n                                    resultString = JSON.parse(resultString);\n                                    let openid = '';\n                                    // 分享\n                                    if (resultString.openGId) {\n                                        openid = resultString.openGId;\n                                    }\n                                    console.log('分享群ID:', openid);\n                                    if (callback != null) {\n                                        callback(openid, WXGlobal.shareTicket);\n                                    }\n                                } else {\n                                    if (failcallback) {\n                                        failcallback();\n                                    }\n                                }\n                            }\n                        },\n                        fail: () => {\n                            console.log('获取分享信息失败');\n                            if (failcallback) {\n                                failcallback();\n                            }\n                        },\n                        complete: () => {\n\n                        },\n                    })\n                } else {\n                    console.log('wx分享到群失败', failcallback);\n                    if (failcallback) {\n                        failcallback();\n                    }\n                }\n            },\n            fail: () => {\n                console.log('wx分享失败', failcallback);\n                if (failcallback) {\n                    failcallback();\n                }\n            }\n        });*/\n\n\n\n        // WXGlobal.shareAppMessage({\n        //     title: text,\n        //     imageUrl: imageurl,\n        //     query: WXGlobal.queryString,\n        //     /*success: (res) => {\n        //         console.log('wx分享成功', res);\n        //         if (res.shareTickets) {\n        //             WXGlobal.shareTicketEnabled = true;\n        //             WXGlobal.shareTicket = res.shareTickets[0];\n        //         }\n        //         if (callback) {\n        //             callback(res.shareTickets);\n        //         }\n        //     },*/\n\n        //     success: function (result) {\n        //         wx.getShareInfo({\n        //             shareTicket: result.shareTickets[0],\n        //             success: function (result) {\n        //                 console.log('获取分享信息成功', result);\n        //                 if (result) {\n        //                     //判断秘钥是否有用\n        //                     var iv = result.iv;\n        //                     var encryptedData = result.encryptedData;\n        //                     console.log('解析分享信息', tywx.UserInfo.wxgame_session_key, iv, encryptedData);\n        //                     var resultString = WXGlobal.decrypt(tywx.UserInfo.wxgame_session_key, iv, encryptedData);\n        //                     console.log(resultString);\n        //                     if (resultString) {\n        //                         resultString = JSON.parse(resultString);\n        //                         let openid = '';\n        //                         // 分享\n        //                         if (resultString.openGId) {\n        //                             openid = resultString.openGId;\n        //                         }\n        //                         console.log('分享群ID:', openid);\n        //                         if (callback != null) {\n        //                             callback(openid, result.);\n        //                         }\n        //                     } else {\n        //                         if (failcallback) {\n        //                             failcallback();\n        //                         }\n        //                     }\n        //                 }\n        //             },\n        //             fail: () => {\n        //                 console.log('获取分享信息失败');\n        //                 if (failcallback) {\n        //                     failcallback();\n        //                 }\n        //             },\n        //             complete: () => {\n\n        //             },\n        //         });\n\n        //     },\n        //     fail: () => {\n        //         console.log('wx分享失败', failcallback);\n        //         if (failcallback) {\n        //             failcallback();\n        //         }\n        //     },\n        // })\n    },\n\n    decrypt: function (key, iv, crypted) {\n        var crypto = require('crypto');\n\n        crypted = new Buffer(crypted, 'base64');\n        iv = new Buffer(iv, 'base64');\n        key = new Buffer(key, 'base64');\n        var decipher = crypto.createDecipheriv('aes-128-cbc', key, iv);\n        var decoded = decipher.update(crypted, 'binary', 'utf8');\n        decoded += decipher.final('utf8');\n        return decoded;\n    },\n\n    login: function (callback) {\n        wx.login(callback);\n    },\n\n    setMaxScore: function (maxscore, gold) {\n\n        WXGlobal.queryString =\n            'nickName=' + WXGlobal.userInfo.nickName + '&' +\n            'maxscore=' + maxscore + '&' +\n            'gold=' + gold + '&' +\n            'gender=' + WXGlobal.userInfo.gender + '&' +\n            'avatarUrl=' + WXGlobal.userInfo.avatarUrl;\n\n        console.log('wx setMaxScore, query:', WXGlobal.queryString);\n    },\n\n    // 返回小程序启动参数\n    getLaunchOptionsSync: function () {\n        return wx.getLaunchOptionsSync()\n    },\n\n    setShareTicketEnabled: function (isEnabled) {\n        wx.updateShareMenu({\n            withShareTicket: isEnabled,\n            success: () => {\n                WXGlobal.shareTicketEnabled = isEnabled;\n            }\n        })\n    },\n\n    getShareInfo: function (obj) {\n        return wx.getShareInfo(obj)\n    },\n\n    getShareUserInfo: function () {\n        return this.query\n    },\n\n    showShareMenu: function () {\n        console.log('显示右上菜单的转发按钮');\n        wx.showShareMenu();\n    },\n    hideShareMenu: function () {\n        console.log('隐藏右上菜单的转发按钮');\n        wx.hideShareMenu();\n    },\n    onShareAppMessage: function (callback) {\n        console.log('注册点击转发按钮事件');\n        wx.onShareAppMessage(callback);\n    },\n    shareAppMessage: function (params) {\n        console.log('转发:', params);\n        wx.shareAppMessage(params);\n    },\n\n    getShareScreenShot: function () {\n        return canvas.toTempFilePathSync({\n            x: 0,\n            y: 0.5 * canvas.height - 0.8 * 0.8 * canvas.width,\n            width: canvas.width,\n            height: 0.8 * canvas.width,\n            destWidth: 500,\n            destHeight: 400,\n        })\n    },\n\n    getShareScreenShotForDown: function () {\n        return canvas.toTempFilePathSync({\n            x: 0,\n            y: 0.5 * canvas.height + 0 * canvas.width,\n            width: canvas.width,\n            height: 0.8 * canvas.width,\n            destWidth: 500,\n            destHeight: 400,\n        })\n    },\n\n    getScreenShot: function () {\n        return canvas.toTempFilePathSync({})\n    },\n\n    getFriendRank: function (params) {\n        let openDataContext = wx.getOpenDataContext()\n        let msg = {\n            type: 'getFriendRank',\n            width: params.rect.width,\n            height: params.rect.height,\n        }\n        if (WXGlobal.shareTicketEnabled) {\n            msg.shareTicket = WXGlobal.shareTicket;\n        }\n        console.log(msg);\n\n        openDataContext.postMessage(msg);\n        if (params.callback) {\n            params.callback('wx');\n        }\n    },\n\n    getGroupRank: function (params) {\n        var myUtil = require(\"myUtil\");\n        //if (!WXGlobal.shareTicketEnabled || typeof this.shareTicket === 'undefined') {\n        var image = myUtil.randomForArray(Global.shareImages);\n        this.shareGame('res/raw-assets/resources/textures/gridItem/' + image, (openGId, shareTicket) => {\n                console.log('on get group rank pre share', shareTicket);\n                //分享给个人\n                if (!shareTicket) {\n                    if (params.callback) {\n                        params.callback('failed');\n                    }\n                } else {\n                    //分享给群\n                    let openDataContext = wx.getOpenDataContext()\n                    let msg = {\n                        type: 'getGroupRank',\n                        width: params.rect.width,\n                        height: params.rect.height,\n                        shareTicket: shareTicket\n                    }\n                    console.log(msg);\n                    openDataContext.postMessage(msg);\n                    if (params.callback) {\n                        params.callback(shareTicket);\n                        this.shareTicket = undefined;\n                    }\n                }\n            },\n            () => {\n                //分享失败\n                if (params.callback) {\n                    params.callback('failed');\n                }\n            }, '002');\n        return;\n        //} \n        /*else {\n            let openDataContext = wx.getOpenDataContext()\n            let msg = {\n                type: 'getGroupRank',\n                width: params.rect.width,\n                height: params.rect.height,\n                shareTicket: this.shareTicket\n            }\n            console.log(msg);\n            openDataContext.postMessage(msg);\n            if (params.callback) {\n                params.callback('success');\n            }\n        }*/\n    },\n\n    setQueryInfo: function (sourcecode, imageUrl) {\n        WXGlobal.queryString =\n            'nickName=' + WXGlobal.userInfo.nickName + '&' +\n            //'inviteCode=' + tywx.UserInfo.userId + '&' +\n            'sourceCode=' + 301 * 10000 + sourcecode + '&' +\n            //'sourceCode=' + this.channelPrefix + '&' +\n            'imageType=' + imageUrl;\n        console.log(WXGlobal.queryString);\n    },\n\n    /*\n    params:\n    {\n        KVDataList: [\n            { key: 'maxscore', value: score + '' },\n            { key: 'name', value: res.userInfo.nickName },\n        ],\n        success: function () {},\n        failed: function () {},\n        comlete: function () {},\n    }\n    kvdata的key和value必须为string\n    */\n    setUserCloudStorage: function (params) {\n        console.log('setUserCloudStorage:', params);\n        wx.setUserCloudStorage(params);\n    },\n\n    /*\n    params:\n    {\n        maxscore: int,\n        crystal: int,\n        callback: function () {},\n    }\n    */\n    saveScore: function (maxscore, gold, callback) {\n        if (typeof wx === 'undefined') return;\n        let obj = {\n            KVDataList: [{\n                    key: 'maxscore',\n                    value: maxscore + ''\n                },\n                {\n                    key: 'gold',\n                    value: gold + ''\n                },\n            ],\n            success: callback\n        }\n        console.log('wx saveScore:', obj);\n        this.setUserCloudStorage(obj);\n        this.setMaxScore(maxscore, gold);\n    },\n    loadScore: function (params) {\n        // 微信无法在主域获取用户托管数据\n        // if (typeof wx !== 'undefined') {\n        //     console.log('wx loadScore:', params);\n        //     this.getUserCloudStorage(params);\n        // }\n    },\n    /*\n参数格式:\n{\n    success: function () {},\n    failed: function () {},\n    comlete: function () {},\n}\n*/\n    shakeShort: function (params) {\n        wx.vibrateShort(params);\n    },\n\n    /*\n    参数格式:\n    {\n        success: function () {},\n        failed: function () {},\n        comlete: function () {},\n    }\n    */\n    shakeLong: function (params) {\n        wx.vibrateLong(params);\n    },\n    exit: function () {\n        wx.exitMiniProgram({\n            success: (res) => {\n                console.log('exit game:', res)\n            }\n        })\n    },\n\n    getSystemInfo: function () {\n        return wx.getSystemInfoSync()\n    },\n\n}\n\nmodule.exports = WXGlobal;"]}
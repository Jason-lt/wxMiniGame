{"version":3,"sources":["reviveUI.js"],"names":["ThirdAPI","require","cc","Class","extends","Component","properties","sLabel","default","type","Label","lbl_countdown","tip","shareLabel","shareNotRevive","Node","scoreNum","start","initData","startContinueConutDown","setShareLabel","node","active","wx","Global","cdnGameConfig","totalSwith","string","reviveScoreSwith","console","log","reviveScoreLimit","wxScore","canRevive","FBInstant","times","pauseInterval","countDownInterval","setInterval","giveUpShare","clearInterval","setScore","score","showRewardAd","game","playSound","wxRewardVideoAd","initCreateReward","onRewardAdClose","bind","openGId","parent","removeChild","reviveShareTimes","saveReviveData","reviveTimes","gridControllerScript","gridController","getComponent","clearGridForRevive","shareGame","myUtil","getImgBase64","onShareSuccess","onShareFailed","shareTicket","showDialogText","x","y","showShareUI","shareUI","updateMaxLabel"],"mappings":"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","file":"reviveUI.js","sourceRoot":"../../../../../assets/Scripts/ui","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nlet ThirdAPI = require('../common/ThirdAPI')\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        sLabel: {\n            default: null,\n            type: cc.Label\n        },\n        lbl_countdown: {\n            default: null,\n            type: cc.Label\n        },\n        tip: {\n            default: null,\n            type: cc.Label\n        },\n        shareLabel: {\n            default: null,\n            type: cc.Label\n        },\n        shareNotRevive: {\n            default: null,\n            type: cc.Node\n        },\n\n        scoreNum: 0,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start() {\n\n    },\n\n    initData: function () {\n        this.startContinueConutDown();\n        this.setShareLabel();\n        this.tip.node.active = false;\n        this.shareNotRevive.active = false;\n        //ThirdAPI.showGameClub(false);\n    },\n\n    //设置分享按钮文本\n    setShareLabel: function () {\n        if (typeof wx !== 'undefined') {\n            if (Global.cdnGameConfig.totalSwith) {\n                this.shareLabel.string = '分享也不能复活'; //\"看视频继续玩\";\n                //this.shareNotRevive.active = true;\n            } else {\n                if (Global.cdnGameConfig.reviveScoreSwith) {\n                    //判断分数\n                    console.log('判断分数：', Global.cdnGameConfig.reviveScoreLimit, Global.wxScore);\n                    var canRevive = Global.wxScore > Global.cdnGameConfig.reviveScoreLimit ? true : false;\n                    if (canRevive) {\n                        console.log('是否可以复活');\n                        this.shareLabel.string = '分享到群继续玩';\n                    } else {\n                        this.shareLabel.string = \"分享也不能复活\"; //'分享也不能复活';\n                        //this.shareNotRevive.active = true;\n                    }\n                } else {\n                    console.log('分享开关已经关闭', Global.cdnGameConfig.reviveScoreSwith);\n                    this.shareLabel.string = '分享到群继续玩';\n                }\n            }\n        } else if (typeof FBInstant !== 'undefined') {\n            this.shareLabel.string = 'share game';\n        } else {\n            this.shareLabel.string = '分享复活';\n        }\n    },\n\n    //设置倒计时\n    startContinueConutDown: function () {\n        let times = 10;\n        this.lbl_countdown.string = times;\n        this.pauseInterval = false;\n        this.countDownInterval = setInterval(() => {\n            if (!this.pauseInterval) {\n                times--;\n                if (times >= 0) {\n                    this.lbl_countdown.string = times;\n                } else {\n                    this.giveUpShare();\n                    clearInterval(this.countDownInterval);\n                }\n            }\n        }, 1000);\n    },\n\n    //设置分数\n    setScore: function (score) {\n        this.scoreNum = score;\n        if (typeof wx !== 'undefined') {\n            this.sLabel.string = '当前分数：' + this.scoreNum;\n        } else if (typeof FBInstant !== 'undefined') {\n            this.sLabel.string = 'current score:' + this.scoreNum;\n        } else {\n            this.sLabel.string = '当前分数:' + this.scoreNum;\n        }\n    },\n\n    //分享\n    showRewardAd: function () {\n        Global.game.playSound('btn', 0.1);\n\n        this.tip.node.active = false;\n        this.pauseInterval = true;\n\n        var wxRewardVideoAd = require('wxRewardVideoAd');\n        wxRewardVideoAd.initCreateReward(this.onRewardAdClose.bind(this));\n    },\n\n    //分享成功\n    onRewardAdClose: function (openGId) {\n        if (this.node.parent) {\n            this.node.parent.removeChild(this.node);\n        }\n        this.pauseInterval = false;\n        clearInterval(this.countDownInterval);\n\n        //可以复活\n        Global.reviveShareTimes--;\n        //保存本地\n        if (Global.reviveShareTimes > -1) {\n            ThirdAPI.saveReviveData(Global.reviveShareTimes);\n        }\n        //当局复活次数加1\n        Global.reviveTimes++;\n\n        //开始消除格子，继续游戏\n        var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n        gridControllerScript.clearGridForRevive();\n    },    \n\n    //分享\n    shareGame: function () {\n        Global.game.playSound('btn', 0.1);\n\n        this.tip.node.active = false;\n        this.pauseInterval = true;\n\n        if (typeof FBInstant !== 'undefined') {\n            var myUtil = require('myUtil');\n            ThirdAPI.shareGame(myUtil.getImgBase64(), this.onShareSuccess.bind(this));\n        } else if (typeof wx !== 'undefined') {\n            console.log('----------------复活分享-----------------');\n            ThirdAPI.shareGame('randomImg', this.onShareSuccess.bind(this), this.onShareFailed.bind(this), '004');\n        } else {\n            console.log('----------------直接复活-----------------');\n            this.onShareSuccess();\n        }\n    },\n\n    //分享成功\n    onShareSuccess: function (openGId, shareTicket) {\n        \n        //总开关判断\n        if (Global.cdnGameConfig.totalSwith) {\n            this.giveUpShare();\n            clearInterval(this.countDownInterval);\n            console.log('功能开关已打开1');\n            return;\n        } else {\n            //分数开关判断\n            if (Global.cdnGameConfig.reviveScoreSwith) {\n                //判断分数\n                console.log('判断分数：', Global.cdnGameConfig.reviveScoreLimit, Global.wxScore);\n                var canRevive = Global.wxScore > Global.cdnGameConfig.reviveScoreLimit ? true : false;\n\n                if (!canRevive) {\n                    this.giveUpShare();\n                    clearInterval(this.countDownInterval);\n                    console.log('revive复活界面--分数开关已打开2');\n                    return;\n                }\n            }\n        }\n\n        /*\n        if (Global.gameinfo.shareData2.arrOpenGId.indexOf(openGId) != -1) {\n            console.log('该群今日已经分享过', openGId);\n            this.pauseInterval = false;\n            Global.game.showDialogText('该群今日已经分享过无法复活');\n            return;\n        } else {\n            console.log('该群未分享过', openGId);\n            Global.gameinfo.shareData2.arrOpenGId.push(openGId);\n            ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n        }*/\n\n        //是否分享到群\n        if (!shareTicket) {\n            Global.game.showDialogText('请分享到不同群！', {\n                x: 0,\n                y: -120\n            });\n            this.pauseInterval = false;\n            console.log('分享失败，必须分享到不同微信群!');\n            return;\n        }\n\n        if (this.node.parent) {\n            this.node.parent.removeChild(this.node);\n        }\n        this.pauseInterval = false;\n        clearInterval(this.countDownInterval);\n\n        //可以复活\n        Global.reviveShareTimes--;\n        //保存本地\n        if (Global.reviveShareTimes > -1) {\n            ThirdAPI.saveReviveData(Global.reviveShareTimes);\n        }\n        //当局复活次数加1\n        Global.reviveTimes++;\n\n        //开始消除格子，继续游戏\n        var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n        gridControllerScript.clearGridForRevive();\n    },\n\n    //分享失败\n    onShareFailed: function () {\n        this.pauseInterval = false;\n        Global.game.showDialogText('请分享到不同群！');\n    },\n\n    //放弃分享\n    giveUpShare: function () {\n        Global.game.playSound('btn', 0.1);\n        if (this.node.parent) {\n            this.node.parent.removeChild(this.node);\n        }\n        this.pauseInterval = false;\n        clearInterval(this.countDownInterval);\n        Global.game.showShareUI();\n        Global.shareUI.updateMaxLabel(this.scoreNum);\n    },\n\n});"]}
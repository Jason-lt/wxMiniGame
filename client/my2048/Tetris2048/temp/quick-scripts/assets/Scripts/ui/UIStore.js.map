{"version":3,"sources":["UIStore.js"],"names":["ThirdAPI","require","loadAtlas","cc","Class","extends","Component","properties","content","default","type","Node","buttonClose","storeitemPrefab","Prefab","tipbox","propScore","Label","arrItems","itemWidth","itemHeight","start","on","onClose","initStore","showTipbox","text","active","getChildByName","getComponent","string","onTipButton","initData","Global","wxGold","updateStoreItemsState","initStoreList","setIsHave","console","log","storeData","i","length","data","wareType","Math","floor","wareIndex","skinIndex","setCurrent","skinArray","push","name","photo","getSpriteFrameFromName","price","index","item","instantiate","setPhoto","setWareType","setPrice","setName","setStoreItemPos","addChild","height","ceil","list","updateState","setCurrentItem","itemCurrent","setPosition","p","game","playSound","node","parent","removeChild"],"mappings":"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","file":"UIStore.js","sourceRoot":"../../../../../assets/Scripts/ui","sourcesContent":["let ThirdAPI = require('../common/ThirdAPI')\nvar loadAtlas = require(\"LoadAtlas\")\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // content 节点，商品列表Content\n        content: {\n            default: null,\n            type: cc.Node\n        },\n        // buttonClose 节点，关闭商店\n        buttonClose: {\n            default: null,\n            type: cc.Node\n        },\n        // 商品项\n        storeitemPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n        // 提示信息\n        tipbox: {\n            default: null,\n            type: cc.Node,\n        },\n        // 道具分数\n        propScore: {\n            default: null,\n            type: cc.Label\n        },\n        arrItems: [],\n        itemWidth: 260,\n        itemHeight: 260,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start() {\n        // 注册按钮\n        this.buttonClose.on('click', this.onClose, this);\n\n        this.initStore();\n    },\n\n    // 显示提示框\n    showTipbox: function (text) {\n        this.tipbox.active = true;\n        this.tipbox.getChildByName(\"text\").getComponent(cc.Label).string = text;\n    },\n\n    onTipButton: function () {\n        this.tipbox.active = false;\n    },\n\n    // 初始化商店\n    initData: function () {\n        // 道具分数\n        //console.log('钻石分：', Global.wxGold);\n        this.propScore.string = Global.wxGold;\n\n        this.updateStoreItemsState();\n    },\n\n    // 初始化商店\n    initStore: function () {\n        this.initStoreList();\n\n        // 将默认皮肤标记为已经拥有\n        this.arrItems[0].getComponent('StoreItem').setIsHave();\n\n\n        // 使用已购商品数据标记已经拥有商品\n        console.log(\"已购商品列表\", Global.storeData);\n        for (let i = 0; i < Global.storeData.length; i++) {\n            var data = Global.storeData[i];\n            var wareType = Math.floor(data / 100);\n            var wareIndex = data % 100;\n            console.log(\"已购商品 type:\" + wareType + \"index:\" + wareIndex);\n            if (wareType == 1) {\n                this.arrItems[wareIndex].getComponent('StoreItem').setIsHave();\n                //console.log('将已购商品标记出来');\n            }\n        }\n\n        // 使用当前索引标记当前皮肤\n        this.arrItems[Global.skinIndex].getComponent('StoreItem').setCurrent(true);\n    },\n\n    // 初始化商店列表\n    initStoreList: function () {\n        var skinArray = [];\n        skinArray.push({\n            type: 1,\n            name: \"数字\",\n            photo: loadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'skin1'),\n            price: 0\n        });\n        skinArray.push({\n            type: 1,\n            name: \"富豪\",\n            photo: loadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'skin2'),\n            price: 50\n        });\n        skinArray.push({\n            type: 1,\n            name: \"甄嬛传\",\n            photo: loadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'skin3'),\n            price: 150\n        });\n        skinArray.push({\n            type: 1,\n            name: \"脑残版\",\n            photo: loadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'skin4'),\n            price: 300\n        });\n        skinArray.push({\n            type: 1,\n            name: \"扑克版\",\n            photo: loadAtlas.getSpriteFrameFromName('textures/gridItem/skins', 'skin5'),\n            price: 500\n        });\n        skinArray.push({\n            type: 1,\n            name: \"复仇版\",\n            photo: loadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'skin5'),\n            price: 850\n        });\n\n        for (let index = 0; index < skinArray.length; index++) {\n            var item = cc.instantiate(this.storeitemPrefab);\n            item.getComponent('StoreItem').setPhoto(skinArray[index].photo);\n            item.getComponent('StoreItem').setWareType(skinArray[index].type);\n            item.getComponent('StoreItem').setPrice(skinArray[index].price);\n            item.getComponent('StoreItem').setName(skinArray[index].name);\n            this.setStoreItemPos(item, index);\n            item.getComponent('StoreItem').index = index;\n            item.getComponent('StoreItem').setCurrent(index == Global.skinIndex);\n            this.content.addChild(item);\n\n            this.arrItems.push(item);\n        }\n        this.content.height = Math.ceil(skinArray.length / 2) * this.itemHeight;\n    },\n\n    // 更新列表商品状态（是否可以购买）\n    updateStoreItemsState: function () {\n        var list = this.arrItems;\n        for (let index = 0; index < list.length; index++) {\n            list[index].getComponent('StoreItem').updateState();\n        }\n    },\n\n    // 设置为当前\n    setCurrentItem: function (itemCurrent) {\n        for (let index = 0; index < this.arrItems.length; index++) {\n            var item = this.arrItems[index];\n            if (item != itemCurrent) {\n                item.getComponent('StoreItem').setCurrent(false);\n            }\n        }\n    },\n\n    // 根据索引设置商品的位置（双排布局）\n    setStoreItemPos: function (item, index) {\n        if (index % 2 == 0) {\n            item.setPosition(cc.p(-this.itemWidth / 2, -(Math.floor(index / 2) + 1 / 2) * this.itemHeight));\n        } else {\n            item.setPosition(cc.p(this.itemWidth / 2, -(Math.floor(index / 2) + 1 / 2) * this.itemHeight));\n        }\n    },\n\n    // 按钮回调：关闭\n    onClose: function () {\n        Global.game.playSound('btn', 0.1);\n        //console.log(\"关闭商店\");\n\n        if (this.node.parent) {\n            this.node.parent.removeChild(this.node);\n        }\n    },\n\n    // update (dt) {},\n});"]}
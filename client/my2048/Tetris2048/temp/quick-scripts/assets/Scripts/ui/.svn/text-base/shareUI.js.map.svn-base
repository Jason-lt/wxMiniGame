{"version":3,"sources":["shareUI.js"],"names":["ThirdAPI","require","cc","Class","extends","Component","properties","bg","default","type","Node","line1","line2","currScore","Label","score","personPer","buttonstate0","buttonstate1","node_gold","fly_node","lbl_gold","lbl_fly","soundOnBtn","soundOffBtn","backgroundAudio","url","AudioClip","tipbox","hasShardReward","isStart","start","Global","shareUI","getComponent","setBackground","initData","destroyBannerAd","showEffect","cdnGameConfig","totalSwith","active","shareScoreSwith","console","log","shareScoreLimit","wxScore","canShow","shareData","shareTimes","wxBannerAd","showTipbox","onTipButton","canvas","find","width","switchBGM","startUI","node","setPosition","p","action","moveTo","runAction","updateMaxLabel","maxNum","string","myUtil","getPercentString","wx","data","loadLocalScore","parseInt","maxscore","gold","loadScore","saveScore","FBInstant","fbScore","dataScript","titleMaxScore","titleUI","updateItemsState","play","game","playSound","enterScene","gotoHome","startGame","showRankUI","showRank","onShareGame","shareGame","getImgBase64","onShareSuccess","bind","EChannelPrefix","sendChannelPrefix","result","onShareFail","onChallenge","img","shareAsync","intent","image","text","myReplayData","then","openGId","shareTicket","canTakeReward","showDialogText","x","y","saveShareData","shareDate","wxGold","shareReward","playGetGoldEffect","ani","Animation","fadeIn","on","sequence","scaleTo","callFunc","fadeOut","target","height","renderTexture","RenderTexture","begin","_sgNode","visit","end","document","createElement","ctx","getContext","_renderType","RENDER_TYPE_CANVAS","texture","getSprite","getTexture","getHtmlElementObj","drawImage","RENDER_TYPE_WEBGL","buffer","gl","createFramebuffer","bindFramebuffer","FRAMEBUFFER","_glID","framebufferTexture2D","COLOR_ATTACHMENT0","TEXTURE_2D","Uint8Array","readPixels","RGBA","UNSIGNED_BYTE","rowBytes","row","srow","data2","Uint8ClampedArray","imageData","ImageData","putImageData","toDataURL"],"mappings":"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","file":"shareUI.js","sourceRoot":"../../../../../assets/Scripts/ui","sourcesContent":["let ThirdAPI = require('../common/ThirdAPI');\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        bg: {\n            default: null,\n            type: cc.Node\n        },\n        line1: {\n            default: null,\n            type: cc.Node\n        },\n        line2: {\n            default: null,\n            type: cc.Node\n        },\n        //当前分数\n        currScore: {\n            default: null,\n            type: cc.Label,\n        },\n        score: {\n            default: null,\n            type: cc.Label,\n        },\n        personPer: {\n            default: null,\n            type: cc.Label,\n        },\n        buttonstate0: {\n            default: null,\n            type: cc.Node,\n        },\n        buttonstate1: {\n            default: null,\n            type: cc.Node,\n        },\n        node_gold: {\n            default: null,\n            type: cc.Node\n        },\n        fly_node: {\n            default: null,\n            type: cc.Node\n        },\n        lbl_gold: {\n            default: null,\n            type: cc.Label,\n        },\n        lbl_fly: {\n            default: null,\n            type: cc.Label,\n        },\n        soundOnBtn: {\n            default: null,\n            type: cc.Node\n        },\n        soundOffBtn: {\n            default: null,\n            type: cc.Node\n        },\n        //背景音乐\n        backgroundAudio: {\n            url: cc.AudioClip,\n            default: null\n        },\n        // 提示信息\n        tipbox: {\n            default: null,\n            type: cc.Node,\n        },\n\n        hasShardReward: true,\n        isStart: false,\n    },\n\n    start() {\n        Global.shareUI = this.getComponent('shareUI');\n\n        this.setBackground();\n        this.isStart = true;\n    },\n\n    initData: function () {\n        this.destroyBannerAd();\n        this.hasShardReward = true;\n        this.showEffect();\n        this.setBackground();\n\n        if (Global.cdnGameConfig.totalSwith) {\n            this.buttonstate0.active = false;\n            this.buttonstate1.active = true;\n        } else {\n            //分数开关判断\n            if (Global.cdnGameConfig.shareScoreSwith) {\n                //判断分数\n                console.log('判断分数：', Global.cdnGameConfig.shareScoreLimit, Global.wxScore);\n                var canShow = Global.wxScore > Global.cdnGameConfig.shareScoreLimit ? true : false;\n                console.log('分享界面按钮判断--canShow:', canShow);\n                if (canShow) {\n                    this.buttonstate0.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? true : false;\n                    this.buttonstate1.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? false : true;\n                } else {\n                    this.buttonstate0.active = false;\n                    this.buttonstate1.active = true;\n                }\n            } else {\n                this.buttonstate0.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? true : false;\n                this.buttonstate1.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? false : true;\n            }\n\n            // this.buttonstate0.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? true : false;\n            // this.buttonstate1.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? false : true;\n        }\n\n\n        // if (Global.shareData.shareTimes >= 5) {\n        //     console.log('分享超过5次限制');\n        //     this.buttonstate0.active = false;\n        //     this.buttonstate1.active = true;\n        // }\n    },\n\n    //销毁banner广告\n    destroyBannerAd: function () {\n        var wxBannerAd = require('wxBannerAd');\n        wxBannerAd.destroyBannerAd();\n    },\n\n    // 显示提示框\n    showTipbox: function () {\n        this.tipbox.active = true;\n    },\n\n    onTipButton: function () {\n        this.tipbox.active = false;\n    },\n\n    //设置头部图片的适配宽高\n    setBackground: function () {\n        let canvas = cc.find('Canvas');\n        this.bg.width = canvas.width;\n        this.line1.width = canvas.width;\n        this.line2.width = canvas.width;\n        console.log('width:', this.bg.width, this.line1.width, this.line2.width);\n    },\n\n    switchBGM: function () {\n        Global.startUI.switchBGM();\n    },\n\n    showEffect: function () {\n        this.node_gold.active = false;\n        this.fly_node.active = false;\n\n        this.node.setPosition(cc.p(-640, 0));\n        var action = cc.moveTo(0.6, cc.p(0, 0));\n        this.node.runAction(action);\n    },\n\n    updateMaxLabel: function (maxNum) {\n        //本局最高分\n        this.currScore.string = maxNum;\n        //全球比分\n        var myUtil = require('myUtil');\n        this.personPer.string = myUtil.getPercentString(maxNum);\n        this.score.string = '历史最高分：' + maxNum;\n        if (typeof wx !== 'undefined') {\n            let data = ThirdAPI.loadLocalScore();\n            var score = parseInt(data.maxscore);\n            var gold = parseInt(data.gold);\n            ThirdAPI.loadScore((maxscore, gold) => {\n                score = parseInt(maxscore);\n                gold = parseInt(gold);\n                console.log('on ThirdAPI loadScore', score, parseInt(gold));\n            });\n\n            //历史最高分\n            if (score < maxNum) {\n                ThirdAPI.saveScore(maxNum, gold);\n                this.score.string = '历史最高分：' + maxNum;\n            } else {\n                this.score.string = '历史最高分：' + score;\n            }\n        } else if (typeof FBInstant !== 'undefined') {\n            if (maxNum > Global.fbScore) {\n                this.score.string = maxNum;\n                //测试\n                Global.dataScript.saveScore(maxNum);\n            } else {\n                this.score.string = Global.fbScore;\n            }\n        }\n\n        Global.titleMaxScore = maxNum;\n        if (Global.titleUI) {\n            Global.titleUI.updateItemsState(1);\n        }\n    },\n\n    //进入游戏\n    play: function () {\n        Global.game.playSound('btn', 0.1);\n        Global.game.enterScene();\n    },\n\n    //返回主页\n    gotoHome: function () {\n        Global.game.playSound('btn', 0.1);\n        Global.game.startGame();\n    },\n\n    //进入排行榜\n    showRankUI: function () {\n        Global.game.playSound('btn', 0.1);\n        Global.game.showRank();\n    },\n\n    // 分享功能  intent(\"INVITE\" | \"REQUEST\" | \"CHALLENGE\" | \"SHARE\") 表示分享的意图\n    onShareGame: function () {\n        Global.game.playSound('btn', 0.1);\n        if (typeof FBInstant !== 'undefined') {\n            ThirdAPI.shareGame(this.getImgBase64(), this.onShareSuccess.bind(this));\n        } else {\n            let EChannelPrefix = require(\"EChannelPrefix\");\n            ThirdAPI.sendChannelPrefix(EChannelPrefix.result);\n            ThirdAPI.shareGame('screenshot', this.onShareSuccess.bind(this), this.onShareFail.bind(this), '003');\n        }\n    },\n\n    onChallenge: function () {\n        Global.game.playSound('btn', 0.1);\n        var img = this.getImgBase64();\n        if (typeof FBInstant === 'undefined') return;\n        FBInstant.shareAsync({\n            intent: 'INVITE',\n            image: img,\n            text: 'I just challenged Tetris2048,Join me!',\n            data: {\n                myReplayData: '...'\n            },\n        }).then(() => {\n            // continue with the game.\n        });\n    },\n\n\n    onShareSuccess: function (openGId, shareTicket) {\n        //总开关判断\n        if (Global.cdnGameConfig.totalSwith) {\n            //this.buttonstate0.active = false;\n            //this.buttonstate1.active = true;\n            return;\n        } else {\n            //分数开关判断\n            if (Global.cdnGameConfig.shareScoreSwith) {\n                //判断分数\n                console.log('分享成功之后判断分数：', Global.cdnGameConfig.shareScoreLimit, Global.wxScore);\n                var canTakeReward = Global.wxScore > Global.cdnGameConfig.shareScoreLimit ? true : false;\n\n                if (!canTakeReward) {\n                    console.log('分享成功不能领取奖励')\n                    //this.buttonstate0.active = false;\n                    //this.buttonstate1.active = true;\n                    return;\n                }\n            }\n        }\n\n        /*\n                if (Global.Gameversion) {\n                    this.buttonstate0.active = false;\n                    this.buttonstate1.active = true;\n                    return;\n                }*/\n\n        //console.log('今日分享次数:', Global.shareData.shareTimes);\n        if (Global.shareData.shareTimes >= 5) {\n            //console.log('分享超过5次限制');\n            //this.buttonstate0.active = false;\n            //this.buttonstate1.active = true;\n            return;\n        }\n\n        //获得钻石动画\n        if (this.hasShardReward) {\n            /*\n            if (Global.gameinfo.shareData3.arrOpenGId.indexOf(openGId) != -1) {\n                console.log('该群今日已经分享过', openGId);\n                Global.game.showDialogText('该群今日已经分享过无法获得奖励');\n                return;\n            } else {\n                console.log('该群未分享过', openGId);\n                Global.gameinfo.shareData3.arrOpenGId.push(openGId);\n                ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n            }*/\n\n            if (!shareTicket) {\n                Global.game.showDialogText('请分享到不同群！', {\n                    x: 0,\n                    y: -200\n                });\n                console.log('shareUI 分享的不是群');\n                return;\n            }\n            console.log('分享获得钻石,开始播放动画');\n            Global.shareData.shareTimes++;\n            ThirdAPI.saveShareData(Global.shareData.shareTimes, Global.shareData.shareDate);\n\n            Global.wxGold += parseInt(Global.shareReward);\n            //更新并存储\n            if (typeof wx !== 'undefined') {\n                let data = ThirdAPI.loadLocalScore();\n                var score = parseInt(data.maxscore);\n                var gold = parseInt(data.gold);\n                ThirdAPI.loadScore((maxscore, gold) => {\n                    score = parseInt(maxscore);\n                    gold = parseInt(gold);\n                    console.log('shareUI on ThirdAPI loadScore', score, parseInt(gold), Global.wxGold);\n                });\n                ThirdAPI.saveScore(score, Global.wxGold);\n            }\n\n            //更改分享可获钻石状态\n            this.hasShardReward = false;\n            this.playGetGoldEffect();\n        }\n    },\n\n    //分享到群失败\n    onShareFail: function () {\n        console.log('向好友索取失败');\n        Global.game.showDialogText('请分享到不同群！');\n    },\n\n    playGetGoldEffect: function () {\n        this.buttonstate0.active = false;\n        this.buttonstate1.active = true;\n        //更改分享可获钻石状态\n        this.hasShardReward = false;\n\n        this.fly_node.active = true;\n        //this.lbl_fly.string = '+' + Global.shareReward;\n        let ani = this.fly_node.getComponent(cc.Animation)\n        ani.play();\n        this.node_gold.active = true;\n        this.lbl_gold.string = Global.wxGold - parseInt(Global.shareReward);\n        this.node_gold.runAction(cc.fadeIn(0.5));\n\n        ani.on('stop', () => {\n            this.node_gold.runAction(cc.sequence(\n                cc.scaleTo(0.2, 1.2),\n                cc.callFunc(() => {\n                    this.lbl_gold.string = Global.wxGold;\n                    this.fly_node.active = false;\n                }),\n                cc.scaleTo(0.2, 1),\n                cc.fadeOut(1)\n            ));\n        });\n    },\n\n    // 截屏返回 iamge base6，用于 Share\n    getImgBase64: function () {\n        let target = cc.find('Canvas');\n        let width = parseInt(target.width),\n            height = parseInt(target.height);\n        let renderTexture = new cc.RenderTexture(width, height);\n        renderTexture.begin();\n        target._sgNode.visit();\n        renderTexture.end();\n        //\n        let canvas = document.createElement('canvas');\n        let ctx = canvas.getContext('2d');\n        canvas.width = width;\n        canvas.height = height;\n        if (cc._renderType === cc.game.RENDER_TYPE_CANVAS) {\n            let texture = renderTexture.getSprite().getTexture();\n            let image = texture.getHtmlElementObj();\n            ctx.drawImage(image, 0, 0);\n        } else if (cc._renderType === cc.game.RENDER_TYPE_WEBGL) {\n            let buffer = gl.createFramebuffer();\n            gl.bindFramebuffer(gl.FRAMEBUFFER, buffer);\n            let texture = renderTexture.getSprite().getTexture()._glID;\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n            let data = new Uint8Array(width * height * 4);\n            gl.readPixels(0, 0, width, height, gl.RGBA, gl.UNSIGNED_BYTE, data);\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n            let rowBytes = width * 4;\n            for (let row = 0; row < height; row++) {\n                let srow = height - 1 - row;\n                let data2 = new Uint8ClampedArray(data.buffer, srow * width * 4, rowBytes);\n                let imageData = new ImageData(data2, width, 1);\n                ctx.putImageData(imageData, 0, row);\n            }\n        }\n        cc.log('to share');\n        return canvas.toDataURL('image/png');\n    },\n});"]}
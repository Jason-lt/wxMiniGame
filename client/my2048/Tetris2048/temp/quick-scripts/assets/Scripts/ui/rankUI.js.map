{"version":3,"sources":["rankUI.js"],"names":["ThirdAPI","require","cc","Class","extends","Component","properties","top1","default","type","Node","top2","rankPrefab","Prefab","innerview","scrollView","content","btn_group","myrankNode","myrankBg","Sprite","myrankSpr","entries","itemHeight","arrItems","start","onLoad","setHandWidthAndHeight","canvas","find","width","onBtnGroupClick","showType","lbl_btn_group","string","getGroupRank","getFriendRank","initData","wx","getComponent","ScrollView","scrollToTop","item","instantiate","itemheight","height","rankCount","console","log","sprite","getChildByName","length","index","setLocalZOrder","setPosition","p","addChild","element","setlevel","hideAll","level","node","active","initGetGroupRank","FBInstant","getRank","w","h","x","y","drawRect","rect","callback","updateContent","updateWxRank","EChannelPrefix","sendChannelPrefix","grouprank","cleanRank","closeThis","self","getLeaderboardAsync","then","leaderboard","getEntriesAsync","getMyRank","catch","fasle","ent","setScore","getScore","setNameAndPhoto","getExtraData","updateMyContent","entri","parseInt","spriteFrame","parent","removeChild","update","dt","openDataContext","getOpenDataContext","sharedCanvas","texture","Texture2D","initWithElement","handleLoadedTexture","sp","SpriteFrame","Type","TILED"],"mappings":"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","file":"rankUI.js","sourceRoot":"../../../../../assets/Scripts/ui","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\n// Learn Attribute:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\n\nlet ThirdAPI = require('../common/ThirdAPI')\ncc.Class({\n    extends: cc.Component,\n\n\n    properties: {\n        top1: {\n            default: null,\n            type: cc.Node,\n        },\n        top2: {\n            default: null,\n            type: cc.Node,\n        },\n        rankPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n        innerview: {\n            default: null,\n            type: cc.Node,\n        },\n        scrollView: {\n            default: null,\n            type: cc.Node,\n        },\n        content: {\n            default: null,\n            type: cc.Node,\n        },\n        btn_group: {\n            default: null,\n            type: cc.Node,\n        },\n        myrankNode: {\n            default: null,\n            type: cc.Node,\n        },\n        myrankBg: {\n            default: null,\n            type: cc.Sprite,\n        },\n        myrankSpr: {\n            default: null,\n            type: cc.Sprite,\n        },\n        entries: null,\n        itemHeight: 30,\n        arrItems: [],\n    },\n\n    start() {\n\n    },\n\n    onLoad: function () {\n        /*if (typeof wx !== 'undefined') {\n            this.lbl_btn_group = this.btn_group.getChildByName('Label').getComponent(cc.Label);\n            this.btn_group.active = true;\n            this.lbl_btn_group.string = '查看群排行';\n            this.showType = 1;\n            this.myrankNode.active = true;\n        } else {\n            this.btn_group.active = false;\n            this.myrankNode.active = false;\n            this.scrollView.height = 780;\n            // this.innerview.height = 820;\n            this.scrollView.y = -27;\n        }*/\n        this.setHandWidthAndHeight();\n    },\n\n    //设置头部图片的适配宽高\n    setHandWidthAndHeight: function () {\n        let canvas = cc.find('Canvas');\n        this.top1.width = canvas.width * 0.5;\n        this.top2.width = canvas.width * 0.5;\n    },\n\n    onBtnGroupClick: function () {\n        if (this.showType == 1) {\n            this.showType = 2;\n            this.lbl_btn_group.string = '查看好友排行';\n            this.getGroupRank();\n        } else {\n            this.showType = 1;\n            this.lbl_btn_group.string = '查看群排行';\n            this.getFriendRank();\n        }\n    },\n\n    initData: function () {\n        if (typeof wx !== 'undefined') {\n            //this.myrankBg.node.setCascadeOpacityEnabled(true);\n            // this.myrankBg.node.setOpacity(255 * 0.3);\n            //this.myrankBg.node.setLocalZOrder(-1);\n        }\n\n        //每次重进游戏置顶\n        var scrollView = this.scrollView.getComponent(cc.ScrollView).scrollToTop(0);\n\n        let item = cc.instantiate(this.rankPrefab);\n        let itemheight = item.height + 5;\n        let rankCount = 20;\n        this.content.height = itemheight * rankCount;\n        console.log('content width:' + this.content.width);\n        //设置绘制照片姓名的画布\n        var sprite = this.content.getChildByName('sprite');\n        sprite.height = itemheight * rankCount;\n        //this.innerview.height -= 100;\n        //this.innerview.height = itemheight * rankCount;\n        if (this.arrItems.length == 0) {\n            for (let index = 0; index < rankCount; index++) {\n                let item = cc.instantiate(this.rankPrefab);\n                item.setLocalZOrder(-1);\n                item.setPosition(cc.p(0, -0.5 * itemheight - index * itemheight));\n                this.arrItems[index] = item;\n\n                this.content.addChild(item);\n            }\n        }\n\n        for (let index = 0; index < this.arrItems.length; index++) {\n            const element = this.arrItems[index];\n            element.getComponent('rankItem').setlevel(index + 1);\n            element.getComponent('rankItem').hideAll();\n        }\n        //开始获取排行榜\n        if (typeof wx !== 'undefined') {\n            for (let index = 0; index < this.arrItems.length; index++) {\n                const element = this.arrItems[index];\n                element.getComponent('rankItem').level.node.active = false;\n            }\n            this.initGetGroupRank();\n        } else if (typeof FBInstant !== 'undefined') {\n            this.getRank();\n        }\n    },\n\n    getFriendRank: function () {\n        console.log(\"getFriendRank\");\n        var sprite = this.content.getChildByName('sprite');\n        //sprite.width = this.content.width;\n\n        let w = sprite.width;\n        let h = sprite.height;\n        let x = this.innerview.x - 0.5 * w;\n        let y = this.innerview.y - 0.5 * h;\n        this.drawRect = {\n            x: x,\n            y: y,\n            width: w,\n            height: h\n        };\n        console.log('draw rect:', this.drawRect, \"this.content.width :\" + this.content.width, \"this.innerview.width\" + this.innerview.width + \"sprite.width :\" + sprite.width);\n        ThirdAPI.getRank({\n            rect: this.drawRect,\n            callback: (entries) => {\n                if (typeof entries === 'object') {\n                    this.updateContent(entries);\n                    // this.getMyRank();\n                } else if (typeof entries === 'string') {\n                    this.updateWxRank = 100;\n                }\n            }\n        }, 'Friend')\n    },\n\n\n    //初始化群排行\n    initGetGroupRank: function () {\n        console.log(\"getGroupRank\");\n\n        let EChannelPrefix = require(\"EChannelPrefix\");\n        ThirdAPI.sendChannelPrefix(EChannelPrefix.grouprank);\n        var sprite = this.content.getChildByName('sprite');\n\n        let w = sprite.width; //this.content.width;\n        let h = sprite.height; //this.content.height;\n        let x = this.innerview.x - 0.5 * w;\n        let y = this.innerview.y - 0.5 * h;\n        this.drawRect = {\n            x: x,\n            y: y,\n            width: w,\n            height: h\n        };\n        console.log('draw rect:', this.drawRect);\n\n        this.cleanRank();\n        ThirdAPI.getRank({\n            rect: this.drawRect,\n            callback: (entries) => {\n                console.log('getGroupRank,oncallback', entries);\n                if (typeof entries === 'object') {\n                    this.updateContent(entries);\n                    // this.getMyRank();\n                } else if (typeof entries === 'string') {\n                    if (entries == 'success') {\n                        this.cleanRank();\n                        this.updateWxRank = 1;\n                    } else if (entries == 'failed') {\n                        this.closeThis();\n                        //Global.game.showDialogText('分享失败，必须分享到微信群', {\n                        //    x: 0,\n                        //    y: 20\n                        //});\n                        console.log('查看排行榜，分享到群失败');\n                    } else {\n                        this.cleanRank();\n                        this.updateWxRank = 1;\n                    }\n                }\n            }\n        }, 'Group')\n    },\n\n    getGroupRank: function () {\n        console.log(\"getGroupRank\");\n\n        let EChannelPrefix = require(\"EChannelPrefix\");\n        ThirdAPI.sendChannelPrefix(EChannelPrefix.grouprank);\n        var sprite = this.content.getChildByName('sprite');\n\n        let w = sprite.width; //this.content.width;\n        let h = sprite.height; //this.content.height;\n        let x = this.innerview.x - 0.5 * w;\n        let y = this.innerview.y - 0.5 * h;\n        this.drawRect = {\n            x: x,\n            y: y,\n            width: w,\n            height: h\n        };\n        console.log('draw rect:', this.drawRect);\n\n        ThirdAPI.getRank({\n            rect: this.drawRect,\n            callback: (entries) => {\n                console.log('getGroupRank,oncallback', entries);\n                if (typeof entries === 'object') {\n                    this.updateContent(entries);\n                    // this.getMyRank();\n                } else if (typeof entries === 'string') {\n                    if (entries == 'success') {\n                        this.cleanRank();\n                        this.updateWxRank = 1;\n                    } else if (entries == 'failed') {\n                        /*this.showType = 1;\n                        this.lbl_btn_group.string = '查看群排行';\n                        this.cleanRank();\n                        this.getFriendRank();*/\n                    } else {\n                        this.cleanRank();\n                        this.updateWxRank = 1;\n                    }\n                }\n            }\n        }, 'Group')\n    },\n\n    //从fb上获取排行榜\n    getRank: function () {\n        if (typeof FBInstant === 'undefined') return;\n        var self = this;\n        FBInstant.getLeaderboardAsync('my_allrank')\n            .then(leaderboard => {\n                return leaderboard.getEntriesAsync();\n            })\n            .then(entries => {\n                self.updateContent(entries);\n                self.getMyRank();\n            })\n            .catch(error => {});\n    },\n\n    updateContent: function (entries) {\n        if (!entries) {\n            for (let index = 0; index < this.arrItems.length; index++) {\n                const element = this.arrItems[index];\n                if (element) {\n                    element.active = fasle;\n                }\n            }\n        } else {\n            this.entries = entries;\n            for (let index = 0; index < this.entries.length; index++) {\n                const element = this.arrItems[index];\n                if (element) {\n                    const ent = this.entries[index];\n                    element.getComponent('rankItem').setScore(ent.getScore());\n                    element.getComponent('rankItem').setlevel(ent.getRank());\n                    element.getComponent('rankItem').setNameAndPhoto(ent.getExtraData());\n                    //this.content.addChild(element);\n                }\n            }\n        }\n    },\n\n    updateMyContent: function (entri) {\n        if (parseInt(entri.getRank()) <= 10) {\n            return;\n        }\n\n        let index = this.entries.length;\n        if (index == 10) {\n            index = 9;\n        }\n\n        const element = this.arrItems[index];\n        element.getComponent('rankItem').setScore(entri.getScore());\n        element.getComponent('rankItem').setlevel(entri.getRank());\n        element.getComponent('rankItem').setNameAndPhoto(entri.getExtraData());\n    },\n\n    cleanRank: function () {\n        var sprite = this.content.getChildByName('sprite');\n        sprite.getComponent(cc.Sprite).spriteFrame = null;\n    },\n\n    closeThis: function () {\n        if (this.node.parent) {\n            this.node.parent.removeChild(this.node);\n        }\n    },\n\n    update(dt) {\n        if (this.updateWxRank && this.updateWxRank > 100) {\n\n            console.log('redraw wx rank');\n            this.updateWxRank = 1;\n            let openDataContext = wx.getOpenDataContext();\n            let sharedCanvas = openDataContext.canvas;\n\n            let texture = new cc.Texture2D();\n            texture.initWithElement(sharedCanvas);\n            texture.handleLoadedTexture();\n            let sp = new cc.SpriteFrame(texture);\n            console.log('texture.width :' + texture.width, texture.height + \" :: \" + this.content.width);\n\n            var sprite = this.content.getChildByName('sprite');\n\n            sprite.getComponent(cc.Sprite).type = cc.Sprite.Type.TILED;\n\n            sprite.width = texture.width;\n            sprite.height = texture.height - 90;\n            sprite.getComponent(cc.Sprite).spriteFrame = sp;\n\n            this.myrankSpr.spriteFrame = sp;\n            this.myrankSpr.node.height = texture.height;\n\n        } else {\n            this.updateWxRank++;\n        }\n    },\n});"]}
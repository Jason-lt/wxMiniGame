{"version":3,"sources":["../../../../../assets/Scripts/controller/assets/Scripts/controller/gridController.js"],"names":["ThirdAPI","require","cc","Class","extends","Component","properties","handLine1","default","type","Node","handLine2","gridPrefab","Prefab","pauseNode","chooseNode","test_btnNode","itemPrefab","randomScore","soonGridNum","soonGridInstance","startX","startY","allGrids","bornGrid","startTouchPosition","deleteGrids","joinGrids","targetGrid","line","Sprite","goldNode","prop","nodesGroup","clearPropBtn","clearLabel","Label","clearAdd","superPropBtn","superLabel","superAdd","doublePropBtn","doubleLabel","doubleAdd","layoutNode","fitOffsetY","propClearTime","score","downGrids","scoreScript","isClickBomming","clickGridNum","createItemIndex","moveItemIndex","startTime","addTimes","usePropTimes","useSuperTimes","useDoubleTimes","useProp","popDialogTimes","onLoad","isFitIphoneX","winSize","width","height","setPosition","getComponent","Widget","top","console","log","initGridData","allWidth","Global","hNum","itemSize","itemSplit","allHeight","vNum","screenWidth","setHandWidthAndHeight","reset","wxBannerAd","createBannerAd","createAllGrid","setTouchControl","process","updateGold","setLine","active","prop1Get","prop2Get","prop3Get","canTest","label","getChildByName","string","testEnabled","canvas","find","node","linePosY","p","lineHight","director","getWinSize","down","checkGridJoin","isDown","hIndex","vIndex","resetItemAction","curState","self","downNum","index","length","element","gridJoin","runAction","sequence","delayTime","callFunc","clearAllJoin","canJoin","gridScript","findDownNum","startBianli","combineTimes","checkJoin","hightBornGrid","bornXgridNum","item","gameOver","createItem","isFind","actionJoin","joinComplete","isJoin","myUtil","randomForArray","gridRandomScores","showChooseNum","createItem2","usePropStatus","instantiate","getPosition","x","y","initData","updateNumForProp","useClear","useDouble","addChild","downSpeed","gridDownSpeed","getStopPosition","targetView","startDownForBorn","setSoonGrid","randomScores","concat","joinRandomScores","parent","useClearProp","gameinfo","clearPropNum","game","showPropDialog","parma","randomPropInfo","limitForGame","showDialogPropText","setPropSprite","updateNum","saveFriendGenStoneInfo","useSuperProp","superPropNum","useDoubleProp","doublePropNum","propFly","propPrefab","LoadAtlas","clearParma","spriteFrame","getSpriteFrameFromName","superParma","doubleParma","btn_node","closeListen","off","EventType","TOUCH_START","nodeStart","TOUCH_MOVE","nodeMove","createGrid","posX","posY","gridItem","setLocalZOrder","gridView","setIndex","itemClick","event","clickGrid","getUserData","stopAllActions","scale1","scaleTo","scaleTime","clearItemToRemove","currHindex","currVindex","downtime","wxGold","costGold","wx","data","loadLocalScore","parseInt","maxscore","gold","loadScore","saveScore","goldLabel","clickProp","resetProp","scaleBy","scale2","repeat","xBorn","yBorn","addIndex","on","getLocation","moveStartX","Math","ceil","abs","canMove","isPaused","moveTemp","dist","downDist","xPadding","round","moveThreshold","isUpOrDown","moveDownThreshold","canMoveGrid","isTouchDown","canMoveQuickDown","priView","maxDownTime","startQuickDownForBorn","gridQuickDownSpeed","changeStateToWaitDown","hindex","_hIndex","_vIndex","endx","soonMoveGrid","vindex","isClearGrid","gridviewScript","_curitem","gridCombineDownSpeed","curtime","gridNum","push","onPauseOrResume","playSound","resumeAllActions","pauseAllActions","onPauseGameForOther","hideChooseNum","onRestart","removeChild","restart","onMainScene","startGame","resume","onShareGame","FBInstant","shareGame","getImgBase64","goldNum","addGold","undefined","reviveShareTimes","loadReviveData","reviveTimes","reviveTotalTimes","showRevive","reviveUI","setScore","scoreNum","showShareUI","shareUI","updateMaxLabel","clearGridForRevive","grid","time","clearVNum","itemViewScript","clearTime","toRevive","flyNumPools","finished","update","unixTime","Date","getTime","accessTime","waitToDown","destroyBannerAd","toRemove","randomForWeight","weightScores"],"mappings":"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","file":"gridController.js","sourceRoot":"../../../../../assets/Scripts/controller","sourcesContent":["let ThirdAPI = require('../common/ThirdAPI')\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        handLine1: {\n            default: null,\n            type: cc.Node,\n        },\n        handLine2: {\n            default: null,\n            type: cc.Node,\n        },\n        gridPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        pauseNode: {\n            default: null,\n            type: cc.Node\n        },\n        chooseNode: {\n            default: null,\n            type: cc.Node\n        },\n        test_btnNode: {\n            default: null,\n            type: cc.Node\n        },\n\n        //格子内的item\n        itemPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n\n        //右上角显示即将下落的格子分数\n        randomScore: 0,\n        //即将出现的格子\n        soonGridNum: {\n            default: null,\n            type: cc.Prefab,\n        },\n        soonGridInstance: null,\n\n        startX: 0,\n        startY: 0,\n        //所有格子节点坐标\n        allGrids: [],\n        //出生的格子\n        bornGrid: null,\n        //开始触摸的位置坐标\n        startTouchPosition: null,\n\n        //将要合并的数组\n        deleteGrids: [],\n        joinGrids: [],\n        //目标的格子\n        targetGrid: {\n            default: null,\n            type: cc.Node\n        },\n\n        line: {\n            default: null,\n            type: cc.Sprite,\n        },\n        //金币节点\n        goldNode: {\n            default: null,\n            type: cc.Node\n        },\n        prop: {\n            default: null,\n            type: cc.Node\n        },\n        nodesGroup: {\n            default: null,\n            type: cc.Node,\n        },\n        //清除道具\n        clearPropBtn: {\n            default: null,\n            type: cc.Sprite,\n        },\n        clearLabel: {\n            default: null,\n            type: cc.Label,\n        },\n        clearAdd: {\n            default: null,\n            type: cc.Node,\n        },\n        //万能道具\n        superPropBtn: {\n            default: null,\n            type: cc.Sprite,\n        },\n        superLabel: {\n            default: null,\n            type: cc.Label,\n        },\n        superAdd: {\n            default: null,\n            type: cc.Node,\n        },\n        //双倍道具\n        doublePropBtn: {\n            default: null,\n            type: cc.Sprite,\n        },\n        doubleLabel: {\n            default: null,\n            type: cc.Label,\n        },\n        doubleAdd: {\n            default: null,\n            type: cc.Node,\n        },\n        layoutNode: {\n            default: null,\n            type: cc.Node,\n        },\n        fitOffsetY: 0,\n        propClearTime: 0, //使用道具消除点击格子的动画时间\n\n        //分数\n        score: {\n            default: null,\n            type: cc.Node,\n        },\n        //可下落格子\n        downGrids: [],\n\n        scoreScript: null,\n        isClickBomming: false,\n        clickGridNum: 0, //消除格子数量\n        createItemIndex: 0,\n        moveItemIndex: 0,\n\n        startTime: 0, //开始时间\n        addTimes: 0, //加速次数\n\n        usePropTimes: 0, //使用清除道具次数\n        useSuperTimes: 0, //使用万能道具的次数\n        useDoubleTimes: 0, //使用万能道具的次数\n        useProp: -1, //使用道具，生产下一个生效\n\n        //弹出道具分享的次数\n        popDialogTimes: 0,\n    },\n\n    onLoad: function () {\n        // 适配\n        var isFitIphoneX = cc.winSize.width / cc.winSize.height <= 0.56;\n\n        this.fitOffsetY = 0;\n        if (isFitIphoneX) {\n            this.fitOffsetY = 40;\n            this.nodesGroup.setPosition(0, -this.fitOffsetY);\n            this.nodesGroup.getComponent(cc.Widget).top = this.fitOffsetY;\n            console.log('widght:', this.fitOffsetY);\n            //this.layoutNode.getPosition().y += 30;\n            //this.layoutNode.getComponent(cc.Widget).top += 30;\n        }\n    },\n\n    initGridData: function () {\n        // 适配\n        var isFitIphoneX = cc.winSize.width / cc.winSize.height <= 0.56;\n\n        this.fitOffsetY = 0;\n        if (isFitIphoneX) {\n            this.fitOffsetY = 40;\n            // this.nodesGroup.setPosition(0, -this.fitOffsetY);\n            // this.nodesGroup.getComponent(cc.Widget).top = this.fitOffsetY;\n            console.log('widght:', this.fitOffsetY);\n        }\n\n        //设置位置坐标\n        var allWidth = Global.hNum * Global.itemSize + (Global.hNum - 1) * Global.itemSplit;\n        var allHeight = Global.vNum * Global.itemSize + (Global.vNum - 1) * Global.itemSplit;\n\n        this.startX = -(Global.screenWidth / 2) + (Global.screenWidth - allWidth) / 2 + Global.itemSize / 2;\n        this.startY = 360 - 70 - this.fitOffsetY; //-(Global.screenHeight / 2) + Global.paddingButtom + allHeight - Global.itemSize + 30 - this.fitOffsetY;\n\n        this.scoreScript = this.score.getComponent(\"score\");\n\n        //设置适配背景\n        this.setHandWidthAndHeight();\n\n        //重置所有数据\n        this.reset();\n\n        var wxBannerAd = require('wxBannerAd');\n        wxBannerAd.createBannerAd();\n        //初始化棋盘\n        this.createAllGrid();\n        //添加触摸侦听\n        this.setTouchControl();\n        //开始处理业务逻辑\n        this.process();\n        //显示星星\n        this.updateGold();\n\n        this.setLine(allWidth, allHeight);\n        this.pauseNode.active = false;\n        this.chooseNode.active = false;\n\n        Global.prop1Get = false;\n        Global.prop2Get = false;\n        Global.prop3Get = false;\n\n        this.test_btnNode.active = Global.canTest;\n        if (Global.canTest) {\n            var label = this.test_btnNode.getChildByName('Label');\n            label.getComponent(cc.Label).string = '测试 ' + (Global.testEnabled ? '开' : '关');\n        }\n    },\n\n    //设置头部图片的适配宽高\n    setHandWidthAndHeight: function () {\n        let canvas = cc.find('Canvas');\n        this.handLine1.width = canvas.width * 0.5;\n        this.handLine2.width = canvas.width * 0.5;\n    },\n\n    //设置线的位置和大小\n    setLine: function (width, height) {\n        this.line.node.width = width + 20;\n        this.line.node.height = height + 20;\n        var linePosY = height / 2 - this.startY - Global.itemSize / 2;\n        this.line.node.setPosition(cc.p(0, -linePosY));\n\n        //Global.lineHight = 0 - 430 - this.fitOffsetY - Global.itemSize / 2 - height;\n        Global.lineHight = this.line.node.height;\n\n        //Global.lineHight = this.line.node.height;\n        Global.linePosY = -linePosY;\n        console.log('line:', -linePosY, this.line.node.height, cc.winSize.width, cc.winSize.height, cc.director.getWinSize());\n    },\n\n    process: function () {\n        //1.格子下落\n        this.down();\n        //格子合并\n        this.checkGridJoin();\n    },\n\n    //下落\n    down: function () {\n        this.isDown = false;\n        this.downGrids = [];\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                if (this.resetItemAction(hIndex, vIndex, false)) {\n                    this.isDown = true;\n                }\n            }\n        }\n\n        if (this.bornGrid && this.bornGrid.getComponent('itemView').curState > 0) {\n            this.isDown = true;\n        }\n    },\n\n    checkGridJoin: function () {\n        let self = this;\n        let downNum = 0;\n        // for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n        //     for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n        //         var gridScript = self.allGrids[hIndex][vIndex].getComponent('gridView');\n        //         if (gridScript.item && gridScript.item.getComponent('itemView').curState > 0) {\n        //             downNum++;\n        //         }\n        //     }\n        // }\n        for (let index = 0; index < this.downGrids.length; index++) {\n            const element = this.downGrids[index];\n            if (element.curState > 0) {\n                downNum++;\n            }\n        }\n        if (this.bornGrid != null && this.bornGrid.getComponent('itemView').curState > 0) {\n            downNum++;\n        }\n        if ((this.bornGrid == null || this.bornGrid.getComponent('itemView').curState == 0) && downNum == 0) {\n            this.gridJoin();\n        } else {\n            this.node.runAction(cc.sequence(cc.delayTime(0.5), cc.callFunc(function () {\n                self.checkGridJoin();\n            })));\n        }\n\n        //this.gridJoin();\n    },\n\n    gridJoin: function () {\n        var self = this;\n        //2.格子合并\n        //self.bornGrid = null;\n\n        //是否有被删除的格子\n        if (self.clickGridNum > 0) {\n            self.process();\n            self.clickGridNum = 0;\n            return;\n        }\n\n        self.clearAllJoin();\n\n        let canJoin = false;\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                var gridScript = self.allGrids[hIndex][vIndex].getComponent('gridView');\n                if (!self.findDownNum() || (self.findDownNum() && gridScript.isDown)) {\n                    //执行合并\n                    if (gridScript.startBianli()) {\n                        canJoin = true;\n                    }\n                }\n            }\n        }\n\n        if (canJoin) {\n            Global.combineTimes++;\n            console.log('要开始合并啦,combineTimes:' + Global.combineTimes);\n            this.checkJoin();\n        } else {\n            var hightBornGrid = self.allGrids[Global.bornXgridNum][0];\n            if (hightBornGrid.getComponent('gridView').item != null && !self.isDown) {\n                //gameover\n                let self = this;\n                self.node.runAction(cc.sequence(cc.delayTime(0.5), cc.callFunc(function () {\n                    self.gameOver();\n                })));\n                return;\n            }\n            if (!self.isDown) {\n                Global.combineTimes = 0;\n                self.bornGrid = null;\n                self.createItem();\n            } else {\n                self.process();\n            }\n        }\n    },\n\n    //合并判断\n    checkJoin: function () {\n        let self = this;\n        self.node.runAction(cc.sequence(cc.delayTime(0.1), cc.callFunc(function () {\n            let isFind = false;\n            for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n                for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                    var gridScript = self.allGrids[hIndex][vIndex].getComponent('gridView');\n                    if (gridScript.actionJoin) {\n                        isFind = true;\n                        break;\n                    }\n                }\n            }\n            if (!isFind) {\n                self.joinComplete();\n            } else {\n                self.checkJoin();\n            }\n        })));\n\n    },\n\n    joinComplete: function () {\n        let self = this;\n        //最高点合并之后重新生产\n        var hightBornGrid = self.allGrids[Global.bornXgridNum][0];\n        if (hightBornGrid.getComponent('gridView').item != null) {\n            //因为在最开始创建的时候下方有物体，所以不能isDown，合并完之后需要重设isDown，\n            //再继续判断是否可以合并，如果没有则再生产一个item，\n            self.isDown = true;\n        }\n        self.gridJoin();\n    },\n\n    findDownNum: function () {\n        var self = this;\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                var gridScript = self.allGrids[hIndex][vIndex].getComponent('gridView');\n                if (gridScript.isDown) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    },\n\n    //清除所有的可合并变量\n    clearAllJoin: function () {\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                var gridScript = this.allGrids[hIndex][vIndex].getComponent('gridView');\n                gridScript.isJoin = false;\n            }\n        }\n    },\n\n    //生产下落的item\n    createItem: function () {\n        var myUtil = require(\"myUtil\");\n        if (this.randomScore == 0) {\n            this.randomScore = myUtil.randomForArray(Global.gridRandomScores);\n        }\n\n        if (Global.testEnabled) {\n            this.showChooseNum();\n        } else {\n            this.createItem2();\n        }\n\n        /*\n                //出生的目标点\n                item.setPosition(cc.p(this.allGrids[Global.bornXgridNum][0].getPosition().x, this.allGrids[Global.bornXgridNum][0].getPosition().y + Global.itemSize));\n                //hightBornGrid.getComponent('gridView').gridNum = this.randomScore;\n                item.getComponent('itemView').initData(this.randomScore, false);\n                this.node.addChild(item);\n\n                this.bornGrid = item;\n\n                var downSpeed = Global.gridDownSpeed;\n                var downNum = this.getStopPosition(Global.bornXgridNum, 0);\n                var targetView = this.allGrids[Global.bornXgridNum][downNum];\n\n                this.bornGrid.getComponent('itemView').targetGrid = targetView;\n\n                item.getComponent('itemView').startDownForBorn(downSpeed);\n\n                this.setSoonGrid();\n                this.process();\n                this.createItemIndex++;*/\n    },\n\n    createItem2: function () {\n        if (this.useProp != -1) {\n            console.log('生产道具', this.useProp);\n            Global.usePropStatus = this.useProp;\n        } else {\n            Global.usePropStatus = -1;\n        }\n        this.useProp = -1;\n\n        let item = cc.instantiate(this.itemPrefab);\n        //出生的目标点\n        item.setPosition(cc.p(this.allGrids[Global.bornXgridNum][0].getPosition().x, this.allGrids[Global.bornXgridNum][0].getPosition().y + Global.itemSize));\n        //hightBornGrid.getComponent('gridView').gridNum = this.randomScore;\n\n        item.getComponent('itemView').initData(this.randomScore, false);\n        item.getComponent('itemView').updateNumForProp();\n        if (Global.usePropStatus == 0) {\n            console.log('锤子道具');\n            item.getComponent('itemView').useClear = true;\n        } else if (Global.usePropStatus == 2) {\n            console.log('设置双倍标识');\n            item.getComponent('itemView').useDouble = true;\n        }\n        this.node.addChild(item);\n\n        this.bornGrid = item;\n\n        var downSpeed = Global.gridDownSpeed;\n        var downNum = this.getStopPosition(Global.bornXgridNum, 0);\n        var targetView = this.allGrids[Global.bornXgridNum][downNum];\n\n        this.bornGrid.getComponent('itemView').targetGrid = targetView;\n\n        item.getComponent('itemView').startDownForBorn(downSpeed);\n\n        this.setSoonGrid();\n        this.process();\n        this.createItemIndex++;\n    },\n\n    //设置即将下落的格子分数\n    setSoonGrid: function () {\n        var myUtil = require(\"myUtil\");\n        var randomScores = Global.gridRandomScores.concat(Global.joinRandomScores);\n        this.randomScore = myUtil.randomForArray(randomScores);\n        if (!this.soonGridInstance || (this.soonGridInstance && !this.soonGridInstance.parent)) {\n            this.soonGridInstance = cc.instantiate(this.soonGridNum);\n            this.node.addChild(this.soonGridInstance);\n        }\n        this.soonGridInstance.setPosition(0, 400 - this.fitOffsetY);\n        this.soonGridInstance.getComponent(\"itemView\").initData(this.randomScore, true);\n    },\n\n    useClearProp: function () {\n        //使用清除道具\n        if (Global.gameinfo.clearPropNum <= 0) {\n            console.log('调起道具分享界面');\n            Global.game.showPropDialog(3, \"\", 0);\n            return;\n        }\n        var parma = Global.randomPropInfo[0];\n        if (parma && this.usePropTimes >= parma.limitForGame) {\n            Global.game.showDialogPropText('每局只能使用' + parma.limitForGame + '次道具哦');\n            return;\n        }\n        Global.gameinfo.clearPropNum--;\n        this.usePropTimes++;\n        this.useProp = 0;\n        //变灰\n        this.setPropSprite();\n\n        this.soonGridInstance.getComponent(\"itemView\").updateNum(0);\n        ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n    },\n\n    //使用万能道具\n    useSuperProp: function () {\n        console.log('aaa:', Global.usePropStatus, this.useProp);\n\n        if (this.useProp == 1) {\n            Global.game.showDialogPropText('这一次道具使用完才能再次使用！');\n            return;\n        }\n\n        if (Global.gameinfo.superPropNum <= 0) {\n            console.log('调起道具分享界面');\n            Global.game.showPropDialog(3, \"\", 1);\n            return;\n        }\n        var parma = Global.randomPropInfo[1];\n        if (parma && this.useSuperTimes >= parma.limitForGame) {\n            Global.game.showDialogPropText('每局只能使用' + parma.limitForGame + '次道具哦');\n            return;\n        }\n        this.useSuperTimes++;\n        Global.gameinfo.superPropNum--;\n        this.useProp = 1;\n        this.setPropSprite();\n        this.soonGridInstance.getComponent(\"itemView\").updateNum(1);\n        ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n    },\n\n    //使用双倍道具\n    useDoubleProp: function () {\n        Global.game.showDialogPropText('正在努力开发中...');\n        return;\n        //使用清除道具\n        if (Global.gameinfo.doublePropNum <= 0) {\n            Global.game.showPropDialog(3, \"\", 2);\n            Global.game.showDialogPropText('道具用光了！');\n            return;\n        }\n        var parma = Global.randomPropInfo[2];\n        if (parma && this.useDoubleTimes >= parma.limitForGame) {\n            Global.game.showDialogPropText('每局只能使用' + parma.limitForGame + '次道具哦');\n            return;\n        }\n        this.useDoubleTimes++;\n        Global.gameinfo.doublePropNum--;\n        this.useProp = 2;\n        this.setPropSprite();\n        this.soonGridInstance.getComponent(\"itemView\").updateNum(2);\n        ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n    },\n\n    //道具飞入动画(传入道具预设)\n    propFly: function (propPrefab) {\n\n\n\n    },\n\n\n    setPropSprite: function () {\n        var LoadAtlas = require(\"LoadAtlas\");\n        //清除\n        var clearParma = Global.randomPropInfo[0];\n        if (clearParma && this.usePropTimes >= clearParma.limitForGame) {\n            this.clearPropBtn.spriteFrame = LoadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'clear_spr1');\n        } else {\n            this.clearPropBtn.spriteFrame = LoadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'clear_spr');\n        }\n        this.clearLabel.string = '消除锤锤 x' + Global.gameinfo.clearPropNum;\n\n        //万能\n        var superParma = Global.randomPropInfo[1];\n        if (superParma && this.useSuperTimes >= superParma.limitForGame) {\n            this.superPropBtn.spriteFrame = LoadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'super_spr1');\n        } else {\n            this.superPropBtn.spriteFrame = LoadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'super_spr');\n        }\n        this.superLabel.string = '万能方块 x' + Global.gameinfo.superPropNum;\n\n        //双倍\n        var doubleParma = Global.randomPropInfo[2];\n        if (doubleParma && this.useDoubleTimes >= doubleParma.limitForGame) {\n            this.doublePropBtn.spriteFrame = LoadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'double_spr1');\n        } else {\n            this.doublePropBtn.spriteFrame = LoadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'double_spr');\n        }\n        this.doubleLabel.string = '双倍方块';\n\n        this.clearAdd.active = Global.gameinfo.clearPropNum <= 0;\n        this.superAdd.active = Global.gameinfo.superPropNum <= 0;\n        //this.doubleAdd.active = Global.gameinfo.doublePropNum <= 0;\n    },\n\n    //测试开关是否开启\n    testEnabled: function () {\n        Global.testEnabled = !Global.testEnabled;\n        var btn_node = this.node.getChildByName('test_btn');\n        if (btn_node) {\n            var label = btn_node.getChildByName('Label');\n            label.getComponent(cc.Label).string = '测试 ' + (Global.testEnabled ? '开' : '关');\n        }\n    },\n\n    //关闭监听\n    closeListen: function () {\n        //关闭触摸\n        this.node.off(cc.Node.EventType.TOUCH_START, this.nodeStart, this);\n        //关闭移动\n        this.node.off(cc.Node.EventType.TOUCH_MOVE, this.nodeMove, this);\n    },\n\n    createAllGrid: function () {\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                var parma = {\n                    hIndex: hIndex,\n                    vIndex: vIndex,\n                };\n                if (!this.allGrids[hIndex]) {\n                    this.allGrids[hIndex] = [];\n                }\n                this.allGrids[hIndex][vIndex] = this.createGrid(parma);\n            }\n        }\n    },\n\n    //创建格子\n    createGrid: function (parma) {\n        //参数\n        var hIndex = parma.hIndex;\n        var vIndex = parma.vIndex;\n        var posX = this.startX + hIndex * Global.itemSize + hIndex * Global.itemSplit;\n        var posY = this.startY - vIndex * Global.itemSize - vIndex * Global.itemSplit;\n\n        //设置格子的坐标\n        var gridItem = cc.instantiate(this.gridPrefab);\n        gridItem.setPosition(cc.p(posX, posY));\n\n        gridItem.setLocalZOrder(20000);\n\n        //设置索引和位置\n        var gridView = gridItem.getComponent(\"gridView\");\n        gridView.node.setPosition(posX, posY);\n        gridView.setIndex(hIndex, vIndex, this);\n        this.node.addChild(gridItem);\n        return gridItem;\n    },\n\n    itemClick: function (event) {\n        var self = this;\n        if (!self.isClickBomming) {\n            return;\n        }\n        if (this.clickGridNum >= 1) {\n            return;\n        }\n        var clickGrid = event.getUserData();\n        self.clickGrid = clickGrid;\n\n        //道具缩放动画停止\n        this.prop.stopAllActions();\n        var scale1 = cc.scaleTo(0.1, 1, 1);\n        this.prop.runAction(scale1);\n\n        //停止生产下落的格子\n        // if (this.bornGrid) {\n        //     this.bornGrid.pauseAllActions();\n        // }\n        //this.node.stopAllActions();\n\n        //消除格子\n        var scaleTime = this.clickGrid.getComponent('gridView').item.getComponent(\"itemView\").clearItemToRemove();\n        this.clickGrid.getComponent('gridView').item = null;\n        //将上方的格子下落\n        var currHindex = this.clickGrid.getComponent('gridView').hIndex;\n        var currVindex = this.clickGrid.getComponent('gridView').vIndex;\n        for (let vIndex = currVindex - 1; vIndex > 0; vIndex--) {\n            var downtime = this.resetItemAction(currHindex, vIndex, true);\n        }\n\n        this.clickGridNum++;\n        this.isClickBomming = false;\n        //消耗金币\n        Global.wxGold -= Global.costGold;\n        //更新金币并存储\n        if (typeof wx !== 'undefined') {\n            let data = ThirdAPI.loadLocalScore();\n            var score = parseInt(data.maxscore);\n            var gold = parseInt(data.gold);\n            ThirdAPI.loadScore((maxscore, gold) => {\n                score = parseInt(maxscore);\n                gold = parseInt(gold);\n                console.log('gridController on ThirdAPI loadScore', score, parseInt(gold), Global.wxGold);\n            });\n            ThirdAPI.saveScore(score, Global.wxGold);\n        }\n        //更新分数\n        var goldLabel = this.goldNode.getChildByName('label');\n        goldLabel.getComponent(cc.Label).string = Global.wxGold;\n\n\n        //console.log('scaleTime:' + scaleTime);\n        //缩放动画播完后再继续下落合并的逻辑(马上按下暂停这里时间就会出现问题)\n        // this.node.stopAllActions();\n        // this.node.runAction(cc.sequence(cc.delayTime(scaleTime / 1000), cc.callFunc(self.process, self)));\n    },\n\n    //点击道具\n    clickProp: function () {\n        if (Global.wxGold < Global.costGold) {\n            console.log('my costGold is ' + Global.costGold);\n            return;\n        }\n\n        if (this.isClickBomming) {\n            this.resetProp();\n        } else {\n            var scale1 = cc.scaleBy(0.4, 1.1, 1.1);\n            var scale2 = cc.scaleBy(0.4, 1 / 1.1, 1 / 1.1);\n            var repeat = cc.repeat(cc.sequence(scale1, scale2), 99999);\n            this.prop.stopAllActions();\n            this.prop.runAction(repeat);\n            // if (this.bornGrid) {\n            //     this.bornGrid.pauseAllActions();\n            // }\n            // this.node.stopAllActions();\n            this.isClickBomming = true;\n            this.clickGridNum = 0;\n        }\n    },\n\n    resetProp: function () {\n        this.isClickBomming = false;\n        this.prop.stopAllActions();\n        var scale1 = cc.scaleTo(0.1, 1, 1);\n        this.prop.runAction(scale1);\n\n\n        // if (this.bornGrid) {\n        //恢复下落格子的动作，将当前格子的item置为下落格子item\n        // var bornGridhIndex = Math.ceil(Math.abs((this.bornGrid.x - this.startX) / Global.itemSize));\n        // var bornGridvIndex = Math.ceil(Math.abs((this.bornGrid.y - this.startY) / Global.itemSize));\n        // this.allGrids[bornGridhIndex][bornGridvIndex].getComponent('gridView').item = this.bornGrid;\n        // this.isClickBomming = false;\n        //this.propClearTime = 0;\n        // this.process();\n        //     console.log('还可以继续下落');\n        // } else {\n        //     console.log('没有下落的格子');\n        // }\n    },\n\n    //先获取出生点那一列最终的目标点\n    getStopPosition: function (xBorn, yBorn) {\n        var addIndex = 0;\n        for (let index = Global.vNum - 1; index >= 0; index--) {\n            var node = this.allGrids[xBorn][index];\n            var gridView = node.getComponent(\"gridView\");\n            if (gridView && gridView.item == null && gridView.vIndex > yBorn) {\n                addIndex++;\n            }\n        }\n        return addIndex;\n    },\n\n    //设置鼠标或者手势操作动作\n    setTouchControl: function () {\n        var self = this;\n        if (self.node.parent) {\n            //开始触摸\n            self.node.on(cc.Node.EventType.TOUCH_START, this.nodeStart, this);\n            //触摸移动\n            self.node.on(cc.Node.EventType.TOUCH_MOVE, this.nodeMove, this);\n        }\n    },\n\n    nodeStart: function (event) {\n        this.startTouchPosition = event.getLocation();\n        this.moveItemIndex = this.createItemIndex;\n        this.moveStartX = Math.ceil(Math.abs((this.bornGrid.x - this.startX) / Global.itemSize));\n    },\n\n    nodeMove: function (event) {\n        if (this.moveItemIndex != this.createItemIndex) {\n            return;\n        }\n        var self = this;\n        if (this.bornGrid && this.bornGrid.getComponent('itemView').canMove && !cc.game.isPaused() && !this.isClickBomming) {\n            var moveTemp = event.getLocation();\n            var dist = moveTemp.x - self.startTouchPosition.x;\n            var downDist = moveTemp.y - self.startTouchPosition.y;\n\n            //左右移动\n            var xPadding = Math.round(dist / Global.moveThreshold);\n            var isUpOrDown = Math.abs(downDist) > Global.moveDownThreshold ? true : false;\n\n            //self.startTouchPosition = moveTemp;\n            var targetGrid = self.canMoveGrid(this.moveStartX + xPadding);\n            if (isUpOrDown) {\n                //上下移动\n                var isTouchDown = moveTemp.y <= self.startTouchPosition.y ? true : false;\n                //self.startTouchPosition = moveTemp;\n                var targetGrid = self.canMoveQuickDown(isTouchDown);\n                if (targetGrid) {\n                    this.bornGrid.x = targetGrid.getPosition().x;\n                    var downNum = self.getStopPosition(targetGrid.getComponent('gridView').hIndex, targetGrid.getComponent('gridView').vIndex);\n                    var targetView = self.allGrids[targetGrid.getComponent('gridView').hIndex][targetGrid.getComponent('gridView').vIndex + downNum];\n                    var priView = self.allGrids[targetGrid.getComponent('gridView').hIndex][targetGrid.getComponent('gridView').vIndex];\n                    priView.getComponent('gridView').isDown = false;\n                    targetView.getComponent('gridView').isDown = true;\n\n                    this.bornGrid.getComponent('itemView').targetGrid = targetView;\n                    //快速开始进行从出生点到最终位置的动作\n                    cc.log('quick down:' + downNum);\n                    if (this.bornGrid.getComponent('itemView').curState == 2 || this.bornGrid.getComponent('itemView').curState == 1) {\n                        self.maxDownTime = this.bornGrid.getComponent('itemView').startQuickDownForBorn(Global.gridQuickDownSpeed);\n                    }\n                    self.node.stopAllActions();\n                    self.checkGridJoin();\n                }\n            } else if (targetGrid) {\n                this.bornGrid.x = targetGrid.getPosition().x;\n                cc.log('change bornGridx:' + this.bornGrid.x);\n                var downNum = self.getStopPosition(targetGrid.getComponent('gridView').hIndex, targetGrid.getComponent('gridView').vIndex);\n                var targetView = self.allGrids[targetGrid.getComponent('gridView').hIndex][targetGrid.getComponent('gridView').vIndex + downNum];\n                var priView = self.allGrids[targetGrid.getComponent('gridView').hIndex][targetGrid.getComponent('gridView').vIndex];\n                priView.getComponent('gridView').isDown = false;\n                targetView.getComponent('gridView').isDown = true;\n\n                this.bornGrid.getComponent('itemView').targetGrid = targetView;\n                this.bornGrid.getComponent('itemView').changeStateToWaitDown(Global.gridDownSpeed);\n                self.node.stopAllActions();\n                self.checkGridJoin();\n            }\n        }\n    },\n\n    /*是否可左右移动 */\n    canMoveGrid: function (hindex) {\n        //横、纵坐标的索引,向下取整\n        var _hIndex = Math.ceil(Math.abs((this.bornGrid.x - this.startX) / Global.itemSize));\n        var _vIndex = Math.ceil(Math.abs((this.bornGrid.y - this.startY) / Global.itemSize));\n\n        if (hindex == _hIndex) {\n            return null;\n        }\n\n        if (hindex < 0 || hindex >= Global.hNum) {\n            return null;\n        }\n        //即将移动到的gird位置\b\n        //中间元素是否可以移动\n        let startX = hindex + 1;\n        let endx = _hIndex - 1;\n        if (hindex > _hIndex) {\n            startX = _hIndex + 1;\n            endx = hindex - 1;\n        }\n        while (startX <= endx) {\n            var soonMoveGrid = this.allGrids[startX][_vIndex];\n            if (soonMoveGrid && soonMoveGrid.getComponent(\"gridView\").item == null) {\n                startX++;\n                continue;\n            }\n            return null;\n        }\n        var soonMoveGrid = this.allGrids[hindex][_vIndex];\n\n        if (soonMoveGrid && soonMoveGrid.getComponent(\"gridView\").item == null) {\n            return soonMoveGrid;\n        }\n        return null;\n    },\n\n    /*是否可以向下移动 */\n    canMoveQuickDown: function (isTouchDown) {\n        //横、纵坐标的索引,向上取整\n        var hIndex = Math.ceil(Math.abs((this.bornGrid.x - this.startX) / Global.itemSize));\n        var vIndex = Math.ceil(Math.abs((this.bornGrid.y - this.startY) / Global.itemSize));\n\n        if (!isTouchDown) {\n            return null;\n        }\n        if (vIndex >= (Global.vNum - 1)) {\n            return null;\n        }\n\n        var soonMoveGrid = this.allGrids[hIndex][vIndex + 1];\n        if (soonMoveGrid && soonMoveGrid.getComponent(\"gridView\").item == null) {\n            return soonMoveGrid;\n        }\n        return null;\n    },\n\n    //重设动作目标\n    resetItemAction: function (hindex, vindex, isClearGrid) {\n        var gridviewScript = this.allGrids[hindex][vindex].getComponent('gridView');\n        if (gridviewScript.item == null) {\n            return false;\n        }\n        var downNum;\n        if (isClearGrid) {\n            downNum = 1;\n        } else {\n            downNum = this.getStopPosition(hindex, vindex);\n        }\n        //设置索引\n        if (downNum == 0) {\n            return false;\n        }\n\n        var targetView = this.allGrids[hindex][vindex + downNum];\n        targetView.getComponent('gridView').isDown = true;\n        var _curitem = gridviewScript.item.getComponent('itemView');\n        _curitem.targetGrid = targetView;\n\n        var downSpeed = (this.isDown || Global.combineTimes > 0) ? Global.gridCombineDownSpeed : Global.gridDownSpeed;\n        console.log('速度：' + downSpeed, Global.combineTimes);\n        var curtime = _curitem.startDownForBorn(downSpeed);\n\n        gridviewScript.item = null;\n        //targetView.getComponent('gridView').item = _curitem;\n        gridviewScript.gridNum = 0;\n        //加入下落格子数组\n        this.downGrids.push(_curitem);\n\n        return true;\n    },\n\n    //暂停游戏\n    onPauseOrResume: function () {\n        Global.game.playSound('btn', 0.1);\n        if (Global.isPaused) {\n            if (this.bornGrid) {\n                this.bornGrid.resumeAllActions();\n            }\n            this.node.resumeAllActions();\n            this.pauseNode.active = false;\n            Global.isPaused = false;\n        } else {\n            if (this.isClickBomming) {\n                this.resetProp();\n            }\n            if (this.bornGrid) {\n                this.bornGrid.pauseAllActions();\n            }\n            this.node.pauseAllActions();\n\n            Global.isPaused = true;\n            this.pauseNode.active = true;\n            this.pauseNode.setLocalZOrder(10);\n        }\n    },\n\n    //游戏其他功能需要暂停游戏\n    onPauseGameForOther: function () {\n        if (Global.isPaused) {\n            if (this.bornGrid) {\n                this.bornGrid.resumeAllActions();\n            }\n            this.node.resumeAllActions();\n            Global.isPaused = false;\n        } else {\n            if (this.isClickBomming) {\n                this.resetProp();\n            }\n            if (this.bornGrid) {\n                this.bornGrid.pauseAllActions();\n            }\n            this.node.pauseAllActions();\n\n            Global.isPaused = true;\n        }\n    },\n\n    //显示数字选择\n    showChooseNum: function () {\n        Global.game.playSound('btn', 0.1);\n        this.chooseNode.active = true;\n        this.chooseNode.setLocalZOrder(1);\n        if (this.bornGrid) {\n            this.bornGrid.pauseAllActions();\n        }\n        this.node.pauseAllActions();\n    },\n\n    //隐藏数字选择\n    hideChooseNum: function () {\n        Global.game.playSound('btn', 0.1);\n        this.chooseNode.active = false;\n        if (this.bornGrid) {\n            this.bornGrid.resumeAllActions();\n        }\n        this.node.resumeAllActions();\n    },\n\n    //重新开始\n    onRestart: function () {\n        Global.game.playSound('btn', 0.1);\n        this.closeListen();\n        this.reset();\n\n        if (this.bornGrid && this.bornGrid.parent) {\n            this.bornGrid.parent.removeChild(this.bornGrid);\n        }\n        Global.game.restart();\n    },\n\n    //返回主界面\n    onMainScene: function () {\n        Global.game.playSound('btn', 0.1);\n        this.closeListen();\n        this.reset();\n\n        if (this.bornGrid && this.bornGrid.parent) {\n            this.bornGrid.parent.removeChild(this.bornGrid);\n        }\n        Global.game.startGame();\n        //返回主界面的时间如果是暂停状态那就恢复游戏\n        if (cc.game.isPaused()) {\n            cc.game.resume();\n        }\n    },\n\n    //分享\n    onShareGame: function () {\n        Global.game.playSound('btn', 0.1);\n        if (typeof FBInstant !== 'undefined') {\n            ThirdAPI.shareGame(this.getImgBase64(), null);\n        } else {\n            ThirdAPI.shareGame('screenshotForDown', null, null, '003');\n        }\n    },\n\n    //更新星星的数量\n    updateGold: function (goldNum) {\n        var goldLabel = this.goldNode.getChildByName('label');\n        goldLabel.getComponent(cc.Label).string = Global.wxGold;\n        //判断是否可以存储和飞入\n        if (Global.addGold[goldNum] === undefined) {\n            cc.log('update gold ');\n            return;\n        }\n        if (parseInt(Global.addGold[goldNum]) <= 0) {\n            return;\n        }\n        Global.wxGold += parseInt(Global.addGold[goldNum]);\n        console.log('1 :' + Global.addGold[goldNum] + \"goldNum :\" + goldNum);\n        //更新并存储\n        if (typeof wx !== 'undefined') {\n            let data = ThirdAPI.loadLocalScore();\n            var score = parseInt(data.maxscore);\n            var gold = parseInt(data.gold);\n            ThirdAPI.loadScore((maxscore, gold) => {\n                score = parseInt(maxscore);\n                gold = parseInt(gold);\n                console.log('gridController on ThirdAPI loadScore', score, parseInt(gold), Global.wxGold);\n            });\n            ThirdAPI.saveScore(score, Global.wxGold);\n        }\n\n        var goldLabel = this.goldNode.getChildByName('label');\n        goldLabel.getComponent(cc.Label).string = Global.wxGold;\n    },\n\n    //游戏结束\n    gameOver: function () {\n        this.node.stopAllActions();\n        this.closeListen();\n\n        //获取复活次数\n        Global.reviveShareTimes = ThirdAPI.loadReviveData();\n\n        //判断当局的次数和当天的复活次数\n        if (Global.reviveTimes < Global.reviveTotalTimes && Global.reviveShareTimes > 0) {\n            Global.game.showRevive();\n            Global.reviveUI.setScore(this.scoreScript.scoreNum);\n        } else {\n            Global.game.showShareUI();\n            Global.shareUI.updateMaxLabel(this.scoreScript.scoreNum);\n        }\n    },\n\n    //复活消除几行\n    clearGridForRevive: function () {\n        this.node.stopAllActions();\n\n        //暂停所有的格子动作\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                var grid = this.allGrids[hIndex][vIndex];\n                var gridView = grid.getComponent(\"gridView\");\n                if (gridView && gridView.item != null) {\n                    gridView.node.stopAllActions();\n                    gridView.item.getComponent(\"itemView\").node.stopAllActions();\n                }\n            }\n        }\n\n        //开始销毁 \n        var time = 0;\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.clearVNum; vIndex++) {\n                var grid = this.allGrids[hIndex][vIndex];\n                var gridView = grid.getComponent(\"gridView\");\n                if (gridView && gridView.item != null) {\n                    var itemViewScript = gridView.item.getComponent(\"itemView\");\n                    var clearTime = itemViewScript.toRevive();\n                    if (clearTime > time) {\n                        time = clearTime;\n                    }\n                    gridView.gridNum = 0;\n                    gridView.item = null;\n                }\n            }\n        }\n\n        this.clearAllJoin();\n\n        //销毁所有数字\n        for (let index = 0; index < Global.flyNumPools.length; index++) {\n            const element = Global.flyNumPools[index];\n            if (element && element.parent) {\n                element.getComponent('flynum').finished();\n            }\n        }\n\n        //添加触摸侦听\n        console.log('clear time:' + time);\n        var self = this;\n        self.node.runAction(cc.sequence(cc.delayTime(time + 0.1), cc.callFunc(function () {\n            if (self.bornGrid) {\n                self.bornGrid.stopAllActions();\n                if (self.bornGrid.parent) {\n                    self.bornGrid.parent.removeChild(self.bornGrid);\n                }\n            }\n            self.bornGrid = null;\n\n            //重置所有数据\n            //self.reset();\n            //初始化棋盘\n            //self.createAllGrid();\n            //添加触摸侦听\n            self.setTouchControl();\n            //开始处理业务逻辑\n            self.process();\n        })));\n    },\n    //时间判断加速\n    update: function () {\n        var unixTime = (new Date()).getTime();\n        if (unixTime > (this.startTime + Global.accessTime) && this.addTimes < Global.addTimes) {\n            this.addTimes++;\n            this.startTime = (new Date()).getTime();\n\n            Global.gridDownSpeed *= 1.2;\n            Global.gridDownSpeed = parseInt(Global.gridDownSpeed * 100) / 100;\n            Global.waitToDown *= 0.8;\n            Global.waitToDown = parseInt(Global.waitToDown * 100) / 100;\n            console.log('加速', Global.gridDownSpeed, Global.waitToDown);\n        }\n    },\n\n    //重置\n    reset: function () {\n        var wxBannerAd = require('wxBannerAd');\n        wxBannerAd.destroyBannerAd();\n\n        this.node.stopAllActions();\n        this.popDialogTimes = 0;\n        //初始时间\n        this.startTime = (new Date()).getTime();\n        this.usePropTimes = 0;\n        this.useSuperTimes = 0;\n        this.useDoubleTimes = 0;\n        this.useProp = -1;\n        this.setPropSprite();\n        Global.usePropStatus = -1;\n        this.addTimes = 0;\n        Global.reviveTimes = 0;\n        Global.combineTimes = 0;\n        Global.testEnabled = false;\n        this.randomScore = 0;\n        Global.joinRandomScores = [];\n        Global.isPaused = false;\n        this.isClickBomming = false;\n        this.propClearTime = 0;\n        this.clickGridNum = 0;\n        this.createItemIndex = 0;\n        this.moveItemIndex = 0;\n        //销毁所有数字\n        for (let index = 0; index < Global.flyNumPools.length; index++) {\n            const element = Global.flyNumPools[index];\n            if (element && element.parent) {\n                element.getComponent('flynum').finished();\n            }\n        }\n\n        if (this.bornGrid) {\n            this.bornGrid.stopAllActions();\n            if (this.bornGrid.parent) {\n                this.bornGrid.parent.removeChild(this.bornGrid);\n            }\n        }\n        //销毁所有格子\n        if (this.allGrids.length > 0) {\n            for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n                for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                    var grid = this.allGrids[hIndex][vIndex];\n                    var gridView = grid.getComponent(\"gridView\");\n                    grid.stopAllActions();\n                    if (gridView && gridView.item != null) {\n                        gridView.item.getComponent(\"itemView\").toRemove();\n                    }\n\n                    //销毁grid\n                    if (grid.parent) {\n                        grid.parent.removeChild(grid);\n                    }\n                }\n            }\n            this.clearAllJoin();\n        }\n        this.allGrids = [];\n        this.scoreScript.reset();\n        this.bornGrid = null;\n        if (this.soonGridInstance && this.soonGridInstance.parent) {\n            this.soonGridInstance.parent.removeChild(this.soonGridInstance);\n        }\n        //重新根据权重生成数字\n        var myUtil = require('myUtil');\n        myUtil.randomForWeight(Global.weightScores);\n        console.log('重设掉落概率1');\n    },\n});"]}
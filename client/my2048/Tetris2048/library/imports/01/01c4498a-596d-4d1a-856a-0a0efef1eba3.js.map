{"version":3,"sources":["../../../../../assets/Scripts/view/assets/Scripts/view/itemView.js"],"names":["ThirdAPI","require","cc","Class","extends","Component","properties","itemSprite","default","type","Sprite","itemNum","Prefab","downAudio","url","AudioClip","num1","num2","num3","num4","num5","numPrefab","goldPrefab","explosionPrefab","isSoonItem","bornNum","targetGrid","numInstance","goldInstance","curState","canMove","useDouble","useClear","initData","randomIndex","setSpriteFrame","updateColor","updateNum","updateNumForProp","Global","usePropStatus","changeStateToWaitDown","speed","log","startDownForBorn","gridController","getComponent","bornGrid","node","stopAllActions","forjoinaction","self","runAction","sequence","delayTime","waitToDown","callFunc","canDown","nodePos","getPosition","targetPos","cury","y","dist","pDistance","canDownNum","Math","floor","itemSize","hdx","hIndex","vdx","vIndex","firstCurH","allGrids","curH","element1","callback","callBackForJoin","actions","t","length","actiond","gridDownDelayTime","push","playTime","abs","action","moveTo","console","stopAction","myAction","startQuickDownForBorn","toRemove","parent","removeChild","targetOff","toRevive","finished","blink","getDuration","clearItemToRemove","spawnAction","spawn","rotateBy","scaleTo","propClear","scaleAction1","scaleAction2","setVisible","LoadAtlas","scaleX","scaleY","spriteFrame","getSpriteFrameFromName","skinIndex","tho","parseInt","hun","ten","uni","getSpriteNum","x","allWidth","width","spr","num","string","getRect","height","loadAtlasRes","soonItemSize","dtime","forJoin","toJoin","pos","combineTime","action1","gridDownSpeed","gridControllerScript","idx","downGrids","indexOf","splice","targetScript","checkGrid","buttonItem","item","buttonItemViewScript","deleteGridScript","deleteItem","shakeShort","gridNum","resetData","playDownAudio","setPosition","p","on","itemClick","Node","EventType","TOUCH_START","touchStart","evtObj","Event","EventCustom","setUserData","dispatchEvent","isBGMPlaying","combineID","audioEngine","play","setFinishCallback","playAudioEnd","playAudioStart","resume","uncache"],"mappings":"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","file":"itemView.js","sourceRoot":"../../../../../assets/Scripts/view","sourcesContent":["/*\n    1. 从itemcontroller中产生\n    2. 出生点，出生数字\n    3. 受鼠标影响\n    4. 运动停止，回调\n\n*/\nlet ThirdAPI = require('../common/ThirdAPI')\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        //出生item的精灵贴图\n        itemSprite: {\n            default: null,\n            type: cc.Sprite,\n        },\n        //出生的数字\n        itemNum: {\n            default: null,\n            type: cc.Prefab,\n        },\n        //下落声音\n        downAudio: {\n            url: cc.AudioClip,\n            default: null\n        },\n        num1: {\n            default: null,\n            type: cc.Sprite,\n        },\n        num2: {\n            default: null,\n            type: cc.Sprite,\n        },\n        num3: {\n            default: null,\n            type: cc.Sprite,\n        },\n        num4: {\n            default: null,\n            type: cc.Sprite,\n        },\n        num5: {\n            default: null,\n            type: cc.Sprite,\n        },\n        numPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n        goldPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n        explosionPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n\n        isSoonItem: false, //是即将出现的item？\n        bornNum: 0, //出生的随机数\n        targetGrid: null, //目标格子\n        numInstance: null, //飞入分数的实例\n        goldInstance: null, //飞入分数的实例\n        curState: 0, //  1 等待下落   2 下落  3  下落完毕等待合并   4 合并\n        canMove: true,\n\n        useDouble: false, //是否使用双倍道具\n        useClear: false, //是否使用锤子道具\n    },\n\n    initData: function (randomIndex, isSoonItem) {\n        this.isSoonItem = isSoonItem;\n        this.bornNum = randomIndex;\n        this.setSpriteFrame();\n    },\n\n    //根据生产的索引值来设置出生的精灵贴图\n    setSpriteFrame: function () {\n        this.updateColor();\n        this.updateNum(-1);\n    },\n\n    updateNumForProp: function () {\n        this.updateNum(Global.usePropStatus);\n    },\n\n    //等待下落\n    changeStateToWaitDown: function (speed) {\n        cc.log(this.curState);\n        if (this.curState == 1) {\n            return;\n        }\n        if (this.curState == 3) {\n            this.startDownForBorn(speed);\n            return;\n        }\n        if (this.curState > 3) {\n            return;\n        }\n        if (Global.gridController.getComponent('gridController').bornGrid == this.node) {\n            if (this.curState > 0) {\n                this.curState = 1; //等待下落\n                this.node.stopAllActions();\n                this.forjoinaction = null;\n                let self = this;\n                this.node.runAction(cc.sequence(cc.delayTime(Global.waitToDown), cc.callFunc(function () {\n                    self.startDownForBorn(speed);\n                })));\n            }\n        }\n    },\n\n    canDown: function () {\n        var nodePos = this.node.getPosition();\n        var targetPos = this.targetGrid.getPosition();\n\n        var cury = nodePos.y;\n        var dist = cc.pDistance(nodePos, targetPos);\n        var canDownNum = Math.floor(dist / Global.itemSize);\n        var hdx = this.targetGrid.getComponent('gridView').hIndex;\n        var vdx = this.targetGrid.getComponent('gridView').vIndex;\n        var firstCurH = canDownNum <= 1 ? 0 : canDownNum;\n        var gridController = Global.gridController.getComponent(\"gridController\");\n        var allGrids = gridController.allGrids;\n        for (let curH = vdx - firstCurH; curH <= vdx; curH++) {\n            var element1 = allGrids[hdx][curH];\n            if (cury > element1.getPosition().y) {\n                return true;\n            }\n        }\n        return false;\n    },\n\n    //开始进行从出生点到最终位置的动作\n    startDownForBorn: function (speed) {\n        this.curState = 2; //下落\n\n        //this.node.stopAllActions();\n        var nodePos = this.node.getPosition();\n        var targetPos = this.targetGrid.getPosition();\n\n        var dist = cc.pDistance(nodePos, targetPos);\n        var canDownNum = Math.floor(dist / Global.itemSize);\n\n        var callback = cc.callFunc(this.callBackForJoin, this);\n\n        var hdx = this.targetGrid.getComponent('gridView').hIndex;\n        var vdx = this.targetGrid.getComponent('gridView').vIndex;\n\n        var cury = nodePos.y;\n        var actions = [];\n        var t = 0;\n        var firstCurH = canDownNum <= 1 ? 0 : canDownNum;\n        var gridController = Global.gridController.getComponent(\"gridController\");\n        var allGrids = gridController.allGrids;\n\n        for (let curH = vdx - firstCurH; curH <= vdx; curH++) {\n            if (curH == -1) {\n                continue;\n            }\n            if (actions.length > 0) {\n                var actiond = cc.delayTime(Global.gridDownDelayTime);\n                actions.push(actiond);\n                t += Global.gridDownDelayTime;\n            }\n\n            var element1 = allGrids[hdx][curH];\n            var playTime = Math.abs(cury - element1.getPosition().y) / speed;\n            if (playTime == 0) {\n                continue;\n            }\n\n            cury += element1.getPosition().y - cury;\n            t += playTime;\n            var action = cc.moveTo(playTime, element1.getPosition());\n            actions.push(action);\n        }\n\n        actions.push(callback);\n\n        //异常处理，当前节点和目标节点相等\n        cc.log(this.curState);\n        if (actions.length <= 1) {\n            console.log('处理异常');\n            if (this.forjoinaction == null) {\n                this.curState = 4;\n                this.node.runAction(callback);\n            }\n            return 0;\n        } else {\n            console.log('actions.length = 0');\n            if (this.forjoinaction != null) {\n                console.log('this.forjoinaction != null' + actions.length);\n                this.node.stopAction(this.forjoinaction);\n                this.forjoinaction = null;\n            }\n        }\n\n        //var action = cc.moveTo(playTime, targetPos);\n        var myAction = cc.sequence(actions);\n        this.node.runAction(myAction);\n        return t;\n    },\n\n    //快速下落动作\n    startQuickDownForBorn: function (speed) {\n        this.curState = 5;\n        this.node.stopAllActions();\n        var nodePos = this.node.getPosition();\n        var targetPos = this.targetGrid.getPosition();\n        var playTime = cc.pDistance(nodePos, targetPos) / speed;\n        var action = cc.moveTo(playTime, targetPos);\n        var callback = cc.callFunc(this.callBackForJoin, this);\n\n        var myAction = cc.sequence(action, callback);\n        this.node.runAction(myAction);\n        return playTime;\n    },\n    /*\n        //格子合并\n        toJoin(pos) {\n            var finished = cc.callFunc(this.toRemove, this);\n            var playTime = cc.pDistance(this.node.getPosition(), pos) / Global.combineTime;\n            //合并动作\n            var action = cc.moveTo(playTime, pos);\n            var action1 = cc.delayTime(0.1);\n\n            //var seq = cc.sequence(action1,action);\n            var myAction = cc.sequence(action1, action, finished);\n            this.node.runAction(myAction);\n\n            return playTime + 0.1;\n        },*/\n\n    toRemove: function () {\n        this.node.stopAllActions();\n        if (this.node.parent) {\n            this.node.parent.removeChild(this.node);\n        }\n        this.node.targetOff(this);\n        this.curState = 0;\n    },\n\n    //复活消除多余格子\n    toRevive: function () {\n        this.node.stopAllActions();\n        var finished = cc.callFunc(this.toRemove, this);\n        var action = cc.blink(1, 2);\n        var myAction = cc.sequence(action, finished);\n        this.node.runAction(myAction);\n        return action.getDuration() + 0.01;\n    },\n\n    //消除动画\n    clearItemToRemove: function () {\n        this.node.stopAllActions();\n        //动作完成则删除节点\n        var callback = cc.callFunc(this.toRemove, this);\n        //缩放动作\n        var spawnAction = cc.spawn(cc.rotateBy(0.5, 360, 360), cc.sequence(cc.scaleTo(0.5, 0.5), cc.scaleTo(0.5, 0)));\n\n        this.node.runAction(cc.sequence(spawnAction, callback));\n        return 500;\n    },\n\n    //道具清除\n    propClear: function () {\n        this.node.stopAllActions();\n        var finished = cc.callFunc(this.toRemove, this);\n        var scaleAction1 = cc.scaleTo(1, 2);\n        var scaleAction2 = cc.scaleTo(1, 1);\n        var spawnAction = cc.sequence(cc.scaleTo(0.5, 0.9), cc.scaleTo(0.5, 0.8), cc.scaleTo(0.5, 1));\n        this.node.runAction(cc.sequence(spawnAction, finished));\n    },\n\n    //更新分数图集\n    updateNum: function (usePropStatus) {\n        this.num5.setVisible(false);\n\n        if (usePropStatus != -1) {\n            console.log('使用道具更新显示分数图集');\n            var LoadAtlas = require(\"LoadAtlas\");\n            this.num1.setVisible(false);\n            this.num2.setVisible(false);\n            this.num3.setVisible(false);\n            this.num4.setVisible(false);\n            this.num5.setVisible(true);\n\n            this.num5.node.scaleX = this.isSoonItem ? 0.5 : 0.7;\n            this.num5.node.scaleY = this.isSoonItem ? 0.5 : 0.7;\n            if (usePropStatus == 0) {\n                this.num5.spriteFrame = LoadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'clear_spr');\n                return;\n            } else if (usePropStatus == 1) {\n                this.num5.spriteFrame = LoadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'super_spr');\n                return;\n            } else if (usePropStatus == 2) {\n                this.num5.spriteFrame = LoadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'double_spr');\n                return;\n            }\n        }\n\n\n        if (Global.skinIndex == 0) {\n            var tho = parseInt(this.bornNum / 1000);\n            var hun = parseInt((this.bornNum / 100) % 10);\n            var ten = parseInt((this.bornNum % 100) / 10);\n            var uni = parseInt(this.bornNum % 10);\n            //千位\n            if (tho > 0) {\n                this.getSpriteNum(this.num1, tho);\n            }\n            //百位\n            if (hun > 0 || tho > 0) {\n                this.getSpriteNum(this.num2, hun);\n            }\n            //十位\n            if (ten > 0 || tho > 0 || hun > 0) {\n                this.getSpriteNum(this.num3, ten);\n            }\n            //个位\n            if (uni > 0 || tho > 0 || hun > 0 || ten > 0) {\n                this.getSpriteNum(this.num4, uni);\n            }\n\n            //是否可见\n            if (tho == 0) {\n                this.num1.setVisible(false);\n            }\n            if (tho == 0 && hun == 0) {\n                this.num2.setVisible(false);\n            }\n            if (tho == 0 && hun == 0 && ten == 0) {\n                this.num3.setVisible(false);\n            }\n\n            //个位\n            if (this.bornNum > 0 && this.bornNum < 9) {\n                this.num4.node.x = 0;\n            } else if (this.bornNum >= 10 && this.bornNum < 99) {\n                var allWidth = this.num3.node.width + this.num4.node.width;\n                this.num3.node.x = -allWidth / 2 + this.num3.node.width / 2;\n                this.num4.node.x = this.num3.node.x + this.num3.node.width / 2 + this.num4.node.width / 2;\n            } else if (this.bornNum >= 100 && this.bornNum < 999) {\n                //百十个位 \n                var allWidth = this.num2.node.width + this.num3.node.width + this.num4.node.width;\n                this.num2.node.x = -allWidth / 2 + this.num2.node.width / 2;\n                this.num3.node.x = this.num2.node.x + this.num2.node.width / 2 + this.num3.node.width / 2;\n                this.num4.node.x = this.num3.node.x + this.num3.node.width / 2 + this.num4.node.width / 2;\n\n            } else if (this.bornNum >= 1000 && this.bornNum < 9999) {\n                var allWidth = this.num1.node.width + this.num2.node.width + this.num3.node.width + this.num4.node.width;\n                this.num1.node.x = -allWidth / 2 + this.num1.node.width / 2 + 6;\n                this.num2.node.x = this.num1.node.x + this.num1.node.width / 2 + this.num2.node.width / 2 - 3;\n                this.num3.node.x = this.num2.node.x + this.num2.node.width / 2 + this.num3.node.width / 2 - 3;\n                this.num4.node.x = this.num3.node.x + this.num3.node.width / 2 + this.num4.node.width / 2 - 3;\n            }\n        } else {\n            console.log('皮肤', Global.skinIndex, this.bornNum, 'skin' + (Global.skinIndex + 1) + '_' + this.bornNum);\n            var LoadAtlas = require(\"LoadAtlas\");\n            this.num4.spriteFrame = LoadAtlas.getSpriteFrameFromName('textures/gridItem/skins', 'skin' + (Global.skinIndex + 1) + '_' + this.bornNum);\n            this.num4.node.scaleX = this.isSoonItem ? 0.7 : 1;\n            this.num4.node.scaleY = this.isSoonItem ? 0.7 : 1;\n        }\n    },\n\n    getSpriteNum: function (spr, num) {\n        var string = \"skin1_\" + num;\n        var LoadAtlas = require(\"LoadAtlas\");\n        var spriteFrame = LoadAtlas.getSpriteFrameFromName('textures/gridItem/skins', num);\n        spr.spriteFrame = spriteFrame;\n        spr.node.width = spriteFrame.getRect().width; // Global.gridNumSize;\n        spr.node.height = spriteFrame.getRect().height; // Global.gridNumSize;\n        spr.node.scaleX = (this.bornNum > 999 || this.isSoonItem) ? 0.8 : 1;\n        spr.node.scaleY = (this.bornNum > 999 || this.isSoonItem) ? 0.8 : 1;\n        spr.setVisible(true);\n    },\n\n    //更新color\n    updateColor: function () {\n        var self = this;\n        var LoadAtlas = require(\"LoadAtlas\");\n        LoadAtlas.loadAtlasRes(\"textures/gridItem/items\", function () {\n            var LoadAtlas = require(\"LoadAtlas\");\n            self.itemSprite.spriteFrame = LoadAtlas.getSpriteFrameFromName(\"textures/gridItem/items\", \"color1_\" + self.bornNum);\n            var soonItemSize = Global.soonItemSize;\n            if (self.bornNum > 99) {\n                soonItemSize = 90;\n            } else if (self.bornNum > 999) {\n                soonItemSize = Global.itemSize;\n            }\n            self.itemSprite.node.width = self.isSoonItem ? soonItemSize : Global.itemSize;\n            self.itemSprite.node.height = self.isSoonItem ? soonItemSize : Global.itemSize;\n        });\n    },\n\n    //回调grid控制器的合并逻辑\n    callBackForJoin: function () {\n        if (this.curState < 3) {\n            this.curState = 3\n        }\n        let self = this;\n        let dtime = Global.forJoin;\n        if (!this.canMove) {\n            dtime = dtime / 3;\n        }\n        this.forjoinaction = cc.sequence(cc.delayTime(dtime), cc.callFunc(function () {\n            self.forJoin();\n        }));\n        this.node.runAction(this.forjoinaction);\n    },\n\n    //格子合并\n    toJoin(pos) {\n        this.curState = 4;\n        var finished = cc.callFunc(this.toRemove, this);\n        var playTime = cc.pDistance(this.node.getPosition(), pos) / Global.combineTime;\n        //合并动作\n        var action = cc.moveTo(playTime, pos);\n        var action1 = cc.delayTime(0.1);\n\n        //var seq = cc.sequence(action1,action);\n        var myAction = cc.sequence(action1, action, finished);\n        this.node.runAction(myAction);\n    },\n\n    forJoin: function () {\n        console.log('forJoin');\n        //是否可以继续下降\n        if (this.canDown()) {\n            this.startDownForBorn(Global.gridDownSpeed);\n            return;\n        }\n        //删除格子\n        this.node.stopAllActions();\n        var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n        let idx = gridControllerScript.downGrids.indexOf(this.getComponent('itemView'));\n        if (idx >= 0) {\n            gridControllerScript.downGrids.splice(idx, 1);\n        }\n\n\n        var targetScript = this.targetGrid.getComponent('gridView');\n        if (Global.usePropStatus == 1) {\n            console.log('使用万能道具');\n            //查找下方是否有格子\n            var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n            var checkGrid = gridControllerScript.allGrids[targetScript.hIndex][targetScript.vIndex + 1];\n            if (checkGrid) {\n                var buttonItem = checkGrid.getComponent(\"gridView\").item;\n                if (buttonItem) {\n                    var buttonItemViewScript = buttonItem.getComponent(\"itemView\");\n                    if (!buttonItemViewScript.useClear) {\n                        console.log('下方有格子，并且不是锤子道具', buttonItemViewScript.bornNum);\n\n                        this.initData(buttonItemViewScript.bornNum, false);\n                        Global.usePropStatus = -1;\n                    } else {\n                        console.log('下方有格子，但是下面的是锤子道具');\n                    }\n                }\n            }\n        } else if (Global.usePropStatus == 0) {\n            console.log('使用锤子道具');\n            //查找下方是否有格子\n            var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n            var checkGrid = gridControllerScript.allGrids[targetScript.hIndex][targetScript.vIndex + 1];\n            if (checkGrid) {\n                var buttonItem = checkGrid.getComponent(\"gridView\").item;\n                if (buttonItem) {\n                    var buttonItemViewScript = buttonItem.getComponent(\"itemView\");\n                    console.log('下方有格子', buttonItemViewScript.bornNum);\n                    var deleteGridScript = checkGrid.getComponent(\"gridView\");\n                    //销毁的item\n                    var deleteItem = deleteGridScript.item;\n\n                    ThirdAPI.shakeShort({});\n                    //var explosionPrefab = cc.instantiate(this.explosionPrefab);\n                    //deleteItem.node.addChild(explosionPrefab);\n\n                    deleteItem.toRevive();\n\n                    console.log('删除item：' + deleteGridScript.gridNum, deleteGridScript.hIndex, deleteGridScript.vIndex);\n                    deleteGridScript.item = null;\n                    deleteGridScript.resetData();\n\n                    gridControllerScript.bornGrid = null;\n                    this.toRevive();\n\n                    this.playDownAudio();\n                    this.canMove = false;\n                    this.curState = 0;\n                    return;\n                }\n            }\n        }\n\n        targetScript.item = this;\n        this.node.setPosition(cc.p(targetScript.node.getPosition()));\n        cc.log('下落停止 item callBackForJoin ：' + targetScript.hIndex + \" :: \" + targetScript.vIndex + \"node pos X\" + this.node.x + \"  node pos Y\" + this.node.y);\n        targetScript.gridNum = this.bornNum;\n\n\n        //添加事件侦听\n        var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n        this.node.on(\"itemclick\", gridControllerScript.itemClick, gridControllerScript);\n        this.node.on(cc.Node.EventType.TOUCH_START, this.touchStart, this);\n\n        // }, Global.gridDownDelayTime * 1000);\n\n        this.playDownAudio();\n        this.canMove = false;\n        this.curState = 0;\n    },\n\n    touchStart: function () {\n        cc.log('itemclick');\n        var evtObj = new cc.Event.EventCustom('itemclick', true);\n        evtObj.setUserData(this.targetGrid);\n        this.node.dispatchEvent(evtObj);\n    },\n\n\n\n    //播放落地声音\n    playDownAudio: function () {\n        cc.log('play down audio');\n        if (Global.isBGMPlaying && this.downAudio != null) {\n            this.combineID = cc.audioEngine.play(this.downAudio, false, 1);\n            //回调\n            var self = this;\n            if (self.combineID > 0) {\n                cc.audioEngine.setFinishCallback(self.combineID, function () {\n                    self.playAudioEnd();\n                });\n            }\n        }\n    },\n    //播放声音\n    playAudioStart: function () {\n        if (this.combineID != 0) {\n            cc.audioEngine.resume(this.combineID);\n        }\n    },\n    //暂停声音声音\n    playAudioEnd: function () {\n        cc.audioEngine.uncache(this.combineID);\n    },\n\n\n\n    // update (dt) {},\n});"]}
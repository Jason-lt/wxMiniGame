{"version":3,"sources":["../../../../../assets/Scripts/ui/assets/Scripts/ui/StoreItem.js"],"names":["ThirdAPI","require","loadAtlas","cc","Class","extends","Component","properties","bg","default","type","Sprite","front","photo","buttonBuy","Node","buttonState1","buttonState2","buttonState3","labelname","Label","price","index","waretype","isHave","isCurrent","hideAll","setVisible","setPhoto","spriteFrame","setButtonState","state","active","updateState","Global","wxGold","setPrice","getChildByName","getComponent","string","setCurrent","value","storeUI","setCurrentItem","node","skinIndex","saveCurrentSkin","setWareType","n","setContentSize","setIsHave","getSpriteFrameFromName","setName","name","start","on","onButtonBy","game","playSound","showTipbox","repeat","i","storeData","length","push","saveInfo","propScore","saveScore","updateStoreItemsState","titleUI","updateItemsState"],"mappings":"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","file":"StoreItem.js","sourceRoot":"../../../../../assets/Scripts/ui","sourcesContent":["let ThirdAPI = require('../common/ThirdAPI')\nvar loadAtlas = require(\"LoadAtlas\")\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        bg: {\n            default: null,\n            type: cc.Sprite,\n        },\n        front: {\n            default: null,\n            type: cc.Sprite,\n        },\n        photo: {\n            default: null,\n            type: cc.Sprite,\n        },\n        buttonBuy: {\n            default: null,\n            type: cc.Node,\n        },\n        buttonState1: {\n            default: null,\n            type: cc.Node,\n        },\n        buttonState2: {\n            default: null,\n            type: cc.Node,\n        },\n        buttonState3: {\n            default: null,\n            type: cc.Node,\n        },\n\n        labelname: {\n            default: null,\n            type: cc.Label,\n        },\n        price: 0,\n        index: 0,\n        // 1, 2, 3, 4\n        waretype: 1,\n        // 此皮肤是否已经拥有\n        isHave: false,\n        // 是否为当前皮肤\n        isCurrent: false,\n    },\n\n    hideAll: function () {\n        //this.price.string = '';\n        this.photo.setVisible(false);\n        this.bg.setVisible(false);\n    },\n\n    setPhoto: function (photo) {\n        this.photo.spriteFrame = photo;\n    },\n\n    setButtonState: function (state) {\n        this.buttonState1.active = false;\n        this.buttonState2.active = false;\n        this.buttonState3.active = false;\n\n        if (state == 1) {\n            this.buttonState1.active = true;\n        }\n        else if (state == 2) {\n            this.buttonState2.active = true;\n        }\n        else if (state == 3) {\n            this.buttonState3.active = true;\n        }\n    },\n\n    updateState: function() {\n        if (this.isHave) return;\n\n        // 可以购买\n        if (this.price <= Global.wxGold) {\n            //this.buttonBuy.getComponent(cc.Button).interactable = true;\n        }\n        // 不可以购买\n        else {\n            //this.buttonBuy.getComponent(cc.Button).interactable = false;\n        }\n    },\n\n    setPrice: function (price) {\n        //this.price.string = price+\" 积分\";\n        this.buttonState1.getChildByName(\"text\").getComponent(cc.Label).string = price;\n        this.price = price;\n\n        // 可以购买\n        if (price <= Global.wxGold) {\n            //this.buttonBuy.getComponent(cc.Button).interactable = true;\n        }\n        // 不可以购买\n        else {\n            //this.buttonBuy.getComponent(cc.Button).interactable = false;\n        }\n    },\n\n    setCurrent: function (value) {\n        if (Global.storeUI == null) return;\n        if (!this.isHave) return;\n\n        //console.log(\"set current skin\");\n        this.isCurrent = value;\n        //this.buttonBuy.getChildByName(\"price\").getComponent(cc.Label).string = value ? \"已拥有\" : \"换上\";\n        this.setButtonState(value ? 3 : 2);\n        if (this.isCurrent) {\n            if (this.waretype == 1) {\n                //Global.skinBall = this.photo.spriteFrame;\n                Global.storeUI.getComponent(\"UIStore\").setCurrentItem(this.node);\n                Global.skinIndex = this.index;\n\n                ThirdAPI.saveCurrentSkin(Global.skinIndex);\n            }\n        }\n    },\n\n    setWareType: function (n) {\n        this.waretype = n;\n        this.photo.node.setContentSize(50,50);\n    },\n\n    setIsHave: function () {\n        //this.buttonBuy.getComponent(cc.Button).interactable = true;\n        this.isHave = true;\n        //this.buttonBuy.getChildByName(\"price\").getComponent(cc.Label).string = \"换上\";\n        this.bg.spriteFrame = loadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'skin-bg1');\n        this.front.spriteFrame = loadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'skin-front1');\n        //this.zuan.node.active = false;\n        this.setButtonState(2);\n    },\n\n    setName: function (name) {\n        this.labelname.string = name;\n    },\n\n    start() {\n        this.buttonBuy.on('click', this.onButtonBy, this);\n        //this.isHave = false;\n        //this.isCurrent = false;\n    },\n\n    // 按钮回调：购买\n    onButtonBy: function () {\n        Global.game.playSound('btn', 0.1);\n        //console.log('是否拥有: ', this.isHave);\n        if (!this.isHave) {\n            //console.log(\"购买:\" + this.index + \", 价格:\" + this.buttonBuy.getChildByName(\"price\").getComponent(cc.Label).string);\n\n            if (this.price <= Global.wxGold) {\n                Global.storeUI.getComponent(\"UIStore\").showTipbox('购买成功！');\n            }\n            // 不可以购买\n            else {\n                Global.storeUI.getComponent(\"UIStore\").showTipbox('您的钻石数量不够！');\n                return;\n            }\n\n            this.isHave = true;\n            var repeat = false;\n            for (var i = 0; i < Global.storeData.length; i++) {\n                if (this.index + this.waretype * 100 == Global.storeData[i]) {\n                    repeat = true;\n                }\n            }\n            if (!repeat) {\n                Global.storeData.push(this.index + this.waretype * 100);\n                ThirdAPI.saveInfo('skinstore', Global.storeData);\n            }\n\n            Global.wxGold -= this.price;\n            Global.storeUI.getComponent(\"UIStore\").propScore.string = Global.wxGold;\n            Global.game.saveScore();\n\n            // 更新商店积分信息，和对商店商品的影响\n            Global.storeUI.getComponent(\"UIStore\").updateStoreItemsState();\n\n            //this.buttonBuy.getChildByName(\"price\").getComponent(cc.Label).string = \"换上\";\n\n\n            this.bg.spriteFrame = loadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'skin-bg1');\n            this.front.spriteFrame = loadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'skin-front1');\n            //this.zuan.node.active = false;\n            this.setButtonState(2);\n\n            if (Global.titleUI)\n                Global.titleUI.updateItemsState(2);\n        }\n        else {\n            if (!this.isCurrent)\n                this.setCurrent(true);\n        }\n    },\n\n    // update (dt) {},\n});\n"]}
{"version":3,"sources":["../../../../../assets/Scripts/controller/assets/Scripts/controller/gridController.js"],"names":["ThirdAPI","require","cc","Class","extends","Component","properties","nextFriendNode","default","type","Node","nextFriendSp","Sprite","handLine1","handLine2","gridPrefab","Prefab","pauseNode","chooseNode","test_btnNode","itemPrefab","randomScore","soonGridNum","soonGridInstance","startX","startY","allGrids","bornGrid","startTouchPosition","deleteGrids","joinGrids","targetGrid","line","goldNode","prop","nodesGroup","fitOffsetY","propClearTime","score","downGrids","scoreScript","isClickBomming","clickGridNum","createItemIndex","moveItemIndex","startTime","addTimes","initGridData","isFitIphoneX","winSize","width","height","setPosition","getComponent","Widget","top","allWidth","Global","hNum","itemSize","itemSplit","allHeight","vNum","screenWidth","setHandWidthAndHeight","reset","wxBannerAd","createBannerAd","createAllGrid","setTouchControl","process","updateGold","getNextFriend","director","getScheduler","schedule","updateWxRank","begin","setLine","active","canTest","label","getChildByName","Label","string","testEnabled","console","log","scoreNum","w","node","h","x","y","drawRect","rect","callback","entries","setTimeout","openDataContext","wx","getOpenDataContext","sharedCanvas","canvas","texture","Texture2D","initWithElement","handleLoadedTexture","sp","SpriteFrame","spriteFrame","error","find","linePosY","p","down","checkGridJoin","isDown","hIndex","vIndex","resetItemAction","curState","self","downNum","index","length","element","gridJoin","runAction","sequence","delayTime","callFunc","clearAllJoin","canJoin","gridScript","findDownNum","startBianli","combineTimes","checkJoin","hightBornGrid","bornXgridNum","item","gameOver","createItem","isFind","actionJoin","joinComplete","isJoin","myUtil","randomForArray","gridRandomScores","showChooseNum","createItem2","instantiate","getPosition","initData","addChild","downSpeed","gridDownSpeed","getStopPosition","targetView","startDownForBorn","setSoonGrid","randomScores","concat","joinRandomScores","parent","btn_node","closeListen","off","EventType","TOUCH_START","nodeStart","TOUCH_MOVE","nodeMove","parma","createGrid","posX","posY","gridItem","setLocalZOrder","gridView","setIndex","itemClick","event","clickGrid","getUserData","stopAllActions","scale1","scaleTo","scaleTime","clearItemToRemove","currHindex","currVindex","downtime","wxGold","costGold","data","loadLocalScore","parseInt","maxscore","gold","loadScore","saveScore","goldLabel","clickProp","resetProp","scaleBy","scale2","repeat","xBorn","yBorn","addIndex","on","getLocation","moveStartX","Math","ceil","abs","canMove","game","isPaused","moveTemp","dist","downDist","xPadding","round","moveThreshold","isUpOrDown","moveDownThreshold","canMoveGrid","isTouchDown","canMoveQuickDown","priView","maxDownTime","startQuickDownForBorn","gridQuickDownSpeed","changeStateToWaitDown","hindex","_hIndex","_vIndex","endx","soonMoveGrid","vindex","isClearGrid","gridviewScript","_curitem","gridCombineDownSpeed","curtime","gridNum","push","onPauseOrResume","playSound","resumeAllActions","pauseAllActions","hideChooseNum","onRestart","removeChild","restart","onMainScene","startGame","resume","onShareGame","FBInstant","shareGame","getImgBase64","goldNum","addGold","undefined","unschedule","reviveShareTimes","loadReviveData","reviveTimes","reviveTotalTimes","showRevive","reviveUI","setScore","showShareUI","shareUI","updateMaxLabel","clearGridForRevive","grid","time","clearVNum","itemViewScript","clearTime","toRevive","flyNumPools","finished","update","unixTime","Date","getTime","accessTime","waitToDown","destroyBannerAd","toRemove","randomForWeight","weightScores"],"mappings":"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","file":"gridController.js","sourceRoot":"../../../../../assets/Scripts/controller","sourcesContent":["let ThirdAPI = require('../common/ThirdAPI')\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        nextFriendNode: {\n            default: null,\n            type: cc.Node,\n        },\n        nextFriendSp: {\n            default: null,\n            type: cc.Sprite,\n        },\n        handLine1: {\n            default: null,\n            type: cc.Node,\n        },\n        handLine2: {\n            default: null,\n            type: cc.Node,\n        },\n        gridPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        pauseNode: {\n            default: null,\n            type: cc.Node\n        },\n        chooseNode: {\n            default: null,\n            type: cc.Node\n        },\n        test_btnNode: {\n            default: null,\n            type: cc.Node\n        },\n\n        //格子内的item\n        itemPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n\n        //右上角显示即将下落的格子分数\n        randomScore: 0,\n        //即将出现的格子\n        soonGridNum: {\n            default: null,\n            type: cc.Prefab,\n        },\n        soonGridInstance: null,\n\n        startX: 0,\n        startY: 0,\n        //所有格子节点坐标\n        allGrids: [],\n        //出生的格子\n        bornGrid: null,\n        //开始触摸的位置坐标\n        startTouchPosition: null,\n\n        //将要合并的数组\n        deleteGrids: [],\n        joinGrids: [],\n        //目标的格子\n        targetGrid: {\n            default: null,\n            type: cc.Node\n        },\n\n        line: {\n            default: null,\n            type: cc.Sprite,\n        },\n        //金币节点\n        goldNode: {\n            default: null,\n            type: cc.Node\n        },\n        prop: {\n            default: null,\n            type: cc.Node\n        },\n        nodesGroup: {\n            default: null,\n            type: cc.Node,\n        },\n        fitOffsetY: 0,\n        propClearTime: 0, //使用道具消除点击格子的动画时间\n\n        //分数\n        score: {\n            default: null,\n            type: cc.Node,\n        },\n        //可下落格子\n        downGrids: [],\n\n        scoreScript: null,\n        isClickBomming: false,\n        clickGridNum: 0, //消除格子数量\n        createItemIndex: 0,\n        moveItemIndex: 0,\n\n        startTime: 0, //开始时间\n        addTimes: 0, //加速次数\n    },\n\n    initGridData: function () {\n        // 适配\n        var isFitIphoneX = cc.winSize.width / cc.winSize.height <= 0.56;\n\n        this.fitOffsetY = 0;\n        if (isFitIphoneX) {\n            this.fitOffsetY = 40;\n            this.nodesGroup.setPosition(0, -this.fitOffsetY);\n            this.nodesGroup.getComponent(cc.Widget).top = this.fitOffsetY;\n        }\n\n        //设置位置坐标\n        var allWidth = Global.hNum * Global.itemSize + (Global.hNum - 1) * Global.itemSplit;\n        var allHeight = Global.vNum * Global.itemSize + (Global.vNum - 1) * Global.itemSplit;\n\n        this.startX = -(Global.screenWidth / 2) + (Global.screenWidth - allWidth) / 2 + Global.itemSize / 2;\n        this.startY = 300 - this.fitOffsetY;//-(Global.screenHeight / 2) + Global.paddingButtom + allHeight - Global.itemSize + 30 - this.fitOffsetY;\n\n        this.scoreScript = this.score.getComponent(\"score\");\n\n        //设置适配背景\n        this.setHandWidthAndHeight();\n\n        //重置所有数据\n        this.reset();\n\n        var wxBannerAd = require('wxBannerAd');\n        wxBannerAd.createBannerAd();\n        //初始化棋盘\n        this.createAllGrid();\n        //添加触摸侦听\n        this.setTouchControl();\n        //开始处理业务逻辑\n        this.process();\n        //显示星星\n        this.updateGold();\n\n        //this.nextFriendNode.setLocalZOrder(2200);\n        this.getNextFriend();\n        cc.director.getScheduler().schedule(this.getNextFriend, this, 1, false);\n        this.updateWxRank = 1;\n        this.begin = true;\n\n        this.setLine(allWidth, allHeight);\n        this.pauseNode.active = false;\n        this.chooseNode.active = false;\n\n        this.test_btnNode.active = Global.canTest;\n        if (Global.canTest) {\n            var label = this.test_btnNode.getChildByName('Label');\n            label.getComponent(cc.Label).string = '测试 ' + (Global.testEnabled ? '开' : '关');\n        }\n    },\n\n    getNextFriend: function () {\n        console.log(\"更新即将超越好友信息\", this.scoreScript.scoreNum);\n\n        let w = this.nextFriendSp.node.width;\n        let h = this.nextFriendSp.node.height;\n        let x = 0;\n        let y = 0;\n        this.drawRect = { x: x, y: y, width: w, height: h };\n        //console.log('draw rect : ', this.drawRect);\n        ThirdAPI.getNextFriend({\n            rect: this.drawRect,\n            score:  this.scoreScript.scoreNum,\n            callback: (entries) => {\n                console.log('获取即将超越好友信息成功');\n\n                setTimeout(() => {\n                    try {\n                        let openDataContext = wx.getOpenDataContext();\n                        let sharedCanvas = openDataContext.canvas;\n            \n                        let texture = new cc.Texture2D();\n                        texture.initWithElement(sharedCanvas);\n                        texture.handleLoadedTexture();\n                        let sp = new cc.SpriteFrame(texture);\n                        this.nextFriendSp.spriteFrame = sp;  \n                    } catch (error) {\n                        \n                    }\n                }, 500);\n            }\n        });\n    },    \n\n    //设置头部图片的适配宽高\n    setHandWidthAndHeight: function () {\n        let canvas = cc.find('Canvas');\n        this.handLine1.width = canvas.width * 0.5;\n        this.handLine2.width = canvas.width * 0.5;\n    },\n\n    //设置线的位置和大小\n    setLine: function (width, height) {\n        this.line.node.width = width + 20;\n        this.line.node.height = height + 20;\n        var linePosY = height / 2 - this.startY - Global.itemSize / 2;\n        this.line.node.setPosition(cc.p(0, -linePosY));\n    },\n\n    process: function () {\n        //1.格子下落\n        this.down();\n        //格子合并\n        this.checkGridJoin();\n    },\n\n    //下落\n    down: function () {\n        this.isDown = false;\n        this.downGrids = [];\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                if (this.resetItemAction(hIndex, vIndex, false)) {\n                    this.isDown = true;\n                }\n            }\n        }\n\n        if (this.bornGrid && this.bornGrid.getComponent('itemView').curState > 0) {\n            this.isDown = true;\n        }\n    },\n\n    checkGridJoin: function () {\n        let self = this;\n        let downNum = 0;\n        // for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n        //     for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n        //         var gridScript = self.allGrids[hIndex][vIndex].getComponent('gridView');\n        //         if (gridScript.item && gridScript.item.getComponent('itemView').curState > 0) {\n        //             downNum++;\n        //         }\n        //     }\n        // }\n        for (let index = 0; index < this.downGrids.length; index++) {\n            const element = this.downGrids[index];\n            if (element.curState > 0) {\n                downNum++;\n            }\n        }\n        if (this.bornGrid != null && this.bornGrid.getComponent('itemView').curState > 0) {\n            downNum++;\n        }\n        if ((this.bornGrid == null || this.bornGrid.getComponent('itemView').curState == 0) && downNum == 0) {\n            this.gridJoin();\n        } else {\n            this.node.runAction(cc.sequence(cc.delayTime(0.5), cc.callFunc(function () {\n                self.checkGridJoin();\n            })));\n        }\n\n        //this.gridJoin();\n    },\n\n    gridJoin: function () {\n        var self = this;\n        //2.格子合并\n        //self.bornGrid = null;\n\n        //是否有被删除的格子\n        if (self.clickGridNum > 0) {\n            self.process();\n            self.clickGridNum = 0;\n            return;\n        }\n\n        self.clearAllJoin();\n\n        let canJoin = false;\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                var gridScript = self.allGrids[hIndex][vIndex].getComponent('gridView');\n                if (!self.findDownNum() || (self.findDownNum() && gridScript.isDown)) {\n                    //执行合并\n                    if (gridScript.startBianli()) {\n                        canJoin = true;\n                    }\n                }\n            }\n        }\n\n        if (canJoin) {\n            Global.combineTimes++;\n            console.log('要开始合并啦,combineTimes:' + Global.combineTimes);\n            this.checkJoin();\n        } else {\n            var hightBornGrid = self.allGrids[Global.bornXgridNum][0];\n            if (hightBornGrid.getComponent('gridView').item != null && !self.isDown) {\n                //gameover\n                let self = this;\n                self.node.runAction(cc.sequence(cc.delayTime(0.5), cc.callFunc(function () {\n                    self.gameOver();\n                })));\n                return;\n            }\n            if (!self.isDown) {\n                Global.combineTimes = 0;\n                self.bornGrid = null;\n                self.createItem();\n            } else {\n                self.process();\n            }\n        }\n    },\n\n    //合并判断\n    checkJoin: function () {\n        let self = this;\n        self.node.runAction(cc.sequence(cc.delayTime(0.1), cc.callFunc(function () {\n            let isFind = false;\n            for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n                for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                    var gridScript = self.allGrids[hIndex][vIndex].getComponent('gridView');\n                    if (gridScript.actionJoin) {\n                        isFind = true;\n                        break;\n                    }\n                }\n            }\n            if (!isFind) {\n                self.joinComplete();\n            } else {\n                self.checkJoin();\n            }\n        })));\n\n    },\n\n    joinComplete: function () {\n        let self = this;\n        //最高点合并之后重新生产\n        var hightBornGrid = self.allGrids[Global.bornXgridNum][0];\n        if (hightBornGrid.getComponent('gridView').item != null) {\n            //因为在最开始创建的时候下方有物体，所以不能isDown，合并完之后需要重设isDown，\n            //再继续判断是否可以合并，如果没有则再生产一个item，\n            self.isDown = true;\n        }\n        self.gridJoin();\n    },\n\n    findDownNum: function () {\n        var self = this;\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                var gridScript = self.allGrids[hIndex][vIndex].getComponent('gridView');\n                if (gridScript.isDown) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    },\n\n    //清除所有的可合并变量\n    clearAllJoin: function () {\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                var gridScript = this.allGrids[hIndex][vIndex].getComponent('gridView');\n                gridScript.isJoin = false;\n            }\n        }\n    },\n\n    //生产下落的item\n    createItem: function () {\n        var myUtil = require(\"myUtil\");\n        if (this.randomScore == 0) {\n            this.randomScore = myUtil.randomForArray(Global.gridRandomScores);\n        }\n\n        if (Global.testEnabled) {\n            this.showChooseNum();\n        } else {\n            this.createItem2();\n        }\n\n        /*\n                //出生的目标点\n                item.setPosition(cc.p(this.allGrids[Global.bornXgridNum][0].getPosition().x, this.allGrids[Global.bornXgridNum][0].getPosition().y + Global.itemSize));\n                //hightBornGrid.getComponent('gridView').gridNum = this.randomScore;\n                item.getComponent('itemView').initData(this.randomScore, false);\n                this.node.addChild(item);\n\n                this.bornGrid = item;\n\n                var downSpeed = Global.gridDownSpeed;\n                var downNum = this.getStopPosition(Global.bornXgridNum, 0);\n                var targetView = this.allGrids[Global.bornXgridNum][downNum];\n\n                this.bornGrid.getComponent('itemView').targetGrid = targetView;\n\n                item.getComponent('itemView').startDownForBorn(downSpeed);\n\n                this.setSoonGrid();\n                this.process();\n                this.createItemIndex++;*/\n    },\n\n    createItem2: function () {\n        let item = cc.instantiate(this.itemPrefab);\n        //出生的目标点\n        item.setPosition(cc.p(this.allGrids[Global.bornXgridNum][0].getPosition().x, this.allGrids[Global.bornXgridNum][0].getPosition().y + Global.itemSize));\n        //hightBornGrid.getComponent('gridView').gridNum = this.randomScore;\n        item.getComponent('itemView').initData(this.randomScore, false);\n        this.node.addChild(item);\n\n        this.bornGrid = item;\n\n        var downSpeed = Global.gridDownSpeed;\n        var downNum = this.getStopPosition(Global.bornXgridNum, 0);\n        var targetView = this.allGrids[Global.bornXgridNum][downNum];\n\n        this.bornGrid.getComponent('itemView').targetGrid = targetView;\n\n        item.getComponent('itemView').startDownForBorn(downSpeed);\n\n        this.setSoonGrid();\n        this.process();\n        this.createItemIndex++;\n    },\n\n    //设置即将下落的格子分数\n    setSoonGrid: function () {\n        var myUtil = require(\"myUtil\");\n        var randomScores = Global.gridRandomScores.concat(Global.joinRandomScores);\n        this.randomScore = myUtil.randomForArray(randomScores);\n        if (!this.soonGridInstance || (this.soonGridInstance && !this.soonGridInstance.parent)) {\n            this.soonGridInstance = cc.instantiate(this.soonGridNum);\n            this.node.addChild(this.soonGridInstance);\n        }\n        this.soonGridInstance.setPosition(0, 420 - this.fitOffsetY);\n        this.soonGridInstance.getComponent(\"itemView\").initData(this.randomScore, true);\n    },\n\n\n    //测试开关是否开启\n    testEnabled: function () {\n        Global.testEnabled = !Global.testEnabled;\n        var btn_node = this.node.getChildByName('test_btn');\n        if (btn_node) {\n            var label = btn_node.getChildByName('Label');\n            label.getComponent(cc.Label).string = '测试 ' + (Global.testEnabled ? '开' : '关');\n        }\n    },\n\n\n    //关闭监听\n    closeListen: function () {\n        //关闭触摸\n        this.node.off(cc.Node.EventType.TOUCH_START, this.nodeStart, this);\n        //关闭移动\n        this.node.off(cc.Node.EventType.TOUCH_MOVE, this.nodeMove, this);\n    },\n\n    createAllGrid: function () {\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                var parma = {\n                    hIndex: hIndex,\n                    vIndex: vIndex,\n                };\n                if (!this.allGrids[hIndex]) {\n                    this.allGrids[hIndex] = [];\n                }\n                this.allGrids[hIndex][vIndex] = this.createGrid(parma);\n            }\n        }\n    },\n\n    //创建格子\n    createGrid: function (parma) {\n        //参数\n        var hIndex = parma.hIndex;\n        var vIndex = parma.vIndex;\n        var posX = this.startX + hIndex * Global.itemSize + hIndex * Global.itemSplit;\n        var posY = this.startY - vIndex * Global.itemSize - vIndex * Global.itemSplit;\n\n        //设置格子的坐标\n        var gridItem = cc.instantiate(this.gridPrefab);\n        gridItem.setPosition(cc.p(posX, posY));\n\n        gridItem.setLocalZOrder(20000);\n\n        //设置索引和位置\n        var gridView = gridItem.getComponent(\"gridView\");\n        gridView.node.setPosition(posX, posY);\n        gridView.setIndex(hIndex, vIndex, this);\n        this.node.addChild(gridItem);\n        return gridItem;\n    },\n\n    itemClick: function (event) {\n        var self = this;\n        if (!self.isClickBomming) {\n            return;\n        }\n        if (this.clickGridNum >= 1) {\n            return;\n        }\n        var clickGrid = event.getUserData();\n        self.clickGrid = clickGrid;\n\n        //道具缩放动画停止\n        this.prop.stopAllActions();\n        var scale1 = cc.scaleTo(0.1, 1, 1);\n        this.prop.runAction(scale1);\n\n        //停止生产下落的格子\n        // if (this.bornGrid) {\n        //     this.bornGrid.pauseAllActions();\n        // }\n        //this.node.stopAllActions();\n\n        //消除格子\n        var scaleTime = this.clickGrid.getComponent('gridView').item.getComponent(\"itemView\").clearItemToRemove();\n        this.clickGrid.getComponent('gridView').item = null;\n        //将上方的格子下落\n        var currHindex = this.clickGrid.getComponent('gridView').hIndex;\n        var currVindex = this.clickGrid.getComponent('gridView').vIndex;\n        for (let vIndex = currVindex - 1; vIndex > 0; vIndex--) {\n            var downtime = this.resetItemAction(currHindex, vIndex, true);\n        }\n\n        this.clickGridNum++;\n        this.isClickBomming = false;\n        //消耗金币\n        Global.wxGold -= Global.costGold;\n        //更新金币并存储\n        if (typeof wx !== 'undefined') {\n            let data = ThirdAPI.loadLocalScore();\n            var score = parseInt(data.maxscore);\n            var gold = parseInt(data.gold);\n            ThirdAPI.loadScore((maxscore, gold) => {\n                score = parseInt(maxscore);\n                gold = parseInt(gold);\n                console.log('gridController on ThirdAPI loadScore', score, parseInt(gold), Global.wxGold);\n            });\n            ThirdAPI.saveScore(score, Global.wxGold);\n        }\n        //更新分数\n        var goldLabel = this.goldNode.getChildByName('label');\n        goldLabel.getComponent(cc.Label).string = Global.wxGold;\n\n\n        //console.log('scaleTime:' + scaleTime);\n        //缩放动画播完后再继续下落合并的逻辑(马上按下暂停这里时间就会出现问题)\n        // this.node.stopAllActions();\n        // this.node.runAction(cc.sequence(cc.delayTime(scaleTime / 1000), cc.callFunc(self.process, self)));\n    },\n\n    //点击道具\n    clickProp: function () {\n        if (Global.wxGold < Global.costGold) {\n            console.log('my costGold is ' + Global.costGold);\n            return;\n        }\n\n        if (this.isClickBomming) {\n            this.resetProp();\n        } else {\n            var scale1 = cc.scaleBy(0.4, 1.1, 1.1);\n            var scale2 = cc.scaleBy(0.4, 1 / 1.1, 1 / 1.1);\n            var repeat = cc.repeat(cc.sequence(scale1, scale2), 99999);\n            this.prop.stopAllActions();\n            this.prop.runAction(repeat);\n            // if (this.bornGrid) {\n            //     this.bornGrid.pauseAllActions();\n            // }\n            // this.node.stopAllActions();\n            this.isClickBomming = true;\n            this.clickGridNum = 0;\n        }\n    },\n\n    resetProp: function () {\n        this.isClickBomming = false;\n        this.prop.stopAllActions();\n        var scale1 = cc.scaleTo(0.1, 1, 1);\n        this.prop.runAction(scale1);\n\n\n        // if (this.bornGrid) {\n        //恢复下落格子的动作，将当前格子的item置为下落格子item\n        // var bornGridhIndex = Math.ceil(Math.abs((this.bornGrid.x - this.startX) / Global.itemSize));\n        // var bornGridvIndex = Math.ceil(Math.abs((this.bornGrid.y - this.startY) / Global.itemSize));\n        // this.allGrids[bornGridhIndex][bornGridvIndex].getComponent('gridView').item = this.bornGrid;\n        // this.isClickBomming = false;\n        //this.propClearTime = 0;\n        // this.process();\n        //     console.log('还可以继续下落');\n        // } else {\n        //     console.log('没有下落的格子');\n        // }\n    },\n\n    //先获取出生点那一列最终的目标点\n    getStopPosition: function (xBorn, yBorn) {\n        var addIndex = 0;\n        for (let index = Global.vNum - 1; index >= 0; index--) {\n            var node = this.allGrids[xBorn][index];\n            var gridView = node.getComponent(\"gridView\");\n            if (gridView && gridView.item == null && gridView.vIndex > yBorn) {\n                addIndex++;\n            }\n        }\n        return addIndex;\n    },\n\n    //设置鼠标或者手势操作动作\n    setTouchControl: function () {\n        var self = this;\n        if (self.node.parent) {\n            //开始触摸\n            self.node.on(cc.Node.EventType.TOUCH_START, this.nodeStart, this);\n            //触摸移动\n            self.node.on(cc.Node.EventType.TOUCH_MOVE, this.nodeMove, this);\n        }\n    },\n\n    nodeStart: function (event) {\n        this.startTouchPosition = event.getLocation();\n        this.moveItemIndex = this.createItemIndex;\n        this.moveStartX = Math.ceil(Math.abs((this.bornGrid.x - this.startX) / Global.itemSize));\n    },\n\n    nodeMove: function (event) {\n        if (this.moveItemIndex != this.createItemIndex) {\n            return;\n        }\n        var self = this;\n        if (this.bornGrid && this.bornGrid.getComponent('itemView').canMove && !cc.game.isPaused() && !this.isClickBomming) {\n            var moveTemp = event.getLocation();\n            var dist = moveTemp.x - self.startTouchPosition.x;\n            var downDist = moveTemp.y - self.startTouchPosition.y;\n\n            //左右移动\n            var xPadding = Math.round(dist / Global.moveThreshold);\n            var isUpOrDown = Math.abs(downDist) > Global.moveDownThreshold ? true : false;\n\n            //self.startTouchPosition = moveTemp;\n            var targetGrid = self.canMoveGrid(this.moveStartX + xPadding);\n            if (isUpOrDown) {\n                //上下移动\n                var isTouchDown = moveTemp.y <= self.startTouchPosition.y ? true : false;\n                //self.startTouchPosition = moveTemp;\n                var targetGrid = self.canMoveQuickDown(isTouchDown);\n                if (targetGrid) {\n                    this.bornGrid.x = targetGrid.getPosition().x;\n                    var downNum = self.getStopPosition(targetGrid.getComponent('gridView').hIndex, targetGrid.getComponent('gridView').vIndex);\n                    var targetView = self.allGrids[targetGrid.getComponent('gridView').hIndex][targetGrid.getComponent('gridView').vIndex + downNum];\n                    var priView = self.allGrids[targetGrid.getComponent('gridView').hIndex][targetGrid.getComponent('gridView').vIndex];\n                    priView.getComponent('gridView').isDown = false;\n                    targetView.getComponent('gridView').isDown = true;\n\n                    this.bornGrid.getComponent('itemView').targetGrid = targetView;\n                    //快速开始进行从出生点到最终位置的动作\n                    cc.log('quick down:' + downNum);\n                    if (this.bornGrid.getComponent('itemView').curState == 2 || this.bornGrid.getComponent('itemView').curState == 1) {\n                        self.maxDownTime = this.bornGrid.getComponent('itemView').startQuickDownForBorn(Global.gridQuickDownSpeed);\n                    }\n                    self.node.stopAllActions();\n                    self.checkGridJoin();\n                }\n            } else if (targetGrid) {\n                this.bornGrid.x = targetGrid.getPosition().x;\n                cc.log('change bornGridx:' + this.bornGrid.x);\n                var downNum = self.getStopPosition(targetGrid.getComponent('gridView').hIndex, targetGrid.getComponent('gridView').vIndex);\n                var targetView = self.allGrids[targetGrid.getComponent('gridView').hIndex][targetGrid.getComponent('gridView').vIndex + downNum];\n                var priView = self.allGrids[targetGrid.getComponent('gridView').hIndex][targetGrid.getComponent('gridView').vIndex];\n                priView.getComponent('gridView').isDown = false;\n                targetView.getComponent('gridView').isDown = true;\n\n                this.bornGrid.getComponent('itemView').targetGrid = targetView;\n                this.bornGrid.getComponent('itemView').changeStateToWaitDown(Global.gridDownSpeed);\n                self.node.stopAllActions();\n                self.checkGridJoin();\n            }\n        }\n    },\n\n    /*是否可左右移动 */\n    canMoveGrid: function (hindex) {\n        //横、纵坐标的索引,向下取整\n        var _hIndex = Math.ceil(Math.abs((this.bornGrid.x - this.startX) / Global.itemSize));\n        var _vIndex = Math.ceil(Math.abs((this.bornGrid.y - this.startY) / Global.itemSize));\n\n        if (hindex == _hIndex) {\n            return null;\n        }\n\n        if (hindex < 0 || hindex >= Global.hNum) {\n            return null;\n        }\n        //即将移动到的gird位置\b\n        //中间元素是否可以移动\n        let startX = hindex + 1;\n        let endx = _hIndex - 1;\n        if (hindex > _hIndex) {\n            startX = _hIndex + 1;\n            endx = hindex - 1;\n        }\n        while (startX <= endx) {\n            var soonMoveGrid = this.allGrids[startX][_vIndex];\n            if (soonMoveGrid && soonMoveGrid.getComponent(\"gridView\").item == null) {\n                startX++;\n                continue;\n            }\n            return null;\n        }\n        var soonMoveGrid = this.allGrids[hindex][_vIndex];\n\n        if (soonMoveGrid && soonMoveGrid.getComponent(\"gridView\").item == null) {\n            return soonMoveGrid;\n        }\n        return null;\n    },\n\n    /*是否可以向下移动 */\n    canMoveQuickDown: function (isTouchDown) {\n        //横、纵坐标的索引,向上取整\n        var hIndex = Math.ceil(Math.abs((this.bornGrid.x - this.startX) / Global.itemSize));\n        var vIndex = Math.ceil(Math.abs((this.bornGrid.y - this.startY) / Global.itemSize));\n\n        if (!isTouchDown) {\n            return null;\n        }\n        if (vIndex >= (Global.vNum - 1)) {\n            return null;\n        }\n\n        var soonMoveGrid = this.allGrids[hIndex][vIndex + 1];\n        if (soonMoveGrid && soonMoveGrid.getComponent(\"gridView\").item == null) {\n            return soonMoveGrid;\n        }\n        return null;\n    },\n\n    //重设动作目标\n    resetItemAction: function (hindex, vindex, isClearGrid) {\n        var gridviewScript = this.allGrids[hindex][vindex].getComponent('gridView');\n        if (gridviewScript.item == null) {\n            return false;\n        }\n        var downNum;\n        if (isClearGrid) {\n            downNum = 1;\n        } else {\n            downNum = this.getStopPosition(hindex, vindex);\n        }\n        //设置索引\n        if (downNum == 0) {\n            return false;\n        }\n\n        var targetView = this.allGrids[hindex][vindex + downNum];\n        targetView.getComponent('gridView').isDown = true;\n        var _curitem = gridviewScript.item.getComponent('itemView');\n        _curitem.targetGrid = targetView;\n\n        var downSpeed = (this.isDown || Global.combineTimes > 0) ? Global.gridCombineDownSpeed : Global.gridDownSpeed;\n        console.log('速度：' + downSpeed, Global.combineTimes);\n        var curtime = _curitem.startDownForBorn(downSpeed);\n\n        gridviewScript.item = null;\n        //targetView.getComponent('gridView').item = _curitem;\n        gridviewScript.gridNum = 0;\n        //加入下落格子数组\n        this.downGrids.push(_curitem);\n\n        return true;\n    },\n\n    //暂停游戏\n    onPauseOrResume: function () {\n        Global.game.playSound('btn', 0.1);\n        if (Global.isPaused) {\n            if (this.bornGrid) {\n                this.bornGrid.resumeAllActions();\n            }\n            this.node.resumeAllActions();\n            this.pauseNode.active = false;\n        } else {\n            if (this.isClickBomming) {\n                this.resetProp();\n            }\n            if (this.bornGrid) {\n                this.bornGrid.pauseAllActions();\n            }\n            this.node.pauseAllActions();\n\n            Global.isPaused = true;\n            this.pauseNode.active = true;\n            this.pauseNode.setLocalZOrder(10);\n        }\n    },\n\n    //显示数字选择\n    showChooseNum: function () {\n        Global.game.playSound('btn', 0.1);\n        this.chooseNode.active = true;\n        this.chooseNode.setLocalZOrder(1);\n        if (this.bornGrid) {\n            this.bornGrid.pauseAllActions();\n        }\n        this.node.pauseAllActions();\n    },\n\n    //隐藏数字选择\n    hideChooseNum: function () {\n        Global.game.playSound('btn', 0.1);\n        this.chooseNode.active = false;\n        if (this.bornGrid) {\n            this.bornGrid.resumeAllActions();\n        }\n        this.node.resumeAllActions();\n    },\n\n    //重新开始\n    onRestart: function () {\n        Global.game.playSound('btn', 0.1);\n        this.closeListen();\n        this.reset();\n\n        if (this.bornGrid && this.bornGrid.parent) {\n            this.bornGrid.parent.removeChild(this.bornGrid);\n        }\n        Global.game.restart();\n    },\n\n    //返回主界面\n    onMainScene: function () {\n        Global.game.playSound('btn', 0.1);\n        this.closeListen();\n        this.reset();\n\n        if (this.bornGrid && this.bornGrid.parent) {\n            this.bornGrid.parent.removeChild(this.bornGrid);\n        }\n        Global.game.startGame();\n        //返回主界面的时间如果是暂停状态那就恢复游戏\n        if (cc.game.isPaused()) {\n            cc.game.resume();\n        }\n    },\n\n    //分享\n    onShareGame: function () {\n        Global.game.playSound('btn', 0.1);\n        if (typeof FBInstant !== 'undefined') {\n            ThirdAPI.shareGame(this.getImgBase64(), null);\n        } else {\n            ThirdAPI.shareGame('screenshotForDown', null, null, '003');\n        }\n    },\n\n    //更新星星的数量\n    updateGold: function (goldNum) {\n        var goldLabel = this.goldNode.getChildByName('label');\n        goldLabel.getComponent(cc.Label).string = Global.wxGold;\n        //判断是否可以存储和飞入\n        if (Global.addGold[goldNum] === undefined) {\n            cc.log('update gold ');\n            return;\n        }\n        if (parseInt(Global.addGold[goldNum]) <= 0) {\n            return;\n        }\n        Global.wxGold += parseInt(Global.addGold[goldNum]);\n        console.log('1 :' + Global.addGold[goldNum] + \"goldNum :\" + goldNum);\n        //更新并存储\n        if (typeof wx !== 'undefined') {\n            let data = ThirdAPI.loadLocalScore();\n            var score = parseInt(data.maxscore);\n            var gold = parseInt(data.gold);\n            ThirdAPI.loadScore((maxscore, gold) => {\n                score = parseInt(maxscore);\n                gold = parseInt(gold);\n                console.log('gridController on ThirdAPI loadScore', score, parseInt(gold), Global.wxGold);\n            });\n            ThirdAPI.saveScore(score, Global.wxGold);\n        }\n\n        var goldLabel = this.goldNode.getChildByName('label');\n        goldLabel.getComponent(cc.Label).string = Global.wxGold;\n    },\n\n    //游戏结束\n    gameOver: function () {\n        this.node.stopAllActions();\n        this.closeListen();\n        cc.director.getScheduler().unschedule(this.getNextFriend, this);\n        this.begin = false;\n\n        //获取复活次数\n        Global.reviveShareTimes = ThirdAPI.loadReviveData();\n\n        //判断当局的次数和当天的复活次数\n        if (Global.reviveTimes < Global.reviveTotalTimes && Global.reviveShareTimes > 0) {\n            Global.game.showRevive();\n            Global.reviveUI.setScore(this.scoreScript.scoreNum);\n        } else {\n            Global.game.showShareUI();\n            Global.shareUI.updateMaxLabel(this.scoreScript.scoreNum);\n        }\n    },\n\n    //复活消除几行\n    clearGridForRevive: function () {\n        this.node.stopAllActions();\n        cc.director.getScheduler().schedule(this.getNextFriend, this, 1, false);\n\n        //暂停所有的格子动作\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                var grid = this.allGrids[hIndex][vIndex];\n                var gridView = grid.getComponent(\"gridView\");\n                if (gridView && gridView.item != null) {\n                    gridView.node.stopAllActions();\n                    gridView.item.getComponent(\"itemView\").node.stopAllActions();\n                }\n            }\n        }\n\n        //开始销毁 \n        var time = 0;\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.clearVNum; vIndex++) {\n                var grid = this.allGrids[hIndex][vIndex];\n                var gridView = grid.getComponent(\"gridView\");\n                if (gridView && gridView.item != null) {\n                    var itemViewScript = gridView.item.getComponent(\"itemView\");\n                    var clearTime = itemViewScript.toRevive();\n                    if (clearTime > time) {\n                        time = clearTime;\n                    }\n                    gridView.gridNum = 0;\n                    gridView.item = null;\n                }\n            }\n        }\n\n        this.clearAllJoin();\n\n        //销毁所有数字\n        for (let index = 0; index < Global.flyNumPools.length; index++) {\n            const element = Global.flyNumPools[index];\n            if (element && element.parent) {\n                element.getComponent('flynum').finished();\n            }\n        }\n\n        //添加触摸侦听\n        console.log('clear time:' + time);\n        var self = this;\n        self.node.runAction(cc.sequence(cc.delayTime(time + 0.1), cc.callFunc(function () {\n            if (self.bornGrid) {\n                self.bornGrid.stopAllActions();\n                if (self.bornGrid.parent) {\n                    self.bornGrid.parent.removeChild(self.bornGrid);\n                }\n            }\n            self.bornGrid = null;\n\n            //重置所有数据\n            //self.reset();\n            //初始化棋盘\n            //self.createAllGrid();\n            //添加触摸侦听\n            self.setTouchControl();\n            //开始处理业务逻辑\n            self.process();\n        })));\n    },\n    //时间判断加速\n    update: function () {\n        if (!this.begin) return;\n\n        var unixTime = (new Date()).getTime();\n        if (unixTime > (this.startTime + Global.accessTime) && this.addTimes < Global.addTimes) {\n            this.addTimes++;\n            this.startTime = (new Date()).getTime();\n\n            Global.gridDownSpeed *= 1.2;\n            Global.gridDownSpeed = parseInt(Global.gridDownSpeed * 100) / 100;\n            Global.waitToDown *= 0.8;\n            Global.waitToDown = parseInt(Global.waitToDown * 100) / 100;\n            console.log('加速', Global.gridDownSpeed, Global.waitToDown);\n        }\n\n        /*\n        if (this.updateWxRank && this.updateWxRank > 30) {\n            //console.log('redraw wx rank');\n            this.updateWxRank = 1;\n            let openDataContext = wx.getOpenDataContext();\n            let sharedCanvas = openDataContext.canvas;\n\n            let texture = new cc.Texture2D();\n            texture.initWithElement(sharedCanvas);\n            texture.handleLoadedTexture();\n            let sp = new cc.SpriteFrame(texture);\n\n            //this.nextFriendSp.type = cc.Sprite.Type.TILED;\n            this.nextFriendSp.spriteFrame = sp;\n            //this.nextFriendSp.node.height = texture.height;\n            console.log('超越好友图片高度',this.nextFriendSp.node.height);\n\n        } else {\n            this.updateWxRank++;\n        }*/\n    },\n\n    //重置\n    reset: function () {\n        var wxBannerAd = require('wxBannerAd');\n        wxBannerAd.destroyBannerAd();\n\n        this.node.stopAllActions();\n        cc.director.getScheduler().unschedule(this.getNextFriend, this);\n        this.begin = false;\n\n        //初始时间\n        this.startTime = (new Date()).getTime();\n        this.addTimes = 0;\n        Global.reviveTimes = 0;\n        Global.combineTimes = 0;\n        Global.testEnabled = false;\n        this.randomScore = 0;\n        Global.joinRandomScores = [];\n        Global.isPaused = false;\n        this.isClickBomming = false;\n        this.propClearTime = 0;\n        this.clickGridNum = 0;\n        this.createItemIndex = 0;\n        this.moveItemIndex = 0;\n        //销毁所有数字\n        for (let index = 0; index < Global.flyNumPools.length; index++) {\n            const element = Global.flyNumPools[index];\n            if (element && element.parent) {\n                element.getComponent('flynum').finished();\n            }\n        }\n\n        if (this.bornGrid) {\n            this.bornGrid.stopAllActions();\n            if (this.bornGrid.parent) {\n                this.bornGrid.parent.removeChild(this.bornGrid);\n            }\n        }\n        //销毁所有格子\n        if (this.allGrids.length > 0) {\n            for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n                for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                    var grid = this.allGrids[hIndex][vIndex];\n                    var gridView = grid.getComponent(\"gridView\");\n                    grid.stopAllActions();\n                    if (gridView && gridView.item != null) {\n                        gridView.item.getComponent(\"itemView\").toRemove();\n                    }\n\n                    //销毁grid\n                    if (grid.parent) {\n                        grid.parent.removeChild(grid);\n                    }\n                }\n            }\n            this.clearAllJoin();\n        }\n        this.allGrids = [];\n        this.scoreScript.reset();\n        this.bornGrid = null;\n        if (this.soonGridInstance && this.soonGridInstance.parent) {\n            this.soonGridInstance.parent.removeChild(this.soonGridInstance);\n        }\n        //重新根据权重生成数字\n        var myUtil = require('myUtil');\n        myUtil.randomForWeight(Global.weightScores);\n    },\n});"]}
{"version":3,"sources":["audioManager.js"],"names":["_audioManager","resource","bgm","init","regist","name","audioSource","console","log","registBGM","audioClip","unregist","unregistAll","play","isMute","stop","pause","resume","mute","key","hasOwnProperty","cc","audioEngine","setVolume","pauseAll","resumeAll","stopAll","playBGM","isLoop","finishCallback","self","loadRemoteSource","audio","currentBGM","setFinishCallback","stopBGM","loopBGM","list","push","loopfunc","loopBGMid","Math","floor","random","length","url","callback","failedCallback","loader","load","err","pauseBGM","resumeBGM","module","exports"],"mappings":"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","file":"audioManager.js","sourceRoot":"../../../../../assets/Scripts/common","sourcesContent":["let _audioManager = {\n\n    resource: {},\n    bgm: {},\n    \n    init () {\n\n    },\n\n    regist (name,audioSource) {\n        if (this.resource[name]) {\n            console.log('音频资源已存在: ',name);\n        }\n        this.resource[name] = audioSource;\n    },\n\n    registBGM(name, audioClip) {\n        if (this.bgm[name]) {\n            console.log('BGM音频资源已存在: ', name);\n        }\n        this.bgm[name] = audioClip;\n    },\n\n    unregist(name) {\n        if (this.resource[name]) {\n            this.resource[name] = null;\n        } else {\n            console.log('音频资源不存在: ', name);\n            return;\n        }\n    },\n\n    unregistAll() {\n        this.resource = {};\n    },\n\n    play(name) {\n        // 微信上不能改变音量,所以只能先这么处理;\n        if (this.isMute) {\n            return\n        }\n        if (this.resource[name]) {\n            this.resource[name].play();\n        } else {\n            console.log('音频资源不存在: ', name);\n            return;\n        }\n    },\n\n    stop(name) {\n        if (this.resource[name]) {\n            this.resource[name].play();\n        } else {\n            console.log('音频资源不存在: ', name);\n            return;\n        }\n    },\n\n\n    pause(name) {\n        if (this.resource[name]) {\n            this.resource[name].pause();\n        } else {\n            console.log('音频资源不存在: ', name);\n            return;\n        }\n    },\n\n    resume(name) {\n        // 微信上不能改变音量,所以只能先这么处理;\n        if (this.isMute) {\n            return\n        }\n        if (this.resource[name]) {\n            this.resource[name].resume();\n        } else {\n            console.log('音频资源不存在: ', name);\n            return;\n        }\n    },\n\n\n    mute (isMute) {\n        this.isMute = isMute;\n        for (const key in this.resource) {\n            if (this.resource.hasOwnProperty(key)) {\n                this.resource[key].mute = isMute;\n            }\n        }\n        if (isMute) {\n            cc.audioEngine.setVolume(0);\n            this.pauseAll();\n        } else {\n            cc.audioEngine.setVolume(1);\n            this.resumeAll();\n        }\n\n    },\n\n    stopAll() {\n        for (const key in this.resource) {\n            if (this.resource.hasOwnProperty(key)) {\n                this.resource[key].stop();\n            }\n        }\n    },\n\n    pauseAll() {\n        for (const key in this.resource) {\n            if (this.resource.hasOwnProperty(key)) {\n                this.resource[key].pause();\n            }\n        }\n    },\n\n    resumeAll() {\n        // 微信上不能改变音量,所以只能先这么处理;\n        if (this.isMute) {\n            return\n        }\n        for (const key in this.resource) {\n            if (this.resource.hasOwnProperty(key)) {\n                this.resource[key].resume();\n            }\n        }\n    },\n\n    playBGM(name,isLoop,finishCallback) {\n        console.log('playBGM', name, isLoop)\n        if (this.isMute) {\n            return\n        }\n        if (this.bgm[name]) {\n            let self = this;\n            this.loadRemoteSource(this.bgm[name],(audio)=>{\n                console.log('current play bgm',name,audio)\n                self.currentBGM = cc.audioEngine.play(audio, isLoop, 1);\n                console.log('current bgm id',self.currentBGM);\n                if (!isLoop) {\n                    cc.audioEngine.setFinishCallback(self.currentBGM, () => {\n                        self.currentBGM = null;\n                        if (finishCallback) {\n                            finishCallback();\n                        }\n                    })\n                }\n            })\n\n        }\n    },\n\n    stopBGM() {\n        if (typeof this.currentBGM == 'number') {\n            cc.audioEngine.stop(this.currentBGM);\n        }\n    },\n\n    loopBGM() {\n        let list = [];\n        for (const key in this.bgm) {\n            if (this.bgm.hasOwnProperty(key)) {\n                const name = this.bgm[key];\n                list.push(key);\n            }\n        }\n        console.log('play loop bgm',list)\n        let self = this;\n\n        let loopfunc = null;\n        loopfunc = function () {\n            self.loopBGMid = Math.floor(Math.random() * list.length);\n            self.playBGM(list[self.loopBGMid], false, loopfunc);\n            console.log('now playing :', list[self.loopBGMid])\n        }\n        this.loopBGMid = Math.floor(Math.random() * list.length);\n        console.log('now playing :', list[self.loopBGMid])\n        this.playBGM(list[self.loopBGMid], false, loopfunc);\n        \n    },\n\n    loadRemoteSource(url,callback,failedCallback) {\n        cc.loader.load(url, (err, audio) => {\n            if (err) {\n                console.log('load error', err);\n                if (failedCallback) {\n                    failedCallback();\n                }\n                return\n            }\n            if (callback) {\n                callback(audio);\n            }\n        })\n    },\n\n    pauseBGM() {\n        console.log('pause bgm', this.currentBGM);\n        if (typeof this.currentBGM == 'number') {\n            cc.audioEngine.pause(this.currentBGM);\n        }\n    },\n\n    resumeBGM() {\n        console.log('resume bgm', this.currentBGM);\n        if (typeof this.currentBGM == 'number') {\n            cc.audioEngine.resume(this.currentBGM);\n        }\n    },\n\n}\n\nmodule.exports = _audioManager;"]}
{"version":3,"sources":["wxAPI.js"],"names":["WXGlobal","initOnEnter","console","log","options","getLaunchOptionsSync","shareTicket","scene","query","isSticky","queryString","helpInfo","setShareTicketEnabled","showShareMenu","registShare","registOnShow","registOnError","userInfo","nickName","maxscore","gold","iv","signature","gender","avatarUrl","sysInfo","wx","getSystemInfoSync","GameClubButton","createGameClubButton","icon","style","left","top","screenHeight","width","height","error","showGameClub","value","show","hide","isFromGroup","parseInt","sourceCode","getEnterGroupShareInfo","params","onShow","res","Global","judgeReviveCoin","onError","message","stack","getAuth","callback","getUserInfo","success","setUserCloudStorage","KVDataList","key","fail","errMsg","indexOf","complete","self","myUtil","require","onShareAppMessage","imageurl","cdnShareImages","length","randomForArray","image","shareImages","text","cdnTexts","shareTexts","setQueryInfo","title","imageUrl","shareGame","imageTag","failcallback","sourcecode","getShareScreenShot","getShareScreenShotForDown","img","cdnShareImages1","cdnTexts1","index","randomIndexForArray","shareAppMessage","shareTickets","shareTicketEnabled","getShareInfo","result","encryptedData","tywx","UserInfo","wxgame_session_key","resultString","decrypt","JSON","parse","openid","openGId","crypted","crypto","Buffer","decipher","createDecipheriv","decoded","update","final","login","setMaxScore","isEnabled","updateShareMenu","withShareTicket","obj","getShareUserInfo","hideShareMenu","canvas","toTempFilePathSync","x","y","destWidth","destHeight","getScreenShot","initFriendRank","openDataContext","getOpenDataContext","msg","type","postMessage","getNextFriendRank","score","rect","getFriendRank","getGroupRank","undefined","userId","SystemInfo","gameId","Date","saveScore","loadScore","shakeShort","vibrateShort","shakeLong","vibrateLong","exit","exitMiniProgram","getSystemInfo","module","exports"],"mappings":"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","file":"wxAPI.js","sourceRoot":"../../../../../assets/Scripts/common","sourcesContent":["let WXGlobal = {\n\n\n    initOnEnter: function () {\n        console.log('get launch options')\n        let options = this.getLaunchOptionsSync();\n        console.log('launch options', options);\n        this.shareTicket = options.shareTicket;\n        this.scene = options.scene;\n        this.query = options.query;\n        this.isSticky = options.isSticky;\n        this.queryString = '';\n        this.helpInfo = null;\n\n        this.setShareTicketEnabled(true);\n        this.showShareMenu();\n        // this.getAuth();\n        this.registShare();\n        this.registOnShow();\n        this.registOnError();\n\n        this.userInfo = {\n            nickName: '不愿透露姓名的老王',\n            maxscore: 0,\n            gold: 0,\n            iv: '',\n            signature: '',\n            gender: 1,\n            avatarUrl: 'res/raw-assets/resources/textures/gridItem/rank_1.png'\n        }\n\n        try {\n            var sysInfo = wx.getSystemInfoSync();\n\n            this.GameClubButton = wx.createGameClubButton({\n                icon: 'green',\n                style: {\n                    left: 10,\n                    top: sysInfo.screenHeight / 2 - 20 - 25,\n                    width: 40,\n                    height: 40\n                }\n            })\n        } catch (error) {\n\n        }\n\n\n        //this.showGameClub();\n    },\n\n    showGameClub: function (value) {\n        if (!this.GameClubButton) return;\n\n        if (value) {\n            console.log('显示游戏圈按钮');\n            this.GameClubButton.show()\n        } else {\n            console.log('隐藏游戏圈按钮');\n            this.GameClubButton.hide()\n        }\n    },\n\n    isFromGroup: function () {\n        console.log('isFromGroup', WXGlobal.shareTicket, WXGlobal.helpInfo);\n        console.log('比较分享点是否为送宝箱点：', parseInt(WXGlobal.helpInfo.sourceCode), parseInt(\"3020000006\"), parseInt(WXGlobal.helpInfo.sourceCode) == parseInt(\"3020000006\"));\n\n        return (WXGlobal.shareTicket) && WXGlobal.helpInfo && parseInt(WXGlobal.helpInfo.sourceCode) == parseInt(\"3020000006\");\n    },\n\n    // 获取游戏进入的微信群分享点\n    getEnterGroupShareInfo: function () {\n        console.log('getEnterGroupSharePoint', WXGlobal.shareTicket, WXGlobal.helpInfo);\n\n        if (!WXGlobal.shareTicket) {\n            console.log('不是从微信群点击进入！', WXGlobal.shareTicket);\n            return null;\n        }\n\n        return WXGlobal.helpInfo;\n    },\n\n    registOnShow: function (params) {\n        wx.onShow((res) => {\n            console.log('------------------wx onShow-------------------', res);\n            if (res.shareTicket) {\n                WXGlobal.shareTicket = res.shareTicket;\n            }\n            if (res.query) {\n                WXGlobal.helpInfo = res.query;\n            }\n            /*\n            if (params.callback) {\n                params.callback();\n            }*/\n\n            if (Global.judgeReviveCoin) {\n                Global.judgeReviveCoin(WXGlobal.shareTicket, WXGlobal.helpInfo);\n            }\n        });\n    },\n\n    registOnError: function () {\n        wx.onError((res) => {\n            console.log('wx error:' + res.message + '\\nstack:\\n' + res.stack);\n        })\n    },\n\n    getAuth: function (callback) {\n        wx.getUserInfo({\n            success: function (res) {\n                // iOS 和 Android 对于拒绝授权的回调 errMsg 没有统一，需要做一下兼容处理\n                console.log(res);\n                WXGlobal.userInfo = res.userInfo\n                WXGlobal.setUserCloudStorage({\n                    KVDataList: [{\n                            key: 'name',\n                            value: res.userInfo.nickName\n                        },\n                        {\n                            key: 'gender',\n                            value: res.userInfo.gender + ''\n                        },\n                        {\n                            key: 'avatarUrl',\n                            value: res.userInfo.avatarUrl\n                        },\n                        {\n                            key: 'iv',\n                            value: res.iv\n                        },\n                        {\n                            key: 'signature',\n                            value: res.signature\n                        },\n                    ],\n                    success: function () {\n                        console.log('set User Cloud Storage success');\n                    }\n                })\n            },\n            fail: function (res) {\n                // iOS 和 Android 对于拒绝授权的回调 errMsg 没有统一，需要做一下兼容处理\n                if (res.errMsg.indexOf('auth deny') > -1 || res.errMsg.indexOf('auth denied') > -1) {\n                    // 处理用户拒绝授权的情况\n                    console.log(res);\n                    WXGlobal.userInfo = {\n                        nickName: '不愿透露姓名的老王',\n                        maxscore: 0,\n                        gold: 0,\n                        iv: '',\n                        signature: '',\n                        gender: 1,\n                        avatarUrl: 'res/raw-assets/resources/textures/gridItem/rank_1.png'\n                    }\n                    console.log('set UserInfo default');\n                }\n            },\n            complete: function () {\n                if (callback) {\n                    callback();\n                }\n            }\n        })\n    },\n\n    registShare: function () {\n        var self = this;\n        var myUtil = require(\"myUtil\");\n        this.onShareAppMessage(() => {\n            //self.shareGame('randomImg', null, null, '001');\n\n            //分享图片\n            var imageurl;\n            if (Global.cdnShareImages && Global.cdnShareImages.length > 0) {\n                imageurl = myUtil.randomForArray(Global.cdnShareImages);\n                console.log('从cdn请求分享图：', imageurl);\n            } else {\n                var image = myUtil.randomForArray(Global.shareImages);\n                imageurl = 'res/raw-assets/resources/textures/gridItem/' + image;\n                console.log('从本地请求分享图：', imageurl);\n            }\n\n            //分享文字\n            var text;\n            if (Global.cdnTexts && Global.cdnTexts.length > 0) {\n                text = myUtil.randomForArray(Global.cdnTexts);\n                console.log('从cdn请求分享文字：', text);\n            } else {\n                text = myUtil.randomForArray(Global.shareTexts);\n                console.log('从本地读取分享文字：', text);\n            }\n\n            // var img = myUtil.randomForArray(Global.shareImages);\n            // imageurl = 'res/raw-assets/resources/textures/gridItem/' + img;\n            this.setQueryInfo('001', imageurl);\n\n            console.log('用户点击了右上按钮并分享,query:', WXGlobal.queryString);\n            return {\n                title: text,\n                imageUrl: imageurl,\n                query: WXGlobal.queryString\n            }\n\n\n            /*\n                        var myUtil = require(\"myUtil\");\n                        var text = myUtil.randomForArray(Global.shareTexts);\n                        console.log('用户点击了右上按钮并分享,query:', WXGlobal.queryString, ' text:' + text);\n                        var img = WXGlobal.getShareScreenShot();\n\n                        self.setQueryInfo(sourcecode, imageurl);\n\n                        WXGlobal.shareAppMessage({\n                            title: text,\n                            imageUrl: img,\n                            query: WXGlobal.queryString\n                        });*/\n        })\n    },\n\n    //分享  001点击转发   002点击群排行    003分享界面点击分享  004 复活界面\n    shareGame: function (imageTag, callback, failcallback, sourcecode) {\n        var myUtil = require(\"myUtil\");\n\n        var imageurl;\n        if (imageTag == \"screenshot\") {\n            imageurl = WXGlobal.getShareScreenShot();\n            this.setQueryInfo(sourcecode, 'screenshot');\n        } else if (imageTag == \"screenshotForDown\") {\n            imageurl = WXGlobal.getShareScreenShotForDown();\n            this.setQueryInfo(sourcecode, 'screenshot');\n        } else {\n            if (Global.cdnShareImages && Global.cdnShareImages.length > 0) {\n                imageurl = myUtil.randomForArray(Global.cdnShareImages);\n                console.log('从cdn请求分享图：', imageurl);\n            } else {\n                var img = myUtil.randomForArray(Global.shareImages);\n                imageurl = 'res/raw-assets/resources/textures/gridItem/' + img;\n                console.log('从本地请求分享图：', imageurl);\n            }\n\n\n            // var img = myUtil.randomForArray(Global.shareImages);\n            // imageurl = 'res/raw-assets/resources/textures/gridItem/' + img;\n            this.setQueryInfo(sourcecode, imageurl);\n        }\n        /*\n                if (!imageurl) {\n                    imageurl = myUtil.randomForArray(Global.shareImages);\n                } else {\n                    imageurl = 'ScreenShot';\n                }*/\n\n\n        //分享文字\n        var text;\n        if (Global.cdnTexts && Global.cdnTexts.length > 0) {\n            text = myUtil.randomForArray(Global.cdnTexts);\n            console.log('从cdn请求分享文字：', text);\n        } else {\n            text = myUtil.randomForArray(Global.shareTexts);\n            console.log('从本地读取分享文字：', text);\n        }\n        console.log('用户点击分享,query:', WXGlobal.queryString);\n\n        if (sourcecode == '005' || sourcecode == '006') {\n            //text = '20W分大佬都在用的道具免费送，快来抢吧！';\n            if (Global.cdnShareImages1 && Global.cdnShareImages1.length > 0 &&\n                Global.cdnTexts1 && Global.cdnTexts1.length > 0) {\n                var index = myUtil.randomIndexForArray(Global.cdnShareImages1);\n                imageurl = Global.cdnShareImages1[index];\n                text = Global.cdnTexts1[index];\n                console.log('从cdn请求分享图：', imageurl, text);\n            }\n        }\n\n        WXGlobal.shareAppMessage({\n            title: text,\n            imageUrl: imageurl,\n            query: WXGlobal.queryString,\n            success: (res) => {\n                console.log('wx分享成功', res);\n                if (res.shareTickets) {\n                    WXGlobal.shareTicketEnabled = true;\n                    WXGlobal.shareTicket = res.shareTickets[0];\n\n                    wx.getShareInfo({\n                        shareTicket: res.shareTickets[0],\n                        success: function (result) {\n                            console.log('获取分享信息成功', result);\n                            if (result) {\n                                //判断秘钥是否有用\n                                var iv = result.iv;\n                                var encryptedData = result.encryptedData;\n                                console.log('解析分享信息', tywx.UserInfo.wxgame_session_key, iv, encryptedData);\n                                try {\n                                    var resultString = WXGlobal.decrypt(tywx.UserInfo.wxgame_session_key, iv, encryptedData);\n                                    console.log(resultString);\n                                    if (resultString) {\n                                        resultString = JSON.parse(resultString);\n                                        let openid = '';\n                                        // 分享\n                                        if (resultString.openGId) {\n                                            openid = resultString.openGId;\n                                        }\n                                        console.log('分享群ID:', openid);\n                                        if (callback != null) {\n                                            callback(openid, WXGlobal.shareTicket);\n                                        }\n                                    } else {\n                                        if (failcallback) {\n                                            failcallback();\n                                        }\n                                    }\n                                } catch (error) {\n\n                                }\n                            }\n                        },\n                        fail: () => {\n                            console.log('获取分享信息失败');\n                            if (failcallback) {\n                                failcallback();\n                            }\n                        },\n                        complete: () => {\n\n                        },\n                    })\n                } else {\n                    console.log('wx分享到群失败', failcallback);\n                    if (failcallback) {\n                        failcallback();\n                    }\n                }\n            },\n            fail: () => {\n                console.log('wx分享失败', failcallback);\n                if (failcallback) {\n                    failcallback();\n                }\n            }\n        });\n\n\n\n        // WXGlobal.shareAppMessage({\n        //     title: text,\n        //     imageUrl: imageurl,\n        //     query: WXGlobal.queryString,\n        //     /*success: (res) => {\n        //         console.log('wx分享成功', res);\n        //         if (res.shareTickets) {\n        //             WXGlobal.shareTicketEnabled = true;\n        //             WXGlobal.shareTicket = res.shareTickets[0];\n        //         }\n        //         if (callback) {\n        //             callback(res.shareTickets);\n        //         }\n        //     },*/\n\n        //     success: function (result) {\n        //         wx.getShareInfo({\n        //             shareTicket: result.shareTickets[0],\n        //             success: function (result) {\n        //                 console.log('获取分享信息成功', result);\n        //                 if (result) {\n        //                     //判断秘钥是否有用\n        //                     var iv = result.iv;\n        //                     var encryptedData = result.encryptedData;\n        //                     console.log('解析分享信息', tywx.UserInfo.wxgame_session_key, iv, encryptedData);\n        //                     var resultString = WXGlobal.decrypt(tywx.UserInfo.wxgame_session_key, iv, encryptedData);\n        //                     console.log(resultString);\n        //                     if (resultString) {\n        //                         resultString = JSON.parse(resultString);\n        //                         let openid = '';\n        //                         // 分享\n        //                         if (resultString.openGId) {\n        //                             openid = resultString.openGId;\n        //                         }\n        //                         console.log('分享群ID:', openid);\n        //                         if (callback != null) {\n        //                             callback(openid, result.);\n        //                         }\n        //                     } else {\n        //                         if (failcallback) {\n        //                             failcallback();\n        //                         }\n        //                     }\n        //                 }\n        //             },\n        //             fail: () => {\n        //                 console.log('获取分享信息失败');\n        //                 if (failcallback) {\n        //                     failcallback();\n        //                 }\n        //             },\n        //             complete: () => {\n\n        //             },\n        //         });\n\n        //     },\n        //     fail: () => {\n        //         console.log('wx分享失败', failcallback);\n        //         if (failcallback) {\n        //             failcallback();\n        //         }\n        //     },\n        // })\n    },\n\n    decrypt: function (key, iv, crypted) {\n        var crypto = require('crypto');\n\n        crypted = new Buffer(crypted, 'base64');\n        iv = new Buffer(iv, 'base64');\n        key = new Buffer(key, 'base64');\n        var decipher = crypto.createDecipheriv('aes-128-cbc', key, iv);\n        var decoded = decipher.update(crypted, 'binary', 'utf8');\n        decoded += decipher.final('utf8');\n        return decoded;\n    },\n\n    login: function (callback) {\n        wx.login(callback);\n    },\n\n    setMaxScore: function (maxscore, gold) {\n\n        WXGlobal.queryString =\n            'nickName=' + WXGlobal.userInfo.nickName + '&' +\n            'maxscore=' + maxscore + '&' +\n            'gold=' + gold + '&' +\n            'gender=' + WXGlobal.userInfo.gender + '&' +\n            'avatarUrl=' + WXGlobal.userInfo.avatarUrl;\n\n        console.log('wx setMaxScore, query:', WXGlobal.queryString);\n    },\n\n    // 返回小程序启动参数\n    getLaunchOptionsSync: function () {\n        return wx.getLaunchOptionsSync()\n    },\n\n    setShareTicketEnabled: function (isEnabled) {\n        wx.updateShareMenu({\n            withShareTicket: isEnabled,\n            success: () => {\n                WXGlobal.shareTicketEnabled = isEnabled;\n            }\n        })\n    },\n\n    getShareInfo: function (obj) {\n        return wx.getShareInfo(obj)\n    },\n\n    getShareUserInfo: function () {\n        return this.query\n    },\n\n    showShareMenu: function () {\n        console.log('显示右上菜单的转发按钮');\n        wx.showShareMenu();\n    },\n    hideShareMenu: function () {\n        console.log('隐藏右上菜单的转发按钮');\n        wx.hideShareMenu();\n    },\n    onShareAppMessage: function (callback) {\n        console.log('注册点击转发按钮事件');\n        wx.onShareAppMessage(callback);\n    },\n    shareAppMessage: function (params) {\n        console.log('转发:', params);\n        wx.shareAppMessage(params);\n    },\n\n    getShareScreenShot: function () {\n        return canvas.toTempFilePathSync({\n            x: 0,\n            y: 0.5 * canvas.height - 0.8 * 0.8 * canvas.width,\n            width: canvas.width,\n            height: 0.8 * canvas.width,\n            destWidth: 500,\n            destHeight: 400,\n        })\n    },\n\n    getShareScreenShotForDown: function () {\n        return canvas.toTempFilePathSync({\n            x: 0,\n            y: 0.5 * canvas.height + 0 * canvas.width,\n            width: canvas.width,\n            height: 0.8 * canvas.width,\n            destWidth: 500,\n            destHeight: 400,\n        })\n    },\n\n    getScreenShot: function () {\n        return canvas.toTempFilePathSync({})\n    },\n\n    initFriendRank: function () {\n        try {\n            let openDataContext = wx.getOpenDataContext()\n            let msg = {\n                type: 'initFriendRank',\n            }\n            if (WXGlobal.shareTicketEnabled) {\n                msg.shareTicket = WXGlobal.shareTicket;\n            }\n            console.log(msg);\n\n            openDataContext.postMessage(msg);\n        } catch (error) {\n\n        }\n    },\n\n    getNextFriendRank: function (params) {\n        try {\n            let openDataContext = wx.getOpenDataContext()\n            let msg = {\n                type: 'getNextFriend',\n                score: params.score,\n                width: params.rect.width,\n                height: params.rect.height,\n            }\n            if (WXGlobal.shareTicketEnabled) {\n                msg.shareTicket = WXGlobal.shareTicket;\n            }\n            console.log(msg);\n\n            openDataContext.postMessage(msg);\n            if (params.callback) {\n                params.callback('wx');\n            }\n        } catch (error) {\n\n        }\n    },\n\n    getFriendRank: function (params) {\n        try {\n            let openDataContext = wx.getOpenDataContext()\n            let msg = {\n                type: 'getFriendRank',\n                width: params.rect.width,\n                height: params.rect.height,\n            }\n            if (WXGlobal.shareTicketEnabled) {\n                msg.shareTicket = WXGlobal.shareTicket;\n            }\n            console.log(msg);\n\n            openDataContext.postMessage(msg);\n            if (params.callback) {\n                params.callback('wx');\n            }\n        } catch (error) {\n\n        }\n    },\n\n    getGroupRank: function (params) {\n        var myUtil = require(\"myUtil\");\n        //if (!WXGlobal.shareTicketEnabled || typeof this.shareTicket === 'undefined') {\n        var image = myUtil.randomForArray(Global.shareImages);\n        this.shareGame('res/raw-assets/resources/textures/gridItem/' + image, (openGId, shareTicket) => {\n                console.log('on get group rank pre share', shareTicket);\n                //分享给个人\n                if (!shareTicket) {\n                    if (params.callback) {\n                        params.callback();\n                    }\n                } else {\n                    try {\n                        //分享给群\n                        let openDataContext = wx.getOpenDataContext()\n                        let msg = {\n                            type: 'getGroupRank',\n                            width: params.rect.width,\n                            height: params.rect.height,\n                            shareTicket: shareTicket\n                        }\n                        console.log(msg);\n                        openDataContext.postMessage(msg);\n                        if (params.callback) {\n                            params.callback(openGId, shareTicket);\n                            this.shareTicket = undefined;\n                        }\n                    } catch (error) {\n\n                    }\n                }\n            },\n            () => {\n                //分享失败\n                if (params.callback) {\n                    params.callback();\n                }\n            }, '002');\n        return;\n        //} \n        /*else {\n            let openDataContext = wx.getOpenDataContext()\n            let msg = {\n                type: 'getGroupRank',\n                width: params.rect.width,\n                height: params.rect.height,\n                shareTicket: this.shareTicket\n            }\n            console.log(msg);\n            openDataContext.postMessage(msg);\n            if (params.callback) {\n                params.callback('success');\n            }\n        }*/\n    },\n\n    setQueryInfo: function (sourcecode, imageUrl) {\n        WXGlobal.queryString =\n            'nickName=' + WXGlobal.userInfo.nickName + '&' +\n            'inviteCode=' + tywx.UserInfo.userId + '&' +\n            'sourceCode=' + tywx.SystemInfo.gameId * 10000 + sourcecode + '&' +\n            'imageType=' + imageUrl + '&' +\n            'shareTime=' + new Date();\n        console.log(WXGlobal.queryString);\n    },\n\n    /*\n    params:\n    {\n        KVDataList: [\n            { key: 'maxscore', value: score + '' },\n            { key: 'name', value: res.userInfo.nickName },\n        ],\n        success: function () {},\n        failed: function () {},\n        comlete: function () {},\n    }\n    kvdata的key和value必须为string\n    */\n    setUserCloudStorage: function (params) {\n        console.log('setUserCloudStorage:', params);\n        wx.setUserCloudStorage(params);\n    },\n\n    /*\n    params:\n    {\n        maxscore: int,\n        crystal: int,\n        callback: function () {},\n    }\n    */\n    saveScore: function (maxscore, gold, callback) {\n        if (typeof wx === 'undefined') return;\n        let obj = {\n            KVDataList: [{\n                    key: 'maxscore',\n                    value: maxscore + ''\n                },\n                {\n                    key: 'gold',\n                    value: gold + ''\n                },\n            ],\n            success: callback\n        }\n        console.log('wx saveScore:', obj);\n        this.setUserCloudStorage(obj);\n        this.setMaxScore(maxscore, gold);\n    },\n    loadScore: function (params) {\n        // 微信无法在主域获取用户托管数据\n        // if (typeof wx !== 'undefined') {\n        //     console.log('wx loadScore:', params);\n        //     this.getUserCloudStorage(params);\n        // }\n    },\n    /*\n参数格式:\n{\n    success: function () {},\n    failed: function () {},\n    comlete: function () {},\n}\n*/\n    shakeShort: function (params) {\n        wx.vibrateShort(params);\n    },\n\n    /*\n    参数格式:\n    {\n        success: function () {},\n        failed: function () {},\n        comlete: function () {},\n    }\n    */\n    shakeLong: function (params) {\n        wx.vibrateLong(params);\n    },\n    exit: function () {\n        wx.exitMiniProgram({\n            success: (res) => {\n                console.log('exit game:', res)\n            }\n        })\n    },\n\n    getSystemInfo: function () {\n        return wx.getSystemInfoSync()\n    },\n\n}\n\nmodule.exports = WXGlobal;"]}
{"version":3,"sources":["wxBannerAd.js"],"names":["wxBannerAd","bannerAd","bannerAdTimer","createBannerAd","console","log","wx","destroyBannerAd","sysInfo","getSystemInfoSync","isFitIphoneX","model","toLowerCase","replace","indexOf","adUnitId","style","left","top","width","show","addBannerAdTimer","onResize","res","height","realWidth","realHeight","fitOffsetY","screenHeight","cc","winSize","screenWidth","Global","game","btnCloseBanner","active","setLocalZOrder","posx","posy","setPosition","position","error","hideBannerAd","hide","showBannerAd","destroy","clearTimeout","bannerAdConfig","swith","setTimeout","interval","module","exports"],"mappings":";;;;;;AAAA;;AAEA,IAAIA,aAAa;AACbC,cAAU,IADG;AAEbC,mBAAe,IAFF;;AAIbC,oBAAgB,0BAAY;AAAA;;AACxBC,gBAAQC,GAAR,CAAY,mBAAZ;;AAEA,YAAI,OAAOC,EAAP,KAAc,WAAlB,EAA+B;AAC3B,gBAAI;AACA,qBAAKC,eAAL;AACA;;AAEA,oBAAIC,UAAUF,GAAGG,iBAAH,EAAd;AACA;AACA,oBAAIC,eAAgBF,QAAQG,KAAR,CAAcC,WAAd,GAA4BC,OAA5B,CAAoC,MAApC,EAA4C,EAA5C,EAAgDC,OAAhD,CAAwD,SAAxD,EAAkE,CAAlE,KAAwE,CAAC,CAA7F;;AAEA,qBAAKb,QAAL,GAAgBK,GAAGH,cAAH,CAAkB;AAC9BY,8BAAU,yBADoB;AAE9BC,2BAAO;AACHC,8BAAM,CADH;AAEHC,6BAAK,CAFF;AAGHC,+BAAO;AAHJ;AAFuB,iBAAlB,CAAhB;;AASA,oBAAI,KAAKlB,QAAT,EAAmB;;AAEf,yBAAKA,QAAL,CAAcmB,IAAd;AACA,yBAAKC,gBAAL;;AAEA,yBAAKpB,QAAL,CAAcqB,QAAd,CAAuB,eAAO;AAC1BlB,gCAAQC,GAAR,CAAY,MAAZ,EAAoBkB,IAAIJ,KAAxB,EAA+BI,IAAIC,MAAnC;AACA,4BAAI,MAAKvB,QAAL,CAAce,KAAlB,EAAyB;AACrBZ,oCAAQC,GAAR,CAAY,OAAZ,EAAqB,MAAKJ,QAAL,CAAce,KAAd,CAAoBS,SAAzC,EAAoD,MAAKxB,QAAL,CAAce,KAAd,CAAoBU,UAAxE;;AAEA,gCAAIC,aAAajB,eAAe,IAAf,GAAsB,CAAvC;AACAN,oCAAQC,GAAR,CAAY,aAAZ,EAA2BsB,UAA3B,EAAuCjB,YAAvC;AACAN,oCAAQC,GAAR,CAAY,aAAZ,EAA2BG,QAAQoB,YAAnC,EAAiDC,GAAGC,OAAH,CAAWN,MAA5D,EAAoEhB,QAAQoB,YAAR,GAAuBC,GAAGC,OAAH,CAAWN,MAAtG;;AAEA,kCAAKvB,QAAL,CAAce,KAAd,CAAoBC,IAApB,GAA2B,CAACT,QAAQuB,WAAR,GAAsBR,IAAIJ,KAA3B,IAAoC,CAA/D;AACA,kCAAKlB,QAAL,CAAce,KAAd,CAAoBE,GAApB,GAA0BV,QAAQoB,YAAR,GAAuBL,IAAIC,MAA3B,GAAoCG,UAA9D;;AAEAvB,oCAAQC,GAAR,CAAY,MAAZ,EAAoB,MAAKJ,QAAL,CAAce,KAAd,CAAoBE,GAAxC;;AAEA;;AAEA,gCAAIc,OAAOC,IAAP,IAAeD,OAAOC,IAAP,CAAYC,cAA/B,EAA+C;AAC3CF,uCAAOC,IAAP,CAAYC,cAAZ,CAA2BC,MAA3B,GAAoC,IAApC;AACAH,uCAAOC,IAAP,CAAYC,cAAZ,CAA2BE,cAA3B,CAA0C,GAA1C;;AAEA,oCAAIC,OAAQ,MAAKpC,QAAL,CAAce,KAAd,CAAoBG,KAApB,GAA0B,CAA3B,IAAiCX,QAAQoB,YAAR,GAAuBC,GAAGC,OAAH,CAAWN,MAAnE,IAA6EQ,OAAOC,IAAP,CAAYC,cAAZ,CAA2Bf,KAA3B,GAAiC,CAAzH;AACA,oCAAImB,OAAOT,GAAGC,OAAH,CAAWN,MAAX,GAAoB,CAApB,GAAyB,CAAC,CAA1B,GAA+BD,IAAIC,MAAJ,IAAchB,QAAQoB,YAAR,GAAuBC,GAAGC,OAAH,CAAWN,MAAhD,CAA/B,GAAyFQ,OAAOC,IAAP,CAAYC,cAAZ,CAA2BV,MAA3B,GAAkC,CAAtI;AACAQ,uCAAOC,IAAP,CAAYC,cAAZ,CAA2BK,WAA3B,CAAuCF,IAAvC,EAA4CC,IAA5C;AACAlC,wCAAQC,GAAR,CAAY,kDAAZ,EAAgE2B,OAAOC,IAAP,CAAYC,cAAZ,CAA2BC,MAA3F,EAAmGH,OAAOC,IAAP,CAAYC,cAAZ,CAA2BM,QAA9H;AACH;AACJ;AACJ,qBA1BD;AA2BH;AACJ,aAlDD,CAkDE,OAAOC,KAAP,EAAc;AACZrC,wBAAQC,GAAR,CAAYoC,KAAZ;AACH;AACJ;AACJ,KA9DY;;AAgEbC,kBAAc,wBAAY;AACtBtC,gBAAQC,GAAR,CAAY,mBAAZ;;AAEA,YAAI;AACA,gBAAI,KAAKJ,QAAT,EAAmB;AACf,qBAAKA,QAAL,CAAc0C,IAAd;AACH;AACJ,SAJD,CAIE,OAAOF,KAAP,EAAc,CAEf;AACJ,KA1EY;;AA4EbG,kBAAc,wBAAY;AACtBxC,gBAAQC,GAAR,CAAY,mBAAZ;;AAEA,YAAI;AACA,gBAAI,KAAKJ,QAAT,EAAmB;AACf,qBAAKA,QAAL,CAAcmB,IAAd;AACH;AACJ,SAJD,CAIE,OAAOqB,KAAP,EAAc,CAEf;AACJ,KAtFY;;AAwFb;AACAlC,qBAAiB,2BAAY;AACzBH,gBAAQC,GAAR,CAAY,sBAAZ;;AAEA,YAAI;AACA,gBAAI2B,OAAOC,IAAP,IAAeD,OAAOC,IAAP,CAAYC,cAA/B,EAA+C;AAC3CF,uBAAOC,IAAP,CAAYC,cAAZ,CAA2BC,MAA3B,GAAoC,KAApC;AACH;;AAED,gBAAI,KAAKlC,QAAT,EAAmB;AACf,qBAAKA,QAAL,CAAc4C,OAAd;AACA,qBAAK5C,QAAL,GAAgB,IAAhB;AACH;AACD6C,yBAAa,KAAK5C,aAAlB;AACA,iBAAKD,QAAL,GAAgB,IAAhB;AACA,iBAAKC,aAAL,GAAqB,IAArB;AACH,SAZD,CAYE,OAAOuC,KAAP,EAAc,CAEf;AACJ,KA3GY;;AA6Gb;AACApB,sBAAkB,4BAAY;AAAA;;AAC1BjB,gBAAQC,GAAR,CAAY,kBAAZ;AACA,YAAI,CAAC2B,OAAOe,cAAP,CAAsBC,KAA3B,EAAkC;AAC9B5C,oBAAQC,GAAR,CAAY,oBAAZ;AACAyC,yBAAa,KAAK5C,aAAlB;AACA,iBAAKA,aAAL,GAAqB,IAArB;AACA;AACH;AACD,aAAKA,aAAL,GAAqB+C,WAAW,YAAM;AAClC,mBAAK9C,cAAL;AACH,SAFoB,EAElB6B,OAAOe,cAAP,CAAsBG,QAFJ,CAArB;AAGH;AAzHY,CAAjB;;AA4HAC,OAAOC,OAAP,GAAiBpD,UAAjB","file":"wxBannerAd.js","sourceRoot":"../../../../../assets/Scripts/common","sourcesContent":["// banner广告接入\n\nlet wxBannerAd = {\n    bannerAd: null,\n    bannerAdTimer: null,\n\n    createBannerAd: function () {\n        console.log('call initBannerAd');\n\n        if (typeof wx !== 'undefined') {\n            try {\n                this.destroyBannerAd();\n                //var adheight = sysInfo.screenHeight/cc.winSize.height*( (cc.winSize.height * 0.693 + 208));\n\n                var sysInfo = wx.getSystemInfoSync();\n                // 判断是否为iphonex\n                var isFitIphoneX = (sysInfo.model.toLowerCase().replace(/\\s+/g, \"\").indexOf(\"iphonex\",0) != -1);\n\n                this.bannerAd = wx.createBannerAd({\n                    adUnitId: 'adunit-bde6af15378cfbbd',\n                    style: {\n                        left: 0,\n                        top: 0,\n                        width: 300\n                    }\n                })\n\n                if (this.bannerAd) {\n\n                    this.bannerAd.show();\n                    this.addBannerAdTimer();\n    \n                    this.bannerAd.onResize(res => {\n                        console.log(\"res:\", res.width, res.height)\n                        if (this.bannerAd.style) {\n                            console.log(\"real:\", this.bannerAd.style.realWidth, this.bannerAd.style.realHeight)\n                            \n                            var fitOffsetY = isFitIphoneX ? 0.01 : 0;\n                            console.log('fitOffsetY:', fitOffsetY, isFitIphoneX);\n                            console.log('res height:', sysInfo.screenHeight, cc.winSize.height, sysInfo.screenHeight / cc.winSize.height);\n        \n                            this.bannerAd.style.left = (sysInfo.screenWidth - res.width) / 2;\n                            this.bannerAd.style.top = sysInfo.screenHeight - res.height + fitOffsetY;\n        \n                            console.log(\"top:\", this.bannerAd.style.top);\n\n                            // 调整banner关闭按钮位置\n\n                            if (Global.game && Global.game.btnCloseBanner) {\n                                Global.game.btnCloseBanner.active = true;\n                                Global.game.btnCloseBanner.setLocalZOrder(999);\n\n                                var posx = (this.bannerAd.style.width/2) / (sysInfo.screenHeight / cc.winSize.height) + Global.game.btnCloseBanner.width/2;\n                                var posy = cc.winSize.height / 2 * (-1) + res.height / (sysInfo.screenHeight / cc.winSize.height) - Global.game.btnCloseBanner.height/2;\n                                Global.game.btnCloseBanner.setPosition(posx,posy);\n                                console.log(\"------------->>>>>>>>>>>>>>banner close btn pos:\", Global.game.btnCloseBanner.active, Global.game.btnCloseBanner.position);\n                            }\n                        }\n                    })\n                }\n            } catch (error) {\n                console.log(error);\n            }\n        }\n    },\n\n    hideBannerAd: function () {\n        console.log('call hideBannerAd');\n\n        try {\n            if (this.bannerAd) {\n                this.bannerAd.hide();\n            }\n        } catch (error) {\n            \n        }\n    },\n\n    showBannerAd: function () {\n        console.log('call showBannerAd');\n\n        try {\n            if (this.bannerAd) {\n                this.bannerAd.show();\n            }\n        } catch (error) {\n            \n        }\n    },\n\n    //销毁广告\n    destroyBannerAd: function () {\n        console.log('call destroyBannerAd');\n\n        try {\n            if (Global.game && Global.game.btnCloseBanner) {\n                Global.game.btnCloseBanner.active = false;\n            }\n\n            if (this.bannerAd) {\n                this.bannerAd.destroy();\n                this.bannerAd = null;\n            }\n            clearTimeout(this.bannerAdTimer);\n            this.bannerAd = null;\n            this.bannerAdTimer = null;\n        } catch (error) {\n            \n        }\n    },\n\n    //增加广告计时器\n    addBannerAdTimer: function () {\n        console.log('addBannerAdTimer');\n        if (!Global.bannerAdConfig.swith) {\n            console.log('关闭每60s刷新banner广告机制');\n            clearTimeout(this.bannerAdTimer);\n            this.bannerAdTimer = null;\n            return;\n        }\n        this.bannerAdTimer = setTimeout(() => {\n            this.createBannerAd();\n        }, Global.bannerAdConfig.interval);\n    },\n}\n\nmodule.exports = wxBannerAd;"]}
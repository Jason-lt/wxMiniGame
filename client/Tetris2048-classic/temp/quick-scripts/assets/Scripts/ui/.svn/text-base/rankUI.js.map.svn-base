{"version":3,"sources":["rankUI.js"],"names":["ThirdAPI","require","cc","Class","extends","Component","properties","gemStone","default","type","Prefab","goldNode","Node","btnZuan","top1","top2","rankPrefab","innerview","scrollView","content","btn_group","myrankNode","myrankBg","Sprite","myrankSpr","entries","itemHeight","arrItems","start","onLoad","setHandWidthAndHeight","canvas","find","width","onBtnGroupClick","showType","lbl_btn_group","string","getGroupRank","getFriendRank","initData","isGroup","wx","getComponent","ScrollView","scrollToTop","item","instantiate","itemheight","height","rankCount","console","log","sprite","getChildByName","length","index","setLocalZOrder","setPosition","p","addChild","element","setlevel","hideAll","active","updateGold","level","node","initGetGroupRank","FBInstant","getRank","w","h","x","y","drawRect","rect","callback","updateContent","updateWxRank","cleanRank","openGId","shareTicket","Global","gameinfo","shareGroupData","arrOpenGId","indexOf","push","saveFriendGenStoneInfo","closeThis","onGetZuan","num","playGetGoldEffect","goldLabel","Label","wxGold","parseInt","data","loadLocalScore","score","maxscore","gold","loadScore","saveScore","times","Math","floor","random","clearInterval","addInterval","setInterval","instance","position","pos","getPosition","toPosition","self","getLeaderboardAsync","then","leaderboard","getEntriesAsync","getMyRank","catch","fasle","ent","setScore","getScore","setNameAndPhoto","getExtraData","updateMyContent","entri","spriteFrame","toRankPoint","showGameClub","parent","removeChild","update","dt","openDataContext","getOpenDataContext","sharedCanvas","texture","Texture2D","initWithElement","handleLoadedTexture","sp","SpriteFrame","Type","TILED","error"],"mappings":"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","file":"rankUI.js","sourceRoot":"../../../../../assets/Scripts/ui","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\n// Learn Attribute:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\n\nlet ThirdAPI = require('../common/ThirdAPI')\ncc.Class({\n    extends: cc.Component,\n\n\n    properties: {\n        //随机钻石预设\n        gemStone: {\n            default: null,\n            type: cc.Prefab\n        },\n        //金币节点\n        goldNode: {\n            default: null,\n            type: cc.Node\n        },\n        //钻石按钮\n        btnZuan: {\n            default: null,\n            type: cc.Node\n        },\n        top1: {\n            default: null,\n            type: cc.Node,\n        },\n        top2: {\n            default: null,\n            type: cc.Node,\n        },\n        rankPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n        innerview: {\n            default: null,\n            type: cc.Node,\n        },\n        scrollView: {\n            default: null,\n            type: cc.Node,\n        },\n        content: {\n            default: null,\n            type: cc.Node,\n        },\n        btn_group: {\n            default: null,\n            type: cc.Node,\n        },\n        myrankNode: {\n            default: null,\n            type: cc.Node,\n        },\n        myrankBg: {\n            default: null,\n            type: cc.Sprite,\n        },\n        myrankSpr: {\n            default: null,\n            type: cc.Sprite,\n        },\n        entries: null,\n        itemHeight: 30,\n        arrItems: [],\n    },\n\n    start() {\n\n    },\n\n    onLoad: function () {\n        /*if (typeof wx !== 'undefined') {\n            this.lbl_btn_group = this.btn_group.getChildByName('Label').getComponent(cc.Label);\n            this.btn_group.active = true;\n            this.lbl_btn_group.string = '查看群排行';\n            this.showType = 1;\n            this.myrankNode.active = true;\n        } else {\n            this.btn_group.active = false;\n            this.myrankNode.active = false;\n            this.scrollView.height = 780;\n            // this.innerview.height = 820;\n            this.scrollView.y = -27;\n        }*/\n        this.setHandWidthAndHeight();\n    },\n\n    //设置头部图片的适配宽高\n    setHandWidthAndHeight: function () {\n        let canvas = cc.find('Canvas');\n        this.top1.width = canvas.width * 0.5;\n        this.top2.width = canvas.width * 0.5;\n    },\n\n    onBtnGroupClick: function () {\n        if (this.showType == 1) {\n            this.showType = 2;\n            this.lbl_btn_group.string = '查看好友排行';\n            this.getGroupRank();\n        } else {\n            this.showType = 1;\n            this.lbl_btn_group.string = '查看群排行';\n            this.getFriendRank();\n        }\n    },\n\n    initData: function (isGroup) {\n        if (typeof wx !== 'undefined') {\n            //this.myrankBg.node.setCascadeOpacityEnabled(true);\n            // this.myrankBg.node.setOpacity(255 * 0.3);\n            //this.myrankBg.node.setLocalZOrder(-1);\n        }\n\n        //每次重进游戏置顶\n        var scrollView = this.scrollView.getComponent(cc.ScrollView).scrollToTop(0);\n\n        let item = cc.instantiate(this.rankPrefab);\n        let itemheight = item.height + 5;\n        let rankCount = 20;\n        this.content.height = itemheight * rankCount;\n        console.log('content width:' + this.content.width);\n        //设置绘制照片姓名的画布\n        var sprite = this.content.getChildByName('sprite');\n        sprite.height = itemheight * rankCount;\n        //this.innerview.height -= 100;\n        //this.innerview.height = itemheight * rankCount;\n        if (this.arrItems.length == 0) {\n            for (let index = 0; index < rankCount; index++) {\n                let item = cc.instantiate(this.rankPrefab);\n                item.setLocalZOrder(-1);\n                item.setPosition(cc.p(0, -0.5 * itemheight - index * itemheight));\n                this.arrItems[index] = item;\n\n                this.content.addChild(item);\n            }\n        }\n\n        for (let index = 0; index < this.arrItems.length; index++) {\n            const element = this.arrItems[index];\n            element.getComponent('rankItem').setlevel(index + 1);\n            element.getComponent('rankItem').hideAll();\n        }\n\n        this.btnZuan.active = false;\n        //this.btnZuan.runAction(cc.repeatForever(cc.));\n        this.updateGold(0);\n        //开始获取排行榜\n        if (typeof wx !== 'undefined') {\n            for (let index = 0; index < this.arrItems.length; index++) {\n                const element = this.arrItems[index];\n                element.getComponent('rankItem').level.node.active = false;\n            }\n            if (isGroup) {\n                this.initGetGroupRank();\n            }\n            else {\n                this.getFriendRank();\n            }\n        } else if (typeof FBInstant !== 'undefined') {\n            this.getRank();\n        }\n    },\n\n    getFriendRank: function () {\n        console.log(\"getFriendRank\");\n        var sprite = this.content.getChildByName('sprite');\n        //sprite.width = this.content.width;\n\n        let w = sprite.width;\n        let h = sprite.height;\n        let x = this.innerview.x - 0.5 * w;\n        let y = this.innerview.y - 0.5 * h;\n        this.drawRect = {\n            x: x,\n            y: y,\n            width: w,\n            height: h\n        };\n        console.log('draw rect:', this.drawRect, \"this.content.width :\" + this.content.width, \"this.innerview.width\" + this.innerview.width + \"sprite.width :\" + sprite.width);\n        ThirdAPI.getRank({\n            rect: this.drawRect,\n            callback: (entries) => {\n                if (typeof entries === 'object') {\n                    this.updateContent(entries);\n                    // this.getMyRank();\n                } else if (typeof entries === 'string') {\n                    this.updateWxRank = 100;\n                }\n            }\n        }, 'Friend')\n    },\n\n\n    //初始化群排行\n    initGetGroupRank: function () {\n        console.log(\"getGroupRank\");\n\n        var sprite = this.content.getChildByName('sprite');\n\n        let w = sprite.width; //this.content.width;\n        let h = sprite.height; //this.content.height;\n        let x = this.innerview.x - 0.5 * w;\n        let y = this.innerview.y - 0.5 * h;\n        this.drawRect = {\n            x: x,\n            y: y,\n            width: w,\n            height: h\n        };\n        console.log('draw rect:', this.drawRect);\n\n        this.cleanRank();\n        ThirdAPI.getRank({\n            rect: this.drawRect,\n            callback: (openGId, shareTicket) => {\n                console.log('getGroupRank,oncallback', openGId, shareTicket);\n\n                if (openGId) {\n                    console.log('分享到群成功');\n                    this.cleanRank();\n                    this.updateWxRank = 1;\n\n                    if (Global.gameinfo.shareGroupData.arrOpenGId.indexOf(openGId) != -1) {\n                        console.log('该群今日已经分享过', openGId);\n                        //Global.game.showDialogText('该群今日已经分享过无法获得奖励');\n                        return;\n                    } else {\n                        console.log('该群未分享过', openGId);\n                        Global.gameinfo.shareGroupData.arrOpenGId.push(openGId);\n                        ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n\n                        this.btnZuan.active = true;\n                    }\n                } else {\n                    console.log('查看排行榜，分享到群失败');\n                    this.closeThis();\n                    this.btnZuan.active = false;\n                }\n            }\n        }, 'Group')\n    },\n\n    getGroupRank: function () {\n        console.log(\"getGroupRank\");\n\n        var sprite = this.content.getChildByName('sprite');\n\n        let w = sprite.width; //this.content.width;\n        let h = sprite.height; //this.content.height;\n        let x = this.innerview.x - 0.5 * w;\n        let y = this.innerview.y - 0.5 * h;\n        this.drawRect = {\n            x: x,\n            y: y,\n            width: w,\n            height: h\n        };\n        console.log('draw rect:', this.drawRect);\n\n        ThirdAPI.getRank({\n            rect: this.drawRect,\n            callback: (openGId, shareTicket) => {\n                console.log('getGroupRank,oncallback', openGId, shareTicket);\n\n                if (openGId) {\n                    console.log('分享到群成功');\n                    this.cleanRank();\n                    this.updateWxRank = 1;\n\n                    if (Global.gameinfo.shareGroupData.arrOpenGId.indexOf(openGId) != -1) {\n                        console.log('该群今日已经分享过', openGId);\n                        //Global.game.showDialogText('该群今日已经分享过无法获得奖励');\n                        return;\n                    } else {\n                        console.log('该群未分享过', openGId);\n                        Global.gameinfo.shareGroupData.arrOpenGId.push(openGId);\n                        ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n\n                        this.btnZuan.active = true;\n                    }\n                } else {\n                    console.log('查看排行榜，分享到群失败');\n                    this.btnZuan.active = false;\n                }\n            }\n        }, 'Group')\n    },\n\n    //点击钻石按钮\n    onGetZuan: function (num) {\n        this.btnZuan.active = false;\n        this.playGetGoldEffect();\n    },\n\n    //更新星星的数量\n    updateGold: function (num) {\n        var goldLabel = this.goldNode.getChildByName('label');\n        goldLabel.getComponent(cc.Label).string = Global.wxGold;\n\n        Global.wxGold += parseInt(num);\n        console.log('1 :' + num, Global.wxGold);\n        //更新并存储\n        if (typeof wx !== 'undefined') {\n            let data = ThirdAPI.loadLocalScore();\n            var score = parseInt(data.maxscore);\n            var gold = parseInt(data.gold);\n            ThirdAPI.loadScore((maxscore, gold) => {\n                score = parseInt(maxscore);\n                gold = parseInt(gold);\n                console.log('gridController on ThirdAPI loadScore', score, parseInt(gold), Global.wxGold);\n            });\n            ThirdAPI.saveScore(score, Global.wxGold);\n        }\n\n        var goldLabel = this.goldNode.getChildByName('label');\n        goldLabel.getComponent(cc.Label).string = Global.wxGold;\n    },\n\n    playGetGoldEffect: function () {\n        var times = Math.floor(Math.random()*4+1)*5;\n        console.log('得钻：', times);\n        //var times = 30;\n        clearInterval(this.addInterval);\n        this.addInterval = setInterval(() => {\n            times -= 5;\n            if (times >= 0) {\n                var instance = cc.instantiate(this.gemStone);\n                instance.setPosition(this.btnZuan.position);\n                this.node.addChild(instance);\n                var pos = this.goldNode.getPosition();\n                instance.getComponent('getGemStone').toPosition([pos.x, pos.y], 5, 2);\n            } else {\n                clearInterval(this.addInterval);\n            }\n        }, 500);\n    },\n\n    //从fb上获取排行榜\n    getRank: function () {\n        if (typeof FBInstant === 'undefined') return;\n        var self = this;\n        FBInstant.getLeaderboardAsync('my_allrank')\n            .then(leaderboard => {\n                return leaderboard.getEntriesAsync();\n            })\n            .then(entries => {\n                self.updateContent(entries);\n                self.getMyRank();\n            })\n            .catch(error => {});\n    },\n\n    updateContent: function (entries) {\n        if (!entries) {\n            for (let index = 0; index < this.arrItems.length; index++) {\n                const element = this.arrItems[index];\n                if (element) {\n                    element.active = fasle;\n                }\n            }\n        } else {\n            this.entries = entries;\n            for (let index = 0; index < this.entries.length; index++) {\n                const element = this.arrItems[index];\n                if (element) {\n                    const ent = this.entries[index];\n                    element.getComponent('rankItem').setScore(ent.getScore());\n                    element.getComponent('rankItem').setlevel(ent.getRank());\n                    element.getComponent('rankItem').setNameAndPhoto(ent.getExtraData());\n                    //this.content.addChild(element);\n                }\n            }\n        }\n    },\n\n    updateMyContent: function (entri) {\n        if (parseInt(entri.getRank()) <= 10) {\n            return;\n        }\n\n        let index = this.entries.length;\n        if (index == 10) {\n            index = 9;\n        }\n\n        const element = this.arrItems[index];\n        element.getComponent('rankItem').setScore(entri.getScore());\n        element.getComponent('rankItem').setlevel(entri.getRank());\n        element.getComponent('rankItem').setNameAndPhoto(entri.getExtraData());\n    },\n\n    cleanRank: function () {\n        var sprite = this.content.getChildByName('sprite');\n        sprite.getComponent(cc.Sprite).spriteFrame = null;\n    },\n\n    closeThis: function () {\n\n        if (Global.toRankPoint == 1) {\n            ThirdAPI.showGameClub(true);\n        }\n\n        if (this.node.parent) {\n            this.node.parent.removeChild(this.node);\n        }\n    },\n\n    update(dt) {\n        if (this.updateWxRank && this.updateWxRank > 100) {\n\n            console.log('redraw wx rank');\n            this.updateWxRank = 1;\n            try {\n                let openDataContext = wx.getOpenDataContext();\n                let sharedCanvas = openDataContext.canvas;\n    \n                let texture = new cc.Texture2D();\n                texture.initWithElement(sharedCanvas);\n                texture.handleLoadedTexture();\n                let sp = new cc.SpriteFrame(texture);\n                console.log('texture.width :' + texture.width, texture.height + \" :: \" + this.content.width);\n    \n                var sprite = this.content.getChildByName('sprite');\n    \n                sprite.getComponent(cc.Sprite).type = cc.Sprite.Type.TILED;\n    \n                sprite.width = texture.width;\n                sprite.height = texture.height - 90;\n                sprite.getComponent(cc.Sprite).spriteFrame = sp;\n    \n                this.myrankSpr.spriteFrame = sp;\n                this.myrankSpr.node.height = texture.height;\n            } catch (error) {\n                \n            }\n        } else {\n            this.updateWxRank++;\n        }\n    },\n});"]}
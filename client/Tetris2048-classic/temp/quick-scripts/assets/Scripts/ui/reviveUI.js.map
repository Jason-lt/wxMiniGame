{"version":3,"sources":["reviveUI.js"],"names":["ThirdAPI","require","cc","Class","extends","Component","properties","sLabel","default","type","Label","lbl_countdown","tip","shareLabel","shareNotRevive","Node","labelReviveCoin","tip0","tip1","scoreNum","start","initData","showBannerAd","string","Global","gameinfo","reviveCoinNum","setShareLabel","node","active","cdnGameConfig","totalSwith","console","log","wxBannerAd","createBannerAd","updateReviveCoin","wx","reviveScoreSwith","reviveScoreLimit","wxScore","canRevive","FBInstant","startContinueConutDown","times","pauseInterval","countDownInterval","setInterval","giveUpShare","clearInterval","setScore","score","shareGame","game","playSound","myUtil","getImgBase64","onShareSuccess","bind","onShareFailed","openGId","saveFriendGenStoneInfo","showDialogText","parent","removeChild","showShareUI","shareUI","updateMaxLabel","onGiveReviveCoin","onGiveReviveCoinSuccess","onGiveReviveCoinFail","x","y","showDialogTextAlawys","onRevive","reviveShareTimes","saveReviveData","reviveTimes","gridControllerScript","gridController","getComponent","clearGridForRevive"],"mappings":"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","file":"reviveUI.js","sourceRoot":"../../../../../assets/Scripts/ui","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nlet ThirdAPI = require('../common/ThirdAPI')\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        sLabel: {\n            default: null,\n            type: cc.Label\n        },\n        lbl_countdown: {\n            default: null,\n            type: cc.Label\n        },\n        tip: {\n            default: null,\n            type: cc.Label\n        },\n        shareLabel: {\n            default: null,\n            type: cc.Label\n        },\n        shareNotRevive: {\n            default: null,\n            type: cc.Node\n        },\n        labelReviveCoin: {\n            default: null,\n            type: cc.Label\n        },\n\n\n        tip0: {\n            default: null,\n            type: cc.Node\n        },\n        tip1: {\n            default: null,\n            type: cc.Node\n        },\n\n        scoreNum: 0,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start() {\n\n    },\n\n    initData: function () {\n\n        this.showBannerAd();\n\n        //this.startContinueConutDown();\n\n        this.labelReviveCoin.string = 'X' + Global.gameinfo.reviveCoinNum;\n\n        this.setShareLabel();\n        this.tip.node.active = false;\n        this.shareNotRevive.active = false;\n        //ThirdAPI.showGameClub(false);\n\n        this.tip0.active = Global.cdnGameConfig.totalSwith;\n        this.tip1.active = !Global.cdnGameConfig.totalSwith;\n    },\n\n    //显示banner广告\n    showBannerAd: function () {\n        console.log('reviveUI show bannerAd');\n        var wxBannerAd = require('wxBannerAd');\n        wxBannerAd.createBannerAd();\n    },\n\n    updateReviveCoin: function () {\n        this.labelReviveCoin.string = 'X' + Global.gameinfo.reviveCoinNum;\n    },\n\n    //设置分享按钮文本\n    setShareLabel: function () {\n        if (typeof wx !== 'undefined') {\n            if (Global.cdnGameConfig.totalSwith) {\n                this.shareLabel.string = \"分享也不能复活\"; //'分享也不能复活';\n                //this.shareNotRevive.active = true;\n            } else {\n                if (Global.cdnGameConfig.reviveScoreSwith) {\n                    //判断分数\n                    console.log('判断分数：', Global.cdnGameConfig.reviveScoreLimit, Global.wxScore);\n                    var canRevive = Global.wxScore > Global.cdnGameConfig.reviveScoreLimit ? true : false;\n                    if (canRevive) {\n                        console.log('是否可以复活');\n                        this.shareLabel.string = '分享到群继续玩';\n                    } else {\n                        this.shareLabel.string = \"分享也不能复活\"; //'分享也不能复活';\n                        //this.shareNotRevive.active = true;\n                    }\n                } else {\n                    console.log('分享开关已经关闭', Global.cdnGameConfig.reviveScoreSwith);\n                    this.shareLabel.string = '分享到群继续玩';\n                }\n            }\n        } else if (typeof FBInstant !== 'undefined') {\n            this.shareLabel.string = 'share game';\n        } else {\n            this.shareLabel.string = '分享复活';\n        }\n    },\n\n    //设置倒计时\n    startContinueConutDown: function () {\n        let times = 10;\n        this.lbl_countdown.string = times;\n        this.pauseInterval = false;\n        this.countDownInterval = setInterval(() => {\n            if (!this.pauseInterval) {\n                times--;\n                if (times >= 0) {\n                    this.lbl_countdown.string = times;\n                } else {\n                    this.giveUpShare();\n                    clearInterval(this.countDownInterval);\n                }\n            }\n        }, 1000);\n    },\n\n    //设置分数\n    setScore: function (score) {\n        this.scoreNum = score;\n        if (typeof wx !== 'undefined') {\n            this.sLabel.string = '当前分数：' + this.scoreNum;\n        } else if (typeof FBInstant !== 'undefined') {\n            this.sLabel.string = 'current score:' + this.scoreNum;\n        } else {\n            this.sLabel.string = '当前分数:' + this.scoreNum;\n        }\n    },\n\n    //分享\n    shareGame: function () {\n        Global.game.playSound('btn', 0.1);\n\n        this.tip.node.active = false;\n        this.pauseInterval = true;\n        if (typeof FBInstant !== 'undefined') {\n            var myUtil = require('myUtil');\n            ThirdAPI.shareGame(myUtil.getImgBase64(), this.onShareSuccess.bind(this));\n        } else if (typeof wx !== 'undefined') {\n            console.log('----------------复活分享-----------------');\n            ThirdAPI.shareGame('randomImg', this.onShareSuccess.bind(this), this.onShareFailed.bind(this), '004');\n        } else {\n            console.log('----------------直接复活-----------------');\n            this.onShareSuccess();\n        }\n    },\n\n    //分享成功\n    onShareSuccess: function (openGId) {\n\n        if (Global.gameinfo.reviveCoinNum == 0) {\n            console.log('复活币不够！');\n\n            Global.gameinfo.reviveCoinNum++;\n            ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n            this.labelReviveCoin.string = 'X' + Global.gameinfo.reviveCoinNum;\n        }\n    },\n\n    //分享失败\n    onShareFailed: function () {\n        this.pauseInterval = false;\n        Global.game.showDialogText('分享失败，必须分享到微信群');\n    },\n\n    //放弃分享\n    giveUpShare: function () {\n        Global.game.playSound('btn', 0.1);\n        if (this.node.parent) {\n            this.node.parent.removeChild(this.node);\n        }\n        this.pauseInterval = false;\n        clearInterval(this.countDownInterval);\n        Global.game.showShareUI();\n        Global.shareUI.updateMaxLabel(this.scoreNum);\n    },\n\n    // 按钮回调：赠送复活币\n    onGiveReviveCoin: function () {\n        Global.game.playSound('btn', 0.1);\n\n        if (typeof FBInstant !== 'undefined') {\n            ThirdAPI.shareGame(this.getImgBase64(), this.onGiveReviveCoinSuccess.bind(this));\n        } else if (typeof wx !== 'undefined') {\n            ThirdAPI.shareGame('randomImg', this.onGiveReviveCoinSuccess.bind(this), this.onGiveReviveCoinFail.bind(this), '006');\n        } else {\n            Global.game.showDialogText('索取失败，必须分享到不同微信群', {\n                x: 0,\n                y: 20\n            });\n            this.onShareSuccess();\n        }\n    },\n\n    onGiveReviveCoinSuccess: function (openGId) {\n        console.log('赠送一个复活币！');\n        //this.playGetGoldEffect();\n        Global.game.showDialogTextAlawys(\"赠人玫瑰，手有余香!\");\n    },\n    onGiveReviveCoinFail: function () {\n\n    },\n\n    //点击复活\n    onRevive: function () {\n        Global.game.playSound('btn', 0.1);\n\n        if (Global.gameinfo.reviveCoinNum <= 0) {\n            console.log('复活币不够！');\n            Global.game.showDialogTextAlawys(\"复活卡用光了!\");\n            return;\n        }\n\n        Global.gameinfo.reviveCoinNum--;\n        ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n        this.labelReviveCoin.string = 'X' + Global.gameinfo.reviveCoinNum;\n\n        if (this.node.parent) {\n            this.node.parent.removeChild(this.node);\n        }\n\n        //可以复活\n        Global.reviveShareTimes--;\n        //保存本地\n        if (Global.reviveShareTimes > -1) {\n            ThirdAPI.saveReviveData(Global.reviveShareTimes);\n        }\n        //当局复活次数加1\n        Global.reviveTimes++;\n\n        //开始消除格子，继续游戏\n        var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n        gridControllerScript.clearGridForRevive();\n    },\n\n});"]}
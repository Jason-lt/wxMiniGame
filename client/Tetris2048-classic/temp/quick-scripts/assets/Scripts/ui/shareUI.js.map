{"version":3,"sources":["shareUI.js"],"names":["ThirdAPI","require","cc","Class","extends","Component","properties","bg","default","type","Node","line1","line2","currScore","Label","score","personPer","buttonstate0","buttonstate1","node_gold","fly_node","lbl_gold","lbl_fly","soundOnBtn","soundOffBtn","backgroundAudio","url","AudioClip","tipbox","hasShardReward","isStart","start","Global","shareUI","getComponent","setBackground","initData","destroyBannerAd","showEffect","console","log","cdnGameConfig","totalSwith","active","shareScoreSwith","shareData","shareTimes","shareScoreLimit","wxScore","canShow","wxBannerAd","showTipbox","onTipButton","canvas","find","width","switchBGM","startUI","node","setPosition","p","action","moveTo","runAction","updateMaxLabel","maxNum","string","myUtil","getPercentString","wx","data","loadLocalScore","parseInt","maxscore","gold","loadScore","saveScore","FBInstant","fbScore","dataScript","titleMaxScore","titleUI","updateItemsState","play","game","playSound","enterScene","gotoHome","startGame","showRankUI","toRankPoint","showRank","onShareGame","shareGame","getImgBase64","onShareSuccess","bind","onShareFail","onChallenge","img","shareAsync","intent","image","text","myReplayData","then","openGId","canTakeReward","gameinfo","shareData3","arrOpenGId","indexOf","showDialogText","push","saveFriendGenStoneInfo","x","y","saveShareData","shareDate","wxGold","shareReward","playGetGoldEffect","ani","Animation","fadeIn","on","sequence","scaleTo","callFunc","fadeOut","target","height","renderTexture","RenderTexture","begin","_sgNode","visit","end","document","createElement","ctx","getContext","_renderType","RENDER_TYPE_CANVAS","texture","getSprite","getTexture","getHtmlElementObj","drawImage","RENDER_TYPE_WEBGL","buffer","gl","createFramebuffer","bindFramebuffer","FRAMEBUFFER","_glID","framebufferTexture2D","COLOR_ATTACHMENT0","TEXTURE_2D","Uint8Array","readPixels","RGBA","UNSIGNED_BYTE","rowBytes","row","srow","data2","Uint8ClampedArray","imageData","ImageData","putImageData","toDataURL"],"mappings":"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","file":"shareUI.js","sourceRoot":"../../../../../assets/Scripts/ui","sourcesContent":["let ThirdAPI = require('../common/ThirdAPI');\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        bg: {\n            default: null,\n            type: cc.Node\n        },\n        line1: {\n            default: null,\n            type: cc.Node\n        },\n        line2: {\n            default: null,\n            type: cc.Node\n        },\n        //当前分数\n        currScore: {\n            default: null,\n            type: cc.Label,\n        },\n        score: {\n            default: null,\n            type: cc.Label,\n        },\n        personPer: {\n            default: null,\n            type: cc.Label,\n        },\n        buttonstate0: {\n            default: null,\n            type: cc.Node,\n        },\n        buttonstate1: {\n            default: null,\n            type: cc.Node,\n        },\n        node_gold: {\n            default: null,\n            type: cc.Node\n        },\n        fly_node: {\n            default: null,\n            type: cc.Node\n        },\n        lbl_gold: {\n            default: null,\n            type: cc.Label,\n        },\n        lbl_fly: {\n            default: null,\n            type: cc.Label,\n        },\n        soundOnBtn: {\n            default: null,\n            type: cc.Node\n        },\n        soundOffBtn: {\n            default: null,\n            type: cc.Node\n        },\n        //背景音乐\n        backgroundAudio: {\n            url: cc.AudioClip,\n            default: null\n        },\n        // 提示信息\n        tipbox: {\n            default: null,\n            type: cc.Node,\n        },\n\n        hasShardReward: true,\n        isStart: false,\n    },\n\n    start() {\n        Global.shareUI = this.getComponent('shareUI');\n\n        this.setBackground();\n        this.isStart = true;\n    },\n\n    initData: function () {\n        this.destroyBannerAd();\n\n        this.hasShardReward = true;\n        this.showEffect();\n        this.setBackground();\n\n        console.log('1---------------》进入分享界面！', Global.cdnGameConfig.totalSwith);\n        if (Global.cdnGameConfig.totalSwith) {\n            console.log('2a---------------》进入分享界面！');\n            this.buttonstate0.active = false;\n            this.buttonstate1.active = true;\n        } else {\n            console.log('2b---------------》进入分享界面！', Global.cdnGameConfig.shareScoreSwith);\n            //分数开关判断\n            if (Global.cdnGameConfig.shareScoreSwith) {\n                console.log('3a---------------》进入分享界面！',Global.shareData.shareTimes);\n                //判断分数\n                console.log('判断分数：', Global.cdnGameConfig.shareScoreLimit, Global.wxScore);\n                var canShow = Global.wxScore > Global.cdnGameConfig.shareScoreLimit ? true : false;\n                console.log('分享界面按钮判断--canShow:', canShow);\n                if (canShow) {\n                    this.buttonstate0.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? true : false;\n                    this.buttonstate1.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? false : true;\n                } else {\n                    this.buttonstate0.active = false;\n                    this.buttonstate1.active = true;\n                }\n            } else {\n                console.log('3b---------------》进入分享界面！',Global.shareData.shareTimes);\n                this.buttonstate0.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? true : false;\n                this.buttonstate1.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? false : true;\n            }\n\n            // this.buttonstate0.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? true : false;\n            // this.buttonstate1.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? false : true;\n        }\n\n        // if (Global.shareData.shareTimes >= 5) {\n        //     console.log('分享超过5次限制');\n        //     this.buttonstate0.active = false;\n        //     this.buttonstate1.active = true;\n        // }\n    },\n\n    //销毁banner广告\n    destroyBannerAd: function () {\n        var wxBannerAd = require('wxBannerAd');\n        wxBannerAd.destroyBannerAd();\n    },\n\n    // 显示提示框\n    showTipbox: function () {\n        this.tipbox.active = true;\n    },\n\n    onTipButton: function () {\n        this.tipbox.active = false;\n    },\n\n    //设置头部图片的适配宽高\n    setBackground: function () {\n        let canvas = cc.find('Canvas');\n        this.bg.width = canvas.width;\n        this.line1.width = canvas.width;\n        this.line2.width = canvas.width;\n        console.log('width:', this.bg.width, this.line1.width, this.line2.width);\n    },\n\n    switchBGM: function () {\n        Global.startUI.switchBGM();\n    },\n\n    showEffect: function () {\n        this.node_gold.active = false;\n        this.fly_node.active = false;\n\n        this.node.setPosition(cc.p(-640, 0));\n        var action = cc.moveTo(0.6, cc.p(0, 0));\n        this.node.runAction(action);\n    },\n\n    updateMaxLabel: function (maxNum) {\n        //本局最高分\n        this.currScore.string = maxNum;\n        //全球比分\n        var myUtil = require('myUtil');\n        this.personPer.string = myUtil.getPercentString(maxNum);\n        this.score.string = '历史最高分：' + maxNum;\n        if (typeof wx !== 'undefined') {\n            let data = ThirdAPI.loadLocalScore();\n            var score = parseInt(data.maxscore);\n            var gold = parseInt(data.gold);\n            ThirdAPI.loadScore((maxscore, gold) => {\n                score = parseInt(maxscore);\n                gold = parseInt(gold);\n                console.log('on ThirdAPI loadScore', score, parseInt(gold));\n            });\n\n            //历史最高分\n            if (score < maxNum) {\n                ThirdAPI.saveScore(maxNum, gold);\n                this.score.string = '历史最高分：' + maxNum;\n            } else {\n                this.score.string = '历史最高分：' + score;\n            }\n        } else if (typeof FBInstant !== 'undefined') {\n            if (maxNum > Global.fbScore) {\n                this.score.string = maxNum;\n                //测试\n                Global.dataScript.saveScore(maxNum);\n            } else {\n                this.score.string = Global.fbScore;\n            }\n        }\n\n        Global.titleMaxScore = maxNum;\n        if (Global.titleUI) {\n            Global.titleUI.updateItemsState(1);\n        }\n    },\n\n    //进入游戏\n    play: function () {\n        Global.game.playSound('btn', 0.1);\n        Global.game.enterScene();\n    },\n\n    //返回主页\n    gotoHome: function () {\n        Global.game.playSound('btn', 0.1);\n        Global.game.startGame();\n    },\n\n    //进入排行榜\n    showRankUI: function () {\n        Global.game.playSound('btn', 0.1);\n        Global.toRankPoint = 0;\n        Global.game.showRank(false);\n    },\n\n    // 分享功能  intent(\"INVITE\" | \"REQUEST\" | \"CHALLENGE\" | \"SHARE\") 表示分享的意图\n    onShareGame: function () {\n        Global.game.playSound('btn', 0.1);\n        if (typeof FBInstant !== 'undefined') {\n            ThirdAPI.shareGame(this.getImgBase64(), this.onShareSuccess.bind(this));\n        } else {\n            ThirdAPI.shareGame('screenshot', this.onShareSuccess.bind(this), this.onShareFail.bind(this), '003');\n        }\n    },\n\n    onChallenge: function () {\n        Global.game.playSound('btn', 0.1);\n        var img = this.getImgBase64();\n        if (typeof FBInstant === 'undefined') return;\n        FBInstant.shareAsync({\n            intent: 'INVITE',\n            image: img,\n            text: 'I just challenged Tetris2048,Join me!',\n            data: {\n                myReplayData: '...'\n            },\n        }).then(() => {\n            // continue with the game.\n        });\n    },\n\n\n    onShareSuccess: function (openGId) {\n        //总开关判断\n        if (Global.cdnGameConfig.totalSwith) {\n            this.buttonstate0.active = false;\n            this.buttonstate1.active = true;\n            return;\n        } else {\n            //分数开关判断\n            if (Global.cdnGameConfig.shareScoreSwith) {\n                //判断分数\n                console.log('分享成功之后判断分数：', Global.cdnGameConfig.shareScoreLimit, Global.wxScore);\n                var canTakeReward = Global.wxScore > Global.cdnGameConfig.shareScoreLimit ? true : false;\n\n                if (!canTakeReward) {\n                    console.log('分享成功不能领取奖励')\n                    this.buttonstate0.active = false;\n                    this.buttonstate1.active = true;\n                    return;\n                }\n            }\n        }\n\n        /*\n                if (Global.Gameversion) {\n                    this.buttonstate0.active = false;\n                    this.buttonstate1.active = true;\n                    return;\n                }*/\n\n        //console.log('今日分享次数:', Global.shareData.shareTimes);\n        if (Global.shareData.shareTimes >= 5) {\n            //console.log('分享超过5次限制');\n            this.buttonstate0.active = false;\n            this.buttonstate1.active = true;\n            return;\n        }\n\n        //获得钻石动画\n        if (this.hasShardReward) {\n            if (Global.gameinfo.shareData3.arrOpenGId.indexOf(openGId) != -1) {\n                console.log('该群今日已经分享过', openGId);\n                Global.game.showDialogText('该群今日已经分享过无法获得奖励');\n                return;\n            } else {\n                console.log('该群未分享过', openGId);\n                Global.gameinfo.shareData3.arrOpenGId.push(openGId);\n                ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n            }\n\n            if (!openGId) {\n                Global.game.showDialogText('分享失败，必须分享到微信群', {\n                    x: 0,\n                    y: -200\n                });\n                console.log('shareUI 分享的不是群');\n                return;\n            }\n            console.log('分享获得钻石,开始播放动画');\n            Global.shareData.shareTimes++;\n            ThirdAPI.saveShareData(Global.shareData.shareTimes, Global.shareData.shareDate);\n\n            Global.wxGold += parseInt(Global.shareReward);\n            //更新并存储\n            if (typeof wx !== 'undefined') {\n                let data = ThirdAPI.loadLocalScore();\n                var score = parseInt(data.maxscore);\n                var gold = parseInt(data.gold);\n                ThirdAPI.loadScore((maxscore, gold) => {\n                    score = parseInt(maxscore);\n                    gold = parseInt(gold);\n                    console.log('shareUI on ThirdAPI loadScore', score, parseInt(gold), Global.wxGold);\n                });\n                ThirdAPI.saveScore(score, Global.wxGold);\n            }\n\n            //更改分享可获钻石状态\n            this.hasShardReward = false;\n            this.playGetGoldEffect();\n        }\n    },\n\n    //分享到群失败\n    onShareFail: function () {\n        console.log('向好友索取失败');\n        Global.game.showDialogText('分享失败，必须分享到微信群');\n    },\n\n    playGetGoldEffect: function () {\n        this.buttonstate0.active = false;\n        this.buttonstate1.active = true;\n        //更改分享可获钻石状态\n        this.hasShardReward = false;\n\n        this.fly_node.active = true;\n        this.lbl_fly.string = '+' + Global.shareReward;\n        let ani = this.fly_node.getComponent(cc.Animation)\n        ani.play();\n        this.node_gold.active = true;\n        this.lbl_gold.string = Global.wxGold - parseInt(Global.shareReward);\n        this.node_gold.runAction(cc.fadeIn(0.5));\n\n        ani.on('stop', () => {\n            this.node_gold.runAction(cc.sequence(\n                cc.scaleTo(0.2, 1.2),\n                cc.callFunc(() => {\n                    this.lbl_gold.string = Global.wxGold;\n                    this.fly_node.active = false;\n                }),\n                cc.scaleTo(0.2, 1),\n                cc.fadeOut(1)\n            ));\n        });\n    },\n\n    // 截屏返回 iamge base6，用于 Share\n    getImgBase64: function () {\n        let target = cc.find('Canvas');\n        let width = parseInt(target.width),\n            height = parseInt(target.height);\n        let renderTexture = new cc.RenderTexture(width, height);\n        renderTexture.begin();\n        target._sgNode.visit();\n        renderTexture.end();\n        //\n        let canvas = document.createElement('canvas');\n        let ctx = canvas.getContext('2d');\n        canvas.width = width;\n        canvas.height = height;\n        if (cc._renderType === cc.game.RENDER_TYPE_CANVAS) {\n            let texture = renderTexture.getSprite().getTexture();\n            let image = texture.getHtmlElementObj();\n            ctx.drawImage(image, 0, 0);\n        } else if (cc._renderType === cc.game.RENDER_TYPE_WEBGL) {\n            let buffer = gl.createFramebuffer();\n            gl.bindFramebuffer(gl.FRAMEBUFFER, buffer);\n            let texture = renderTexture.getSprite().getTexture()._glID;\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n            let data = new Uint8Array(width * height * 4);\n            gl.readPixels(0, 0, width, height, gl.RGBA, gl.UNSIGNED_BYTE, data);\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n            let rowBytes = width * 4;\n            for (let row = 0; row < height; row++) {\n                let srow = height - 1 - row;\n                let data2 = new Uint8ClampedArray(data.buffer, srow * width * 4, rowBytes);\n                let imageData = new ImageData(data2, width, 1);\n                ctx.putImageData(imageData, 0, row);\n            }\n        }\n        cc.log('to share');\n        return canvas.toDataURL('image/png');\n    },\n});"]}
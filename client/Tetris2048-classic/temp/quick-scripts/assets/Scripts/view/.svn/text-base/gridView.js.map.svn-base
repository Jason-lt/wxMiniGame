{"version":3,"sources":["gridView.js"],"names":["cc","Class","extends","Component","properties","combineAudio","url","AudioClip","default","numPrefab","type","Prefab","goldPrefab","combineID","allGrids","hIndex","vIndex","item","gridNum","targetGrid","Node","isDown","moveIndex","sameScoreNum","deleteGrids","isJoin","actionJoin","joinItems","setIndex","gridController","startBianli","self","gridControllerScript","Global","getComponent","bianliForGrid","startJoin","length","changeScore","console","log","extraNum","combineTimes","scoreScript","addScore","itemViewScript","bornNum","updateNum","updateColor","playFlyNum","playFlyGold","flyIndex","canFlyNums","indexOf","parseInt","numInstance","instantiate","setNum","setPosition","p","node","getPosition","x","y","parent","addChild","toPosition","canFlyGolds","goldInstance","goldNode","gridViewScript","bianliHIndex","bianliVIndex","hasSameScore","hNum","vNum","compareGrid","compareGridScript","gridMaxScore","gridScript","push","index","deleteGrid","deleteGridScript","deleteItem","toJoin","resetData","check","runAction","sequence","delayTime","callFunc","checkJoinComplete","isComplete","curState","playCombineAudio","isBGMPlaying","audioEngine","play","setFinishCallback","playAudioEnd","playAudioStart","resume","uncache"],"mappings":"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","file":"gridView.js","sourceRoot":"../../../../../assets/Scripts/view","sourcesContent":["/*\n    合并触发判断，递归\n*/\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        combineAudio: {\n            url: cc.AudioClip,\n            default: null\n        },\n\n        numPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n        goldPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n        combineID: 0,\n        allGrids: null, //所有的格子信息\n        hIndex: 0,\n        vIndex: 0,\n        item: null,\n\n        //格子上的分数\n        gridNum: 0, //2  4 8  16\n\n        //目标格子\n        targetGrid: {\n            default: null,\n            type: cc.Node\n        },\n\n        isDown: false, //是否是下落的格子\n\n        moveIndex: 0, //下方的格子被消灭后，移动的距离\n        sameScoreNum: 0, //合并时记录相同的分数格子数量\n\n        deleteGrids: [], //存储即将合并的格子\n        isJoin: false,\n        actionJoin: false,\n        joinItems: [],\n    },\n\n    //设置索引index\n    setIndex: function (hIndex, vIndex, gridController) {\n        this.hIndex = hIndex;\n        this.vIndex = vIndex;\n    },\n\n    //开始遍历\n    startBianli: function () {\n        var self = this;\n        this.joinItems = [];\n\n        var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n        this.allGrids = gridControllerScript.allGrids;\n        //将要合并的数组\n        this.deleteGrids = [];\n\n        this.bianliForGrid();\n        //开始执行合并动作\n        this.startJoin();\n        //改变分数\n        this.isDown = false;\n\n        return (this.joinItems.length > 0);\n    },\n\n    //改变分数\n    changeScore: function () {\n        let self = this;\n        var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n        self.isDown = false;\n        //改变分数\n        if (self.deleteGrids.length > 0) {\n            if (self.deleteGrids.length == 1) {\n                self.gridNum *= 2;\n            } else if (self.deleteGrids.length == 2) {\n                self.gridNum *= 4;\n            } else if (self.deleteGrids.length == 3) {\n                self.gridNum *= 8;\n            }\n\n            //combine加分\n            console.log('连击之前的分数：' + self.gridNum);\n            var extraNum = 0;\n            if (Global.combineTimes > 0) {\n                if (Global.combineTimes > 4) {\n                    Global.combineTimes = 4;\n                }\n                /*\n                if (Global.combineTimes > 1) {\n                    //合并数大于2\n                    console.log('删除的格子数量：' + self.deleteGrids.length);\n                    if (self.deleteGrids.length > 1) {\n                        Global.combineTimes = self.deleteGrids.length + 1;\n                    }\n                }*/\n                extraNum = (Global.combineTimes - 1) * self.gridNum;\n                console.log('连击加的分数：' + extraNum);\n            }\n            console.log('连击之后的分数：' + (self.gridNum + extraNum));\n\n            if (self.gridNum > 4096) {\n                self.gridNum = 4096;\n            }\n\n            console.log('deleteGrids:' + self.deleteGrids.length);\n\n            console.log('addScore', self.gridNum);\n            gridControllerScript.scoreScript.addScore(self.gridNum + extraNum);\n            console.log('addScore end,self.item:', self.item);\n            if (self.item) {\n                var itemViewScript = self.item.getComponent('itemView');\n                itemViewScript.bornNum = self.gridNum;\n                console.log('updateNum');\n                itemViewScript.updateNum();\n                console.log('updateColor');\n                itemViewScript.updateColor();\n                console.log('playFlyNum');\n                //飞入动画\n                self.playFlyNum();\n                console.log('playFlyGold');\n                //飞入金币\n                self.playFlyGold();\n                console.log('updateGold');\n                //gridControllerScript.updateGold(self.gridNum);\n            }\n        }\n    },\n\n    //开始播放飞入动画\n    playFlyNum: function () {\n        //合成一个512或者2048就播放数字向上飘的动画\n        var flyIndex = Global.canFlyNums.indexOf(parseInt(this.gridNum));\n        if (flyIndex <= -1) {\n            return;\n        }\n        // if (this.numInstance == null) {\n        this.numInstance = cc.instantiate(this.numPrefab);\n        // }\n        // if (this.numInstance.parent) {\n        //     this.numInstance.parent.removeChild(this.numInstance);\n        // }\n        this.numInstance.getComponent('flyNum').setNum(this.gridNum);\n        this.numInstance.setPosition(cc.p(this.node.getPosition().x, this.node.getPosition().y));\n        this.node.parent.addChild(this.numInstance);\n        this.numInstance.getComponent('flyNum').toPosition(-300);\n    },\n\n    //播放钻石动画\n    playFlyGold: function () {\n        //合成一个512或者2048就播放数字向上飘的动画\n        var flyIndex = Global.canFlyGolds.indexOf(parseInt(this.gridNum));\n        if (flyIndex <= -1) {\n            return;\n        }\n        this.goldInstance = cc.instantiate(this.goldPrefab);\n        this.goldInstance.setPosition(cc.p(this.node.getPosition().x, this.node.getPosition().y));\n        this.node.parent.addChild(this.goldInstance);\n        //金币飞入到gridControllder的金币位置\n        var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n        this.goldInstance.getComponent('flyGold').toPosition(gridControllerScript.goldNode.getPosition(), this.gridNum);\n    },\n\n    //从当前的格子开始遍历\n    bianliForGrid: function () {\n        var gridViewScript = this.node.getComponent(\"gridView\");\n        //将要遍历格子的横向索引\n        var bianliHIndex = gridViewScript.hIndex;\n        //将要遍历格子的纵向索引\n        var bianliVIndex = gridViewScript.vIndex;\n\n        //遍历左边\n        this.hasSameScore(bianliHIndex - 1, bianliVIndex);\n        //遍历右边\n        this.hasSameScore(bianliHIndex + 1, bianliVIndex);\n        //遍历上边\n        this.hasSameScore(bianliHIndex, bianliVIndex - 1);\n        //遍历下边\n        this.hasSameScore(bianliHIndex, bianliVIndex + 1);\n    },\n\n    //判断是否有相同分数的格子,如果有就进行合并\n    hasSameScore: function (hIndex, vIndex) {\n        //判断是否是边界\n        if (hIndex < 0 || hIndex >= Global.hNum || vIndex < 0 || vIndex >= Global.vNum) {\n            return;\n        }\n\n        if (hIndex == this.hIndex && vIndex == this.vIndex) {\n            return;\n        }\n\n        var compareGrid = this.allGrids[hIndex][vIndex];\n        if (this.deleteGrids.indexOf(compareGrid) > -1) {\n            return;\n        }\n        var compareGridScript = compareGrid.getComponent(\"gridView\");\n\n        //判断是否有item\n        if (compareGrid && compareGridScript.item == null) {\n            return;\n        }\n        //达到最大分数\n        if (compareGridScript.gridNum > Global.gridMaxScore) {\n            return;\n        }\n        if (compareGridScript.isJoin) {\n            return;\n        }\n        var gridScript = this.node.getComponent(\"gridView\");\n        if (compareGridScript.gridNum == gridScript.gridNum) {\n            this.deleteGrids.push(compareGrid);\n            compareGridScript.isDown = false;\n            this.bianliForGrid(compareGrid);\n            compareGridScript.isJoin = true;\n        }\n    },\n\n    //开始合并动作    \n    startJoin: function () {\n        var self = this;\n        if (self.deleteGrids.length <= 0) {\n            return 0;\n        }\n\n        this.joinItems = [];\n        for (let index = 0; index < self.deleteGrids.length; index++) {\n            var deleteGrid = self.deleteGrids[index];\n            var deleteGridScript = deleteGrid.getComponent(\"gridView\");\n            //销毁的item\n            var deleteItem = deleteGridScript.item;\n            this.joinItems.push(deleteGridScript.item);\n\n            deleteItem.toJoin(this.node.getPosition());\n\n            console.log('删除item：' + deleteGridScript.gridNum, deleteGridScript.hIndex, deleteGridScript.vIndex);\n            deleteGridScript.item = null;\n            deleteGridScript.resetData();\n        }\n        //播放合并的声音\n        this.actionJoin = true;\n        this.check();\n    },\n\n    check: function () {\n        let self = this;\n        this.node.runAction(cc.sequence(cc.delayTime(0.01), cc.callFunc(function () {\n            self.checkJoinComplete();\n        })));\n    },\n\n    checkJoinComplete: function () {\n        let isComplete = true;\n        for (let index = 0; index < this.joinItems.length; index++) {\n            var deleteItem = this.joinItems[index];\n            if (deleteItem.curState > 0) {\n                isComplete = false;\n                break;\n            }\n        }\n        if (isComplete) {\n            this.changeScore();\n            this.actionJoin = false;\n            this.playCombineAudio();\n        } else {\n            this.check();\n        }\n    },\n\n    playCombineAudio: function () {\n        cc.log('play audio');\n        if (Global.isBGMPlaying && this.combineAudio != null) {\n            this.combineID = cc.audioEngine.play(this.combineAudio, false, 1);\n            //回调\n            var self = this;\n            if (self.combineID > 0) {\n                cc.audioEngine.setFinishCallback(self.combineID, function () {\n                    self.playAudioEnd();\n                });\n            }\n        }\n    },\n    //播放声音\n    playAudioStart: function () {\n        if (this.combineID != 0) {\n            cc.audioEngine.resume(this.combineID);\n        }\n    },\n\n    //暂停声音声音\n    playAudioEnd: function () {\n        cc.audioEngine.uncache(this.combineID);\n    },\n\n    //重置数据\n    resetData: function () {\n        this.gridNum = 0;\n    },\n});"]}
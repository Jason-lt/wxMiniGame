{"version":3,"sources":["../../../../../assets/Scripts/ui/assets/Scripts/ui/rankUI.js"],"names":["cc","Class","extends","Component","properties","titleLabel","Label","rankBtnLabel","playBtn","Node","groupRankBtn","rankSprite","Sprite","texture","Texture2D","spriteFrame","SpriteFrame","shareTicket","onLoad","openDataContext","wxGame","GlobalFuncs","getOpenData","NotificationCenter","trigger","EventType","STOP_UPDATE_RANK_TEXTURE","shareCanvas","canvas","width","height","showOrigin","tywx","Timer","cancelTimer","updateRankTexture","setTimer","showRankListForShare","unscheduleAllCallbacks","sharedCanvas","getFriendRank","getGroupRank","sprite","initWithElement","handleLoadedTexture","_refreshTexture","changeButtonToRank","string","active","onClickRankBtn","showRankUI","onClickGroupRankBtn","shareManager","sharePoint","RankShareSuccess","bind","RankShareFail","openId","LOGE","JSON","stringify","showToast","onClickPlayBtn","gameResult","onClose","backAction","playGame","node","destroy","rankUI","UPDATE_RESULT_RANK","onDestroy"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,oBAAWL,GAAGM,KADN;AAERC,sBAAaP,GAAGM,KAFR;;AAIRE,iBAAQR,GAAGS,IAJH;AAKRC,sBAAaV,GAAGS,IALR;;AAORE,oBAAWX,GAAGY,MAPN;AAQRC,iBAAQb,GAAGc,SARH;AASRC,qBAAYf,GAAGgB,WATP;AAURC,qBAAc;AAVN,KAHP;;AAgBLC,YAAO,kBAAU;AACb,YAAIC,kBAAkBC,OAAOC,WAAP,CAAmBC,WAAnB,EAAtB;AACA,YAAG,CAACH,eAAJ,EAAoB;AAChB;AACH;AACDC,eAAOG,kBAAP,CAA0BC,OAA1B,CAAkCJ,OAAOK,SAAP,CAAiBC,wBAAnD;AACA,aAAKC,WAAL,GAAmBR,gBAAgBS,MAAnC;AACA,aAAKD,WAAL,CAAiBE,KAAjB,GAAyB,GAAzB;AACA,aAAKF,WAAL,CAAiBG,MAAjB,GAA0B,IAA1B;AACAV,eAAOC,WAAP,CAAmBU,UAAnB;AACA,aAAKlB,OAAL,GAAe,IAAIb,GAAGc,SAAP,EAAf;AACA,aAAKC,WAAL,GAAmB,IAAIf,GAAGgB,WAAP,CAAmB,KAAKH,OAAxB,CAAnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAmB,aAAKC,KAAL,CAAWC,WAAX,CAAuB,IAAvB,EAA4B,KAAKC,iBAAjC;AACAH,aAAKC,KAAL,CAAWG,QAAX,CAAoB,IAApB,EAA0B,KAAKD,iBAA/B,EAAkD,IAAE,EAApD,EAAwD,IAAxD;AACH,KAzCI;;AA2CLE,0BAAqB,gCAAU;AAC3B,aAAKC,sBAAL;AACA,YAAInB,kBAAkBC,OAAOC,WAAP,CAAmBC,WAAnB,EAAtB;AACA,YAAG,CAACH,eAAJ,EAAoB;AAChB;AACH;;AAED,aAAKoB,YAAL,GAAoBpB,gBAAgBS,MAApC;AACA,YAAI,CAAC,KAAKX,WAAN,IAAqB,KAAKA,WAAL,IAAoB,EAA7C,EAAiD;AAC7CG,mBAAOC,WAAP,CAAmBmB,aAAnB;AACH,SAFD,MAEM;AACFpB,mBAAOC,WAAP,CAAmBoB,YAAnB,CAAgC,KAAKxB,WAArC;AACH;AACD;AACAe,aAAKC,KAAL,CAAWC,WAAX,CAAuB,IAAvB,EAA4B,KAAKC,iBAAjC;AACAH,aAAKC,KAAL,CAAWG,QAAX,CAAoB,IAApB,EAA0B,KAAKD,iBAA/B,EAAkD,IAAE,EAApD,EAAwD,IAAxD;AACH,KA3DI;AA4DLA,uBAAkB,6BAAU;AACxB,YAAItB,UAAU,KAAKA,OAAnB;AACA,YAAIE,cAAc,KAAKA,WAAvB;AACA,YAAI2B,SAAS,KAAK/B,UAAlB;AACAE,gBAAQ8B,eAAR,CAAwB,KAAKJ,YAA7B;AACA1B,gBAAQ+B,mBAAR;AACAF,eAAO3B,WAAP,GAAqBA,WAArB;AACA2B,eAAO3B,WAAP,CAAmB8B,eAAnB,CAAmChC,OAAnC;AACH,KApEI;AAqELiC,wBAAmB,4BAAS7B,WAAT,EAAqB;AACpC,aAAKA,WAAL,GAAmBA,WAAnB;AACA,aAAKoB,oBAAL;AACA,YAAIpB,eAAeA,eAAe,EAAlC,EAAqC;AACjC,iBAAKZ,UAAL,CAAgB0C,MAAhB,GAAyB,KAAzB;AACA,iBAAKvC,OAAL,CAAawC,MAAb,GAAsB,IAAtB;AACA,iBAAKtC,YAAL,CAAkBsC,MAAlB,GAA2B,KAA3B;AACH,SAJD,MAIM;AACF,iBAAK3C,UAAL,CAAgB0C,MAAhB,GAAyB,MAAzB;AACA,iBAAKvC,OAAL,CAAawC,MAAb,GAAsB,KAAtB;AACA,iBAAKtC,YAAL,CAAkBsC,MAAlB,GAA2B,IAA3B;AACH;AACJ,KAjFI;;AAmFL;AACAC,oBAAe,0BAAU;AACrB7B,eAAOC,WAAP,CAAmB6B,UAAnB,CAA8B,EAA9B;AACH,KAtFI;;AAwFLC,yBAAoB,+BAAU;AAC1B/B,eAAOgC,YAAP,CAAoBC,UAApB,CAA+B,KAA/B,EAAqC,KAAKC,gBAAL,CAAsBC,IAAtB,CAA2B,IAA3B,CAArC,EAAsE,KAAKC,aAAL,CAAmBD,IAAnB,CAAwB,IAAxB,CAAtE;AACH,KA1FI;;AA4FLD,sBAAiB,0BAASG,MAAT,EAAgBxC,WAAhB,EAA4B;AACzCG,eAAOsC,IAAP,CAAY,4DAA4DC,KAAKC,SAAL,CAAe3C,WAAf,CAAxE;AACAG,eAAOC,WAAP,CAAmB6B,UAAnB,CAA8BjC,WAA9B;AACA;AACH,KAhGI;;AAkGLuC,mBAAc,yBAAU;AACpBpC,eAAOC,WAAP,CAAmBwC,SAAnB,CAA6B,OAA7B;AACH,KApGI;;AAsGL;AACAC,oBAAe,0BAAU;AACrB,YAAI1C,OAAO2C,UAAX,EAAuB;AACnB3C,mBAAO2C,UAAP,CAAkBC,OAAlB;AACH;AACD,aAAKC,UAAL;AACA7C,eAAOC,WAAP,CAAmB6C,QAAnB;AACH,KA7GI;;AA+GLD,gBAAW,sBAAU;AACjBjC,aAAKC,KAAL,CAAWC,WAAX,CAAuB,IAAvB,EAA4B,KAAKC,iBAAjC;AACA,aAAKgC,IAAL,CAAUC,OAAV;AACAhD,eAAOiD,MAAP,GAAgB,IAAhB;AACAjD,eAAOG,kBAAP,CAA0BC,OAA1B,CAAkCJ,OAAOK,SAAP,CAAiB6C,kBAAnD;AACH,KApHI;;AAsHLC,eAAU,qBAAU;AAChBnD,eAAOiD,MAAP,GAAgB,IAAhB;AACArC,aAAKC,KAAL,CAAWC,WAAX,CAAuB,IAAvB,EAA4B,KAAKC,iBAAjC;AACA,aAAKG,sBAAL;AACH;AACD;AA3HK,CAAT","file":"rankUI.js","sourceRoot":"../../../../../assets/Scripts/ui","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        titleLabel:cc.Label,\n        rankBtnLabel:cc.Label,\n\n        playBtn:cc.Node,\n        groupRankBtn:cc.Node,\n\n        rankSprite:cc.Sprite,\n        texture:cc.Texture2D,\n        spriteFrame:cc.SpriteFrame,\n        shareTicket : \"\"\n    },\n\n    onLoad:function(){\n        var openDataContext = wxGame.GlobalFuncs.getOpenData();\n        if(!openDataContext){\n            return;\n        }\n        wxGame.NotificationCenter.trigger(wxGame.EventType.STOP_UPDATE_RANK_TEXTURE);\n        this.shareCanvas = openDataContext.canvas;\n        this.shareCanvas.width = 540;\n        this.shareCanvas.height = 1760;\n        wxGame.GlobalFuncs.showOrigin();\n        this.texture = new cc.Texture2D();\n        this.spriteFrame = new cc.SpriteFrame(this.texture);\n        // var texture = this.texture;\n        // var spriteFrame = this.spriteFrame;\n        // var sprite = this.rankSprite;\n        // var main = function(){\n        //     texture.initWithElement(shareCanvas);\n        //     texture.handleLoadedTexture();\n        //     sprite.spriteFrame = spriteFrame;\n        //     sprite.spriteFrame._refreshTexture(texture);\n        // };\n        // main();\n        // tywx.Timer.setTimer(this, main, 1/10, 1000);\n        tywx.Timer.cancelTimer(this,this.updateRankTexture);\n        tywx.Timer.setTimer(this, this.updateRankTexture, 1/10, 1000);\n    },\n    \n    showRankListForShare:function(){\n        this.unscheduleAllCallbacks();\n        var openDataContext = wxGame.GlobalFuncs.getOpenData();\n        if(!openDataContext){\n            return;\n        }\n\n        this.sharedCanvas = openDataContext.canvas;\n        if (!this.shareTicket || this.shareTicket == \"\") {\n            wxGame.GlobalFuncs.getFriendRank();\n        }else {\n            wxGame.GlobalFuncs.getGroupRank(this.shareTicket);\n        }\n        // tywx.Timer.setTimer(this, main, 1/10,1000);\n        tywx.Timer.cancelTimer(this,this.updateRankTexture);\n        tywx.Timer.setTimer(this, this.updateRankTexture, 1/10, 1000);\n    },\n    updateRankTexture:function(){\n        var texture = this.texture;\n        var spriteFrame = this.spriteFrame;\n        var sprite = this.rankSprite;\n        texture.initWithElement(this.sharedCanvas);\n        texture.handleLoadedTexture();\n        sprite.spriteFrame = spriteFrame;\n        sprite.spriteFrame._refreshTexture(texture);\n    },\n    changeButtonToRank:function(shareTicket){\n        this.shareTicket = shareTicket;\n        this.showRankListForShare();\n        if (shareTicket && shareTicket != \"\"){\n            this.titleLabel.string = \"群排行\";\n            this.playBtn.active = true;\n            this.groupRankBtn.active = false;\n        }else {\n            this.titleLabel.string = \"好友排行\";\n            this.playBtn.active = false;\n            this.groupRankBtn.active = true;\n        }\n    },\n\n    //\n    onClickRankBtn:function(){\n        wxGame.GlobalFuncs.showRankUI(\"\");\n    },\n\n    onClickGroupRankBtn:function(){\n        wxGame.shareManager.sharePoint(\"574\",this.RankShareSuccess.bind(this),this.RankShareFail.bind(this));\n    },\n\n    RankShareSuccess:function(openId,shareTicket){\n        wxGame.LOGE(\"file = [rankUI] fun = [RankShareSuccess] shareTicket = \" + JSON.stringify(shareTicket));\n        wxGame.GlobalFuncs.showRankUI(shareTicket);\n        // wxGame.shareManager.resultType = 0;\n    },\n\n    RankShareFail:function(){\n        wxGame.GlobalFuncs.showToast(\"分享失败!\");\n    },\n\n    //玩一局\n    onClickPlayBtn:function(){\n        if (wxGame.gameResult) {\n            wxGame.gameResult.onClose();\n        }\n        this.backAction();\n        wxGame.GlobalFuncs.playGame();\n    },\n\n    backAction:function(){\n        tywx.Timer.cancelTimer(this,this.updateRankTexture);\n        this.node.destroy();\n        wxGame.rankUI = null;\n        wxGame.NotificationCenter.trigger(wxGame.EventType.UPDATE_RESULT_RANK);\n    },\n\n    onDestroy:function(){\n        wxGame.rankUI = null;\n        tywx.Timer.cancelTimer(this,this.updateRankTexture);\n        this.unscheduleAllCallbacks();\n    }\n    // update (dt) {},\n});\n"]}
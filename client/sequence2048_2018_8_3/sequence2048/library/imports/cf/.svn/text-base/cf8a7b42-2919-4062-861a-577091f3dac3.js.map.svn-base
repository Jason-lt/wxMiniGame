{"version":3,"sources":["../../../../../assets/Scripts/common/assets/Scripts/common/wxAdManager.js"],"names":["wxGame","wxAdManager","videoAdId","checkVideoTime","showRewardVideo","adSuccessCallFunc","adfailCallFunc","wx","hasOwnProperty","LOGD","GlobalFuncs","showToast","onAdClose","res","playEnded","isEnded","videoAdManager","offClose","canPlay","checkVideoAd","show","destroyBanner","onClose","createRewardedVideoAd","adUnitId","load","then","LOGW","catch","err","JSON","stringify","setTimeout","wxBannerAd","bannerAd","hide","error"],"mappings":";;;;;;AAAA;;;AAGAA,OAAOC,WAAP,GAAqB;AACjBC,eAAU,yBADO;AAEjBC,oBAAiB,MAFA;AAGjB;;;;AAIAC,qBAAgB,yBAASC,iBAAT,EAA2BC,cAA3B,EAA0C;AACtD,YAAI,CAACC,GAAGC,cAAH,CAAkB,uBAAlB,CAAL,EAAgD;AAC5CR,mBAAOS,IAAP,CAAY,gBAAZ;AACAT,mBAAOU,WAAP,CAAmBC,SAAnB,CAA6B,sBAA7B;AACA;AACH;AACD,YAAIC,YAAY,SAAZA,SAAY,CAASC,GAAT,EAAa;AACzB,gBAAIC,YAAa,CAACD,GAAD,IAASA,OAAOA,IAAIE,OAArC;AACA;AACA;AACA,gBAAIV,iBAAJ,EAAuB;AACnBA,kCAAkBS,SAAlB;AACH;AACDd,mBAAOC,WAAP,CAAmBe,cAAnB,CAAkCC,QAAlC,CAA2CL,SAA3C;AACAZ,mBAAOC,WAAP,CAAmBiB,OAAnB,GAA6B,KAA7B;AACAlB,mBAAOC,WAAP,CAAmBkB,YAAnB;AACH,SAVD;;AAYA,YAAInB,OAAOC,WAAP,CAAmBiB,OAAvB,EAA+B;AAC3BlB,mBAAOC,WAAP,CAAmBe,cAAnB,CAAkCI,IAAlC;AACA,iBAAKC,aAAL;AACArB,mBAAOC,WAAP,CAAmBe,cAAnB,CAAkCM,OAAlC,CAA0CV,SAA1C;AACH,SAJD,MAKI;AACA;AACA;AACA,gBAAIN,cAAJ,EAAoB;AAChBA;AACH;AACJ;AACJ,KArCgB;;AAuCjBa,kBAAa,wBAAU;AACnB,YAAI,CAACZ,GAAGC,cAAH,CAAkB,uBAAlB,CAAL,EAAgD;AAC5C;AACH;;AAED,YAAI,CAAC,KAAKQ,cAAV,EAAyB;AACrB,iBAAKA,cAAL,GAAsBT,GAAGgB,qBAAH,CAAyB;AAC3CC,0BAASxB,OAAOC,WAAP,CAAmBC;AADe,aAAzB,CAAtB;AAGH;;AAED,aAAKc,cAAL,CAAoBS,IAApB,GAA2BC,IAA3B,CAAgC,YAAY;AACxC1B,mBAAO2B,IAAP,CAAY,eAAZ;AACA3B,mBAAOC,WAAP,CAAmBiB,OAAnB,GAA6B,IAA7B;AACH,SAHD,EAGGU,KAHH,CAGS,UAAUC,GAAV,EAAe;AACpB7B,mBAAO2B,IAAP,CAAY,oBAAZ,EAAkCG,KAAKC,SAAL,CAAeF,GAAf,CAAlC;AACA7B,mBAAOC,WAAP,CAAmBiB,OAAnB,GAA6B,KAA7B;;AAEAc,uBAAW,YAAY;AACnBhC,uBAAOC,WAAP,CAAmBkB,YAAnB;AACH,aAFD,EAEGnB,OAAOC,WAAP,CAAmBE,cAFtB;AAGH,SAVD;AAWH,KA7DgB;;AA+DjBkB,mBAAc,yBAAU;AACpB,YAAIrB,OAAOiC,UAAP,CAAkBC,QAAtB,EAAgC;AAC5B,gBAAI;AACAlC,uBAAOiC,UAAP,CAAkBC,QAAlB,CAA2BC,IAA3B;AACH,aAFD,CAEE,OAAOC,KAAP,EAAc,CAEf;AACJ;AACJ;AAvEgB,CAArB","file":"wxAdManager.js","sourceRoot":"../../../../../assets/Scripts/common","sourcesContent":["/**\n * Created by tuyoo on 2018/9/17.\n */\nwxGame.wxAdManager = {\n    videoAdId:\"adunit-cfb475129810e6a2\",\n    checkVideoTime : 300000,\n    /*\n     * 播放激励广告视频\n     *\n     */\n    showRewardVideo:function(adSuccessCallFunc,adfailCallFunc){\n        if (!wx.hasOwnProperty('createRewardedVideoAd')){\n            wxGame.LOGD(\"玩家基础库不支持激励广告视频\");\n            wxGame.GlobalFuncs.showToast('您的微信版本过低,请升级至6.6.6以上');\n            return\n        }\n        var onAdClose = function(res){\n            var playEnded = (!res || (res && res.isEnded));\n            //只有播放完成才发奖\n            // wxGame.NotificationCenter.trigger(wxGame.EventType.REWARD_VIDEO_COMPLETE, playEnded);\n            if (adSuccessCallFunc) {\n                adSuccessCallFunc(playEnded);\n            }\n            wxGame.wxAdManager.videoAdManager.offClose(onAdClose);\n            wxGame.wxAdManager.canPlay = false;\n            wxGame.wxAdManager.checkVideoAd();\n        };\n\n        if (wxGame.wxAdManager.canPlay){\n            wxGame.wxAdManager.videoAdManager.show();\n            this.destroyBanner();\n            wxGame.wxAdManager.videoAdManager.onClose(onAdClose);\n        }\n        else{\n            // ty.BiLog.clickStat(ty.UserInfo.clickStatEventType.clickStatEventTypeWatchVideo, [\"fail\", type]);\n            // wxGame.NotificationCenter.trigger(wxGame.EventType.REWARD_VIDEO_COMPLETE, true);\n            if (adfailCallFunc) {\n                adfailCallFunc();\n            }\n        }\n    },\n\n    checkVideoAd:function(){\n        if (!wx.hasOwnProperty('createRewardedVideoAd')){\n            return;\n        }\n\n        if (!this.videoAdManager){\n            this.videoAdManager = wx.createRewardedVideoAd({\n                adUnitId:wxGame.wxAdManager.videoAdId\n            });\n        }\n\n        this.videoAdManager.load().then(function () {\n            wxGame.LOGW(\"====== 成功获取广告\");\n            wxGame.wxAdManager.canPlay = true;\n        }).catch(function (err) {\n            wxGame.LOGW(\"====== 获取广告失败,继续获取\", JSON.stringify(err));\n            wxGame.wxAdManager.canPlay = false;\n\n            setTimeout(function () {\n                wxGame.wxAdManager.checkVideoAd();\n            }, wxGame.wxAdManager.checkVideoTime);\n        });\n    },\n    \n    destroyBanner:function(){\n        if (wxGame.wxBannerAd.bannerAd) {\n            try {\n                wxGame.wxBannerAd.bannerAd.hide();\n            } catch (error) {\n\n            }\n        }\n    },\n}"]}
{"version":3,"sources":["../../../../../assets/Scripts/ui/assets/Scripts/ui/seq_getBox.js"],"names":["cc","Class","extends","Component","properties","cardSprite","Sprite","cardSpriteFrame","SpriteFrame","boxNode","Node","onLoad","wxGame","NotificationCenter","listen","EventType","UPDATE_SHARE_STATE","updateShareState","isAction","ani","node","getComponent","Animation","anim","getAnimationState","that","once","play","setBoxCardScore","score","index","GameConfig","itemScoreConfig","indexOf","spriteFrame","Global","sharePoint","LOGW","resultType","shareManager","GlobalFuncs","showToast","propList","arrIndex","Math","floor","random","length","tcpManager","sendCmd","shareToGetreward","tywx","BiLog","clickStat","biManager","getChangeCard","getCardProp","propIndex","getBombCard","getPowerfulCard","onClose","onClickGetBox","shareConfig","mergeBox","useMethod","onClickBox","wxAdManager","showRewardVideo","onAdSuccess","bind","onAdFail","isEnd","wxBannerAd","createBannerAd","isBringVersion","onClickSkipBtn","stop","stopAllActions","destroy","onDestroy","boxUI","ignoreScope"],"mappings":"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","file":"seq_getBox.js","sourceRoot":"../../../../../assets/Scripts/ui","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        cardSprite:cc.Sprite,\n        cardSpriteFrame:[cc.SpriteFrame],\n\n        boxNode:cc.Node,\n    },\n\n    onLoad:function(){\n        wxGame.NotificationCenter.listen(wxGame.EventType.UPDATE_SHARE_STATE,this.updateShareState,this);\n        this.isAction = true;\n        var ani = this.node.getComponent(cc.Animation);\n        var anim = ani.getAnimationState('2048_baoxiang');\n        var that = this;\n        anim.once(\"finished\", function () {\n            that.isAction = false;\n        });\n        anim.play();\n    },\n\n    setBoxCardScore:function(score){\n        var index = wxGame.GameConfig.itemScoreConfig.indexOf(score);\n        if (index >= 0) {\n            this.cardSprite.spriteFrame = this.cardSpriteFrame[index];\n        }\n    },\n\n    updateShareState:function(){\n        if (wxGame.Global.sharePoint == \"571\") {\n            wxGame.LOGW(\"file = [seq_getBox] fun = [updateShareState] \");\n            var resultType = wxGame.shareManager.resultType;\n            switch (resultType) {\n                case 1:\n                    wxGame.GlobalFuncs.showToast(\"分享到群才有效哦~\");\n                    break;\n                case 2:\n                    wxGame.GlobalFuncs.showToast(\"这个群今天已经打扰过了哦~\");\n                    break;\n                case 3:\n                    var propList = [0,1,2];\n                    var arrIndex = Math.floor(Math.random() * propList.length);\n                    if (propList[arrIndex] != null) {\n                        if (propList[arrIndex] == 2) {\n                            tcpManager.sendCmd.shareToGetreward(10700001);\n                            tywx.BiLog.clickStat(wxGame.biManager.getChangeCard, [\"video\",\"box\"]);\n                        }else {\n                            wxGame.GlobalFuncs.getCardProp(propList[arrIndex]);\n                            if (this.propIndex == 0){   //炸弹\n                                tywx.BiLog.clickStat(wxGame.biManager.getBombCard, [\"video\",\"box\"]);\n                            }else if (this.propIndex == 1){   //万能\n                                tywx.BiLog.clickStat(wxGame.biManager.getPowerfulCard, [\"video\",\"box\"]);\n                            }\n                        }\n                    }\n                    this.onClose();\n                    break;\n                case 6:\n                    wxGame.GlobalFuncs.showToast(\"分享失败!\");\n                    break;\n                default:\n                    wxGame.GlobalFuncs.showToast(\"分享失败!\");\n                    break;\n            }\n            wxGame.shareManager.resultType = 0;\n        }\n    },\n\n    onClickGetBox:function(){\n        if (this.isAction) {\n            return\n        }\n        if(wxGame.shareConfig.mergeBox.useMethod == \"share\") {\n            wxGame.shareManager.sharePoint(\"571\");\n            tywx.BiLog.clickStat(wxGame.biManager.onClickBox, [\"share\"]);\n        }else {\n            tywx.BiLog.clickStat(wxGame.biManager.onClickBox, [\"video\"]);\n            wxGame.wxAdManager.showRewardVideo(this.onAdSuccess.bind(this),this.onAdFail.bind(this));\n        }\n    },\n\n    onAdSuccess:function(isEnd){\n        if (isEnd){\n            var propList = [0,1,2];\n            var arrIndex = Math.floor(Math.random() * propList.length);\n            if (propList[arrIndex] != null) {\n                if (propList[arrIndex] == 2) {\n                    tcpManager.sendCmd.shareToGetreward(10700001);\n                    tywx.BiLog.clickStat(wxGame.biManager.getChangeCard, [\"share\",\"box\"]);\n                }else {\n                    wxGame.GlobalFuncs.getCardProp(propList[arrIndex]);\n                    if (this.propIndex == 0){   //炸弹\n                        tywx.BiLog.clickStat(wxGame.biManager.getBombCard, [\"share\",\"box\"]);\n                    }else if (this.propIndex == 1){   //万能\n                        tywx.BiLog.clickStat(wxGame.biManager.getPowerfulCard, [\"share\",\"box\"]);\n                    }\n                }\n            }\n            this.onClose();\n        }else {\n            wxGame.GlobalFuncs.showToast(\"观看完整视频,才可获得奖励\");\n        }\n        wxGame.wxBannerAd.createBannerAd();\n    },\n\n    onAdFail:function(){\n        wxGame.GlobalFuncs.showToast(\"激励视频已达上限!\");\n        wxGame.wxBannerAd.createBannerAd();\n        if (wxGame.Global.isBringVersion) {\n            return\n        }\n        wxGame.shareManager.sharePoint(\"571\");\n    },\n\n    onClickSkipBtn:function(){\n        if (this.isAction) {\n            return\n        }\n        this.onClose();\n    },\n\n    onClose:function(){\n        var ani = this.node.getComponent(cc.Animation);\n        var anim = ani.getAnimationState('2048_baoxiang');\n        anim.stop();\n\n        this.boxNode.stopAllActions();\n\n        this.node.destroy();\n    },\n    onDestroy:function () {\n        wxGame.boxUI = null;\n        wxGame.NotificationCenter.ignoreScope(this);\n    }\n});\n"]}
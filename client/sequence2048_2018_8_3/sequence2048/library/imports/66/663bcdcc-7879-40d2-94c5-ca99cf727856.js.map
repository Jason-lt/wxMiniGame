{"version":3,"sources":["../../../../../assets/Scripts/ui/assets/Scripts/ui/resurgenceUI.js"],"names":["cc","Class","extends","Component","properties","title","Label","logoBtn","Node","btnLabel","timerSprite","Sprite","onLoad","wxGame","GlobalFuncs","btnScaleEffect","NotificationCenter","listen","EventType","UPDATE_SHARE_STATE","updateShareState","resurgenceConfig","useMethod","string","resurgenceRemove","fillRange","timer","timerSpriteAni","that","callFunc","node","runAction","sequence","delayTime","onClose","onClickLogoBtn","stopAllActions","shareManager","sharePoint","shareSuccess","bind","shareFail","tywx","BiLog","clickStat","biManager","resurgenceBtn","wxAdManager","showRewardVideo","onAdSuccess","onAdFail","isEnd","trigger","RESURGENCE_SUCCESS","resurgenceSuccess","onResurgence","showToast","Global","isBringVersion","LOGW","resultType","onClickSkipBtn","resurgenceSkip","GAME_OVER_RESET","POP_RESULTUI","destroy","onDestroy","unscheduleAllCallbacks","ignoreScope"],"mappings":"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","file":"resurgenceUI.js","sourceRoot":"../../../../../assets/Scripts/ui","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        title:cc.Label,\n        logoBtn:cc.Node,\n        btnLabel:cc.Label,\n        timerSprite:cc.Sprite,\n    },\n\n    onLoad:function(){\n        wxGame.GlobalFuncs.btnScaleEffect(this.logoBtn,1.2);\n        wxGame.NotificationCenter.listen(wxGame.EventType.UPDATE_SHARE_STATE,this.updateShareState,this);\n\n        if (wxGame.resurgenceConfig.useMethod == \"share\") {\n            this.btnLabel.string = \"分享到群消\" + wxGame.resurgenceConfig.resurgenceRemove + \"行\";\n        }else {\n            this.btnLabel.string = \"看视频消\" + wxGame.resurgenceConfig.resurgenceRemove + \"行\";\n        }\n\n        this.timerSprite.fillRange = 1;\n        this.timer = 100;\n        this.timerSpriteAni();\n\n    },\n    \n    \n\n    timerSpriteAni:function(){\n\n        if (this.timer > 0) {\n            var that = this;\n            var callFunc = function(){\n                that.timerSprite.fillRange = that.timer/100;\n                that.timer = that.timer - 0.2;\n                that.timerSpriteAni();\n            };\n            this.node.runAction(cc.sequence(cc.delayTime(0.002),cc.callFunc(callFunc)));\n        }else {\n            this.onClose();\n        }\n    },\n\n    onClickLogoBtn:function(){\n        this.node.stopAllActions();\n        if (wxGame.resurgenceConfig.useMethod == \"share\") {\n            wxGame.shareManager.sharePoint(\"575\",this.shareSuccess.bind(this),this.shareFail.bind(this));\n            tywx.BiLog.clickStat(wxGame.biManager.resurgenceBtn, [\"share\"]);\n        }else {\n            wxGame.wxAdManager.showRewardVideo(this.onAdSuccess.bind(this),this.onAdFail.bind(this));\n            tywx.BiLog.clickStat(wxGame.biManager.resurgenceBtn, [\"video\"]);\n        }\n\n        // wxGame.shareManager.sharePoint(\"575\");\n\n        // wxGame.NotificationCenter.trigger(wxGame.EventType.RESURGENCE_SUCCESS);\n        // this.onResurgence();\n\n        // this.node.stopAllActions();\n        // this.timerSprite.fillRange = 0;\n    },\n\n    onAdSuccess:function(isEnd){\n        if (isEnd){\n            wxGame.NotificationCenter.trigger(wxGame.EventType.RESURGENCE_SUCCESS);\n            tywx.BiLog.clickStat(wxGame.biManager.resurgenceSuccess, [\"video\"]);\n            this.onResurgence();\n        }else {\n            wxGame.GlobalFuncs.showToast(\"观看完整视频,才可获得奖励\");\n            this.timerSpriteAni();\n        }\n    },\n\n    onAdFail:function(){\n        wxGame.GlobalFuncs.showToast(\"激励视频已达上限!\");\n        if (wxGame.Global.isBringVersion) {\n            this.timerSpriteAni();\n            return\n        }\n        wxGame.shareManager.sharePoint(\"575\",this.shareSuccess.bind(this),this.shareFail.bind(this));\n    },\n\n    shareSuccess:function(){\n        // var resultType = wxGame.shareManager.resultType;\n        // switch (resultType) {\n        //     case 1:\n        //         wxGame.GlobalFuncs.showToast(\"分享到群才有效哦~\");\n        //         break;\n        //     case 2:\n        //         wxGame.GlobalFuncs.showToast(\"这个群今天已经打扰过了哦~\");\n        //         break;\n        //     case 3:\n        //         // wxGame.GlobalFuncs.showToast(\"分享也不能复活!\");\n        //         wxGame.NotificationCenter.trigger(wxGame.EventType.RESURGENCE_SUCCESS);\n        //         this.onResurgence();\n        //         return;\n        //         break;\n        //     case 6:\n        //         wxGame.GlobalFuncs.showToast(\"分享失败!\");\n        //         break;\n        //     default:\n        //         wxGame.GlobalFuncs.showToast(\"分享失败!\");\n        //         break;\n        // }\n        // wxGame.shareManager.resultType = 0;\n        // this.onClose();\n        this.timerSpriteAni();\n    },\n\n    shareFail:function(){\n        this.timerSpriteAni();\n        // wxGame.GlobalFuncs.showToast(\"分享失败!\");\n    },\n\n    updateShareState:function(){\n        if (wxGame.Global.sharePoint == \"575\") {\n            wxGame.LOGW(\"file = [resurgenceUI] fun = [updateShareState] wxGame.Global.sharePoint = \" + wxGame.Global.sharePoint);\n            var resultType = wxGame.shareManager.resultType;\n            switch (resultType) {\n                case 1:\n                    wxGame.GlobalFuncs.showToast(\"分享到群才有效哦~\");\n                    break;\n                case 2:\n                    wxGame.GlobalFuncs.showToast(\"这个群今天已经打扰过了哦~\");\n                    break;\n                case 3:\n                    wxGame.NotificationCenter.trigger(wxGame.EventType.RESURGENCE_SUCCESS);\n                    tywx.BiLog.clickStat(wxGame.biManager.resurgenceSuccess, [\"share\"]);\n                    this.onResurgence();\n                    return;\n                    break;\n                case 6:\n                    wxGame.GlobalFuncs.showToast(\"分享失败!\");\n                    break;\n                default:\n                    wxGame.GlobalFuncs.showToast(\"分享失败!\");\n                    break;\n            }\n            wxGame.shareManager.resultType = 0;\n            // this.onClose();\n        }\n    },\n\n    onClickSkipBtn:function(){\n        tywx.BiLog.clickStat(wxGame.biManager.resurgenceSkip, [\"onClickSkipBtn\"]);\n        this.onClose();\n    },\n\n    onClose:function(){\n        this.logoBtn.stopAllActions();\n        wxGame.NotificationCenter.trigger(wxGame.EventType.GAME_OVER_RESET);\n        wxGame.NotificationCenter.trigger(wxGame.EventType.POP_RESULTUI);\n        this.node.destroy();\n    },\n\n    onResurgence:function(){\n        this.logoBtn.stopAllActions();\n        this.node.stopAllActions();\n        this.timerSprite.fillRange = 0;\n        this.node.destroy();\n    },\n\n\n    onDestroy:function(){\n        this.unscheduleAllCallbacks();\n        wxGame.NotificationCenter.ignoreScope(this);\n    }\n    // update (dt) {},\n});\n"]}
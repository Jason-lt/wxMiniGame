{"version":3,"sources":["gridNode.js"],"names":["cc","Class","extends","Component","properties","gridPrefab","Prefab","itemPrefab","onLoad","allGrids","wxGame","NotificationCenter","listen","EventType","UPDATE_TOUCH_BEGAN","_onTouchBegan","UPDATE_TOUCH_MOVE","_onTouchMove","UPDATE_TOUCH_END","_onTouchEnd","MERGE_ITEM_SCORE","mergeItem","CHECK_OVER","checkOver","GAME_OVER_RESET","resetData","REMOVE_GAME_ANI","removeGameAni","SELECT_POWERFUL","selectPowerful","SELECT_BOMBCARD","selectBombCard","RECOVER_LAST_OPERATION","recoverLastOperation","RESURGENCE_SUCCESS","resurgenceSuccess","lastItemScores","saveLastData","length","i","item","data","propType","getProp","score","getScore","node","setLocalZOrder","index","GlobalFuncs","isEmptyObject","setItemZOrder","onMergeRemoveItem","hideColtSprite","setScore","setPropType","grid","trigger","CREATE_ITEM","getNoneCardGrid","selectGrid","selectLastGrid","operItem","lastSelectGrid","pos","callFunc","_item","setIsGridSelect","btmGrid","grid_pos","convertToNodeSpace","getRootNode","convertToWorldSpace","p","winSize","director","getWinSize","cardRect","rect","x","width","y","Global","isXInter","height","rectContainsPoint","isMergeIng","btmGridIndex","ShowKunag","vibrateShort","AudioManager","playEffect","AudioType","select","lastGrid","gameInfo","powerfulCard","bombCard","GameConfig","itemScoreConfig","indexOf","isMerge","bind","isLastOperation","SELECT_GRID","lastGridMerge","nowCrossBet","bombAni","scoreConfig","createCardConfig","randomForArray","SELECT_LAST_GRID","getIsPropCard","powerful","merge","undoCard","revocation","UPDATE_REVOCATION_PROP","UPDATE_SCORE_LABEL","that","_selectLastGrid","boxCallFunc","boxNumer","boxCardConfig","probability","boxCardProbability","Math","random","shareConfig","mergeBox","isUse","popBoxUI","clearCardConfig","bomeMerge","mergeAni","playBetAni","posy","_bet","_node","getScene","loader","loadRes","err","prefab","betNode","instantiate","addChild","_size","getContentSize","setPosition","setTag","com","getComponent","setBet","item_b","item_t","bet","checkMerge","itemsize","getPosition","SAVE_DATA","moveToPosMerge","timer","runAction","sequence","delayTime","bomb","isOver","CHECK_OVER_RESULT","createAllGrid","hIndex","gridInfo","vIndex","rowNum","parma","createGrid","gridItem","gridSize","inter_r","inter_c","interval","posX","posY","gridView","setIndex","lastLength","resurgenceConfig","resurgenceRemove","randTimer","removeeAni","onDestroy","ignoreScope"],"mappings":"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","file":"gridNode.js","sourceRoot":"../../../../../assets/Scripts/component","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        gridPrefab:cc.Prefab,\n        itemPrefab:cc.Prefab,\n\n    },\n\n    onLoad:function(){\n        this.allGrids = [];\n        wxGame.NotificationCenter.listen(wxGame.EventType.UPDATE_TOUCH_BEGAN,this._onTouchBegan,this);\n        wxGame.NotificationCenter.listen(wxGame.EventType.UPDATE_TOUCH_MOVE,this._onTouchMove,this);\n        wxGame.NotificationCenter.listen(wxGame.EventType.UPDATE_TOUCH_END,this._onTouchEnd,this);\n        wxGame.NotificationCenter.listen(wxGame.EventType.MERGE_ITEM_SCORE,this.mergeItem,this);\n\n        wxGame.NotificationCenter.listen(wxGame.EventType.CHECK_OVER,this.checkOver,this);\n        \n        wxGame.NotificationCenter.listen(wxGame.EventType.GAME_OVER_RESET,this.resetData,this);\n\n        wxGame.NotificationCenter.listen(wxGame.EventType.REMOVE_GAME_ANI,this.removeGameAni,this);\n\n        wxGame.NotificationCenter.listen(wxGame.EventType.SELECT_POWERFUL,this.selectPowerful,this);\n        wxGame.NotificationCenter.listen(wxGame.EventType.SELECT_BOMBCARD,this.selectBombCard,this);\n\n        wxGame.NotificationCenter.listen(wxGame.EventType.RECOVER_LAST_OPERATION,this.recoverLastOperation,this);\n\n        wxGame.NotificationCenter.listen(wxGame.EventType.RESURGENCE_SUCCESS,this.resurgenceSuccess,this);\n        this.lastItemScores = [];\n        \n        // \n    },\n\n    //保存各个格子的分数\n    saveLastData:function(){\n        if (this.allGrids.length <= 0) {\n            return\n        }\n        this.lastItemScores = [];\n        for (var i = 0; i < this.allGrids.length; i++) {\n            if (this.allGrids[i].item) {\n                var data = {};\n                data.propType = this.allGrids[i].item.getProp() || 0;\n                data.score = this.allGrids[i].item.getScore() || 0;\n                this.lastItemScores[i] = data;\n            }else {\n                var data = {};\n                this.lastItemScores[i] = data;\n            }\n        }\n    },\n\n    //恢复上次操作\n    recoverLastOperation:function(){\n        if (this.lastItemScores.length <= 0) {\n            // wxGame.GlobalFuncs.showToast(\"道具使用失败~\");\n            return\n        }\n        this.node.setLocalZOrder(1);\n        var index = 0;\n        for (var i = 0; i < this.lastItemScores.length; i++) {\n            if (!wxGame.GlobalFuncs.isEmptyObject(this.lastItemScores[i])) {\n                index++;\n            }\n            if (this.allGrids[i].item) {\n                this.allGrids[i].item.setItemZOrder(2);\n                if (wxGame.GlobalFuncs.isEmptyObject(this.lastItemScores[i])) {\n                    this.allGrids[i].item.onMergeRemoveItem(this.allGrids[i]);\n                    this.allGrids[i].item = null;\n                    if (i == 0) {\n                        this.allGrids[i].hideColtSprite(true);\n                    }\n                }else {\n                    this.allGrids[i].item.setScore(this.lastItemScores[i].score);\n                    this.allGrids[i].item.setPropType(this.lastItemScores[i].propType);\n                }\n            }else {\n                if (!wxGame.GlobalFuncs.isEmptyObject(this.lastItemScores[i])) {\n                    var data = {};\n                    data.grid = this.allGrids[i];\n                    data.score = this.lastItemScores[i].score;\n                    data.propType = this.lastItemScores[i].propType;\n                    wxGame.NotificationCenter.trigger(wxGame.EventType.CREATE_ITEM,data);\n                }\n            }\n        }\n        // var index = this.lastItemScores.length;\n        if (index > 0) {\n            for (var i = index; i < this.allGrids.length; i++) {\n                if (this.allGrids[i].item) {\n                    this.allGrids[i].item.onMergeRemoveItem(this.allGrids[i]);\n                    if (i == 0) {\n                        this.allGrids[i].hideColtSprite(true);\n                    }\n                    this.allGrids[i].item = null;\n                }\n            }\n        }\n\n    },\n\n    _onTouchBegan:function(item){\n        this.getNoneCardGrid();\n        this.selectGrid = null;\n        this.selectLastGrid = null;\n        this.operItem = null;\n\n        this.lastSelectGrid = null;\n    },\n\n    _onTouchMove:function(data){\n        var pos = data.pos;\n        var callFunc = data.callFunc;\n        var _item = data.item;\n        this.selectGrid = null;\n        this.selectLastGrid = null;\n        this.operItem = null;\n        this.getNoneCardGrid();\n        _item.setIsGridSelect(false);\n\n        if (this.btmGrid) {\n            var grid_pos = this.node.convertToNodeSpace(this.btmGrid.getRootNode().convertToWorldSpace(cc.p(0,0)));\n            pos = this.node.convertToNodeSpace(pos);\n            var winSize = cc.director.getWinSize();\n            var cardRect = cc.rect(grid_pos.x - winSize.width/2,\n                grid_pos.y-wxGame.Global.isXInter , this.btmGrid.node.width, this.btmGrid.node.height);\n            if (cc.rectContainsPoint(cardRect, pos) && !this.isMergeIng) {\n                //位置\n                // wxGame.LOGW(\"file = [bottom] fun = [touchCardsMoved] 已到最上面四个空格子了 i = \" + i);\n                _item.setIsGridSelect(true);\n                if (this.btmGrid == this.allGrids[0]) {\n                    this.node.setLocalZOrder(1);\n                }else {\n                    this.node.setLocalZOrder(1000);\n                }\n                if (this.btmGridIndex == 0) {\n                    this.btmGrid.ShowKunag(true);\n                }else if (this.btmGridIndex > 0 && this.allGrids[this.btmGridIndex - 1]) {\n                    this.allGrids[this.btmGridIndex - 1].item.ShowKunag(true);\n                }\n\n                if (this.lastSelectGrid != this.btmGrid) {  //记录上次选中格子,防止在同一个格子中移动重复振动\n                    wxGame.GlobalFuncs.vibrateShort();\n\n                    //播放选中音效\n                    wxGame.AudioManager.playEffect(wxGame.AudioManager.AudioType.select,1.2);\n\n                    this.lastSelectGrid = this.btmGrid;\n                }\n\n                this.selectGrid = this.btmGrid;\n            }else {\n                this.node.setLocalZOrder(1);\n                this.lastSelectGrid = null;\n            }\n        }else if (this.allGrids[this.allGrids.length - 1].item) {\n            var lastGrid = this.allGrids[this.allGrids.length - 1];\n\n            var grid_pos = this.node.convertToNodeSpace(lastGrid.getRootNode().convertToWorldSpace(cc.p(0,0)));\n            pos = this.node.convertToNodeSpace(pos);\n            var winSize = cc.director.getWinSize();\n            var cardRect = cc.rect(grid_pos.x - winSize.width/2,\n                grid_pos.y-wxGame.Global.isXInter , lastGrid.node.width, lastGrid.node.height);\n            if (cc.rectContainsPoint(cardRect, pos) && !this.isMergeIng) {\n                //位置\n                this.node.setLocalZOrder(1000);\n                lastGrid.item.ShowKunag(true);\n                // lastGrid.ShowLastKuang(true);\n                if (this.lastSelectGrid != lastGrid) {  //记录上次选中格子,防止在同一个格子中移动重复振动\n                    wxGame.GlobalFuncs.vibrateShort();\n                    //播放选中音效\n                    wxGame.AudioManager.playEffect(wxGame.AudioManager.AudioType.select,1.2);\n                    this.lastSelectGrid = lastGrid;\n                }\n                if (lastGrid.item.getScore() == _item.getScore() || _item.getProp() == wxGame.Global.gameInfo.powerfulCard\n                    || _item.getProp() == wxGame.Global.gameInfo.bombCard) {\n                    if (wxGame.GameConfig.itemScoreConfig.indexOf(lastGrid.item.getScore()) >= 0) {\n                        this.selectLastGrid = lastGrid;\n                        this.operItem = _item;\n                    }\n                }\n                _item.setIsGridSelect(true);\n            }else {\n                this.node.setLocalZOrder(1);\n                this.lastSelectGrid = null;\n            }\n        }\n\n        callFunc();\n    },\n\n    _onTouchEnd:function(){\n        var data = {};\n        data.selectGrid = this.selectGrid;\n        if (data.selectGrid) {  //保存上次各个格子的分数\n            data.callFunc = this.isMerge.bind(this);\n            this.saveLastData();\n            wxGame.Global.isLastOperation = true;\n        }else {\n            this.lastItemScores = [];\n\n        }\n\n        wxGame.NotificationCenter.trigger(wxGame.EventType.SELECT_GRID,data);\n        if (this.selectLastGrid) {\n            this.lastGridMerge();\n            wxGame.Global.isLastOperation = true;\n        }\n\n    },\n\n    //炸弹牌销毁上一张牌\n    selectBombCard:function(grid){\n        if (this.allGrids.length <= 0) {\n            return\n        }\n        for (var i = 0; i < this.allGrids.length; i++){\n            if (this.allGrids[i] == grid) {\n                if (this.allGrids[i-1] && this.allGrids[i-1].item) {\n                    wxGame.Global.gameInfo.score = wxGame.Global.gameInfo.score + this.allGrids[i-1].item.getScore() * wxGame.Global.gameInfo.nowCrossBet;\n                    // this.allGrids[i-1].item.onMergeRemoveItem(this.allGrids[i-1]);\n                    this.allGrids[i-1].item.bombAni();\n                    this.allGrids[i-1].item = null;\n                    this.node.setLocalZOrder(1);\n                    this.allGrids[0].hideColtSprite(true);\n                    grid.item.bombAni();\n                    grid.item = null;\n                    // grid.item.onMergeRemoveItem(grid);\n\n                }else if (i == 0) {\n                    //放在第一行\n                    // grid.item.onMergeRemoveItem(grid);\n                    this.node.setLocalZOrder(1);\n                    grid.hideColtSprite(true);\n                    grid.item.bombAni();\n                    grid.item = null;\n\n                }\n                break;\n            }\n        }\n    },\n\n    //设置万能卡牌分数\n    selectPowerful:function(grid){\n        if (this.allGrids.length <= 0) {\n            return\n        }\n        for (var i = 0; i < this.allGrids.length; i++){\n            if (this.allGrids[i] == grid) {\n                if (this.allGrids[i-1]) {\n                    //设置万能牌和上一张牌分数相同\n                    grid.item.setScore(this.allGrids[i-1].item.getScore());\n                    break;\n                }else if (i == 0) {\n                    //放在第一行\n                    var scoreConfig = wxGame.GameConfig.createCardConfig;\n                    var score = wxGame.GlobalFuncs.randomForArray(scoreConfig);\n                    grid.item.setScore(score);\n                }\n            }\n        }\n    },\n\n    //最后一个格子直接合并\n    lastGridMerge:function(){\n        wxGame.NotificationCenter.trigger(wxGame.EventType.SELECT_LAST_GRID);\n        wxGame.GlobalFuncs.vibrateShort();\n        //合并音效\n\n        if (this.operItem.getIsPropCard() == wxGame.Global.gameInfo.powerfulCard) {\n            wxGame.AudioManager.playEffect(wxGame.AudioManager.AudioType.powerful,1.2);\n        }else {\n            wxGame.AudioManager.playEffect(wxGame.AudioManager.AudioType.merge,1.2);\n        }\n        if (this.selectLastGrid.item.getIsPropCard() == wxGame.Global.gameInfo.undoCard || this.operItem.getIsPropCard() == wxGame.Global.gameInfo.undoCard){ //撤销卡牌合并\n            wxGame.Global.gameInfo.revocation++;\n            wxGame.NotificationCenter.trigger(wxGame.EventType.UPDATE_REVOCATION_PROP);\n        }\n\n        if (this.selectLastGrid.item.getProp() == wxGame.Global.gameInfo.bombCard || this.operItem.getProp() == wxGame.Global.gameInfo.bombCard) {\n\n            // if (this.operItem.getIsPropCard() == wxGame.Global.gameInfo.powerfulCard) {\n            //     wxGame.Global.gameInfo.score = wxGame.Global.gameInfo.score + this.selectLastGrid.item.getScore() * 5 * 2;\n            // }else {\n            //     wxGame.Global.gameInfo.score = wxGame.Global.gameInfo.score + this.selectLastGrid.item.getScore()*2;\n            // }\n            // this.bomeMerge();\n            wxGame.Global.gameInfo.score = wxGame.Global.gameInfo.score + this.selectLastGrid.item.getScore()*2 * wxGame.Global.gameInfo.nowCrossBet;\n            // this.selectLastGrid.item.onMergeRemoveItem(this.selectLastGrid);\n            // this.operItem.onMergeRemoveItem();\n\n            this.selectLastGrid.item.bombAni();\n            this.selectLastGrid.item = null;\n\n            this.operItem.bombAni();\n            wxGame.NotificationCenter.trigger(wxGame.EventType.UPDATE_SCORE_LABEL);\n            wxGame.NotificationCenter.trigger(wxGame.EventType.SELECT_LAST_GRID);\n            return\n        }\n        this.operItem.onMergeRemoveItem();\n        this.selectLastGrid.item.setScore(this.selectLastGrid.item.getScore() * 2);\n\n        var that = this;\n        var _selectLastGrid = that.selectLastGrid;\n        var boxCallFunc = function(){\n            if (!_selectLastGrid || !_selectLastGrid.item) {\n                return\n            }\n            var boxNumer = wxGame.Global.gameInfo.boxNumer;\n\n            //合并的宝箱\n            if (wxGame.GameConfig.boxCardConfig.indexOf(_selectLastGrid.item.getScore()) >= 0) {\n                var probability = 1;\n                if (wxGame.GameConfig.boxCardProbability && wxGame.GameConfig.boxCardProbability.length > 0){\n                    if (wxGame.GameConfig.boxCardProbability[boxNumer]) {\n                        probability = wxGame.GameConfig.boxCardProbability[boxNumer];\n                    }else {\n                        probability = wxGame.GameConfig.boxCardProbability[wxGame.GameConfig.boxCardProbability.length - 1];\n                    }\n                }\n\n                if (Math.random() <= probability) {\n                    //合并的宝箱\n                    if (wxGame.shareConfig.mergeBox.isUse) {\n                        //弹出宝箱\n                        wxGame.GlobalFuncs.popBoxUI(_selectLastGrid.item.getScore());\n                        wxGame.Global.gameInfo.boxNumer++;\n                    }\n                }\n            }\n\n            //合并消除一列\n            if (wxGame.GameConfig.clearCardConfig.indexOf(_selectLastGrid.item.getScore()) >= 0) {\n                that.bomeMerge();\n                //消除一列空丢弃栏\n                // wxGame.NotificationCenter.trigger(wxGame.EventType.CLEAR_WASTE_STATE);\n            }\n\n            if (_selectLastGrid.item.getScore() == 2048){\n                //翻倍\n                wxGame.Global.gameInfo.nowCrossBet++;\n            }\n        };\n\n        var callFunc = function(){\n            boxCallFunc();\n            wxGame.NotificationCenter.trigger(wxGame.EventType.MERGE_ITEM_SCORE);\n        };\n\n        this.selectLastGrid.item.mergeAni(callFunc); //合并特效\n        wxGame.Global.gameInfo.score = wxGame.Global.gameInfo.score + this.selectLastGrid.item.getScore()*2*wxGame.Global.gameInfo.nowCrossBet;\n        wxGame.NotificationCenter.trigger(wxGame.EventType.UPDATE_SCORE_LABEL);\n    },\n\n    //获取没有卡牌最上面一层四个格子\n    getNoneCardGrid:function(){\n        this.btmGrid = null;\n        this.btmGridIndex = null;\n        // this.allGrids[hIndex][vIndex]\n        if (this.allGrids.length <= 0) {\n            return\n        }\n        for (var i = 0; i < this.allGrids.length; i++){\n            if (!this.allGrids[i].item) {\n                this.btmGridIndex = i;\n                this.btmGrid = this.allGrids[i];\n                break;\n            }\n        }\n    },\n\n\n    //播放翻倍动画\n    playBetAni:function(posy,_bet,_node){\n        var grid_pos = cc.director.getScene().convertToNodeSpace(_node.getRootNode().convertToWorldSpace(cc.p(0,0)));\n        cc.loader.loadRes('prefab/betAni', function (err, prefab) {\n            var betNode = cc.instantiate(prefab);\n            cc.director.getScene().addChild(betNode);\n            var _size = _node.getRootNode().getContentSize()\n            betNode.setPosition(cc.p(grid_pos.x + _size.width/2,grid_pos.y + _size.height/2));\n            betNode.setTag(10);\n            var com = betNode.getComponent('betScore');\n            com.setBet(_bet);\n\n        });\n    },\n\n    //检测是否可以\n    isMerge:function(){\n        var isMerge = false;\n        if (!this.allGrids || this.allGrids.length <= 0) {\n            return\n        }\n        var that = this;\n        for (var i = that.allGrids.length; i > 0; i--) {\n            if (that.allGrids[i] && that.allGrids[i].item && that.allGrids[i-1] && that.allGrids[i-1].item) {\n                var item_b = that.allGrids[i].item;\n                var item_t = that.allGrids[i-1].item;\n                if (item_b.getScore() == item_t.getScore()) {\n                    //相等可以合并\n                    isMerge = true;\n                    break;\n                }\n            }\n        }\n\n        return isMerge;\n    },\n\n    //合并\n    mergeItem:function(){\n        if (this.allGrids.length <= 0) {\n            return\n        }\n        var that = this;\n        var bet = 0;\n        var checkMerge = function(){\n            that.isMergeIng = false;\n            for (var i = that.allGrids.length; i > 0; i--) {\n                if (that.allGrids[i] && that.allGrids[i].item && that.allGrids[i-1] && that.allGrids[i-1].item) {\n                    var item_b = that.allGrids[i].item;\n                    var item_t = that.allGrids[i-1].item;\n                    bet++;\n                    if (item_b.getScore() == item_t.getScore() && wxGame.GameConfig.itemScoreConfig.indexOf(item_t.getScore()*2) >= 0) {\n                        that.isMergeIng = true;\n                        //相等合并\n                        var callFunc = function(){\n                            // if (item_t.getProp() == wxGame.Global.gameInfo.bombCard || item_b.getProp() == wxGame.Global.gameInfo.bombCard) {\n                            //     that.bomeMerge();\n                            //     return\n                            // }\n                            if (i == 1 && that.allGrids[i-1]) {\n                                that.node.setLocalZOrder(1);\n                                that.allGrids[i-1].hideColtSprite(true);\n                            }\n\n                            //合并音效\n                            if (item_b.getIsPropCard() == wxGame.Global.gameInfo.powerfulCard) {\n                                wxGame.AudioManager.playEffect(wxGame.AudioManager.AudioType.powerful,1.2);\n                                wxGame.Global.gameInfo.score = wxGame.Global.gameInfo.score + item_t.getScore()*bet * 5 *\n                                    2 * wxGame.Global.gameInfo.nowCrossBet;\n                            }else if (item_b.getIsPropCard() == wxGame.Global.gameInfo.undoCard){ //撤销卡牌合并\n                                wxGame.Global.gameInfo.revocation++;\n                                wxGame.NotificationCenter.trigger(wxGame.EventType.UPDATE_REVOCATION_PROP);\n                                wxGame.AudioManager.playEffect(wxGame.AudioManager.AudioType.merge,1.2);\n                                wxGame.Global.gameInfo.score = wxGame.Global.gameInfo.score + item_t.getScore()*bet *\n                                    2 * wxGame.Global.gameInfo.nowCrossBet;\n                            }else {\n                                wxGame.AudioManager.playEffect(wxGame.AudioManager.AudioType.merge,1.2);\n                                wxGame.Global.gameInfo.score = wxGame.Global.gameInfo.score + item_t.getScore()*bet *\n                                    2 * wxGame.Global.gameInfo.nowCrossBet;\n                            }\n                            if (item_t.getIsPropCard() == wxGame.Global.gameInfo.undoCard) {\n                                wxGame.Global.gameInfo.revocation++;\n                                wxGame.NotificationCenter.trigger(wxGame.EventType.UPDATE_REVOCATION_PROP);\n                            }\n                            if (bet > 1) {\n                                var itemsize = that.allGrids[i-1].getRootNode().getContentSize();\n                                var posy = that.allGrids[i-1].getRootNode().getPosition().y + itemsize.height/2;\n                                that.playBetAni(posy,bet,that.allGrids[i-1]);\n                            }\n                            item_t.setScore(item_t.getScore() * 2,true);\n                            item_t.mergeAni(checkMerge); //合并特效\n                            wxGame.GlobalFuncs.vibrateShort();\n                            item_b.onMergeRemoveItem(that.allGrids[i]);\n                            wxGame.NotificationCenter.trigger(wxGame.EventType.UPDATE_SCORE_LABEL);\n                            wxGame.NotificationCenter.trigger(wxGame.EventType.SAVE_DATA);\n\n                            if (item_t.getScore() == 2048) {\n                                //翻倍\n                                wxGame.Global.gameInfo.nowCrossBet++;\n                            }\n\n                            //合并的宝箱\n                            if (wxGame.GameConfig.boxCardConfig.indexOf(item_t.getScore()) >= 0) {\n                                var boxNumer = wxGame.Global.gameInfo.boxNumer;\n                                var probability = 1;\n                                if (wxGame.GameConfig.boxCardProbability && wxGame.GameConfig.boxCardProbability.length > 0){\n                                    if (wxGame.GameConfig.boxCardProbability[boxNumer]) {\n                                        probability = wxGame.GameConfig.boxCardProbability[boxNumer];\n                                    }else {\n                                        probability = wxGame.GameConfig.boxCardProbability[wxGame.GameConfig.boxCardProbability.length - 1];\n                                    }\n                                }\n\n                                if (Math.random() <= probability) {\n                                    //合并的宝箱\n                                    if (wxGame.shareConfig.mergeBox.isUse) {\n                                        //弹出宝箱\n                                        wxGame.GlobalFuncs.popBoxUI(item_t.getScore());\n                                        wxGame.Global.gameInfo.boxNumer++;\n                                    }\n                                }\n                            }\n\n                            //合并消除一列\n                            if (wxGame.GameConfig.clearCardConfig.indexOf(item_t.getScore()) >= 0) {\n                                that.bomeMerge();\n                                //消除一列空丢弃栏\n                                // wxGame.NotificationCenter.trigger(wxGame.EventType.CLEAR_WASTE_STATE);\n                            }\n                        };\n                        item_b.moveToPosMerge(item_t.getRootNode().getPosition(),callFunc);\n                        // this.allGrids[i].item = null;\n                        break;\n                    }\n                }\n            }\n        };\n\n        checkMerge();\n    },\n\n    //炸弹合并\n    bomeMerge:function(){\n        if (this.allGrids.length <= 0) {\n            this.isMergeIng = false;\n            return\n        }\n        var timer = 0;\n        var that = this;\n        var index = 0;\n        var callFunc = function(){\n            that.isMergeIng = true;\n            if (that.allGrids[index] && that.allGrids[index].item) {\n                if (index == 0) {\n                    that.allGrids[index].hideColtSprite(true);\n                }\n                wxGame.Global.gameInfo.score = wxGame.Global.gameInfo.score + that.allGrids[index].item.getScore() * wxGame.Global.gameInfo.nowCrossBet;\n                that.node.setLocalZOrder(1);\n                that.allGrids[index].item.bombAni();\n                that.allGrids[index].item = null;\n                wxGame.NotificationCenter.trigger(wxGame.EventType.UPDATE_SCORE_LABEL);\n                wxGame.NotificationCenter.trigger(wxGame.EventType.SAVE_DATA);//存档\n                that.node.runAction(cc.sequence(cc.delayTime(timer),cc.callFunc(function(){\n                    callFunc();\n                })));\n                timer += 0.1;\n            }else {\n                that.isMergeIng = false;\n            }\n            index++;\n        };\n\n        callFunc();\n\n        wxGame.GlobalFuncs.vibrateShort();\n\n        //炸弹音效\n        wxGame.AudioManager.playEffect(wxGame.AudioManager.AudioType.bomb,1.2);\n    },\n\n    //检查游戏是否结束\n    checkOver:function(item){\n        var isOver = true;\n        // if (this.allGrids.length <= 0) {\n        //     //\n        //     return\n        // }\n        if (item) {\n            if (item.getProp() == wxGame.Global.gameInfo.powerfulCard) {\n                isOver = false;\n            }\n        }\n\n        for (var i = 0; i < this.allGrids.length; i++){\n            if (!this.allGrids[i].item) {\n                isOver = false;\n            }\n        }\n        if (this.isMerge()) {\n            isOver = false;\n        }\n\n        if (isOver) {\n            if (this.allGrids[this.allGrids.length-1].item && this.allGrids[this.allGrids.length-1].item.getScore) {\n                if (this.allGrids[this.allGrids.length-1].item.getScore() == item.getScore()){\n                    isOver = false;\n                }\n            }\n        }\n        wxGame.NotificationCenter.trigger(wxGame.EventType.CHECK_OVER_RESULT,isOver);\n    },\n\n    //创建格子:\n    createAllGrid:function(hIndex){\n        var gridInfo = wxGame.Global.gridInfo;\n        for (var vIndex = 0; vIndex < gridInfo.rowNum; vIndex++) {\n            var parma = {\n                hIndex: hIndex,\n                vIndex: vIndex,\n            };\n            this.allGrids[vIndex] = this.createGrid(parma);\n        }\n    },\n\n    //创建格子\n    createGrid: function (parma) {\n        //参数\n        var hIndex = parma.hIndex;\n        var vIndex = parma.vIndex;\n        var gridInfo = wxGame.Global.gridInfo;\n        var gridItem = cc.instantiate(this.gridPrefab);\n        // var posX = this.startX + hIndex * Global.itemSize + hIndex * Global.itemSplit;\n        // var posY = this.startY - vIndex * Global.itemSize - vIndex * Global.itemSplit;\n        var _size = this.node.getContentSize();\n        var gridSize = gridItem.getContentSize();\n        var inter_r = (_size.height - gridSize.height)/(gridInfo.rowNum - 1);\n        var inter_c = gridInfo.interval;\n        // var initX = 0 - ((gridInfo.colNum-1) * inter_c + gridInfo.colNum*gridSize.width)/2;\n        var posX = 0;\n\n        var posY = _size.height/2 - vIndex*inter_r - gridSize.height/2;\n        //设置格子的坐标\n        gridItem.setPosition(cc.p(posX, posY));\n        gridItem.setLocalZOrder(20);\n        //设置索引和位置\n        var gridView = gridItem.getComponent(\"gridView\");\n        gridView.node.setPosition(posX, posY);\n        gridView.setIndex(hIndex, vIndex, this);\n        if (vIndex == 0) {\n            gridView.hideColtSprite(true);\n        }\n        this.node.addChild(gridItem);\n        return gridView;\n    },\n\n    resurgenceSuccess:function(){\n        if (this.allGrids.length <= 0) {\n            return\n        }\n        var lastLength = this.allGrids.length - 1;\n\n        var timer = 0;\n        var that = this;\n        var index = 0;\n        var callFunc = function(){\n            if (that.allGrids[lastLength - index] && that.allGrids[index].item && index < wxGame.resurgenceConfig.resurgenceRemove) {\n                that.node.setLocalZOrder(1);\n                that.allGrids[lastLength - index].item.bombAni();\n                that.allGrids[lastLength - index].item = null;\n\n                that.node.runAction(cc.sequence(cc.delayTime(timer),cc.callFunc(function(){\n                    callFunc();\n                })));\n                timer += 0.05;\n            }\n            index++;\n        };\n\n        callFunc();\n    },\n    \n    \n    resetData:function(){\n        // this.selectGrid = null;\n        if (this.allGrids.length <= 0) {\n            return\n        }\n        // this.node.stopAllActions();\n        var timer = 0;\n\n        var that = this;\n\n        var index = 0;\n        var callFunc = function(){\n            if (that.allGrids[index] && that.allGrids[index].item) {\n                if (index == 0) {\n                    that.allGrids[index].hideColtSprite(true);\n                }\n                that.node.setLocalZOrder(1);\n                that.allGrids[index].item.bombAni();\n                that.allGrids[index].item = null;\n\n                that.node.runAction(cc.sequence(cc.delayTime(timer),cc.callFunc(function(){\n                    callFunc();\n                })));\n                timer += 0.05;\n            }\n            index++;\n        };\n\n        var randTimer = Math.random()/2;\n        this.node.runAction(cc.sequence(cc.delayTime(randTimer),cc.callFunc(function(){\n            callFunc();\n        })));\n        this.lastItemScores = [];\n        this.selectGrid = null;\n        this.selectLastGrid = null;\n        this.operItem = null;\n    },\n\n    removeGameAni:function(){\n        this.lastItemScores = [];\n        this.selectGrid = null;\n        this.selectLastGrid = null;\n        this.operItem = null;\n\n        if (this.allGrids.length <= 0) {\n            return\n        }\n\n        for (var i = 0; i < this.allGrids.length; i++) {\n            if (this.allGrids[i].item){\n                this.allGrids[i].item.removeeAni();\n                this.allGrids[i].item = null;\n            }\n        }\n    },\n\n    onDestroy:function () {\n        wxGame.NotificationCenter.ignoreScope(this);\n    }\n    // update (dt) {},\n});\n"]}
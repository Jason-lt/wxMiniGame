{"version":3,"sources":["scoreNode.js"],"names":["cc","Class","extends","Component","properties","scoreLabel","Label","betLabel","betIcon","Node","scoreProgress","ProgressBar","sectionLabel_1","sectionLabel_2","zhixiang","rankTexture","Texture2D","rankSpriteFrame","SpriteFrame","rankSprite","Sprite","onLoad","wxGame","NotificationCenter","listen","EventType","UPDATE_SCORE_LABEL","setScoreLabel","GAME_OVER_RESET","resetData","UPDATE_RANK_INFO","updateRankInfo","STOP_UPDATE_RANK","stopUpdateRank","section_1","section_2","lastScore","GlobalFuncs","getFriendRankInfo","openDataContext","getOpenData","sharedCanvas","canvas","width","height","node","active","tywx","Timer","cancelTimer","updateRank","setTimer","texture","spriteFrame","sprite","initWithElement","handleLoadedTexture","_refreshTexture","gameInfo","Global","score","parseInt","string","formatGold","nowCrossBet","getScoreSection","lastSection","index","score_2","Math","pow","index_2","_progress","size","getContentSize","endPos","proGressAni","tcpManager","sendCmd","sendSaveScore","onDestroy","ignoreScope"],"mappings":"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","file":"scoreNode.js","sourceRoot":"../../../../../assets/Scripts/component","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        scoreLabel:cc.Label,\n        betLabel:cc.Label,\n        betIcon:cc.Node,\n        scoreProgress:cc.ProgressBar,\n        sectionLabel_1:cc.Label,\n        sectionLabel_2:cc.Label,\n        zhixiang:cc.Node,\n\n\n        rankTexture : cc.Texture2D,\n        rankSpriteFrame : cc.SpriteFrame,\n        rankSprite : cc.Sprite,\n    },\n\n    onLoad:function(){\n        wxGame.NotificationCenter.listen(wxGame.EventType.UPDATE_SCORE_LABEL,this.setScoreLabel,this);\n        wxGame.NotificationCenter.listen(wxGame.EventType.GAME_OVER_RESET,this.resetData,this);\n        wxGame.NotificationCenter.listen(wxGame.EventType.UPDATE_RANK_INFO,this.updateRankInfo,this);\n        wxGame.NotificationCenter.listen(wxGame.EventType.STOP_UPDATE_RANK,this.stopUpdateRank,this);\n        this.section_1 = 0;\n\n        this.section_2 = 500;\n        this.lastScore = 0;\n        this.setScoreLabel();\n\n        wxGame.GlobalFuncs.getFriendRankInfo(this.section_1,this.section_2,this.lastScore,false);\n    },\n\n    updateRankInfo:function(){\n        var openDataContext = wxGame.GlobalFuncs.getOpenData();\n        if(!openDataContext){\n            return;\n        }\n\n        this.sharedCanvas = openDataContext.canvas;\n        this.sharedCanvas.width = 640;\n        this.sharedCanvas.height = 100;\n        this.rankTexture = new cc.Texture2D();\n        this.rankSpriteFrame = new cc.SpriteFrame(this.rankTexture);\n\n        this.rankSprite.node.active = true;\n\n        tywx.Timer.cancelTimer(this,this.updateRank);\n        tywx.Timer.setTimer(this, this.updateRank, 1/10, 1000);\n\n        wxGame.GlobalFuncs.getFriendRankInfo(this.section_1,this.section_2,this.lastScore,true);\n    },\n\n    updateRank:function(){\n        var texture = this.rankTexture;\n        var spriteFrame = this.rankSpriteFrame;\n        var sprite = this.rankSprite;\n        texture.initWithElement(this.sharedCanvas);\n        texture.handleLoadedTexture();\n        sprite.spriteFrame = spriteFrame;\n        sprite.spriteFrame._refreshTexture(texture);\n    },\n\n    //停止刷新当前排行\n    stopUpdateRank:function(){\n        tywx.Timer.cancelTimer(this,this.updateRank);\n    },\n\n    setScoreLabel:function(){\n        if (!this.scoreLabel) {\n            return\n        }\n        var gameInfo = wxGame.Global.gameInfo;\n        var score = gameInfo.score;\n        this.lastScore = parseInt(this.scoreLabel.string);\n        this.scoreLabel.string = wxGame.GlobalFuncs.formatGold(score);\n        if (wxGame.Global.gameInfo.nowCrossBet > 1) {\n            this.betIcon.active = true;\n            // var scoreSize = this.scoreLabel.node.getContentSize();\n            this.betLabel.string = \"x\" + wxGame.Global.gameInfo.nowCrossBet;\n            // this.betLabel.node.x = scoreSize.width/2 + 20;\n        }else {\n            this.betIcon.active = false;\n        }\n\n        this.getScoreSection(score);\n    },\n\n    resetData:function(){\n        this.section_1 = 0;\n        this.section_2 = 500;\n        this.lastSection = null;\n        this.rankSprite.node.active = false;\n        tywx.Timer.cancelTimer(this,this.updateRank);\n        this.sharedCanvas = null;\n    },\n\n    //计算分数两端区间数\n    getScoreSection:function(score){\n        var index = 0;\n        var score_2 = 500*Math.pow(2,index);\n        while (score >= score_2){\n            index++;\n            score_2 = 500*Math.pow(2,index);\n        }\n        this.section_1 = 0;\n        if (index == 0){\n            this.sectionLabel_1.string = 0;\n            this.section_1 = 0;\n        }else if (index > 0){\n            var index_2 = index - 1;\n            this.sectionLabel_1.string = 500*Math.pow(2,index_2);\n            this.section_1 = 500*Math.pow(2,index_2);\n        }\n        this.section_2 = 500*Math.pow(2,index);\n        this.sectionLabel_2.string = this.section_2;\n        this.sectionLabel_1.string = this.section_1;\n\n        var _progress = (score - this.section_1)/(this.section_2 - this.section_1);\n        var size = this.scoreProgress.node.getContentSize();\n        var endPos = size.width * _progress - size.width/2;\n        wxGame.GlobalFuncs.proGressAni(this.zhixiang,endPos,0.5);\n        // var _progress = (score - section_1)/(section_2 - section_1);\n        // this.scoreProgress.progress = _progress;\n\n        this.updateRankInfo();\n        if (this.lastSection != this.section_1) {\n            this.lastSection = this.section_1;\n        }\n        if (score > 0) {\n            tcpManager.sendCmd.sendSaveScore();\n        }\n    },\n\n    onDestroy:function () {\n        wxGame.NotificationCenter.ignoreScope(this);\n        tywx.Timer.cancelTimer(this,this.updateRank);\n    }\n\n});\n"]}
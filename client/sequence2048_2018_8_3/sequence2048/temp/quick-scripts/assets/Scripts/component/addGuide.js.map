{"version":3,"sources":["addGuide.js"],"names":["ctr","addGuide","sp","hand","guideNode","spUrl","handurl","hasInit","nodeHeight","isFromMyApp","init","self","cc","Node","addComponent","Sprite","addChild","loader","loadRes","SpriteFrame","err","spriteFrame","_sprite","getComponent","loadComplete","setIsFromMyApp","vSceneId","tywx","showScene","sprite1","sprite2","Math","max","getRect","height","position","p","width","showEffect","stopAllActions","_act1","moveTo","_act2","rep","repeatForever","sequence","runAction","show","wx","parent","removeChild","active","vSysInfo","getSystemInfoSync","pos","caculateHandNodePosition","game","addPersistRootNode","hide","size","director","getWinSize","isFitIphoneX","model","toLowerCase","replace","indexOf","dy","winSize","windowWidth","dx","windowHeight"],"mappings":"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","file":"addGuide.js","sourceRoot":"../../../../../assets/Scripts/component","sourcesContent":["//添加小程序\nctr.addGuide = {\n    sp: null,\n    hand: null,\n    //引导节点\n    guideNode: null,\n    //添加到小程序的图url\n    spUrl: 'textures/add',\n    //添加到小程序的手url\n    handurl: 'textures/hand',\n    hasInit: false,\n    nodeHeight: 0,\n    isFromMyApp:false,\n\n    //初始化\n    init: function () {\n        this.hasInit = true;\n        var self = this;\n        self.guideNode = new cc.Node('guideNode');\n\n        self.sp = new cc.Node('sp');\n        self.sp.addComponent(cc.Sprite);\n\n        self.hand = new cc.Node('hand');\n        self.hand.addComponent(cc.Sprite);\n\n        self.guideNode.addChild(self.sp);\n        self.guideNode.addChild(self.hand);\n\n        cc.loader.loadRes(self.spUrl, cc.SpriteFrame, function (err, spriteFrame) {\n            var _sprite = self.sp.getComponent(cc.Sprite);\n            _sprite.spriteFrame = spriteFrame;\n            self.loadComplete();\n        });\n\n        cc.loader.loadRes(self.handurl, cc.SpriteFrame, function (err, spriteFrame) {\n            var _sprite = self.hand.getComponent(cc.Sprite);\n            _sprite.spriteFrame = spriteFrame;\n            self.loadComplete();\n        });\n    },\n\n    setIsFromMyApp: function(vSceneId){\n        if(tywx.showScene == '1104'){\n            this.isFromMyApp = true;\n        }\n    },\n\n    loadComplete: function () {\n        var sprite1 = this.sp.getComponent(cc.Sprite).spriteFrame;\n        var sprite2 = this.hand.getComponent(cc.Sprite).spriteFrame;\n\n        if (sprite1 && sprite2) {\n            this.nodeHeight = Math.max(sprite1.getRect().height, sprite2.getRect().height);\n            this.hand.position = cc.p(-sprite2.getRect().width / 2, 0);\n            this.sp.position = cc.p(-sprite2.getRect().width - sprite1.getRect().width / 2 - 18, 0);\n            this.showEffect();\n        }\n    },\n\n    showEffect: function () {\n        var sprite1 = this.sp.getComponent(cc.Sprite).spriteFrame;\n        var sprite2 = this.hand.getComponent(cc.Sprite).spriteFrame;\n        if (sprite1 && sprite2) {\n            this.hand.stopAllActions();\n            var _act1 = cc.moveTo(0.8,cc.p(-sprite2.getRect().width / 2 + 8, 0));\n            var _act2 = cc.moveTo(0.8,cc.p(-sprite2.getRect().width / 2 - 8, 0));\n            var rep = cc.repeatForever(cc.sequence(_act1, _act2));\n            this.hand.runAction(rep);\n        }\n    },\n\n    //显示引导\n    show: function () {\n        if (typeof wx === 'undefined') {\n            return;\n        }\n        this.setIsFromMyApp();\n\n        if(this.isFromMyApp){\n            return;\n        }\n        if (!this.hasInit) {\n            this.init();\n        }\n        if (this.guideNode.parent) {\n            this.guideNode.parent.removeChild(this.guideNode);\n        }\n        this.guideNode.active = true;\n        var vSysInfo = wx.getSystemInfoSync();\n        var pos = this.caculateHandNodePosition();\n        this.guideNode.position = cc.p(pos[1], pos[0]);\n        //Global.ui.node.addChild(that.guideNode);\n        cc.game.addPersistRootNode(this.guideNode);\n\n        this.showEffect();\n    },\n\n    //隐藏引导\n    hide: function () {\n        if (this.guideNode) {\n            this.guideNode.active = false;\n        }\n    },\n\n    caculateHandNodePosition: function () {\n        if (typeof wx === 'undefined') {\n            return;\n        }\n        var vSysInfo = wx.getSystemInfoSync();\n\n        let size = cc.director.getWinSize()\n        var isFitIphoneX = (vSysInfo.model && (vSysInfo.model.toLowerCase().replace(/\\s+/g, \"\").indexOf(\"iphonex\",0) != -1));\n        let dy = cc.winSize.width - (cc.winSize.width /vSysInfo.windowWidth) * 100 - 10;\n        let dx = size.height - (size.height /vSysInfo.windowHeight) * 25;\n        if (isFitIphoneX) {\n            dx = size.height - (size.height /vSysInfo.windowHeight) * 60;\n        } \n        return [dx,dy];\n    },\n\n}"]}
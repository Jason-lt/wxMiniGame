{"version":3,"sources":["myUtil.js"],"names":["ThirdAPI","require","myUtil","randomForArray","arr","length","Math","floor","random","randomForMinAndMax","min","max","clampValue","value","randomForWeight","weights","totalWeight","Global","gridRandomScores","i","weight","parseInt","j","push","id","getDayForYear","unixTime","currTime","Date","day","getDate","month","getMonth","year","getFullYear","sum","leap","getShortTimeString","second","h","s","secondBody","minuteBody","getSecondString","num","per","getFormatTime","hourBody","getPercentString","socre","perStr","getImgBase64","target","cc","find","width","height","renderTexture","RenderTexture","begin","_sgNode","visit","end","canvas","document","createElement","ctx","getContext","_renderType","game","RENDER_TYPE_CANVAS","texture","getSprite","getTexture","image","getHtmlElementObj","drawImage","RENDER_TYPE_WEBGL","buffer","gl","createFramebuffer","bindFramebuffer","FRAMEBUFFER","_glID","framebufferTexture2D","COLOR_ATTACHMENT0","TEXTURE_2D","data","Uint8Array","readPixels","RGBA","UNSIGNED_BYTE","rowBytes","row","srow","data2","Uint8ClampedArray","imageData","ImageData","putImageData","log","toDataURL","isIphoneX","wx","sysInfo","getSystemInfoSync","model","isFitIphoneX","toLowerCase","replace","indexOf","error","winSize","saveData","isDailyLimit","console","gridControllerScript","gridController","getComponent","allGrids","hasGridNum","list","vIndex","vNum","hIndex","hNum","grid","gridView","item","gridNum","saveGamePropgress","scoreScript","scoreNum","resetInitData","d","now","gameinfo","loadFriendGenStoneInfo","initData","shareTimes","shareTotalTimes","shareDate","toDateString","shareTime","shareTimesAndRewardVideoAd","dailyTime","dailyScore","battleTimes","dailyBattleTimes","showRewardVideoAdTimes","showRewardVideoAdDate","undefined","clearPropNum","getClearPropNum","superPropNum","getSuperPropNum","getTime","shareData1","arrOpenGId","shareData2","shareData3","inviteUserList","inviteDate","userList","saveFriendGenStoneInfo","module","exports"],"mappings":"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","file":"myUtil.js","sourceRoot":"../../../../../assets/Scripts/common","sourcesContent":["var ThirdAPI = require('ThirdAPI');\nvar myUtil = {\n    //随机输出数组中的一项\n    randomForArray: function (arr) {\n        if (!arr || arr.length == 0) {\n            return 0;\n        }\n\n        return arr[Math.floor(Math.random() * arr.length)];\n    },\n\n    //在某一范围内随机\n    randomForMinAndMax: function (min, max) {\n        return Math.floor(Math.random() * (max - min + 1)) + min;\n    },\n\n    //限制value值的大小\n    clampValue: function (value, min, max) {\n        if (value < min) {\n            return min;\n        } else if (value > max) {\n            return max;\n        } else {\n            return value;\n        }\n    },\n\n    //根据权重随机\n    randomForWeight: function (weights, totalWeight) {\n        Global.gridRandomScores = [];\n        for (var i in weights) {\n            var weight = parseInt((weights[i].weight / totalWeight) * 10000 / 100);\n            for (var j = 0; j < weight; j++) {\n                Global.gridRandomScores.push(weights[i].id);\n            }\n        }\n    },\n\n    //根据时间获取一年中的第几天\n    getDayForYear(unixTime) {\n        if (unixTime == 0) {\n            return 0;\n        }\n        var currTime = new Date(unixTime);\n        var day = currTime.getDate();\n        var month = currTime.getMonth() + 1;\n        var year = currTime.getFullYear();\n        var sum = 0;\n        var leap = 0;\n        switch (month) {　 /*先计算某月以前月份的总天数*/\n            case 1:\n                sum = 0;\n                break;　\n            case 2:\n                sum = 31;\n                break;　\n            case 3:\n                sum = 59;\n                break;　\n            case 4:\n                sum = 90;\n                break;　\n            case 5:\n                sum = 120;\n                break;　\n            case 6:\n                sum = 151;\n                break;　\n            case 7:\n                sum = 181;\n                break;　\n            case 8:\n                sum = 212;\n                break;　\n            case 9:\n                sum = 243;\n                break;　\n            case 10:\n                sum = 273;\n                break;　\n            case 11:\n                sum = 304;\n                break;　\n            case 12:\n                sum = 334;\n                break;　\n            default:\n                sum = 0;\n                break;\n        }\n        sum += day;\n        if (year % 400 == 0 || (year % 4 == 0 && year % 100 != 0)) { /*判断是不是闰年*/\n            leap = 1;　\n        } else　 {\n            leap = 0;\n        }　\n        if (leap == 1 && month > 2) /*如果是闰年且月份大于2,总天数应该加一天*/ {\n            sum++;\n        }\n        return sum;\n    },\n    //倒计时限时\n    getShortTimeString: function (second) {\n        var h = Math.floor(second / 3600);\n        var s = second % 60;\n        var min = Math.floor(second / 60) % 60;\n        var secondBody;\n        var minuteBody;\n        //秒\n        if (h == 0 && min == 0 && s == 0) {\n            secondBody = \"00\";\n        } else if (s < 10) {\n            secondBody = \"0\" + s;\n        } else {\n            secondBody = s;\n        }\n\n        //分\n        if (h == 0 && min == 0) {\n            minuteBody = \"00:\";\n        } else if (min < 10) {\n            minuteBody = \"0\" + min + \":\";\n        } else {\n            minuteBody = min + \":\";\n        }\n        return minuteBody + \"\" + secondBody;\n    },\n\n    getSecondString: function (num) {\n        var per = 60;\n\n        if (Math.floor(num / 3600) <= 0)\n            return Math.floor((num % 3600) / 60) + \":\" + (num % 3600) % 60;\n\n        return Math.floor(num / 3600) + \":\" + Math.floor((num % 3600) / 60) + \":\" + (num % 3600) % 60;\n    },\n\n    //格式化秒数：10:00\n    getFormatTime: function (second) {\n        var h = Math.floor(second / 3600);\n        var s = second % 60;\n        var min = Math.floor(second / 60) % 60;\n        var hourBody;\n        var minuteBody;\n        //秒\n        if (h == 0) {\n            hourBody = \"00\";\n        } else if (h < 10) {\n            hourBody = \"0\" + h + \":\";\n        } else {\n            hourBody = h + \":\";\n        }\n\n        //分\n        if (h == 0 && min == 0) {\n            minuteBody = \"00\";\n        } else if (min < 10) {\n            minuteBody = \"0\" + min;\n        } else {\n            minuteBody = min;\n        }\n        return hourBody + \"\" + minuteBody;\n    },\n\n    getPercentString: function (socre) {\n        var perStr = 0;\n        if (socre < 1) {\n            perStr = '0%';\n        } else if (socre >= 1 && socre < 1500) {\n            perStr = '1%';\n        } else if (socre >= 1501 && socre < 3000) {\n            perStr = '3%';\n        } else if (socre >= 3001 && socre < 30000) {\n            perStr = '8%';\n        } else if (socre >= 30001 && socre < 60000) {\n            perStr = '15%';\n        } else if (socre >= 60001 && socre < 90000) {\n            perStr = '30%';\n        } else if (socre >= 90001 && socre < 120000) {\n            perStr = '55%';\n        } else if (socre >= 120001 && socre < 150000) {\n            perStr = '65%';\n        } else if (socre >= 150001 && socre < 180000) {\n            perStr = '75%';\n        } else if (socre >= 180001 && socre < 210000) {\n            perStr = '85%';\n        } else if (socre >= 210001 && socre < 240000) {\n            perStr = '88%';\n        } else if (socre >= 240001 && socre < 270000) {\n            perStr = '90%';\n        } else if (socre >= 270001 && socre < 300000) {\n            perStr = '95%';\n        } else {\n            perStr = '99%';\n        }\n        return perStr;\n    },\n\n    // 截屏返回 iamge base6，用于 Share\n    getImgBase64: function () {\n        var target = cc.find('Canvas');\n        var width = parseInt(target.width),\n            height = parseInt(target.height);\n        var renderTexture = new cc.RenderTexture(width, height);\n        renderTexture.begin();\n        target._sgNode.visit();\n        renderTexture.end();\n        //\n        var canvas = document.createElement('canvas');\n        var ctx = canvas.getContext('2d');\n        canvas.width = width;\n        canvas.height = height;\n        if (cc._renderType === cc.game.RENDER_TYPE_CANVAS) {\n            var texture = renderTexture.getSprite().getTexture();\n            var image = texture.getHtmlElementObj();\n            ctx.drawImage(image, 0, 0);\n        } else if (cc._renderType === cc.game.RENDER_TYPE_WEBGL) {\n            var buffer = gl.createFramebuffer();\n            gl.bindFramebuffer(gl.FRAMEBUFFER, buffer);\n            var texture = renderTexture.getSprite().getTexture()._glID;\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n            var data = new Uint8Array(width * height * 4);\n            gl.readPixels(0, 0, width, height, gl.RGBA, gl.UNSIGNED_BYTE, data);\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n            var rowBytes = width * 4;\n            for (var row = 0; row < height; row++) {\n                var srow = height - 1 - row;\n                var data2 = new Uint8ClampedArray(data.buffer, srow * width * 4, rowBytes);\n                var imageData = new ImageData(data2, width, 1);\n                ctx.putImageData(imageData, 0, row);\n            }\n        }\n        cc.log('to share');\n        return canvas.toDataURL('image/png');\n    },\n\n    //iphoneX判断\n    isIphoneX: function () {\n        if (typeof wx !== 'undefined') {\n            try {\n                var sysInfo = wx.getSystemInfoSync();\n                if (sysInfo && sysInfo.model) {\n                    // 适配iphoneX\n                    var isFitIphoneX = (sysInfo.model.toLowerCase().replace(/\\s+/g, \"\").indexOf(\"iphonex\", 0) != -1);\n                    return isFitIphoneX;\n                }\n            } catch (error) {\n                return cc.winSize.width / cc.winSize.height < 0.50;\n            }\n        }\n        return cc.winSize.width / cc.winSize.height < 0.50;\n    },\n\n    //存档数据（保存游戏进度和分数到本地）\n    saveData: function () {\n        if (Global.isDailyLimit) return;\n        console.log('开始存档');\n\n        var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n        var allGrids = gridControllerScript.allGrids;\n\n        var hasGridNum = 0;\n        var list = [];\n        for (var vIndex = 0; vIndex < Global.vNum; vIndex++) {\n            for (var hIndex = 0; hIndex < Global.hNum; hIndex++) {\n                var grid = allGrids[hIndex][vIndex];\n                var gridView = grid.getComponent(\"gridView\");\n\n                if (gridView && gridView.item != null) {\n                    list.push(gridView.gridNum);\n                    hasGridNum++;\n                } else {\n                    list.push(-1);\n                }\n            }\n        }\n        if (hasGridNum <= 0) {\n            list = [];\n        }\n        var ThirdAPI = require('ThirdAPI');\n        ThirdAPI.saveGamePropgress({\n            'list': list,\n            'score': gridControllerScript.scoreScript.scoreNum\n        });\n\n        console.log('save data list:', list, gridControllerScript.scoreScript.scoreNum);\n    },\n\n\n    //重置初始化数据\n    resetInitData: function () {\n        var d = new Date(Date.now());\n        // 加载游戏缓存数据\n        var ThirdAPI = require('ThirdAPI');\n        Global.gameinfo = ThirdAPI.loadFriendGenStoneInfo();\n\n        //默认初始化数据\n        var initData = {\n            shareTimes: 0,\n            shareTotalTimes: 0,\n            shareDate: d.toDateString(),\n            shareTime: 0,\n            shareTimesAndRewardVideoAd: 0,\n\n            dailyTime: 0, //每日时间\n            dailyScore: 0, //每日分数\n            battleTimes: Global.dailyBattleTimes, //每日挑战次数\n\n            showRewardVideoAdTimes: 0, //看广告的次数\n            showRewardVideoAdDate: d.toDateString(),\n        };\n\n        // 没有数据初始化\n        if (!Global.gameinfo || Global.gameinfo == undefined) {\n            Global.gameinfo = initData;\n        }\n\n        //兼容dailyScore\n        if (Global.gameinfo || (Global.gameinfo && parseInt(Global.gameinfo.dailyTime) == 0)) {\n            if (!Global.gameinfo.dailyScore || Global.gameinfo.dailyScore == undefined) {\n                Global.gameinfo.dailyScore = 0;\n            }\n        }\n\n        //判断看广告是否在当天\n        if (Global.gameinfo.showRewardVideoAdDate != d.toDateString()) {\n            Global.gameinfo.showRewardVideoAdTimes = 0;\n            Global.gameinfo.showRewardVideoAdDate = d.toDateString();\n        }\n        \n        // //判断是否初始化道具数量\n        // if (!Global.gameinfo.hasInit) {\n        //     Global.gameinfo.hasInit = true;\n        //     Global.gameinfo.clearPropNum = 1;\n        //     Global.gameinfo.superPropNum = 1;\n        //     Global.gameinfo.doublePropNum = 0;\n        //     console.log('not hasInit ', Global.gameinfo);\n        // }\n        //存储本地数据\n        \n        Global.gameinfo.clearPropNum = ThirdAPI.getClearPropNum();\n        Global.gameinfo.superPropNum = ThirdAPI.getSuperPropNum();\n\n        //判断时间是否是当天\n        if (new Date(Global.gameinfo.dailyTime).getDate() !== (new Date().getDate())) {\n            console.log('时间不是当日日期，每日分数重置为0');\n            Global.gameinfo.dailyTime = (new Date()).getTime();\n            Global.gameinfo.dailyScore = 0;\n            Global.gameinfo.battleTimes = Global.dailyBattleTimes;\n            console.log('每日挑战的次数信息：', Global.gameinfo, Global.gameinfo.dailyTime);\n        }\n\n        //判断是否是当日(向朋友索取)\n        if (Global.gameinfo.shareDate != d.toDateString()) {\n            Global.gameinfo.shareTimesAndRewardVideoAd = 0;\n            Global.gameinfo.shareTimes = 0;\n            Global.gameinfo.shareTotalTimes = 0;\n            Global.gameinfo.shareTime = 0;\n            Global.gameinfo.shareDate = d.toDateString();\n        }\n\n        if (!Global.gameinfo.shareData1 || Global.gameinfo.shareData1.shareDate != d.toDateString()) {\n            Global.gameinfo.shareData1 = {\n                shareDate: d.toDateString(),\n                arrOpenGId: [],\n            };\n        }\n        //复活界面的分享成功 记录群ID\n        if (!Global.gameinfo.shareData2 || Global.gameinfo.shareData2.shareDate != d.toDateString()) {\n            Global.gameinfo.shareData2 = {\n                shareDate: d.toDateString(),\n                arrOpenGId: [],\n            };\n        }\n\n        //开始界面的加号分享得星星和每日挑战没有次数分享 成功记录群ID\n        if (!Global.gameinfo.shareData3 || Global.gameinfo.shareData3.shareDate != d.toDateString()) {\n            Global.gameinfo.shareData3 = {\n                shareDate: d.toDateString(),\n                arrOpenGId: [],\n            };\n        }\n        //群里小卡片的邀请用户信息\n        if (!Global.gameinfo.inviteUserList || Global.gameinfo.inviteUserList.inviteDate != d.toDateString()) {\n            Global.gameinfo.inviteUserList = {\n                inviteDate: d.toDateString(),\n                userList: [],\n            };\n        }\n        ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n    },\n\n};\nmodule.exports = myUtil;"]}
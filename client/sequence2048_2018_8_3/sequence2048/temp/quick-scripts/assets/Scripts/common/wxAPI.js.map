{"version":3,"sources":["wxAPI.js"],"names":["WXGlobal","initOnEnter","options","getLaunchOptionsSync","console","log","shareTicket","scene","query","isSticky","queryString","setShareTicketEnabled","showShareMenu","registShare","registOnShow","registOnError","userInfo","nickName","maxscore","gold","iv","signature","gender","avatarUrl","sysInfo","wx","getSystemInfoSync","SDKVersion","replace","slice","GameClubButton","createGameClubButton","icon","style","left","top","width","height","showGameClub","value","hide","onError","res","wxGame","LOGE","message","stack","getAuth","callback","getUserInfo","success","setUserCloudStorage","KVDataList","key","fail","errMsg","indexOf","complete","self","myUtil","require","onShareAppMessage","imageurl","Global","cdnShareImages","length","randomForArray","image","shareImages","text","cdnTexts","shareTexts","setQueryInfo","title","imageUrl","getHelpInfo","helpInfo","onShow","LOGD","shareGame","imageTag","failcallback","sourcecode","getShareScreenShot","getShareScreenShotForDown","propShareImages","img","propShareTexts","shareAppMessage","shareTickets","shareTicketEnabled","getShareInfo","result","encryptedData","tywx","UserInfo","wxgame_session_key","resultString","decrypt","JSON","parse","openid","openGId","error","crypted","crypto","Buffer","decipher","createDecipheriv","decoded","update","final","login","setMaxScore","isEnabled","updateShareMenu","withShareTicket","obj","getShareUserInfo","hideShareMenu","params","canvas","toTempFilePathSync","x","y","destWidth","destHeight","getScreenShot","initFriendRank","openDataContext","getOpenDataContext","msg","type","postMessage","getNextFriendRank","score","rect","getFriendRank","GlobalFuncs","getOpenData","week","getCurWeek","method","userId","rankType","getGroupRank","val","getDailyRank","getMyInfo","SystemInfo","gameId","saveScore","gameinfo","resetInitData","dailyScore","dailyTime","loadScore","shakeShort","vibrateShort","shakeLong","vibrateLong","exit","exitMiniProgram","getSystemInfo","module","exports"],"mappings":"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","file":"wxAPI.js","sourceRoot":"../../../../../assets/Scripts/common","sourcesContent":["var WXGlobal = {\n    initOnEnter: function () {\n        var options = this.getLaunchOptionsSync();\n        console.log('launch options', options);\n        this.shareTicket = options.shareTicket;\n        this.scene = options.scene;\n        this.query = options.query;\n        this.isSticky = options.isSticky;\n        this.queryString = '';\n\n        this.setShareTicketEnabled(true);\n        this.showShareMenu();\n        // this.getAuth();\n        this.registShare();\n        this.registOnShow();\n        this.registOnError();\n\n        this.userInfo = {\n            nickName: '不愿透露姓名的老王',\n            maxscore: 0,\n            gold: 0,\n            iv: '',\n            signature: '',\n            gender: 1,\n            avatarUrl: 'res/raw-assets/resources/textures/gridItem/rank_1.png'\n        };\n\n        var sysInfo = wx.getSystemInfoSync();\n        console.log('sysinfo: ', sysInfo, sysInfo.SDKVersion.replace(/\\./g, \"\"));\n        if (sysInfo.SDKVersion.slice(0, 5).replace(/\\./g, \"\") >= 203) {\n            this.GameClubButton = wx.createGameClubButton({\n                icon: 'green',\n                style: {\n                    left: 10,\n                    top: 30,\n                    width: 40,\n                    height: 40\n                }\n            })\n        }\n\n        /*\n         var sysInfo = wx.getSystemInfoSync();\n         console.log('sysinfo: ', sysInfo, sysInfo.SDKVersion.replace(/\\./g, \"\"));\n         if (sysInfo.SDKVersion.slice(0, 5).replace(/\\./g, \"\") >= 203) {\n         this.GameClubButton = wx.createGameClubButton({\n         icon: 'green',\n         style: {\n         left: 20,\n         top: 20,\n         width: 40,\n         height: 40\n         }\n         })\n         }*/\n\n        //this.showGameClub();\n    },\n\n    showGameClub: function (value) {\n        if (!this.GameClubButton) return;\n\n        // if (value) {\n        //     console.log('显示游戏圈按钮');\n        //     this.GameClubButton.show()\n        // } else {\n        //     console.log('隐藏游戏圈按钮');\n        //     this.GameClubButton.hide()\n        // }\n\n        this.GameClubButton.hide()\n    },\n\n    registOnError: function () {\n        wx.onError(function(res) {\n            wxGame.LOGE('wx error:' + res.message + '\\nstack:\\n' + res.stack);\n        })\n    },\n\n    getAuth: function (callback) {\n        wx.getUserInfo({\n            success: function (res) {\n                // iOS 和 Android 对于拒绝授权的回调 errMsg 没有统一，需要做一下兼容处理\n                console.log(res);\n                WXGlobal.userInfo = res.userInfo\n                WXGlobal.setUserCloudStorage({\n                    KVDataList: [{\n                        key: 'name',\n                        value: res.userInfo.nickName\n                    },\n                        {\n                            key: 'gender',\n                            value: res.userInfo.gender + ''\n                        },\n                        {\n                            key: 'avatarUrl',\n                            value: res.userInfo.avatarUrl\n                        },\n                        {\n                            key: 'iv',\n                            value: res.iv\n                        },\n                        {\n                            key: 'signature',\n                            value: res.signature\n                        },\n                    ],\n                    success: function () {\n                        console.log('set User Cloud Storage success');\n                    }\n                })\n            },\n            fail: function (res) {\n                // iOS 和 Android 对于拒绝授权的回调 errMsg 没有统一，需要做一下兼容处理\n                if (res.errMsg.indexOf('auth deny') > -1 || res.errMsg.indexOf('auth denied') > -1) {\n                    // 处理用户拒绝授权的情况\n                    console.log(res);\n                    WXGlobal.userInfo = {\n                        nickName: '不愿透露姓名的老王',\n                        maxscore: 0,\n                        gold: 0,\n                        iv: '',\n                        signature: '',\n                        gender: 1,\n                        avatarUrl: 'res/raw-assets/resources/textures/gridItem/rank_1.png'\n                    }\n                    console.log('set UserInfo default');\n                }\n            },\n            complete: function () {\n                if (callback) {\n                    callback();\n                }\n            }\n        })\n    },\n\n    registShare: function () {\n        var self = this;\n        var myUtil = require(\"myUtil\");\n        this.onShareAppMessage(function() {\n            var imageurl;\n            if (Global.cdnShareImages && Global.cdnShareImages.length > 0) {\n                imageurl = myUtil.randomForArray(Global.cdnShareImages);\n                console.log('从cdn请求分享图：', imageurl);\n            } else {\n                var image = myUtil.randomForArray(Global.shareImages);\n                imageurl = 'res/raw-assets/resources/textures/gridItem/' + image;\n                console.log('从本地请求分享图：', imageurl);\n            }\n\n            //分享文字\n            var text;\n            if (Global.cdnTexts && Global.cdnTexts.length > 0) {\n                text = myUtil.randomForArray(Global.cdnTexts);\n                console.log('从cdn请求分享文字：', text);\n            } else {\n                text = myUtil.randomForArray(Global.shareTexts);\n                console.log('从本地读取分享文字：', text);\n            }\n\n            // var img = myUtil.randomForArray(Global.shareImages);\n            // imageurl = 'res/raw-assets/resources/textures/gridItem/' + img;\n            this.setQueryInfo('001', imageurl);\n\n            console.log('用户点击了右上按钮并分享,query:', WXGlobal.queryString);\n            return {\n                title: text,\n                imageUrl: imageurl,\n                query: WXGlobal.queryString\n            }\n\n        })\n    },\n\n    getHelpInfo: function () {\n        return WXGlobal.helpInfo;\n    },\n\n    registOnShow: function () {\n        wx.onShow(function(res) {\n            wxGame.LOGD('wx onShow+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++', res);\n        if (res.shareTicket) {\n            WXGlobal.shareTicket = res.shareTicket;\n        }\n\n        Global.helpInfo = null;\n        if (res.query) {\n            WXGlobal.helpInfo = res.query;\n            Global.helpInfo = WXGlobal.helpInfo;\n            console.log('registOnShow----', Global.helpInfo);\n        }\n    });\n    },\n\n    //分享  001点击转发   002点击群排行    003分享界面点击分享  004 复活界面\n    shareGame: function (imageTag, callback, failcallback, sourcecode) {\n        var myUtil = require(\"myUtil\");\n        var imageurl;\n        if (imageTag == \"screenshot\") {\n            imageurl = WXGlobal.getShareScreenShot();\n            this.setQueryInfo(sourcecode, 'screenshot');\n        } else if (imageTag == \"screenshotForDown\") {\n            imageurl = WXGlobal.getShareScreenShotForDown();\n            this.setQueryInfo(sourcecode, 'screenshot');\n        } else if ((imageTag == \"01\" || imageTag == \"02\" || imageTag == \"03\") && Global.propShareImages) {\n            console.log('imageTag:', Global.propShareImages, imageTag);\n            imageurl = Global.propShareImages[imageTag];\n            this.setQueryInfo(sourcecode, imageurl);\n        } else {\n            if (Global.cdnShareImages && Global.cdnShareImages.length > 0) {\n                imageurl = myUtil.randomForArray(Global.cdnShareImages);\n                console.log('从cdn请求分享图：', imageurl);\n            } else {\n                var img = myUtil.randomForArray(Global.shareImages);\n                imageurl = 'res/raw-assets/resources/textures/gridItem/' + img;\n                console.log('从本地请求分享图：', imageurl);\n            }\n            this.setQueryInfo(sourcecode, imageurl);\n        }\n\n        //分享文字\n        var text;\n        if (imageTag == \"01\" || imageTag == \"02\" || imageTag == \"03\") {\n            text = Global.propShareTexts[imageTag];\n            console.log('道具分享文字', text);\n        } else if (Global.cdnTexts && Global.cdnTexts.length > 0) {\n            text = myUtil.randomForArray(Global.cdnTexts);\n            console.log('从cdn请求分享文字：', text);\n        } else {\n            text = myUtil.randomForArray(Global.shareTexts);\n            console.log('从本地读取分享文字：', text);\n        }\n        console.log('用户点击分享,query:', WXGlobal.queryString);\n\n        /*\n         tywx.PropagateInterface.getShareConfigInfo();\n         console.log('all ConfigInfo:' + tywx.PropagateInterface.ShareConfig);\n         var config = tywx.PropagateInterface.getShareConfigInfo({\n         share_type: sourcecode + \"\"\n         });\n         console.log('config1:' + config);\n         if (!config) {\n         config = tywx.ShareInterface.getRandomOnShareAppMessageInfo();\n         }\n         tywx.ShareInterface.setOnShareAppMessageInfo(config.title, config.imageUrl, config.sharePointId, config.shareSchemeId);\n         console.log('config:', config);\n\n         tywx.ShareInterface.share(\n         config.title,\n         config.imageUrl,\n         config.sharePointId,\n         config.shareSchemeId,\n         (res) => {\n         console.log('wx分享成功', res);\n         if (res.shareTickets) {\n         WXGlobal.shareTicketEnabled = true;\n         WXGlobal.shareTicket = res.shareTickets[0];\n\n         wx.getShareInfo({\n         shareTicket: res.shareTickets[0],\n         success: function (result) {\n         console.log('获取分享信息成功', result);\n         if (result) {\n         //判断秘钥是否有用\n         var iv = result.iv;\n         var encryptedData = result.encryptedData;\n         console.log('解析分享信息', tywx.UserInfo.wxgame_session_key, iv, encryptedData);\n         var resultString = WXGlobal.decrypt(tywx.UserInfo.wxgame_session_key, iv, encryptedData);\n         console.log(resultString);\n         if (resultString) {\n         resultString = JSON.parse(resultString);\n         var openid = '';\n         // 分享\n         if (resultString.openGId) {\n         openid = resultString.openGId;\n         }\n         console.log('分享群ID:', openid);\n         if (callback != null) {\n         callback(openid, WXGlobal.shareTicket);\n         }\n         } else {\n         if (failcallback) {\n         failcallback();\n         }\n         }\n         }\n         },\n         fail: () => {\n         console.log('获取分享信息失败');\n         if (failcallback) {\n         failcallback();\n         }\n         },\n         complete: () => {\n\n         },\n         })\n         } else {\n         console.log('wx分享到群失败', failcallback);\n         if (failcallback) {\n         failcallback();\n         }\n         }\n         },\n         () => {\n         console.log('wx分享失败', failcallback);\n         if (failcallback) {\n         failcallback();\n         }\n         }\n         );*/\n\n        WXGlobal.shareAppMessage({\n                title: text,\n                imageUrl: imageurl,\n                query: WXGlobal.queryString,\n                success: function(res) {\n                console.log('wx分享成功', res);\n        if (res.shareTickets) {\n            WXGlobal.shareTicketEnabled = true;\n            WXGlobal.shareTicket = res.shareTickets[0];\n\n            wx.getShareInfo({\n                    shareTicket: res.shareTickets[0],\n                    success: function (result) {\n                        console.log('获取分享信息成功', result);\n                        if (result) {\n                            //判断秘钥是否有用\n                            var iv = result.iv;\n                            var encryptedData = result.encryptedData;\n                            console.log('解析分享信息', tywx.UserInfo.wxgame_session_key, iv, encryptedData);\n                            try {\n                                var resultString = WXGlobal.decrypt(tywx.UserInfo.wxgame_session_key, iv, encryptedData);\n                                console.log(resultString);\n                                if (resultString) {\n                                    resultString = JSON.parse(resultString);\n                                    var openid = '';\n                                    // 分享\n                                    if (resultString.openGId) {\n                                        openid = resultString.openGId;\n                                    }\n                                    console.log('分享群ID:', openid);\n                                    if (callback != null) {\n                                        callback(openid, WXGlobal.shareTicket);\n                                    }\n                                } else {\n                                    if (failcallback) {\n                                        failcallback();\n                                    }\n                                }\n                            } catch (error) {\n                                if (callback != null) {\n                                    callback(res.shareTickets[0], WXGlobal.shareTicket);\n                                }\n                            }\n                        }\n                    },\n                    fail: function() {\n                    console.log('获取分享信息失败');\n            if (failcallback) {\n                failcallback();\n            }\n        },\n            complete:function(){\n\n            },\n        })\n        } else {\n            console.log('wx分享到群失败', failcallback);\n            if (failcallback) {\n                failcallback(\"fail\");\n            }\n        }\n    },\n        fail:function() {\n            console.log('wx分享失败', failcallback);\n            if (failcallback) {\n                failcallback(\"cancel\");\n            }\n        }\n    });\n    },\n\n    decrypt: function (key, iv, crypted) {\n        var crypto = require('crypto');\n\n        crypted = new Buffer(crypted, 'base64');\n        iv = new Buffer(iv, 'base64');\n        key = new Buffer(key, 'base64');\n        var decipher = crypto.createDecipheriv('aes-128-cbc', key, iv);\n        var decoded = decipher.update(crypted, 'binary', 'utf8');\n        decoded += decipher.final('utf8');\n        return decoded;\n    },\n\n    login: function (callback) {\n        wx.login(callback);\n    },\n\n    setMaxScore: function (maxscore, gold) {\n\n        WXGlobal.queryString =\n            'nickName=' + WXGlobal.userInfo.nickName + '&' +\n            'maxscore=' + maxscore + '&' +\n            'gold=' + gold + '&' +\n            'gender=' + WXGlobal.userInfo.gender + '&' +\n            'avatarUrl=' + WXGlobal.userInfo.avatarUrl;\n\n        console.log('wx setMaxScore, query:', WXGlobal.queryString);\n    },\n\n    // 返回小程序启动参数\n    getLaunchOptionsSync: function () {\n        return wx.getLaunchOptionsSync()\n    },\n\n    setShareTicketEnabled: function (isEnabled) {\n        wx.updateShareMenu({\n            withShareTicket: isEnabled,\n            success: function() {\n            WXGlobal.shareTicketEnabled = isEnabled;\n    }\n    })\n    },\n\n    getShareInfo: function (obj) {\n        return wx.getShareInfo(obj)\n    },\n\n    getShareUserInfo: function () {\n        return this.query\n    },\n\n    showShareMenu: function () {\n        console.log('显示右上菜单的转发按钮');\n        wx.showShareMenu();\n    },\n    hideShareMenu: function () {\n        console.log('隐藏右上菜单的转发按钮');\n        wx.hideShareMenu();\n    },\n    onShareAppMessage: function (callback) {\n        console.log('注册点击转发按钮事件');\n        // wx.onShareAppMessage(callback);\n    },\n    shareAppMessage: function (params) {\n        console.log('转发:', params);\n        wx.shareAppMessage(params);\n    },\n\n    getShareScreenShot: function () {\n        return canvas.toTempFilePathSync({\n            x: 0,\n            y: 0.5 * canvas.height - 0.8 * 0.8 * canvas.width,\n            width: canvas.width,\n            height: 0.8 * canvas.width,\n            destWidth: 500,\n            destHeight: 400,\n        })\n    },\n\n    getShareScreenShotForDown: function () {\n        return canvas.toTempFilePathSync({\n            x: 0,\n            y: 0.5 * canvas.height + 0 * canvas.width,\n            width: canvas.width,\n            height: 0.8 * canvas.width,\n            destWidth: 500,\n            destHeight: 400,\n        })\n    },\n\n    getScreenShot: function () {\n        return canvas.toTempFilePathSync({})\n    },\n\n\n    initFriendRank: function () {\n        try {\n            var openDataContext = wx.getOpenDataContext();\n            var msg = {\n                type: 'initFriendRank',\n            }\n            if (WXGlobal.shareTicketEnabled) {\n                msg.shareTicket = WXGlobal.shareTicket;\n            }\n            console.log(msg);\n\n            openDataContext.postMessage(msg);\n        } catch (error) {\n\n        }\n    },\n\n    getNextFriendRank: function (params) {\n        try {\n            var openDataContext = wx.getOpenDataContext();\n            var msg = {\n                type: 'getNextFriend',\n                score: params.score,\n                width: params.rect.width,\n                height: params.rect.height,\n            }\n            if (WXGlobal.shareTicketEnabled) {\n                msg.shareTicket = WXGlobal.shareTicket;\n            }\n            //console.log(msg);\n\n            openDataContext.postMessage(msg);\n            if (params.callback) {\n                params.callback('wx');\n            }\n        } catch (error) {\n\n        }\n    },\n\n\n\n    // 展示自己的好友排行榜数\n    getFriendRank: function (params) {\n        try {\n            var openDataContext = wxGame.GlobalFuncs.getOpenData();\n            if(!openDataContext){\n                return;\n            }\n            var week = wxGame.GlobalFuncs.getCurWeek();\n            openDataContext.postMessage({\n                method:'showFriendRank',\n                userId:tywx.UserInfo.userId,\n                rankType : \"sumScore\",\n                week : week\n            });\n            if (params.callback) {\n                params.callback('wx');\n            }\n        } catch (error) {\n\n        }\n    },\n\n    getGroupRank: function (val) {\n        //分享给群\n        try {\n            var openDataContext = wxGame.GlobalFuncs.getOpenData();\n            if(!openDataContext){\n                return;\n            }\n            var week = wxGame.GlobalFuncs.getCurWeek();\n            openDataContext.postMessage({\n                method:'showGroupRank',\n                shareTicket: val,\n                userId:tywx.UserInfo.userId,\n                rankType : \"sumScore\",\n                week : week\n            })\n        } catch (error) {\n\n        }\n    },\n\n    //每日挑战排行榜\n    getDailyRank: function (params) {\n        try {\n            var openDataContext = wx.getOpenDataContext()\n            var msg = {\n                type: 'getDailyRank',\n                width: params.rect.width,\n                height: params.rect.height,\n            }\n            if (WXGlobal.shareTicketEnabled) {\n                msg.shareTicket = WXGlobal.shareTicket;\n            }\n            console.log(msg);\n\n            openDataContext.postMessage(msg);\n            if (params.callback) {\n                params.callback('wx');\n            }\n        } catch (error) {}\n    },\n\n\n    //好友互助奖励信息\n    getMyInfo: function (params) {\n        try {\n            var openDataContext = wx.getOpenDataContext()\n            var msg = {\n                type: 'getMyInfo',\n                width: params.rect.width,\n                height: params.rect.height,\n            }\n            if (WXGlobal.shareTicketEnabled) {\n                msg.shareTicket = WXGlobal.shareTicket;\n            }\n            console.log('getMyInfo:', msg);\n\n            openDataContext.postMessage(msg);\n            if (params.callback) {\n                params.callback('wx');\n            }\n        } catch (error) {}\n    },\n\n    setQueryInfo: function (sourcecode, imageUrl) {\n        WXGlobal.queryString =\n            'nickName=' + WXGlobal.userInfo.nickName + '&' +\n            'inviteCode=' + tywx.UserInfo.userId + '&' +\n            'sourceCode=' + tywx.SystemInfo.gameId * 10000 + sourcecode + '&' +\n            'imageType=' + imageUrl;\n        console.log(WXGlobal.queryString);\n    },\n\n    /*\n     params:\n     {\n     KVDataList: [\n     { key: 'maxscore', value: score + '' },\n     { key: 'name', value: res.userInfo.nickName },\n     ],\n     success: function () {},\n     failed: function () {},\n     comlete: function () {},\n     }\n     kvdata的key和value必须为string\n     */\n    setUserCloudStorage: function (params) {\n        console.log('setUserCloudStorage:', params);\n        try {\n            wx.setUserCloudStorage(params);\n        } catch (error) {\n\n        }\n    },\n\n    /*\n     params:\n     {\n     maxscore: int,\n     crystal: int,\n     callback: function () {},\n     }\n     */\n    saveScore: function (maxscore, gold, callback) {\n        if (typeof wx === 'undefined') return;\n        //兼容dailyScore\n        if (!Global.gameinfo) {\n            var myUtil = require('myUtil');\n            myUtil.resetInitData();\n        }\n        if (Global.gameinfo && !Global.gameinfo.dailyScore) {\n            Global.gameinfo.dailyScore = 0;\n        }\n\n        var obj = {\n            KVDataList: [{\n                key: 'maxscore',\n                value: maxscore + ''\n            },\n                {\n                    key: 'gold',\n                    value: gold + ''\n                },\n                {\n                    key: 'dailyTime',\n                    value: Global.gameinfo.dailyTime + ''\n                },\n                {\n                    key: 'dailyScore',\n                    value: Global.gameinfo.dailyScore + ''\n                },\n            ],\n            success: callback\n        }\n        console.log('wx saveScore:', obj);\n        this.setUserCloudStorage(obj);\n        this.setMaxScore(maxscore, gold);\n    },\n    loadScore: function (params) {\n        // 微信无法在主域获取用户托管数据\n        // if (typeof wx !== 'undefined') {\n        //     console.log('wx loadScore:', params);\n        //     this.getUserCloudStorage(params);\n        // }\n    },\n    /*\n     参数格式:\n     {\n     success: function () {},\n     failed: function () {},\n     comlete: function () {},\n     }\n     */\n    shakeShort: function (params) {\n        wx.vibrateShort(params);\n    },\n\n    /*\n     参数格式:\n     {\n     success: function () {},\n     failed: function () {},\n     comlete: function () {},\n     }\n     */\n    shakeLong: function (params) {\n        wx.vibrateLong(params);\n    },\n    exit: function () {\n        wx.exitMiniProgram({\n            success: function(res) {\n            wxGame.LOGD('exit game:', res)\n            }\n        })\n    },\n\n    getSystemInfo: function () {\n        return wx.getSystemInfoSync()\n    },\n\n};\n\nmodule.exports = WXGlobal;"]}
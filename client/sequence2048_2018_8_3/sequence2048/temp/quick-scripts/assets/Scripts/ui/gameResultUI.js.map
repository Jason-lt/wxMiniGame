{"version":3,"sources":["gameResultUI.js"],"names":["cc","Class","extends","Component","properties","homeBtn","Node","historyScore","Label","rankTexture","Texture2D","rankSpriteFrame","SpriteFrame","rankSprite","Sprite","onLoad","string","wxGame","Global","gameInfo","score","NotificationCenter","listen","EventType","UPDATE_RESULT_RANK","setRankInfo","STOP_UPDATE_RANK_TEXTURE","stopUpdateRankTexture","updateUserInfo","tywx","BiLog","clickStat","biManager","enterGameResult","max_score","GlobalFuncs","upDateRankData","openDataContext","getOpenData","sharedCanvas","canvas","width","height","Timer","cancelTimer","updateRankTexture","setTimer","getThirdRankInfo","texture","spriteFrame","sprite","initWithElement","handleLoadedTexture","_refreshTexture","onClickHomeBtn","goToBeginScene","onClickChallengeBtn","shareManager","sharePoint","onClickRankBtn","friendRank","showRankUI","onClickAgainBtn","resultClcikRestart","playGame","onClose","node","destroy","gameResult","onDestroy","ignoreScope"],"mappings":"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","file":"gameResultUI.js","sourceRoot":"../../../../../assets/Scripts/ui","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        homeBtn:cc.Node,\n        historyScore:cc.Label,\n        rankTexture : cc.Texture2D,\n        rankSpriteFrame : cc.SpriteFrame,\n        rankSprite : cc.Sprite,\n\n    },\n\n    onLoad:function(){\n        this.historyScore.string = wxGame.Global.gameInfo.score;\n        wxGame.NotificationCenter.listen(wxGame.EventType.UPDATE_RESULT_RANK,this.setRankInfo,this);\n        wxGame.NotificationCenter.listen(wxGame.EventType.STOP_UPDATE_RANK_TEXTURE,this.stopUpdateRankTexture,this);\n\n        this.updateUserInfo();\n        this.setRankInfo();\n\n        tywx.BiLog.clickStat(wxGame.biManager.enterGameResult, [\"gameResult\"]);\n    },\n\n    updateUserInfo:function(){\n        if(wxGame.Global.gameInfo.max_score != null){\n            wxGame.GlobalFuncs.upDateRankData(wxGame.Global.gameInfo.max_score);\n        }\n    },\n\n    setRankInfo:function(){\n        var openDataContext = wxGame.GlobalFuncs.getOpenData();\n        if(!openDataContext){\n            return;\n        }\n        this.sharedCanvas = openDataContext.canvas;\n        this.sharedCanvas.width = 400;\n        this.sharedCanvas.height = 180;\n        this.rankTexture = new cc.Texture2D();\n        this.rankSpriteFrame = new cc.SpriteFrame(this.rankTexture);\n\n\n        tywx.Timer.cancelTimer(this,this.updateRankTexture);\n        tywx.Timer.setTimer(this, this.updateRankTexture, 1/10, 1000);\n        // tywx.Timer.setTimer(this, main, 1/10, 1000);\n\n        wxGame.GlobalFuncs.getThirdRankInfo();\n    },\n\n    updateRankTexture:function(){\n        var texture = this.rankTexture;\n        var spriteFrame = this.rankSpriteFrame;\n        var sprite = this.rankSprite;\n        texture.initWithElement(this.sharedCanvas);\n        texture.handleLoadedTexture();\n        sprite.spriteFrame = spriteFrame;\n        sprite.spriteFrame._refreshTexture(texture);\n    },\n\n    //停止刷新当前排行\n    stopUpdateRankTexture:function(){\n        tywx.Timer.cancelTimer(this,this.updateRankTexture);\n    },\n\n    onClickHomeBtn:function(){\n        wxGame.GlobalFuncs.goToBeginScene();\n    },\n\n    onClickChallengeBtn:function(){\n        wxGame.shareManager.sharePoint(\"576\");\n    },\n\n    onClickRankBtn:function(){\n        tywx.BiLog.clickStat(wxGame.biManager.friendRank, [\"gameResultFriendRank\"]);\n        wxGame.GlobalFuncs.showRankUI(\"\");\n    },\n\n    onClickAgainBtn:function(){\n        tywx.BiLog.clickStat(wxGame.biManager.resultClcikRestart, [\"gameResultPlayGame\"]);\n        wxGame.GlobalFuncs.playGame();\n        this.onClose();\n    },\n\n    onClose:function(){\n        this.node.destroy();\n        wxGame.gameResult = null;\n    },\n\n    onDestroy:function () {\n        this.sharedCanvas = null;\n        tywx.Timer.cancelTimer(this,this.updateRankTexture);\n        wxGame.NotificationCenter.ignoreScope(this);\n    }\n});\n"]}
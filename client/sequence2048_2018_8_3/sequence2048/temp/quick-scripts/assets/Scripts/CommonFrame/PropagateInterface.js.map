{"version":3,"sources":["PropagateInterface.js"],"names":["tywx","PropagateInterface","ShareConfig","getShareConfigInfo","reqObj","timeStamp","Date","getTime","act","time","game_mark","SystemInfo","cloudId","gameId","signStr","getConfigSignStr","paramStrList","key","push","finalUrl","shareManagerUrl","join","successcb","ret","retmsg","NotificationCenter","trigger","EventType","GET_SHARE_CONFIG_SUCCESS","failcb","GET_SHARE_CONFIG_FAIL","HttpUtil","httpGet","getUserFeatureInfo","cloud_id","game_id","user_id","UserInfo","userId","GET_USER_FEATURE_SUCCESS","GET_USER_FEATURE_FAIL","sortedKeys","Object","keys","sort","i","length","finalSign","hex_md5"],"mappings":"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","file":"PropagateInterface.js","sourceRoot":"../../../../../assets/Scripts/CommonFrame","sourcesContent":["/**\n * Created by xiaochuntian on 2018/5/25.\n * 营销传播智能管理系统对应数据获取接口\n */\n\n\ntywx.PropagateInterface = {\n    ShareConfig: {},\n    /**\n     * 通过http获取分享相关信息\n     * http://market.touch4.me/?act=api.getShareConfig&time=1421755384&game_mark=richddz&sign=a30ab1292aa5929e7f913ceed795f78c\n     test demo\n     var param = {\n                 share_type:\"hyyq2\",      //获取分享点相关参数,可不传,传则代表获取单个分享点,不传表示获取all\n                 config_id:\"002003003\"    //获取方案对应数据,不论该方案是否已发布,内部测试接口参数,代码发布上线时请删除\n             };\n     tywx.PropagateInterface.getShareConfigInfo(param);\n     */\n    getShareConfigInfo: function(reqObj) {\n        if(typeof(reqObj) != 'object') {\n            reqObj = {};\n        }\n\n        var timeStamp = new Date().getTime();\n        reqObj.act = 'api.getShareConfig';\n        reqObj.time = timeStamp;\n        reqObj.game_mark = tywx.SystemInfo.cloudId + \"-\" + tywx.SystemInfo.gameId;\n\n        var signStr = this.getConfigSignStr(reqObj);\n        var paramStrList = [];\n        for(var key in reqObj) {\n            paramStrList.push(key + '=' + reqObj[key]);\n        }\n        paramStrList.push('sign=' + signStr);\n        var finalUrl = tywx.SystemInfo.shareManagerUrl + '?' + paramStrList.join('&');\n        var successcb = function(ret) {\n            for(var key in ret.retmsg) {\n                tywx.PropagateInterface.ShareConfig[key] = ret.retmsg[key];\n            }\n            tywx.NotificationCenter.trigger(tywx.EventType.GET_SHARE_CONFIG_SUCCESS, ret);\n        };\n\n        var failcb = function(ret) {\n            tywx.NotificationCenter.trigger(tywx.EventType.GET_SHARE_CONFIG_FAIL, ret);\n        };\n        tywx.HttpUtil.httpGet({'url':finalUrl}, successcb, failcb);\n    },\n\n\n    /**\n     * 获取用户特征值接口\n     * http://market.touch4.me/?act=api.getUserFeature&cloud_id=24&game_id=6&time=1527235026&user_id=1404248&sign=a2b6938904ac3759fe6404ea8ed49267\n     * @param reqObj\n     */\n    getUserFeatureInfo: function() {\n        var reqObj = {};\n        var timeStamp = new Date().getTime();\n        reqObj.act = 'api.getUserFeature';\n        reqObj.cloud_id = tywx.SystemInfo.cloudId;\n        reqObj.game_id = tywx.SystemInfo.gameId;\n        reqObj.user_id = tywx.UserInfo.userId;\n        reqObj.time = timeStamp;\n\n        var signStr = this.getConfigSignStr(reqObj);\n        var paramStrList = [];\n        for(var key in reqObj) {\n            paramStrList.push(key + '=' + reqObj[key]);\n        }\n        paramStrList.push('sign=' + signStr);\n        // var finalUrl = tywx.SystemInfo.shareManagerUrl + '?' + paramStrList.join('&');\n        var finalUrl = 'https://analy.ywdier.com/' + '?' + paramStrList.join('&');\n        var successcb = function(ret) {\n            tywx.NotificationCenter.trigger(tywx.EventType.GET_USER_FEATURE_SUCCESS, ret);\n        };\n\n        var failcb = function(ret) {\n            tywx.NotificationCenter.trigger(tywx.EventType.GET_USER_FEATURE_FAIL, ret);\n        };\n        tywx.HttpUtil.httpGet({'url':finalUrl}, successcb, failcb);\n    },\n\n    /**\n     * 计算签名字符串\n     * @param reqObj\n     * @returns {string}\n     */\n    getConfigSignStr: function(reqObj) {\n        var sortedKeys = Object.keys(reqObj).sort();\n        var signStr = '';\n        for(var i=0;i<sortedKeys.length;i++){\n            var key = sortedKeys[i];\n            if(key == 'act' || key == 'sign') {\n                continue;\n            } else {\n                signStr += key + '=' + reqObj[key];\n            }\n        }\n        var finalSign = tywx.hex_md5('market.tuyoo.com-api-' + signStr + '-market.tuyoo-api') || '';\n        return finalSign;\n    },\n};"]}
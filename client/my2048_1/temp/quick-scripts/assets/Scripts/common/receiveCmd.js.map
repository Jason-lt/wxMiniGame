{"version":3,"sources":["receiveCmd.js"],"names":["tcpManager","receiveCmd","process","params","result","action","cmdType","normalLogin","ok","parseInt","console","log","clickLinkLogin","sendCmd","sendLoginData","Global","game","showDialogPropText","tcpData","formatData","data","sendGetClickUserList","isClick","wx","msg","rewardConfig","inviteNum","addStone","fetchDailyReward","rewardUI","refreshDailyInfo","getClickUserList","clickItems","fetchClickReward","clickUserDict","index","length","element","userDict","userId","isGet","time","refreshList","firstLogin","date","isAmGet","isPmGet","remainCount","throwError"],"mappings":"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","file":"receiveCmd.js","sourceRoot":"../../../../../assets/Scripts/common","sourcesContent":["tcpManager.receiveCmd = {\n    //收到服务器下发的协议处理\n    process: function (params) {\n        var result = params.result;\n\n        if (result.action == tcpManager.cmdType.normalLogin) {\n            //处理异常报错\n            if (result.ok && parseInt(result.ok) <= 0) {\n                console.log('处理异常报错');\n                if (result.action == tcpManager.cmdType.clickLinkLogin) {\n                    console.log('点击自己发送的小卡片需要请求normalLogin协议');\n                    tcpManager.sendCmd.sendLoginData();\n                    return;\n                }\n                Global.game.showDialogPropText('账号数据异常');\n                return;\n            }\n\n            console.log('normalLogin:', result.action);\n            Global.tcpData = {};\n            tcpManager.receiveCmd.formatData(result.data);\n            tcpManager.sendCmd.sendGetClickUserList();\n\n            /* Global.tcpData.firstLogin = result.data.firstLogin;\n             Global.tcpData.date = result.data.date;\n             Global.tcpData.isAmGet = result.data.isAmGet;\n             Global.tcpData.isPmGet = result.data.isPmGet;\n             Global.tcpData.clickUserDict = result.data.clickUserDict;\n             Global.tcpData.remainCount = result.data.remainCount;*/\n        } else if (result.action == tcpManager.cmdType.clickLinkLogin) {\n            //处理异常报错\n            if (result.ok && parseInt(result.ok) <= 0) {\n                console.log('处理异常报错');\n                if (result.action == tcpManager.cmdType.clickLinkLogin) {\n                    console.log('点击自己发送的小卡片需要请求normalLogin协议');\n                    tcpManager.sendCmd.sendLoginData();\n                    return;\n                }\n                Global.game.showDialogPropText('账号数据异常');\n                return;\n            }\n            console.log('clickLinkLogin:', result.data);\n\n            Global.tcpData = {};\n            tcpManager.receiveCmd.formatData(result.data);\n            tcpManager.sendCmd.sendGetClickUserList();\n\n            if (parseInt(result.data.isClick) <= 0) {\n                console.log('是首次点击小卡片，可以领取奖励');\n                //本地加星星奖励\n                if (typeof wx !== 'undefined') {\n                    var msg = '你已帮助好友获得' + Global.rewardConfig.inviteNum + '钻，你也获得了' + Global.rewardConfig.inviteNum + '钻';\n                    Global.game.addStone(Global.rewardConfig.inviteNum, msg);\n                }\n            } else {\n                Global.game.showDialogPropText('你已经帮助过该好友！');\n            }\n        } else if (result.action == tcpManager.cmdType.fetchDailyReward) {\n            //处理异常报错\n            if (result.ok && parseInt(result.ok) <= 0) {\n                console.log('处理异常报错');\n                if (result.action == tcpManager.cmdType.clickLinkLogin) {\n                    console.log('点击自己发送的小卡片需要请求normalLogin协议');\n                    tcpManager.sendCmd.sendLoginData();\n                    return;\n                }\n                Global.game.showDialogPropText('账号数据异常');\n                return;\n            }\n\n            console.log('fetchDailyReward:', result.data);\n            tcpManager.receiveCmd.formatData(result.data);\n            Global.rewardUI.refreshDailyInfo();\n            /*\n                        if (parseInt(result.data.isAmGet) > 0) {\n                            console.log('更新上午的每日奖励信息');\n                            Global.rewardUI.refreshDailyInfo();\n                            //shuaxin\n                            Global.tcpData.isAmGet = parseInt(result.data.isAmGet);\n                        }\n                        if (parseInt(result.data.isPmGet) > 0) {\n                            console.log('更新xia午的每日奖励信息');\n                            Global.rewardUI.refreshDailyInfo();\n                            //shuaxin\n                            Global.tcpData.isPmGet = parseInt(result.data.isPmGet);\n                        }*/\n        } else if (result.action == tcpManager.cmdType.getClickUserList) {\n            //处理异常报错\n            if (result.ok && parseInt(result.ok) <= 0) {\n                console.log('处理异常报错');\n                if (result.action == tcpManager.cmdType.clickLinkLogin) {\n                    console.log('点击自己发送的小卡片需要请求normalLogin协议');\n                    tcpManager.sendCmd.sendLoginData();\n                    return;\n                }\n                Global.game.showDialogPropText('账号数据异常');\n                return;\n            }\n\n            console.log('getClickUserList:', result.data);\n            Global.tcpData.clickItems = result.data;\n        } else if (result.action == tcpManager.cmdType.fetchClickReward) {\n            //处理异常报错\n            if (result.ok && parseInt(result.ok) <= 0) {\n                console.log('处理异常报错');\n                if (result.action == tcpManager.cmdType.clickLinkLogin) {\n                    console.log('点击自己发送的小卡片需要请求normalLogin协议');\n                    tcpManager.sendCmd.sendLoginData();\n                    return;\n                }\n                Global.game.showDialogPropText('账号数据异常');\n                return;\n            }\n\n            console.log('fetchClickReward:', result.data);\n\n            //本地加星星奖励\n            if (typeof wx !== 'undefined') {\n                var msg = '恭喜你获得好友互助奖励';\n                Global.game.addStone(Global.rewardConfig.inviteNum, msg);\n            }\n\n            if (Global.tcpData.clickItems && result.data && result.data.clickUserDict) {\n                for (let index = 0; index < Global.tcpData.clickItems.length; index++) {\n                    const element = Global.tcpData.clickItems[index];\n                    var userDict = result.data.clickUserDict[element.userId];\n                    console.log('--------------', element.userId, userDict)\n                    if (userDict) {\n                        console.log('修改成功', element.userId);\n                        element.isGet = userDict.isGet;\n                        element.time = userDict.time;\n                    }\n                }\n            }\n\n            Global.rewardUI.refreshList();\n        } \n        //console.log('Global.tcpData:', Global.tcpData);\n    },\n\n    formatData: function (data) {\n        Global.tcpData.firstLogin = data.firstLogin;\n        Global.tcpData.date = data.date;\n        Global.tcpData.isClick = data.isClick;\n        Global.tcpData.isAmGet = data.isAmGet;\n        Global.tcpData.isPmGet = data.isPmGet;\n        Global.tcpData.clickUserDict = data.clickUserDict;\n        Global.tcpData.remainCount = data.remainCount;\n    },\n\n    throwError: function (result) {\n        //处理异常报错\n        if (result.ok && parseInt(result.ok) <= 0) {\n            console.log('处理异常报错');\n            if (result.action == tcpManager.cmdType.clickLinkLogin) {\n                console.log('点击自己发送的小卡片需要请求normalLogin协议');\n                tcpManager.sendCmd.sendLoginData();\n                return;\n            }\n            Global.game.showDialogPropText('账号数据异常');\n            return;\n        }\n    },\n}"]}
{"version":3,"sources":["wxBannerAd.js"],"names":["wxBannerAd","bannerAd","bannerAdTimer","isScale","createBannerAd","console","log","wx","sysInfo","getSystemInfoSync","SDKVersion","replace","slice","destroyBannerAd","adUnitId","style","left","top","width","screenWidth","show","addBannerAdTimer","onResize","res","height","realWidth","realHeight","myUtil","require","fitOffsetY","isIphoneX","showHeight","Global","bannerAdConfig","buttomHeight","screenHeight","lineHight","linePosY","error","hideBannerAd","hide","showBannerAd","destroy","clearTimeout","swith","setTimeout","interval","module","exports"],"mappings":"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","file":"wxBannerAd.js","sourceRoot":"../../../../../assets/Scripts/common","sourcesContent":["// banner广告接入\n\nlet wxBannerAd = {\n    bannerAd: null,\n    bannerAdTimer: null,\n\n    isScale: false,\n\n    createBannerAd: function () {\n        console.log('call initBannerAd');\n\n        if (typeof wx !== 'undefined') {\n            var sysInfo = wx.getSystemInfoSync();\n            console.log('sysinfo: ', sysInfo);\n            if (sysInfo && sysInfo.SDKVersion && sysInfo.SDKVersion !== '') {\n                console.log('sysinfo---: ', sysInfo.SDKVersion.replace(/\\./g, \"\"));\n            }\n            if (sysInfo && sysInfo.SDKVersion && sysInfo.SDKVersion !== '' && sysInfo.SDKVersion.slice(0, 5).replace(/\\./g, \"\") >= 204) {\n                this.destroyBannerAd();\n                try {\n                    this.bannerAd = wx.createBannerAd({\n                        adUnitId: 'adunit-b4b17fafcb3b6c17',\n                        style: {\n                            left: 0,\n                            top: 0,\n                            width: sysInfo.screenWidth\n                        }\n                    });\n                    this.isScale = false;\n\n                    if (this.bannerAd) {\n                        this.bannerAd.show();\n                        this.addBannerAdTimer();\n\n                        this.bannerAd.onResize(res => {\n                            if (this.bannerAd && this.bannerAd.style) {\n                                console.log(\"res:\", res.width, res.height)\n                                if (this.bannerAd && this.bannerAd.style) {\n                                    console.log(\"real:\", this.bannerAd.style.realWidth, this.bannerAd.style.realHeight)\n                                }\n\n                                // 适配iphoneX\n                                var myUtil = require('myUtil');\n                                var fitOffsetY = myUtil.isIphoneX() ? 0.01 : 0;\n                                console.log('fitOffsetY:', fitOffsetY);\n\n                                var showHeight = Global.bannerAdConfig.showHeight;\n                                if (this.bannerAd && this.bannerAd.style.realHeight <= Global.bannerAdConfig.showHeight) {\n                                    showHeight = this.bannerAd.style.realHeight;\n                                }\n\n                                if (this.bannerAd && this.bannerAd.style) {\n                                    //var buttomHeight = sysInfo.screenHeight / sysInfo.pixelRatio - (Global.lineHight / 2 - Global.linePosY) / sysInfo.pixelRatio;\n                                    var buttomHeight = sysInfo.screenHeight / 2 - (sysInfo.screenHeight * Global.lineHight / 568 / 2 - Global.linePosY) / 2;\n                                    if (myUtil.isIphoneX()) {\n                                        console.log('isIphoneX');\n                                        buttomHeight -= 6;\n                                    }\n                                    //var buttomHeight = sysInfo.screenHeight / sysInfo.pixelRatio - (Global.lineHight / 2 - Global.linePosY) / sysInfo.pixelRatio - (sysInfo.screenHeight - 568) / 4;\n                                    //var buttomHeight = sysInfo.screenHeight / sysInfo.pixelRatio - (sysInfo.screenHeight * sysInfo.pixelRatio -Math.abs(Global.lineHight)) / sysInfo.pixelRatio;\n                                    if (this.bannerAd.style.realHeight >= buttomHeight) {\n                                        console.log('重设宽度');\n                                        this.bannerAd.style.width = 300;\n\n                                        //this.bannerAd.style.top = sysInfo.screenHeight - this.bannerAd.style.realHeight;\n                                    } else {\n                                        // this.bannerAd.style.top = sysInfo.screenHeight - buttomHeight;\n                                    }\n\n                                    console.log('buttomHeight', Global.lineHight, Global.linePosY, buttomHeight);\n                                    this.bannerAd.style.left = (sysInfo.screenWidth - res.width) / 2;\n                                    this.bannerAd.style.top = sysInfo.screenHeight - buttomHeight;\n                                    //this.bannerAd.style.top = sysInfo.screenHeight - this.bannerAd.style.realHeight;\n\n\n\n\n                                    /*\n                                                                        var downHeight = 0;\n                                                                        if ((this.bannerAd.style.realHeight / sysInfo.screenHeight) > 0.16) {\n                                                                            //downHeight = this.bannerAd.style.realHeight - sysInfo.screenHeight * 0.16;\n                                                                            console.log('****this.bannerAd.style.realHeight:', this.bannerAd.style.realHeight);\n                                                                            this.bannerAd.style.width = 300;\n                                                                            this.bannerAd.style.top = sysInfo.screenHeight - this.bannerAd.style.realHeight;\n                                                                            this.isScale = true;\n                                                                        } else {\n                                                                            if (this.isScale) {\n                                                                                console.log('重设宽度之后：', sysInfo.screenHeight, this.bannerAd.style.realHeight);\n\n                                                                                this.bannerAd.style.top = sysInfo.screenHeight - this.bannerAd.style.realHeight - 20;\n                                                                                this.isScale = false;\n                                                                            } else {\n                                                                                this.bannerAd.style.top = sysInfo.screenHeight - this.bannerAd.style.realHeight;\n                                                                            }\n\n                                                                            //this.bannerAd.style.top = sysInfo.screenHeight - this.bannerAd.style.realHeight;\n                                                                        }*/\n\n\n                                    /* var width = sysInfo.screenWidth;\n                                     if ((this.bannerAd.style.realHeight / sysInfo.screenHeight) > 0.16) {\n                                         width -= sysInfo.screenWidth * 0.16;\n                                     }\n                                     this.bannerAd.style.width = width;*/\n\n                                    //this.bannerAd.style.left = (sysInfo.screenWidth - res.width) / 2;\n\n                                    //this.bannerAd.style.top = sysInfo.screenHeight - showHeight + fitOffsetY;\n\n\n                                    // this.bannerAd.style.top = sysInfo.screenHeight - this.bannerAd.style.realHeight;\n\n\n\n                                    // console.log(\"top:\", this.bannerAd.style.top, \"showHeight:\", showHeight);\n                                }\n                            }\n                        })\n                    }\n                } catch (error) {\n                    console.log(error);\n                }\n            } else {\n                console.log('SDKVersion 判断基础库版本号 >= 2.0.4 后再使用该 API');\n            }\n        }\n    },\n\n    hideBannerAd: function () {\n        console.log('call hideBannerAd');\n\n        if (this.bannerAd) {\n            this.bannerAd.hide();\n        }\n    },\n\n    showBannerAd: function () {\n        console.log('call showBannerAd');\n\n        if (this.bannerAd) {\n            this.bannerAd.show();\n        }\n    },\n\n    //销毁广告\n    destroyBannerAd: function () {\n        console.log('call destroyBannerAd');\n\n        if (this.bannerAd) {\n            try {\n                this.bannerAd.destroy();\n                this.bannerAd = null;\n            } catch (error) {\n                this.bannerAd = null;\n            }\n        }\n        clearTimeout(this.bannerAdTimer);\n    },\n\n    //增加广告计时器\n    addBannerAdTimer: function () {\n        console.log('addBannerAdTimer');\n        if (!Global.bannerAdConfig.swith) {\n            console.log('关闭每60s刷新banner广告机制');\n            clearTimeout(this.bannerAdTimer);\n            return;\n        }\n        this.bannerAdTimer = setTimeout(() => {\n            this.createBannerAd();\n        }, Global.bannerAdConfig.interval);\n    },\n}\n\nmodule.exports = wxBannerAd;"]}
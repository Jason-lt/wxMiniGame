{"version":3,"sources":["../../../../../assets/Scripts/common/assets/Scripts/common/sendCmd.js"],"names":["tcpManager","sendCmd","lisiner","console","log","tywx","UserInfo","wxgame_session_key","initLogin","NotificationCenter","listen","gameEvent","BIND_USER_SUCCESS","sendMsg","params","websocket","sendData","Global","helpInfo","parseInt","inviteCode","sendClickLinkLogin","sendLoginData","cmd","cmdType","wx","normalLogin","userId","SystemInfo","gameId","intClientId","loginDateStr","Date","toDateString","clickLinkLogin","sendFetchClickReward","targetUserId","fetchClickReward","sendGetClickUserList","getClickUserList","sendFetchDailyReward","fetchDailyReward"],"mappings":"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","file":"sendCmd.js","sourceRoot":"../../../../../assets/Scripts/common","sourcesContent":["//let ThirdAPI = require('./common/ThirdAPI')\n//发送协议\ntcpManager.sendCmd = {\n    lisiner: function () {\n        console.log('监听成功');\n        if (tywx.UserInfo.wxgame_session_key != '') {\n            tcpManager.sendCmd.initLogin();\n        }\n        tywx.NotificationCenter.listen(tcpManager.gameEvent.BIND_USER_SUCCESS, tcpManager.sendCmd.initLogin, null);\n    },\n\n    //发送协议\n    sendMsg: function (params) {\n        tcpManager.websocket.sendData(params);\n    },\n\n    //初始化登录\n    initLogin: function () {\n        console.log('Global.helpInfo:', Global.helpInfo);\n        if (Global.helpInfo && parseInt(Global.helpInfo.inviteCode) > 0) {\n            tcpManager.sendCmd.sendClickLinkLogin();\n        } else {\n            tcpManager.sendCmd.sendLoginData();\n        }\n    },\n\n    //不是点链接发送登录协议\n    sendLoginData: function () {\n        var cmd = {\n            'apiVersion': '5.0',\n            'namespace': \"wx\",\n            'cmd': tcpManager.cmdType.wx,\n            'params': {\n                'action': tcpManager.cmdType.normalLogin,\n                'userId': tywx.UserInfo.userId,\n                'gameId': 9997,\n                'sxGameId': tywx.SystemInfo.gameId,\n                'intClientId': tywx.SystemInfo.intClientId\n            }\n        };\n        tcpManager.sendCmd.sendMsg(cmd);\n         //记录登录时的时间\n         Global.loginDateStr = (new Date()).toDateString();\n    },\n\n    //发送玩家点击链接协议\n    sendClickLinkLogin: function () {\n        console.log('tcpManager.sendCmd.sendClickLinkLogin WXGlobal.helpInfo:', Global.helpInfo);\n        if (!Global.helpInfo) {\n            return;\n        }\n        if (parseInt(Global.helpInfo.inviteCode) <= 0) {\n            return;\n        }\n        var cmd = {\n            'apiVersion': '5.0',\n            'namespace': \"wx\",\n            'cmd': tcpManager.cmdType.wx,\n            'params': {\n                'action': tcpManager.cmdType.clickLinkLogin,\n                'userId': tywx.UserInfo.userId,\n                'gameId': 9997,\n                'targetUserId': parseInt(Global.helpInfo.inviteCode),\n                'sxGameId': tywx.SystemInfo.gameId,\n                'intClientId': tywx.SystemInfo.intClientId\n            }\n        };\n        console.log('sendClickLinkLogin:', cmd);\n        tcpManager.sendCmd.sendMsg(cmd);\n         //记录登录时的时间\n         Global.loginDateStr = (new Date()).toDateString();\n    },\n\n    //领取链接被点之后的奖励\n    sendFetchClickReward: function (targetUserId) {\n        if (parseInt(targetUserId) <= 0) {\n            return;\n        }\n        var cmd = {\n            'apiVersion': '5.0',\n            'namespace': \"wx\",\n            'cmd': tcpManager.cmdType.wx,\n            'params': {\n                'action': tcpManager.cmdType.fetchClickReward,\n                'userId': tywx.UserInfo.userId,\n                'gameId': 9997,\n                'targetUserId': parseInt(targetUserId),\n                'sxGameId': tywx.SystemInfo.gameId,\n                'intClientId': tywx.SystemInfo.intClientId\n            }\n        };\n        console.log('sendFetchClickReward:', cmd);\n        tcpManager.sendCmd.sendMsg(cmd);\n    },\n\n    //获取点击用户列表\n    sendGetClickUserList: function () {\n        var cmd = {\n            'apiVersion': '5.0',\n            'namespace': \"wx\",\n            'cmd': tcpManager.cmdType.wx,\n            'params': {\n                'action': tcpManager.cmdType.getClickUserList,\n                'userId': tywx.UserInfo.userId,\n                'gameId': 9997,\n                'sxGameId': tywx.SystemInfo.gameId,\n                'intClientId': tywx.SystemInfo.intClientId\n            }\n        };\n        console.log('sendGetClickUserList:', cmd);\n        tcpManager.sendCmd.sendMsg(cmd);\n    },\n\n    //领取每日奖励\n    sendFetchDailyReward: function () {\n        var cmd = {\n            'apiVersion': '5.0',\n            'namespace': \"wx\",\n            'cmd': tcpManager.cmdType.wx,\n            'params': {\n                'action': tcpManager.cmdType.fetchDailyReward,\n                'userId': tywx.UserInfo.userId,\n                'gameId': 9997,\n                'sxGameId': tywx.SystemInfo.gameId,\n                'intClientId': tywx.SystemInfo.intClientId\n            }\n        };\n        console.log('sendFetchDailyReward:', cmd);\n        tcpManager.sendCmd.sendMsg(cmd);\n    },\n\n}"]}
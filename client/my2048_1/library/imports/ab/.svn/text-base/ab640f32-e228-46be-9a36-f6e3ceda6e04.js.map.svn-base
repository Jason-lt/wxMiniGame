{"version":3,"sources":["../../../../../assets/Scripts/ui/assets/Scripts/ui/shareUI.js"],"names":["ThirdAPI","require","cc","Class","extends","Component","properties","bg","default","type","Node","line1","line2","currScore","Label","score","personPer","btn_label","node_gold","fly_node","lbl_gold","lbl_fly","soundOnBtn","soundOffBtn","dailyLabel","backgroundAudio","url","AudioClip","tipbox","getStoneBtn","shareBtn","hasShardReward","isStart","start","Global","shareUI","getComponent","setBackground","initData","destroyBannerAd","showEffect","setShowButton","gridControllerScript","gridController","updateMaxLabel","scoreScript","scoreNum","biManager","bilog","entershare","cdnGameConfig","totalSwith","isDailyLimit","active","canShow","wxScore","shareScoreLimit","shareScoreSwith","shareData","shareTimes","wxBannerAd","showTipbox","onTipButton","canvas","find","width","console","log","switchBGM","startUI","node","setPosition","p","action","moveTo","runAction","maxNum","string","myUtil","getPercentString","wx","data","loadLocalScore","parseInt","maxscore","gold","loadScore","dailyBattleTimes","gameinfo","battleTimes","saveScore","historyMaxScore","resetInitData","dailyScore","gameInfo","FBInstant","fbScore","dataScript","titleMaxScore","titleUI","updateItemsState","play","game","playSound","showDialogPropText","saveFriendGenStoneInfo","enterScene","restar","gotoHome","startGame","showRankUI","showRank","onShareGame","shareGame","getImgBase64","onShareSuccess","bind","EChannelPrefix","sendChannelPrefix","result","onShareFail","getStoneForShare","onGetStoneSuccess","openGId","storeShare","saveShareData","shareDate","wxGold","shareReward","playGetGoldEffect","onChallenge","shareAsync","intent","image","text","myReplayData","then","showDialogText","ani","Animation","fadeIn","on","sequence","scaleTo","callFunc","fadeOut"],"mappings":"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","file":"shareUI.js","sourceRoot":"../../../../../assets/Scripts/ui","sourcesContent":["let ThirdAPI = require('../common/ThirdAPI');\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        bg: {\n            default: null,\n            type: cc.Node\n        },\n        line1: {\n            default: null,\n            type: cc.Node\n        },\n        line2: {\n            default: null,\n            type: cc.Node\n        },\n        //当前分数\n        currScore: {\n            default: null,\n            type: cc.Label,\n        },\n        score: {\n            default: null,\n            type: cc.Label,\n        },\n        personPer: {\n            default: null,\n            type: cc.Label,\n        },\n        btn_label: {\n            default: null,\n            type: cc.Label,\n        },\n        node_gold: {\n            default: null,\n            type: cc.Node\n        },\n        fly_node: {\n            default: null,\n            type: cc.Node\n        },\n        lbl_gold: {\n            default: null,\n            type: cc.Label,\n        },\n        lbl_fly: {\n            default: null,\n            type: cc.Label,\n        },\n        soundOnBtn: {\n            default: null,\n            type: cc.Node\n        },\n        soundOffBtn: {\n            default: null,\n            type: cc.Node\n        },\n        dailyLabel: {\n            default: null,\n            type: cc.Label,\n        },\n        //背景音乐\n        backgroundAudio: {\n            url: cc.AudioClip,\n            default: null\n        },\n        // 提示信息\n        tipbox: {\n            default: null,\n            type: cc.Node,\n        },\n        //分享给好友得星星\n        getStoneBtn: {\n            default: null,\n            type: cc.Node,\n        },\n        shareBtn: {\n            default: null,\n            type: cc.Node,\n        },\n\n        /*\n                buttonstate0: {\n                    default: null,\n                    type: cc.Node\n                },\n                buttonstate1: {\n                    default: null,\n                    type: cc.Node\n                },*/\n\n        hasShardReward: true,\n        isStart: false,\n    },\n\n    start() {\n        Global.shareUI = this.getComponent('shareUI');\n\n        this.setBackground();\n        this.isStart = true;\n    },\n\n    initData: function () {\n        this.hasShardReward = true;\n        this.destroyBannerAd();\n        this.showEffect();\n        this.setBackground();\n        this.setShowButton();\n\n        var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n        if (gridControllerScript) {\n            this.updateMaxLabel(gridControllerScript.scoreScript.scoreNum);\n        }\n\n        //记载进入结算界面打点\n        var biManager = require('biManager');\n        biManager.bilog(biManager.entershare, null);\n\n        /*\n                if (Global.cdnGameConfig.totalSwith || Global.isDailyLimit) {\n                    this.buttonstate0.active = false;\n                    this.buttonstate1.active = true;\n                } else {\n                    //分数开关判断\n                    if (Global.cdnGameConfig.shareScoreSwith) {\n                        //判断分数\n                        console.log('判断分数：', Global.cdnGameConfig.shareScoreLimit, Global.wxScore);\n                        var canShow = Global.wxScore > Global.cdnGameConfig.shareScoreLimit ? true : false;\n                        console.log('分享界面按钮判断--canShow:', canShow);\n                        if (canShow) {\n                            this.buttonstate0.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? true : false;\n                            this.buttonstate1.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? false : true;\n                        } else {\n                            this.buttonstate0.active = false;\n                            this.buttonstate1.active = true;\n                        }\n                    } else {\n                        this.buttonstate0.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? true : false;\n                        this.buttonstate1.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? false : true;\n                    }\n\n                    // this.buttonstate0.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? true : false;\n                    // this.buttonstate1.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? false : true;\n                }*/\n\n\n        // if (Global.shareData.shareTimes >= 5) {\n        //     console.log('分享超过5次限制');\n        //     this.buttonstate0.active = false;\n        //     this.buttonstate1.active = true;\n        // }\n    },\n\n    //根据开关设置分享按钮状态\n    setShowButton: function () {\n        if (!Global.cdnGameConfig.totalSwith || Global.isDailyLimit) {\n            this.getStoneBtn.active = false;\n            this.shareBtn.active = true;\n        } else {\n            var canShow = Global.wxScore > Global.cdnGameConfig.shareScoreLimit ? true : false;\n            //开关打开，并且不能显示按钮\n            if (Global.cdnGameConfig.shareScoreSwith && !canShow) {\n                this.getStoneBtn.active = false;\n                this.shareBtn.active = true;\n            } else {\n                this.getStoneBtn.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? true : false;\n                this.shareBtn.active = (this.hasShardReward && Global.shareData.shareTimes < 5) ? false : true;\n            }\n        }\n    },\n\n    //销毁banner广告\n    destroyBannerAd: function () {\n        var wxBannerAd = require('wxBannerAd');\n        wxBannerAd.destroyBannerAd();\n    },\n\n    // 显示提示框\n    showTipbox: function () {\n        this.tipbox.active = true;\n    },\n\n    onTipButton: function () {\n        this.tipbox.active = false;\n    },\n\n    //设置头部图片的适配宽高\n    setBackground: function () {\n        let canvas = cc.find('Canvas');\n        this.bg.width = canvas.width;\n        this.line1.width = canvas.width;\n        this.line2.width = canvas.width;\n        console.log('width:', this.bg.width, this.line1.width, this.line2.width);\n    },\n\n    switchBGM: function () {\n        Global.startUI.switchBGM();\n    },\n\n    showEffect: function () {\n        this.node_gold.active = false;\n        this.fly_node.active = false;\n\n        this.node.setPosition(cc.p(-640, 0));\n        var action = cc.moveTo(0.6, cc.p(0, 0));\n        this.node.runAction(action);\n    },\n\n    updateMaxLabel: function (maxNum) {\n        //本局最高分\n        this.currScore.string = maxNum;\n        //全球比分\n        var myUtil = require('myUtil');\n        this.personPer.string = myUtil.getPercentString(maxNum);\n        this.score.string = '历史最高分：' + maxNum;\n        if (typeof wx !== 'undefined') {\n            let data = ThirdAPI.loadLocalScore();\n            var score = parseInt(data.maxscore);\n            var gold = parseInt(data.gold);\n            ThirdAPI.loadScore((maxscore, gold) => {\n                score = parseInt(maxscore);\n                gold = parseInt(gold);\n                console.log('on ThirdAPI loadScore', score, parseInt(gold));\n            });\n            if (Global.isDailyLimit) {\n                this.dailyLabel.string = \"每日挑战次数：\" + (Global.dailyBattleTimes - Global.gameinfo.battleTimes) + \"/\" + Global.dailyBattleTimes;\n            } else {\n                this.dailyLabel.string = \"\";\n            }\n\n            //不是每日挑战\n            if (!Global.isDailyLimit) {\n                //历史最高分\n                if (score < maxNum) {\n                    ThirdAPI.saveScore(maxNum, gold);\n                    this.score.string = '历史最高分：' + maxNum;\n                    Global.historyMaxScore = maxNum;\n                } else {\n                    this.score.string = '历史最高分：' + score;\n                    Global.historyMaxScore = score;\n                }\n            } else {\n                //兼容dailyScore\n                if (!Global.gameinfo) {\n                    var myUtil = require('myUtil');\n                    myUtil.resetInitData();\n                }\n                if (Global.gameinfo && !Global.gameinfo.dailyScore) {\n                    Global.gameinfo.dailyScore = 0;\n                }\n                this.score.string = \"今日挑战最高分数：\" + parseInt(Global.gameInfo.dailyScore);\n            }\n        } else if (typeof FBInstant !== 'undefined') {\n            if (maxNum > Global.fbScore) {\n                this.score.string = maxNum;\n                //测试\n                Global.dataScript.saveScore(maxNum);\n            } else {\n                this.score.string = Global.fbScore;\n            }\n        }\n\n        Global.titleMaxScore = maxNum;\n        if (Global.titleUI) {\n            Global.titleUI.updateItemsState(1);\n        }\n    },\n\n    //进入游戏\n    play: function () {\n        Global.game.playSound('btn', 0.1);\n        if (Global.isDailyLimit) {\n            //判断挑战次数\n            if (Global.gameinfo.battleTimes <= 0) {\n                console.log('挑战次数不足');\n                Global.game.showDialogPropText(\"每日挑战次数到达上限\");\n                return;\n            }\n            Global.gameinfo.battleTimes--;\n            ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n        }\n        Global.game.enterScene();\n\n        //记载结算界面重新开始打点\n        var biManager = require('biManager');\n        biManager.bilog(biManager.restar, null);\n    },\n\n    //返回主页\n    gotoHome: function () {\n        Global.game.playSound('btn', 0.1);\n        Global.game.startGame();\n    },\n\n    //进入排行榜\n    showRankUI: function () {\n        Global.game.playSound('btn', 0.1);\n        Global.game.showRank();\n    },\n\n    // 分享功能  intent(\"INVITE\" | \"REQUEST\" | \"CHALLENGE\" | \"SHARE\") 表示分享的意图\n    onShareGame: function () {\n        Global.game.playSound('btn', 0.1);\n        if (typeof FBInstant !== 'undefined') {\n            var myUtil = require('myUtil');\n            ThirdAPI.shareGame(myUtil.getImgBase64(), this.onShareSuccess.bind(this));\n        } else {\n            let EChannelPrefix = require(\"EChannelPrefix\");\n            ThirdAPI.sendChannelPrefix(EChannelPrefix.result);\n            ThirdAPI.shareGame('screenshot', this.onShareSuccess.bind(this), this.onShareFail.bind(this), '252');\n        }\n    },\n\n    //分享给好友成功\n    onShareSuccess: function () {\n        console.log('分享给好友成功');\n        this.getStoneBtn.active = false;\n        this.shareBtn.active = true;\n        Global.game.showDialogPropText('分享成功！');\n    },\n\n\n    //分享得星星\n    getStoneForShare: function () {\n        Global.game.playSound('btn', 0.1);\n        if (typeof FBInstant !== 'undefined') {\n            var myUtil = require('myUtil');\n            ThirdAPI.shareGame(myUtil.getImgBase64(), this.onShareSuccess.bind(this));\n        } else {\n            let EChannelPrefix = require(\"EChannelPrefix\");\n            ThirdAPI.sendChannelPrefix(EChannelPrefix.result);\n            ThirdAPI.shareGame('randomImg', this.onGetStoneSuccess.bind(this), this.onShareFail.bind(this), '251');\n        }\n    },\n\n    //分享得星星成功\n    onGetStoneSuccess: function (openGId) {\n        //结算界面通过送星星分享成功\n        var biManager = require('biManager');\n        biManager.bilog(biManager.storeShare, null);\n\n        if (Global.shareData.shareTimes >= 5) {\n            console.log('分享超过5次限制');\n            this.getStoneBtn.active = false;\n            this.shareBtn.active = true;\n            return;\n        }\n\n        //获得星星动画\n        if (this.hasShardReward) {\n            /* if (Global.gameinfo.shareData3.arrOpenGId.indexOf(openGId) != -1) {\n                 console.log('该群今日已经分享过', openGId);\n                 Global.game.showDialogText('该群今日已经分享过无法获得奖励');\n                 return;\n             } else {\n                 console.log('该群未分享过', openGId);\n                 Global.gameinfo.shareData3.arrOpenGId.push(openGId);\n                 ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n             }\n\n             if (!openGId) {\n                 Global.game.showDialogText('分享失败，必须分享到微信群', {\n                     x: 0,\n                     y: -200\n                 });\n                 console.log('shareUI 分享的不是群');\n                 return;\n             }*/\n            console.log('分享获得星星,开始播放动画');\n            Global.shareData.shareTimes++;\n            ThirdAPI.saveShareData(Global.shareData.shareTimes, Global.shareData.shareDate);\n\n            Global.wxGold += parseInt(Global.shareReward);\n            //更新并存储\n            if (typeof wx !== 'undefined') {\n                let data = ThirdAPI.loadLocalScore();\n                var score = parseInt(data.maxscore);\n                var gold = parseInt(data.gold);\n                ThirdAPI.loadScore((maxscore, gold) => {\n                    score = parseInt(maxscore);\n                    gold = parseInt(gold);\n                    console.log('shareUI on ThirdAPI loadScore', score, parseInt(gold), Global.wxGold);\n                });\n                ThirdAPI.saveScore(score, Global.wxGold);\n            }\n\n            //更改分享可获星星状态\n            this.hasShardReward = false;\n            this.playGetGoldEffect();\n        }\n    },\n\n\n    /*\n        onShareSuccess: function (openGId) {\n            //总开关判断\n            if (Global.cdnGameConfig.totalSwith || Global.isDailyLimit) {\n                this.buttonstate0.active = false;\n                this.buttonstate1.active = true;\n                return;\n            } else {\n                //分数开关判断\n                if (Global.cdnGameConfig.shareScoreSwith) {\n                    //判断分数\n                    console.log('分享成功之后判断分数：', Global.cdnGameConfig.shareScoreLimit, Global.wxScore);\n                    var canTakeReward = Global.wxScore > Global.cdnGameConfig.shareScoreLimit ? true : false;\n\n                    if (!canTakeReward) {\n                        console.log('分享成功不能领取奖励')\n                        this.buttonstate0.active = false;\n                        this.buttonstate1.active = true;\n                        return;\n                    }\n                }\n            }\n\n    //console.log('今日分享次数:', Global.shareData.shareTimes);\n    /* if (Global.shareData.shareTimes >= 5) {\n            //console.log('分享超过5次限制');\n            this.buttonstate0.active = false;\n            this.buttonstate1.active = true;\n            return;\n        }\n\n        //获得星星动画\n        if (this.hasShardReward) {\n            if (Global.gameinfo.shareData3.arrOpenGId.indexOf(openGId) != -1) {\n                console.log('该群今日已经分享过', openGId);\n                Global.game.showDialogText('该群今日已经分享过无法获得奖励');\n                return;\n            } else {\n                console.log('该群未分享过', openGId);\n                Global.gameinfo.shareData3.arrOpenGId.push(openGId);\n                ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n            }\n\n            if (!openGId) {\n                Global.game.showDialogText('分享失败，必须分享到微信群', {\n                    x: 0,\n                    y: -200\n                });\n                console.log('shareUI 分享的不是群');\n                return;\n            }\n            console.log('分享获得星星,开始播放动画');\n            Global.shareData.shareTimes++;\n            ThirdAPI.saveShareData(Global.shareData.shareTimes, Global.shareData.shareDate);\n\n            Global.wxGold += parseInt(Global.shareReward);\n            //更新并存储\n            if (typeof wx !== 'undefined') {\n                let data = ThirdAPI.loadLocalScore();\n                var score = parseInt(data.maxscore);\n                var gold = parseInt(data.gold);\n                ThirdAPI.loadScore((maxscore, gold) => {\n                    score = parseInt(maxscore);\n                    gold = parseInt(gold);\n                    console.log('shareUI on ThirdAPI loadScore', score, parseInt(gold), Global.wxGold);\n                });\n                ThirdAPI.saveScore(score, Global.wxGold);\n            }\n\n            //更改分享可获星星状态\n            this.hasShardReward = false;\n            this.playGetGoldEffect();\n        }\n    },*/\n\n\n    onChallenge: function () {\n        Global.game.playSound('btn', 0.1);\n        var myUtil = require('myUtil');\n        if (typeof FBInstant === 'undefined') return;\n        FBInstant.shareAsync({\n            intent: 'INVITE',\n            image: myUtil.getImgBase64(),\n            text: 'I just challenged Tetris2048,Join me!',\n            data: {\n                myReplayData: '...'\n            },\n        }).then(() => {\n            // continue with the game.\n        });\n    },\n\n    //分享到群失败\n    onShareFail: function () {\n        console.log('分享失败');\n        Global.game.showDialogText('分享失败!');\n    },\n\n    playGetGoldEffect: function () {\n        this.getStoneBtn.active = false;\n        this.shareBtn.active = true;\n        //更改分享可获星星状态\n        this.hasShardReward = false;\n\n        this.fly_node.active = true;\n        this.lbl_fly.string = '+' + Global.shareReward;\n        let ani = this.fly_node.getComponent(cc.Animation)\n        ani.play();\n        this.node_gold.active = true;\n        this.lbl_gold.string = Global.wxGold - parseInt(Global.shareReward);\n        this.node_gold.runAction(cc.fadeIn(0.5));\n\n        ani.on('stop', () => {\n            this.node_gold.runAction(cc.sequence(\n                cc.scaleTo(0.2, 1.2),\n                cc.callFunc(() => {\n                    this.lbl_gold.string = Global.wxGold;\n                    this.fly_node.active = false;\n                }),\n                cc.scaleTo(0.2, 1),\n                cc.fadeOut(1)\n            ));\n        });\n    },\n});"]}
{"version":3,"sources":["dataScript.js"],"names":["cc","Class","extends","Component","start","Global","dataScript","node","getComponent","getScore","savestr","saveobj","FBInstant","fbname","player","getName","fbphoto","getPhoto","sdkversion","getSDKVersion","getDataAsync","then","data","fbScore","startUI","updateBestScore","saveScore","maxScore","setDataAsync","maxscore","strNameAndPhoto","getLeaderboardAsync","leaderboard","setScoreAsync","entry","catch","error","game","addLogStr"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,SAHK,mBAGG;AACJC,eAAOC,UAAP,GAAoB,KAAKC,IAAL,CAAUC,YAAV,CAAuB,YAAvB,CAApB;AACA,aAAKC,QAAL;AACH,KANI;;;AAQLA,cAAU,kBAAUC,OAAV,EAAmBC,OAAnB,EAA4B;AAClC,YAAI,OAAOC,SAAP,KAAqB,WAAzB,EAAsC;;AAEtCP,eAAOQ,MAAP,GAAgBD,UAAUE,MAAV,CAAiBC,OAAjB,EAAhB;AACAV,eAAOW,OAAP,GAAiBJ,UAAUE,MAAV,CAAiBG,QAAjB,EAAjB;AACA,YAAIC,aAAaN,UAAUO,aAAV,EAAjB;;AAEAP,kBAAUE,MAAV,CAAiBM,YAAjB,CAA8B,CAAC,UAAD,EAAa,SAAb,CAA9B,EACKC,IADL,CACU,UAAUC,IAAV,EAAgB;AAClB,gBAAI,OAAOA,KAAK,UAAL,CAAP,KAA4B,WAAhC,EAA6C;AACzCjB,uBAAOkB,OAAP,GAAiBD,KAAK,UAAL,CAAjB;AACH,aAFD,MAEO;AACHjB,uBAAOkB,OAAP,GAAiB,CAAjB;AACH;;AAED,gBAAIlB,OAAOmB,OAAX,EAAoB;AAChBnB,uBAAOmB,OAAP,CAAeC,eAAf;AACH;AACJ,SAXL;AAYH,KA3BI;;AA6BLC,eAAW,mBAAUC,QAAV,EAAoB;AAC3B,YAAI,OAAOf,SAAP,KAAqB,WAAzB,EAAsC;AACtC,YAAIe,WAAWtB,OAAOkB,OAAtB,EAA+B;AAC3BX,sBAAUE,MAAV,CAAiBc,YAAjB,CAA8B;AACtBC,0BAAUF;AADY,aAA9B,EAGKN,IAHL,CAGU,YAAY;AACdhB,uBAAOkB,OAAP,GAAiBM,QAAjB;AACH,aALL;;AAOA,gBAAIC,kBAAkBzB,OAAOQ,MAAP,GAAgB,GAAhB,GAAsBR,OAAOW,OAAnD;AACA;AACAJ,sBAAUmB,mBAAV,CAA8B,YAA9B,EACKV,IADL,CACU,UAAUW,WAAV,EAAuB;AACzB,uBAAOA,YAAYC,aAAZ,CAA0BN,QAA1B,EAAoCG,eAApC,CAAP;AACH,aAHL,EAIKT,IAJL,CAIU,UAAUa,KAAV,EAAiB,CACtB,CALL,EAMKC,KANL,CAMW,UAAUC,KAAV,EAAiB;AACpB/B,uBAAOgC,IAAP,CAAYC,SAAZ,CAAsBF,KAAtB;AACH,aARL;AASH;AAEJ;AApDI,CAAT","file":"dataScript.js","sourceRoot":"../../../../../assets/Scripts/controller","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\n// Learn Attribute:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\n\ncc.Class({\n    extends: cc.Component,\n\n    start() {\n        Global.dataScript = this.node.getComponent('dataScript');\n        this.getScore();\n    },\n\n    getScore: function (savestr, saveobj) {\n        if (typeof FBInstant === 'undefined') return;\n\n        Global.fbname = FBInstant.player.getName();\n        Global.fbphoto = FBInstant.player.getPhoto();\n        var sdkversion = FBInstant.getSDKVersion();\n\n        FBInstant.player.getDataAsync(['maxscore', 'starnum'])\n            .then(function (data) {\n                if (typeof data['maxscore'] !== 'undefined') {\n                    Global.fbScore = data['maxscore'];\n                } else {\n                    Global.fbScore = 0;\n                }\n\n                if (Global.startUI) {\n                    Global.startUI.updateBestScore();\n                }\n            });\n    },\n\n    saveScore: function (maxScore) {\n        if (typeof FBInstant === 'undefined') return;\n        if (maxScore > Global.fbScore) {\n            FBInstant.player.setDataAsync({\n                    maxscore: maxScore,\n                })\n                .then(function () {\n                    Global.fbScore = maxscore;\n                });\n\n            var strNameAndPhoto = Global.fbname + '_' + Global.fbphoto;\n            //更新排行榜\n            FBInstant.getLeaderboardAsync('my_allrank')\n                .then(function (leaderboard) {\n                    return leaderboard.setScoreAsync(maxScore, strNameAndPhoto);\n                })\n                .then(function (entry) {\n                })\n                .catch(function (error) {\n                    Global.game.addLogStr(error);\n                });\n        }\n\n    },\n});\n"]}
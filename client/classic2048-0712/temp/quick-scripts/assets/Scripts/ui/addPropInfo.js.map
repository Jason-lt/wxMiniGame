{"version":3,"sources":["addPropInfo.js"],"names":["ThirdAPI","require","cc","Class","extends","Component","properties","mainNode","default","type","Node","successNode","titleLabel","Label","propSprite","Sprite","propNum","propDesc","light","gainPropIcon","gainPropName","parma","showText","parmaIndex","gridControllerScript","closeTimer","initData","active","setInfo","pauseGame","prop_parma","Global","randomPropInfo","string","name","self","LoadAtlas","loadAtlasRes","spriteFrame","getSpriteFrameFromName","addPropSprite","gainAddPropNum","desc","gridController","getComponent","onPauseGameForOther","playLightAction","node","runAction","repeatForever","sequence","rotateBy","onShargeGame","game","playSound","myUtil","FBInstant","shareGame","getImgBase64","wx","sourceCode","onShareSuccess","bind","onShareFailed","console","log","openGId","showDialogText","gameinfo","shareData1","arrOpenGId","indexOf","push","saveFriendGenStoneInfo","canvas","find","button","getChildByName","width","clearPropNum","parseInt","biManager","bilog","clearToShare","superPropNum","superToShare","doublePropNum","setPropSprite","setTimeout","onClose","msg","undefined","clearTimeout","parent","removeChild","addPropInfoUI"],"mappings":"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","file":"addPropInfo.js","sourceRoot":"../../../../../assets/Scripts/ui","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nlet ThirdAPI = require('../common/ThirdAPI')\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        mainNode: {\n            default: null,\n            type: cc.Node,\n        },\n        successNode: {\n            default: null,\n            type: cc.Node,\n        },\n        titleLabel: {\n            default: null,\n            type: cc.Label,\n        },\n        propSprite: {\n            default: null,\n            type: cc.Sprite,\n        },\n        propNum: {\n            default: null,\n            type: cc.Label,\n        },\n        propDesc: {\n            default: null,\n            type: cc.Label,\n        },\n        light: {\n            default: null,\n            type: cc.Sprite,\n        },\n        gainPropIcon: {\n            default: null,\n            type: cc.Sprite,\n        },\n        gainPropName: {\n            default: null,\n            type: cc.Label,\n        },\n        parma: null,\n        showText: '', //显示分享文字\n        parmaIndex: -1, //传入的索引\n        gridControllerScript: null,\n        closeTimer: null,\n    },\n\n    //初始化分享获得道具数据\n    initData: function (parma) {\n        this.mainNode.active = true;\n        this.successNode.active = false;\n\n        this.parma = parma;\n        this.parmaIndex = parma.parmaIndex;\n\n        this.setInfo();\n    },\n\n    //\n    setInfo: function () {\n        this.pauseGame();\n        //文字显示\n        var prop_parma = Global.randomPropInfo[this.parmaIndex];\n        if (prop_parma) {\n            this.titleLabel.string = prop_parma.name;\n\n            var self = this;\n            var LoadAtlas = require(\"LoadAtlas\");\n            LoadAtlas.loadAtlasRes(\"textures/gridItem/items\", function () {\n                var LoadAtlas = require(\"LoadAtlas\");\n                self.propSprite.spriteFrame = LoadAtlas.getSpriteFrameFromName(\"textures/gridItem/items\", prop_parma.addPropSprite);\n            });\n            self.propNum.string = 'x' + prop_parma.gainAddPropNum;\n            this.propDesc.string = prop_parma.desc;\n        }\n    },\n\n    pauseGame: function () {\n        if (Global.gridController) {\n            this.gridControllerScript = Global.gridController.getComponent(\"gridController\");\n            this.gridControllerScript.onPauseGameForOther();\n        }\n    },\n\n    playLightAction: function () {\n        this.light.node.runAction(\n            cc.repeatForever(\n                cc.sequence(cc.rotateBy(0.3, -90), cc.rotateBy(0.3, -90), cc.rotateBy(0.3, -90), cc.rotateBy(0.3, -90)))\n        );\n    },\n\n\n    //自己分享得道具\n    onShargeGame: function () {\n        Global.game.playSound('btn', 0.1);\n        var myUtil = require('myUtil');\n        if (typeof FBInstant !== 'undefined') {\n            ThirdAPI.shareGame(myUtil.getImgBase64(), null);\n        } else if (typeof wx !== 'undefined') {\n            var sourceCode = '231';\n            if (this.parmaIndex == 1) {\n                sourceCode = '232';\n            }\n            ThirdAPI.shareGame('randomImg', this.onShareSuccess.bind(this), this.onShareFailed.bind(this), sourceCode);\n        } else {\n            console.log('测试分享');\n            this.onShareSuccess();\n        }\n    },\n\n    onShareSuccess: function (openGId) {\n        console.log('分享成功');\n        if (typeof wx !== 'undefined') {\n            if (!openGId) {\n                Global.game.showDialogText('分享失败，分享到群才有效');\n                console.log('分享失败，分享到群才有效');\n                return;\n            }\n        }\n\n        if (Global.gameinfo.shareData1.arrOpenGId.indexOf(openGId) != -1) {\n            console.log('该群今日已经分享过', openGId);\n            Global.game.showDialogText('分享失败，请分享到不同群');\n            return;\n        } else {\n            console.log('该群未分享过', openGId);\n            Global.gameinfo.shareData1.arrOpenGId.push(openGId);\n            ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n        }\n\n        //设置全屏的按钮\n        let canvas = cc.find('Canvas');\n        var button = this.successNode.getChildByName('button');\n        if (button) {\n            button.width = canvas.width;\n            button.width = canvas.width;\n        }\n        this.playLightAction();\n\n        this.mainNode.active = false;\n        this.successNode.active = true;\n        var prop_parma = Global.randomPropInfo[this.parmaIndex];\n        //增加道具\n        if (prop_parma) {\n            if (this.parmaIndex == 0) {\n                Global.gameinfo.clearPropNum += parseInt(prop_parma.gainAddPropNum);\n                //游戏界面点击锤锤分享并成功\n                var biManager = require('biManager');\n                biManager.bilog(biManager.clearToShare, null);\n            } else if (this.parmaIndex == 1) {\n                Global.gameinfo.superPropNum += parseInt(prop_parma.gainAddPropNum);\n                //游戏界面点击万能数字分享并成功\n                var biManager = require('biManager');\n                biManager.bilog(biManager.superToShare, null);\n            } else if (this.parmaIndex == 2) {\n                Global.gameinfo.doublePropNum += parseInt(prop_parma.gainAddPropNum);\n            }\n        }\n\n        if (prop_parma) {\n            this.titleLabel.string = prop_parma.name;\n\n            var self = this;\n            var LoadAtlas = require(\"LoadAtlas\");\n            LoadAtlas.loadAtlasRes(\"textures/gridItem/items\", function () {\n                var LoadAtlas = require(\"LoadAtlas\");\n                self.gainPropIcon.spriteFrame = LoadAtlas.getSpriteFrameFromName(\"textures/gridItem/items\", prop_parma.addPropSprite);\n            });\n            self.gainPropName.string = prop_parma.name + 'x' + prop_parma.gainAddPropNum;\n        }\n        //存储本地数据\n        ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n        if (this.gridControllerScript) {\n            this.gridControllerScript.setPropSprite();\n        }\n        this.closeTimer = setTimeout(() => {\n            this.onClose();\n        }, 2000);\n    },\n\n    onShareFailed: function (msg) {\n        if (msg === undefined) {\n            Global.game.showDialogText('分享失败！');\n        } else if (msg == 'fail') {\n            Global.game.showDialogText('分享失败，分享到群才有效');\n        } else if (msg == 'cancel') {\n            Global.game.showDialogText('分享失败！');\n        } else {\n            Global.game.showDialogText('分享失败！');\n        }\n    },\n\n    // 按钮回调：关闭\n    onClose: function () {\n        Global.game.playSound('btn', 0.1);\n        if (this.closeTimer !== null) {\n            clearTimeout(this.closeTimer);\n            this.closeTimer = null;\n        }\n        if (this.gridControllerScript) {\n            console.log('恢复游戏');\n            this.gridControllerScript.onPauseGameForOther();\n        }\n        if (this.node.parent) {\n            this.node.parent.removeChild(this.node);\n        }\n        if (Global.addPropInfoUI && Global.addPropInfoUI.node && Global.addPropInfoUI.node.parent) {\n            Global.addPropInfoUI.node.parent.removeChild(Global.addPropInfoUI.node);\n        }\n        Global.addPropInfoUI = null;\n    },\n});"]}
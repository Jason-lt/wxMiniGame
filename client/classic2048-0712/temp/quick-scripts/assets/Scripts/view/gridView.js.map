{"version":3,"sources":["gridView.js"],"names":["cc","Class","extends","Component","properties","combineAudio","url","AudioClip","default","numPrefab","type","Prefab","goldPrefab","itemPrefab","combineID","allGrids","hIndex","vIndex","item","gridNum","targetGrid","Node","isDown","moveIndex","sameScoreNum","deleteGrids","isJoin","actionJoin","joinItems","canDrop","isMarkGrid","setIndex","gridController","startBianli","self","gridControllerScript","Global","getComponent","bianliForGrid","startJoin","length","changeScore","console","log","extraNum","combineTimes","doubleNum","usePropStatus","scoreScript","addScore","itemViewScript","bornNum","random","Math","popDialogTimes","cdnGameConfig","popPropTotalTimes","weightRate","markScoreEquals","indexOf","hasMark","updateNum","updateColor","playFlyNum","playFlyGold","scoreEquals","game","showPropDialog","flyIndex","canFlyNums","parseInt","numInstance","instantiate","setNum","setPosition","p","node","getPosition","x","y","parent","addChild","toPosition","playFlyNumToItem","num","bombDoubleRate","toItemPosition","score","canFlyGolds","goldInstance","goldNode","gridViewScript","bianliHIndex","bianliVIndex","hasSameScore","hNum","vNum","compareGrid","compareGridScript","compareItem","useClear","gridMaxScore","gridScript","isDropProp","push","index","deleteGrid","deleteGridScript","deleteItem","useDouble","isStone","toJoin","resetData","check","runAction","sequence","delayTime","callFunc","checkJoinComplete","isComplete","curState","candropProp","playCombineAudio","isSoundPlaying","audioEngine","play","setFinishCallback","playAudioEnd","playAudioStart","resume","uncache","dropStone"],"mappings":"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","file":"gridView.js","sourceRoot":"../../../../../assets/Scripts/view","sourcesContent":["/*\n    合并触发判断，递归\n*/\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        combineAudio: {\n            url: cc.AudioClip,\n            default: null\n        },\n\n        numPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n        goldPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n\n        itemPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n\n\n        combineID: 0,\n        allGrids: null, //所有的格子信息\n        hIndex: 0,\n        vIndex: 0,\n        item: null,\n\n        //格子上的分数\n        gridNum: 0, //2  4 8  16\n\n        //目标格子\n        targetGrid: {\n            default: null,\n            type: cc.Node\n        },\n\n        isDown: false, //是否是下落的格子\n\n        moveIndex: 0, //下方的格子被消灭后，移动的距离\n        sameScoreNum: 0, //合并时记录相同的分数格子数量\n\n        deleteGrids: [], //存储即将合并的格子\n        isJoin: false,\n        actionJoin: false,\n        joinItems: [],\n\n        canDrop: false,\n        isMarkGrid: false, //是带有标识的格子\n    },\n\n    //设置索引index\n    setIndex: function (hIndex, vIndex, gridController) {\n        this.hIndex = hIndex;\n        this.vIndex = vIndex;\n    },\n\n    //开始遍历\n    startBianli: function () {\n        var self = this;\n        this.joinItems = [];\n\n        var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n        this.allGrids = gridControllerScript.allGrids;\n        //将要合并的数组\n        this.deleteGrids = [];\n\n        this.bianliForGrid();\n        //开始执行合并动作\n        this.startJoin();\n        //改变分数\n        this.isDown = false;\n\n        return (this.joinItems.length > 0);\n    },\n\n    //改变分数\n    changeScore: function () {\n        let self = this;\n        var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n        self.isDown = false;\n        //改变分数\n        if (self.deleteGrids.length > 0) {\n            if (self.deleteGrids.length == 1) {\n                self.gridNum *= 2;\n            } else if (self.deleteGrids.length == 2) {\n                self.gridNum *= 4;\n            } else if (self.deleteGrids.length == 3) {\n                self.gridNum *= 8;\n            }\n\n            //判断是否是有角标的道具\n            /* var canShowDialog = false;\n             for (let index = 0; index < self.deleteGrids.length; index++) {\n                 var deleteGrid = self.deleteGrids[index];\n                 var deleteGridScript = deleteGrid.getComponent(\"gridView\");\n                 //销毁的item\n                 var deleteItem = deleteGridScript.item;\n                 if (deleteItem && deleteItem.hasMark) {\n                     canShowDialog = true;\n                 }\n             }*/\n\n\n            //弹出宝箱分享弹框\n            /*if (self.deleteGrids.length >= 2) {\n                var random = Math.random();\n                console.log('随机宝箱的概率：' + random);\n                if (!Global.propInfoUI && random <= Global.randomChestWeight) {\n                    setTimeout(() => {\n                        Global.game.showPropDialog(true);\n                    }, 300);\n                }\n            }*/\n\n            //combine加分\n            console.log('连击之前的分数：' + self.gridNum);\n            var extraNum = 0;\n            if (Global.combineTimes > 0) {\n                if (Global.combineTimes > 4) {\n                    Global.combineTimes = 4;\n                }\n                /*\n                if (Global.combineTimes > 1) {\n                    //合并数大于2\n                    console.log('删除的格子数量：' + self.deleteGrids.length);\n                    if (self.deleteGrids.length > 1) {\n                        Global.combineTimes = self.deleteGrids.length + 1;\n                    }\n                }*/\n                extraNum = (Global.combineTimes - 1) * self.gridNum;\n                console.log('连击加的分数：' + extraNum);\n            }\n            console.log('连击之后的分数：' + (self.gridNum + extraNum));\n\n            var doubleNum = 0;\n            if (Global.usePropStatus == 2) {\n                console.log('使用了双倍道具,加分之前的分数：', self.gridNum + extraNum);\n                doubleNum = self.gridNum * (2 - 1);\n                console.log('双倍道具使用之后的分数:' + self.gridNum + extraNum + doubleNum);\n                Global.usePropStatus = -1;\n            }\n\n            if (self.gridNum > 4096) {\n                self.gridNum = 4096;\n            }\n\n            //弹出道具分享\n            /*if (Global.cdnGameConfig.totalSwith) {\n                var currTime = (new Date()).getTime();\n                if (Global.wxScore < Global.cdnGameConfig.newUserScore) {\n                    if ((currTime - gridControllerScript.popDialogTimes) > Global.cdnGameConfig.newUserPropCd) {\n                        if (Global.cdnGameConfig.newUserEquals && Global.cdnGameConfig.newUserEquals.indexOf(self.gridNum) > -1) {\n                            //Global.game.showPropDialog(true);\n                            gridControllerScript.popDialogTimes = currTime;\n                        }\n                    }\n                } else {\n                    var random = Math.random();\n                    if (gridControllerScript.popDialogTimes < Global.cdnGameConfig.popPropTotalTimes || random <= Global.cdnGameConfig.weightRate) {\n                        if (self.gridNum == 1024) {\n                            //Global.game.showPropDialog(true);\n                            gridControllerScript.popDialogTimes++;\n                            itemViewScript.hasMark = true;\n                        }\n                    }\n                }\n            }*/\n\n\n            console.log('deleteGrids:' + self.deleteGrids.length);\n\n            console.log('addScore', self.gridNum);\n            gridControllerScript.scoreScript.addScore(self.gridNum + extraNum + doubleNum);\n            console.log('addScore end,self.item:', self.item);\n            if (self.item) {\n                var itemViewScript = self.item.getComponent('itemView');\n                itemViewScript.bornNum = self.gridNum;\n                //缩放动画\n                var random = Math.random();\n                console.log('设置item格子的标志概率：', random, gridControllerScript.popDialogTimes, Global.cdnGameConfig.popPropTotalTimes, self.gridNum);\n                if (gridControllerScript.popDialogTimes < Global.cdnGameConfig.popPropTotalTimes || random <= Global.cdnGameConfig.weightRate) {\n                    console.log('查找mark标识', Global.cdnGameConfig.markScoreEquals, self.gridNum);\n                    if (Global.cdnGameConfig.markScoreEquals.indexOf(self.gridNum) > -1) {\n                        //Global.game.showPropDialog(true);\n                        gridControllerScript.popDialogTimes++;\n                        itemViewScript.hasMark = true;\n                        console.log('设置item格子的标志：', self.gridNum);\n                    }\n                }\n\n                console.log('updateNum');\n                itemViewScript.updateNum(-1);\n                console.log('updateColor');\n                itemViewScript.updateColor();\n                console.log('playFlyNum');\n                //飞入动画\n                self.playFlyNum();\n                console.log('playFlyGold');\n                //飞入金币\n                self.playFlyGold();\n                console.log('updateGold');\n                //gridControllerScript.updateGold(self.gridNum);\n\n                //判断是否是有角标的道具\n                //var canShowDialog = false;\n                /* for (let index = 0; index < self.deleteGrids.length; index++) {\n                     var deleteGrid = self.deleteGrids[index];\n                     var deleteGridScript = deleteGrid.getComponent(\"gridView\");\n                     //销毁的item\n                     var deleteItem = deleteGridScript.item;\n                     if (deleteItem && deleteItem.hasMark) {\n                         console.log('弹出宝箱');\n                         Global.game.showPropDialog(true);\n                     }\n                 }*/\n\n                console.log('设置item格子的合成宝箱：', self.isMarkGrid, self.gridNum);\n                if (self.isMarkGrid && Global.cdnGameConfig.scoreEquals.indexOf(self.gridNum) > -1) {\n                    Global.game.showPropDialog(true);\n                }\n            }\n        }\n    },\n\n    //开始播放飞入动画\n    playFlyNum: function () {\n        //合成一个512或者2048就播放数字向上飘的动画\n        var flyIndex = Global.canFlyNums.indexOf(parseInt(this.gridNum));\n        if (flyIndex <= -1) {\n            return;\n        }\n        // if (this.numInstance == null) {\n        this.numInstance = cc.instantiate(this.numPrefab);\n        // }\n        // if (this.numInstance.parent) {\n        //     this.numInstance.parent.removeChild(this.numInstance);\n        // }\n        this.numInstance.getComponent('flyNum').setNum(this.gridNum, Global.combineTimes);\n        this.numInstance.setPosition(cc.p(this.node.getPosition().x, this.node.getPosition().y));\n        this.node.parent.addChild(this.numInstance);\n        this.numInstance.getComponent('flyNum').toPosition(-300);\n    },\n\n    //开始播放飞入动画\n    playFlyNumToItem: function (num) {\n        var numInstance = cc.instantiate(this.numPrefab);\n\n        numInstance.getComponent('flyNum').setNum(num, Global.cdnGameConfig.bombDoubleRate);\n        numInstance.setPosition(cc.p(this.node.getPosition().x, this.node.getPosition().y));\n        this.node.parent.addChild(numInstance);\n        var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n        numInstance.getComponent('flyNum').toItemPosition(gridControllerScript.score.getPosition());\n    },\n\n    //播放钻石动画\n    playFlyGold: function () {\n        //合成一个512或者2048就播放数字向上飘的动画\n        var flyIndex = Global.canFlyGolds.indexOf(parseInt(this.gridNum));\n        if (flyIndex <= -1) {\n            return;\n        }\n        this.goldInstance = cc.instantiate(this.goldPrefab);\n        this.goldInstance.setPosition(cc.p(this.node.getPosition().x, this.node.getPosition().y));\n        this.node.parent.addChild(this.goldInstance);\n        //金币飞入到gridControllder的金币位置\n        var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n        this.goldInstance.getComponent('flyGold').toPosition(gridControllerScript.goldNode.getPosition(), this.gridNum);\n    },\n\n    //从当前的格子开始遍历\n    bianliForGrid: function () {\n        var gridViewScript = this.node.getComponent(\"gridView\");\n        //将要遍历格子的横向索引\n        var bianliHIndex = gridViewScript.hIndex;\n        //将要遍历格子的纵向索引\n        var bianliVIndex = gridViewScript.vIndex;\n\n        //遍历左边\n        this.hasSameScore(bianliHIndex - 1, bianliVIndex);\n        //遍历右边\n        this.hasSameScore(bianliHIndex + 1, bianliVIndex);\n        //遍历上边\n        this.hasSameScore(bianliHIndex, bianliVIndex - 1);\n        //遍历下边\n        this.hasSameScore(bianliHIndex, bianliVIndex + 1);\n    },\n\n    //判断是否有相同分数的格子,如果有就进行合并\n    hasSameScore: function (hIndex, vIndex) {\n        //判断是否是边界\n        if (hIndex < 0 || hIndex >= Global.hNum || vIndex < 0 || vIndex >= Global.vNum) {\n            return;\n        }\n\n        if (hIndex == this.hIndex && vIndex == this.vIndex) {\n            return;\n        }\n\n        var compareGrid = this.allGrids[hIndex][vIndex];\n        if (this.deleteGrids.indexOf(compareGrid) > -1) {\n            return;\n        }\n        var compareGridScript = compareGrid.getComponent(\"gridView\");\n\n        //判断是否有item\n        if (compareGrid && compareGridScript.item == null) {\n            return;\n        }\n\n        //判断是否是锤子道具\n        var compareItem = compareGridScript.item;\n        if (compareItem.getComponent(\"itemView\").useClear) {\n            console.log('匹配项是锤子道具111');\n            return;\n        }\n\n        //达到最大分数\n        if (compareGridScript.gridNum > Global.gridMaxScore) {\n            return;\n        }\n        if (compareGridScript.isJoin) {\n            return;\n        }\n        var gridScript = this.node.getComponent(\"gridView\");\n        if (gridScript.item && gridScript.item.getComponent(\"itemView\").useClear) {\n            console.log('当前项是锤子道具222');\n            return;\n        }\n        //钻石道具\n        var isDropProp = false;\n        // if (compareItem.getComponent(\"itemView\").isStone) {\n        //     isDropProp = true;\n        // }\n        if (compareGridScript.gridNum == gridScript.gridNum || isDropProp) {\n            this.deleteGrids.push(compareGrid);\n            compareGridScript.isDown = false;\n            this.bianliForGrid(compareGrid);\n            compareGridScript.isJoin = true;\n        }\n    },\n\n    //开始合并动作    \n    startJoin: function () {\n        var self = this;\n        self.isMarkGrid = false;\n        if (self.deleteGrids.length <= 0) {\n            return 0;\n        }\n\n        this.joinItems = [];\n        for (let index = 0; index < self.deleteGrids.length; index++) {\n            var deleteGrid = self.deleteGrids[index];\n            var deleteGridScript = deleteGrid.getComponent(\"gridView\");\n            //销毁的item\n            var deleteItem = deleteGridScript.item;\n            this.joinItems.push(deleteGridScript.item);\n\n            //判断被销毁对格子是否是加倍道具\n            if (deleteItem.useDouble) {\n                console.log('加倍道具1' + deleteGridScript.gridNum);\n                deleteItem.useDouble = false;\n                Global.usePropStatus = 2;\n            }\n            //判断自己格子是否是加倍道具\n            /*if (this.item.useDouble) {\n                console.log('加倍道具2' + this.gridNum);\n                this.item.useDouble = false;\n                Global.usePropStatus = 2;\n            }*/\n\n            //判断是否是钻石道具\n            if (deleteItem.isStone) {\n                this.goldInstance = cc.instantiate(this.goldPrefab);\n                this.goldInstance.setPosition(cc.p(this.node.getPosition().x, this.node.getPosition().y));\n                this.node.parent.addChild(this.goldInstance);\n                //金币飞入到gridControllder的金币位置\n                var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n                this.goldInstance.getComponent('flyGold').toPosition(gridControllerScript.goldNode.getPosition(), this.gridNum);\n\n                console.log('删除项是钻石道具');\n            }\n\n            if (deleteItem.hasMark) {\n                console.log('有标志');\n                self.isMarkGrid = true;\n            }\n            deleteItem.hasMark = false;\n\n            deleteItem.toJoin(this.node.getPosition());\n\n            console.log('删除item：' + deleteGridScript.gridNum, deleteGridScript.hIndex, deleteGridScript.vIndex);\n            deleteGridScript.item = null;\n            deleteGridScript.resetData();\n        }\n        //播放合并的声音\n        this.actionJoin = true;\n        this.check();\n    },\n\n    check: function () {\n        console.log('gridView check');\n        let self = this;\n        this.node.runAction(cc.sequence(cc.delayTime(0.01), cc.callFunc(function () {\n            self.checkJoinComplete();\n        })));\n    },\n\n    checkJoinComplete: function () {\n        let isComplete = true;\n        for (let index = 0; index < this.joinItems.length; index++) {\n            var deleteItem = this.joinItems[index];\n            if (deleteItem.curState > 0) {\n                isComplete = false;\n                break;\n            }\n        }\n        if (isComplete) {\n            if (this.joinItems.length > 0) {\n                Global.candropProp = true;\n            }\n            console.log('合并结束，加分数');\n            this.changeScore();\n            this.actionJoin = false;\n            this.playCombineAudio();\n        } else {\n            console.log('检查合并结束，重新check');\n            this.check();\n        }\n    },\n\n    playCombineAudio: function () {\n        cc.log('play audio');\n        if (Global.isSoundPlaying && this.combineAudio != null) {\n            this.combineID = cc.audioEngine.play(this.combineAudio, false, 1);\n            //回调\n            var self = this;\n            if (self.combineID > 0) {\n                cc.audioEngine.setFinishCallback(self.combineID, function () {\n                    self.playAudioEnd();\n                });\n            }\n        }\n    },\n    //播放声音\n    playAudioStart: function () {\n        if (this.combineID != 0) {\n            cc.audioEngine.resume(this.combineID);\n        }\n    },\n\n    //暂停声音声音\n    playAudioEnd: function () {\n        cc.audioEngine.uncache(this.combineID);\n    },\n\n    //重置数据\n    resetData: function () {\n        this.gridNum = 0;\n    },\n\n    //概率掉落道具(钻石)\n    dropStone: function (hIndex, vIndex) {\n        /*   //先判断上方是否有格子存在\n           if (vIndex >= Global.vNum) {\n               return;\n           }\n           var upGrid = this.allGrids[hIndex][vIndex];\n           if (!upGrid) return;\n           var upGridScript = upGrid.getComponent(\"gridView\");\n\n           //判断是否有item\n           if (upGridScript.item !== null) {\n               return;\n           }\n           //开始创建item\n           let item = cc.instantiate(this.itemPrefab);\n           //出生的目标点\n           item.setPosition(upGrid.getPosition());\n           var itemScript = item.getComponent('itemView');\n           itemScript.isStone = true;\n\n           itemScript.initData(0, false);\n           itemScript.updateNumForProp();\n\n           Global.gridController.addChild(item);\n           upGridScript.item = itemScript;\n\n           var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n\n           itemScript.targetGrid = this.allGrids[hIndex][vIndex];\n           Global.candropProp = false;\n\n           console.log('drop---------:', this.hIndex, this.vIndex,this.allGrids);*/\n\n\n        //itemScript.targetGrid = upGrid;\n\n        //itemScript.startDownForBorn(Global.gridDownSpeed);\n    },\n\n\n\n});"]}
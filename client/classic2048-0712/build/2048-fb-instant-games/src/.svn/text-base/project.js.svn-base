require=function r(a,s,l){function c(n,t){if(!s[n]){if(!a[n]){var e="function"==typeof require&&require;if(!t&&e)return e(n,!0);if(d)return d(n,!0);var i=new Error("Cannot find module '"+n+"'");throw i.code="MODULE_NOT_FOUND",i}var o=s[n]={exports:{}};a[n][0].call(o.exports,function(t){var e=a[n][1][t];return c(e||t)},o,o.exports,r,a,s,l)}return s[n].exports}for(var d="function"==typeof require&&require,t=0;t<l.length;t++)c(l[t]);return c}({Game:[function(e,t,n){"use strict";cc._RF.push(t,"41a6d+zz9JLm6SvBYPugiIf","Game"),cc.Class({extends:cc.Component,properties:{girdRoot:{default:null,type:cc.Prefab},bg:{default:null,type:cc.Sprite},battleRootPrefab:{default:null,type:cc.Prefab},uiRootPrefab:{default:null,type:cc.Prefab},rankPrefab:{default:null,type:cc.Prefab}},onLoad:function(){cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.renderer.enableDirtyRegion(!1);var t=this;e("LoadAtlas").loadAtlasRes("textures/gridItem/items",function(){e("LoadAtlas");t.startGame()}),Global.game=this.getComponent("Game")},startGame:function(){Global.uiScript||(Global.uiScript=cc.instantiate(this.uiRootPrefab).getComponent("uiRoot")),Global.uiScript.node.parent&&Global.uiScript.node.parent.removeChild(Global.uiScript.node),Global.uiScript.showStartUI(),this.node.addChild(Global.uiScript.node)},showShareUI:function(){Global.uiScript||(Global.uiScript=cc.instantiate(this.uiRootPrefab).getComponent("uiRoot")),Global.uiScript.node.parent&&Global.uiScript.node.parent.removeChild(Global.uiScript.node),this.node.addChild(Global.uiScript.node),Global.uiScript.showShareUI()},showRank:function(){Global.rankui||(Global.rankui=cc.instantiate(this.rankPrefab).getComponent("rankUI")),Global.rankui.node.parent&&Global.rankui.node.parent.removeChild(Global.rankui.node),Global.rankui.initData(),this.node.addChild(Global.rankui.node)},restart:function(){this.enterScene()},enterScene:function(){Global.gridController||(Global.gridController=cc.instantiate(this.girdRoot)),Global.gridController.parent&&Global.gridController.parent.removeChild(Global.gridController),this.node.addChild(Global.gridController),Global.gridController.getComponent("gridController").initGridData()}}),cc._RF.pop()},{LoadAtlas:"LoadAtlas"}],Global:[function(t,e,n){"use strict";cc._RF.push(e,"706f3NfOLBHb7CfrXxA4ezP","Global"),window.Global={hNum:5,vNum:7,itemSize:100,itemSplit:0,screenWidth:960,screenHeight:640,paddingButtom:-100,gridNumSize:24,bornXgridNum:2,gridRandomScores:[2,4,8,16,32,64],gridDownSpeed:180,moveThreshold:50,gridMaxScore:2048,combineTime:200,game:null,gridController:null,startUI:null,shareUI:null,battleRootScript:null,uiScript:null,dataScript:null,rankui:null,fbname:"",fbphoto:"",fbScore:0},cc._RF.pop()},{}],LoadAtlas:[function(t,e,n){"use strict";cc._RF.push(e,"e6954PqwupDA68Ay/f/GhDn","LoadAtlas");var i={spriteAtlas:[],loadAtlasRes:function(a,s){if(-1<this.spriteAtlas.indexOf(a))s();else{var l=this;cc.loader.loadRes(a,cc.SpriteAtlas,function(t,e){for(var n=e.getSpriteFrames(),i=[],o=0;o<n.length;o++){var r=n[o];i[r.name]=r}l.spriteAtlas[a]=i,s()})}},getSpriteFrameFromName:function(t,e){return this.spriteAtlas[t][e]}};e.exports=i,cc._RF.pop()},{}],Util:[function(t,e,n){"use strict";cc._RF.push(e,"907ddwVrcNMFoX1AupADcMj","Util");var i={randomForArray:function(t){return t&&0!=t.length?t[Math.floor(Math.random()*t.length)]:0},randomForMinAndMax:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},clampValue:function(t,e,n){return t<e?e:n<t?n:t}};e.exports=i,cc._RF.pop()},{}],battleRoot:[function(t,e,n){"use strict";cc._RF.push(e,"481f1mhoLRAd5RWbtwlzHVf","battleRoot"),cc.Class({extends:cc.Component,properties:{battle:{default:null,type:cc.Node},bg:{default:null,type:cc.Sprite}},enterBattle:function(){}}),cc._RF.pop()},{}],dataScript:[function(t,e,n){"use strict";cc._RF.push(e,"191c8YcqW9NYql3hC0bgshx","dataScript"),cc.Class({extends:cc.Component,start:function(){Global.dataScript=this.node.getComponent("dataScript"),this.getScore()},getScore:function(t,e){if("undefined"!=typeof FBInstant){Global.fbname=FBInstant.player.getName(),Global.fbphoto=FBInstant.player.getPhoto();FBInstant.getSDKVersion();FBInstant.player.getDataAsync(["maxscore","starnum"]).then(function(t){void 0!==t.maxscore?Global.fbScore=t.maxscore:Global.fbScore=0,Global.startUI&&Global.startUI.updateBestScore()})}},saveScore:function(e){if("undefined"!=typeof FBInstant&&e>Global.fbScore){FBInstant.player.setDataAsync({maxscore:e}).then(function(){Global.fbScore=maxscore});var n=Global.fbname+"_"+Global.fbphoto;FBInstant.getLeaderboardAsync("my_allrank").then(function(t){return t.setScoreAsync(e,n)}).then(function(t){}).catch(function(t){Global.game.addLogStr(t)})}}}),cc._RF.pop()},{}],gridController:[function(n,t,e){"use strict";cc._RF.push(t,"1ba5537UdpN/4pRkFoExyPm","gridController"),cc.Class({extends:cc.Component,properties:{gridPrefab:{default:null,type:cc.Prefab},itemPrefab:{default:null,type:cc.Prefab},randomScore:0,soonGridNum:{default:null,type:cc.Prefab},soonGridInstance:null,startX:0,startY:0,allGrids:[],bornGrid:null,startTouchPosition:null,deleteGrids:[],joinGrids:[],targetGrid:{default:null,type:cc.Node},maxDownTime:0,score:{default:null,type:cc.Node},isDown:!1,scoreScript:null},initGridData:function(){var t=Global.hNum*Global.itemSize+(Global.hNum-1)*Global.itemSplit,e=Global.vNum*Global.itemSize+(Global.vNum-1)*Global.itemSplit;this.startX=-Global.screenWidth/2+(Global.screenWidth-t)/2+Global.itemSize/2,this.startY=-Global.screenHeight/2+Global.paddingButtom+e-Global.itemSize,this.scoreScript=this.score.getComponent("score"),this.reset(),this.createAllGrid(),this.setTouchControl(),this.process()},process:function(){this.down();var t=this.allGrids[Global.bornXgridNum][0];if(cc.log("this.maxDownTime :"+this.maxDownTime),null!=t.getComponent("gridView").item&&this.maxDownTime<=0)return this.closeListen(),void Global.game.showShareUI();0<this.maxDownTime?this.isDown=!0:this.isDown=!1,this.gridJoin()},down:function(){for(var t=this.maxDownTime=0;t<Global.hNum;t++)for(var e=0;e<Global.vNum;e++){var n=this.resetItemAction(t,e);n>this.maxDownTime&&(this.maxDownTime=n)}},gridJoin:function(){cc.log("gridJoin");var r=this;.05<this.maxDownTime?this.node.runAction(cc.sequence(cc.delayTime(this.maxDownTime-.05),cc.callFunc(function(){r.bornGrid=null}))):r.bornGrid=null;var t=0;0<this.maxDownTime&&(t=this.maxDownTime+.05),this.node.runAction(cc.sequence(cc.delayTime(t),cc.callFunc(function(){r.clearAllJoin(),r.bornGrid=null;for(var t=0,e=0;e<Global.hNum;e++)for(var n=0;n<Global.vNum;n++){var i=r.allGrids[e][n].getComponent("gridView");if(!r.findDownNum()||r.findDownNum()&&i.isDown){var o=i.startBianli();t<o&&(t=o)}}0<t?r.node.runAction(cc.sequence(cc.delayTime(t+.05),cc.callFunc(function(){r.maxDownTime=0,r.gridJoin()}))):r.isDown?r.process():r.createItem()})))},findDownNum:function(){for(var t=0;t<Global.hNum;t++)for(var e=0;e<Global.vNum;e++){if(this.allGrids[t][e].getComponent("gridView").isDown)return!0}return!1},clearAllJoin:function(){for(var t=0;t<Global.hNum;t++)for(var e=0;e<Global.vNum;e++){this.allGrids[t][e].getComponent("gridView").isJoin=!1}},createItem:function(){var t=n("Util"),e=this.allGrids[Global.bornXgridNum][0];0==this.randomScore&&(this.randomScore=t.randomForArray(Global.gridRandomScores)),e.getComponent("gridView").item=cc.instantiate(this.itemPrefab),e.getComponent("gridView").item.setPosition(e.getPosition()),e.getComponent("gridView").gridNum=this.randomScore,e.getComponent("gridView").item.getComponent("itemView").initData(this.randomScore),this.node.addChild(e.getComponent("gridView").item),this.bornGrid=e.getComponent("gridView").item,this.setSoonGrid(),this.process()},setSoonGrid:function(){var t=n("Util");this.randomScore=t.randomForArray(Global.gridRandomScores),(!this.soonGridInstance||this.soonGridInstance&&!this.soonGridInstance.parent)&&(this.soonGridInstance=cc.instantiate(this.soonGridNum),this.node.addChild(this.soonGridInstance)),this.soonGridInstance.setPosition(120,520),this.soonGridInstance.getComponent("itemView").initData(this.randomScore)},closeListen:function(){this.node.off(cc.Node.EventType.TOUCH_START,this.nodeStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.nodeMove,this)},createAllGrid:function(){for(var t=0;t<Global.hNum;t++)for(var e=0;e<Global.vNum;e++){var n={hIndex:t,vIndex:e};this.allGrids[t]||(this.allGrids[t]=[]),this.allGrids[t][e]=this.createGrid(n)}},createGrid:function(t){var e=t.hIndex,n=t.vIndex,i=this.startX+e*Global.itemSize+e*Global.itemSplit,o=this.startY-n*Global.itemSize-n*Global.itemSplit,r=cc.instantiate(this.gridPrefab);r.setPosition(cc.p(i,o));var a=r.getComponent("gridView");return a.node.setPosition(i,o),a.setIndex(e,n),this.node.addChild(r),r},getStopPosition:function(t,e){for(var n=0,i=Global.vNum-1;0<=i;i--){var o=this.allGrids[t][i].getComponent("gridView");o&&null==o.item&&o.vIndex>e&&n++}return n},setTouchControl:function(){this.node.parent&&(this.node.on(cc.Node.EventType.TOUCH_START,this.nodeStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.nodeMove,this))},nodeStart:function(t){this.startTouchPosition=t.getLocation()},nodeMove:function(t){var e=this;if(this.bornGrid&&!cc.game.isPaused()){var n=t.getLocation(),i=n.x-e.startTouchPosition.x;if(cc.log("setTouchControl"),Math.abs(i)>Global.moveThreshold){var o=n.x<=e.startTouchPosition.x;e.startTouchPosition=n;var r=e.canMoveGrid(o);if(r){this.bornGrid.x=r.getPosition().x;var a=e.getStopPosition(r.getComponent("gridView").hIndex,r.getComponent("gridView").vIndex),s=e.allGrids[r.getComponent("gridView").hIndex][r.getComponent("gridView").vIndex+a];e.allGrids[r.getComponent("gridView").hIndex][r.getComponent("gridView").vIndex].getComponent("gridView").isDown=!1,s.getComponent("gridView").isDown=!0,this.bornGrid.getComponent("itemView").targetGrid=s,e.maxDownTime=this.bornGrid.getComponent("itemView").startDownForBorn(),cc.log(e.maxDownTime),e.node.stopAllActions(),e.gridJoin()}}var l=n.y<=e.startTouchPosition.y;cc.log("isTouchDown"+l)}},canMoveGrid:function(t){var e,n=Math.ceil(Math.abs((this.bornGrid.x-this.startX)/Global.itemSize)),i=Math.ceil(Math.abs((this.bornGrid.y-this.startY)/Global.itemSize));return t&&n<=0?null:!t&&n>=Global.hNum-1?null:(e=t?this.allGrids[n-1][i]:this.allGrids[n+1][i])&&null==e.getComponent("gridView").item?e:null},resetItemAction:function(t,e){if(null==this.allGrids[t][e].getComponent("gridView").item)return 0;var n=this.getStopPosition(t,e);if(0==n)return 0;var i=this.allGrids[t][e+n];i.getComponent("gridView").isDown=!0;var o=this.allGrids[t][e].getComponent("gridView").item.getComponent("itemView");o.targetGrid=i;var r=o.startDownForBorn(),a=this.allGrids[t][e].getComponent("gridView");return a.item=null,a.gridNum=0,r},onPauseOrResume:function(){cc.game.isPaused()?cc.game.resume():cc.game.pause()},onMainScene:function(){this.closeListen(),this.reset(),this.bornGrid&&this.bornGrid.parent&&this.bornGrid.parent.removeChild(this.bornGrid),Global.game.startGame(),cc.game.isPaused()&&cc.game.resume()},reset:function(){if(this.node.stopAllActions(),(this.randomScore=0)<this.allGrids.length){for(var t=0;t<Global.hNum;t++)for(var e=0;e<Global.vNum;e++){var n=this.allGrids[t][e],i=n.getComponent("gridView");i&&null!=i.item&&i.item.getComponent("itemView").toRemove(),n.parent&&n.parent.removeChild(n)}this.clearAllJoin()}this.allGrids=[],this.scoreScript.reset()}}),cc._RF.pop()},{Util:"Util"}],gridView:[function(t,e,n){"use strict";cc._RF.push(e,"2512d9CR5dPU5PDcD210m/E","gridView"),cc.Class({extends:cc.Component,properties:{allGrids:null,hIndex:0,vIndex:0,item:null,gridNum:0,targetGrid:{default:null,type:cc.Node},isDown:!1,moveIndex:0,sameScoreNum:0,deleteGrids:[],isJoin:!1},start:function(){},setIndex:function(t,e){this.hIndex=t,this.vIndex=e},startBianli:function(){var t=this;this.isJoin=!0;var e=Global.gridController.getComponent("gridController");this.allGrids=e.allGrids,this.deleteGrids=[],this.bianliForGrid();var n=this.startJoin();return 0<n&&this.node.runAction(cc.sequence(cc.delayTime(n-.01),cc.callFunc(function(){t.isDown=!1,0<t.deleteGrids.length&&(1==t.deleteGrids.length?t.gridNum*=2:2==t.deleteGrids.length?t.gridNum*=4:3==t.deleteGrids.length&&(t.gridNum*=8),e.scoreScript.addScore(t.gridNum),t.item.getComponent("itemView").bornNum=t.gridNum,t.item.getComponent("itemView").updateNum(),t.item.getComponent("itemView").updateColor())}))),this.isDown=!1,n},bianliForGrid:function(){var t=this.node.getComponent("gridView"),e=t.hIndex,n=t.vIndex;this.hasSameScore(e-1,n),this.hasSameScore(e+1,n),this.hasSameScore(e,n-1),this.hasSameScore(e,n+1)},hasSameScore:function(t,e){if(!(t<0||t>=Global.hNum||e<0||e>=Global.vNum||t==this.hIndex&&e==this.vIndex)){var n=this.allGrids[t][e];if(!(-1<this.deleteGrids.indexOf(n))){var i=n.getComponent("gridView");if(!(n&&null==i.item||i.gridNum>=Global.gridMaxScore||i.isJoin)){var o=this.node.getComponent("gridView");i.gridNum==o.gridNum&&(this.deleteGrids.push(n),i.isDown=!1,this.bianliForGrid(n),i.isJoin=!0)}}}},startJoin:function(){if(this.deleteGrids.length<=0)return 0;for(var t=0,e=0;e<this.deleteGrids.length;e++){var n=this.deleteGrids[e].getComponent("gridView"),i=n.item.getComponent("itemView").toJoin(this.node.getPosition());t<i&&(t=i),n.item=null,n.resetData()}return t},toDown:function(){var t=this;return null!=this.item&&(Global.gridController.getComponent("gridController").resetItemAction(t.item.hIndex,t.item.vIndex)?(t.item.getComponent("itemView").startDownForBorn(),t.item=null,t.resetData(),!0):(t.onJoinComplete(),!1))},resetData:function(){this.gridNum=0},onJoinComplete:function(){this.deleteGrids=[],Global.gridController.getComponent("gridController").createItem()}}),cc._RF.pop()},{}],itemView:[function(i,t,e){"use strict";cc._RF.push(t,"01c44mKWW1NGoVqCg7+8euj","itemView"),cc.Class({extends:cc.Component,properties:{itemSprite:{default:null,type:cc.Sprite},itemNum:{default:null,type:cc.Prefab},num1:{default:null,type:cc.Sprite},num2:{default:null,type:cc.Sprite},num3:{default:null,type:cc.Sprite},num4:{default:null,type:cc.Sprite},bornNum:0,targetGrid:null},initData:function(t){this.bornNum=t,this.setSpriteFrame()},setSpriteFrame:function(){this.updateColor(),this.updateNum()},startDownForBorn:function(){this.node.stopAllActions();var t=this.node.getPosition(),e=this.targetGrid.getPosition(),n=cc.pDistance(t,e)/Global.gridDownSpeed,i=cc.callFunc(this.callBackForJoin,this),o=cc.moveTo(n,e),r=cc.sequence(o,i);return this.node.runAction(r),n},toJoin:function(t){var e=cc.callFunc(this.toRemove,this),n=cc.pDistance(this.node.getPosition(),t)/Global.combineTime,i=cc.moveTo(n,t),o=cc.sequence(i,e);return this.node.runAction(o),n},toRemove:function(){this.node.parent&&this.node.parent.removeChild(this.node)},updateNum:function(){var t=parseInt(this.bornNum/1e3),e=parseInt(this.bornNum/100%10),n=parseInt(this.bornNum%100/10),i=parseInt(this.bornNum%10);if(0<t&&this.getSpriteNum(this.num1,t),(0<e||0<t)&&this.getSpriteNum(this.num2,e),(0<n||0<t||0<e)&&this.getSpriteNum(this.num3,n),(0<i||0<t||0<e||0<n)&&this.getSpriteNum(this.num4,i),0==t&&this.num1.setVisible(!1),0==t&&0==e&&this.num2.setVisible(!1),0==t&&0==e&&0==n&&this.num3.setVisible(!1),0<this.bornNum&&this.bornNum<9)this.num4.node.x=0;else if(10<=this.bornNum&&this.bornNum<99){var o=this.num3.node.width+this.num4.node.width;this.num3.node.x=-o/2+this.num3.node.width/2,this.num4.node.x=this.num3.node.x+this.num3.node.width/2+this.num4.node.width/2}else if(100<=this.bornNum&&this.bornNum<999){o=this.num2.node.width+this.num3.node.width+this.num4.node.width;this.num2.node.x=-o/2+this.num2.node.width/2,this.num3.node.x=this.num2.node.x+this.num2.node.width/2+this.num3.node.width/2,this.num4.node.x=this.num3.node.x+this.num3.node.width/2+this.num4.node.width/2}else if(1e3<=this.bornNum&&this.bornNum<9999){o=this.num1.node.width+this.num2.node.width+this.num3.node.width+this.num4.node.width;this.num1.node.x=-o/2+this.num1.node.width/2,this.num2.node.x=this.num1.node.x+this.num1.node.width/2+this.num2.node.width/2,this.num3.node.x=this.num2.node.x+this.num2.node.width/2+this.num3.node.width/2,this.num4.node.x=this.num3.node.x+this.num3.node.width/2+this.num4.node.width/2}},getSpriteNum:function(t,e){var n=i("LoadAtlas").getSpriteFrameFromName("textures/gridItem/items",e);t.spriteFrame=n,t.node.width=Global.gridNumSize,t.node.height=Global.gridNumSize,t.setVisible(!0)},updateColor:function(){var e=this;i("LoadAtlas").loadAtlasRes("textures/gridItem/items",function(){var t=i("LoadAtlas");e.itemSprite.spriteFrame=t.getSpriteFrameFromName("textures/gridItem/items","color1_"+e.bornNum)})},callBackForJoin:function(){var t=this.targetGrid.getComponent("gridView");t.item=this,cc.log("下落停止 item callBackForJoin"+t.hIndex),t.gridNum=this.bornNum}}),cc._RF.pop()},{LoadAtlas:"LoadAtlas"}],rankItem:[function(i,t,e){"use strict";cc._RF.push(t,"81f14kuRn5K9LTujk2+2GHB","rankItem"),cc.Class({extends:cc.Component,properties:{photo:{default:null,type:cc.Sprite},fbname:{default:null,type:cc.Label},score:{default:null,type:cc.Label},level:{default:null,type:cc.Label},levelIcon:{default:null,type:cc.Sprite}},hideAll:function(){this.levelIcon.setVisible(!1),this.level.string="",this.score.string="",this.fbname.string="",this.photo.setVisible(!1)},setScore:function(t){this.score.string=t},setNameAndPhoto:function(t){var n=this,e=t.indexOf("_");if(0<e){var i=t.substring(0,e),o=t.substring(e+1);this.photo.setVisible(!0),this.fbname.string=i,cc.loader.load(o,function(t,e){n.photo.spriteFrame=new cc.SpriteFrame(e)})}},setlevel:function(t){this.level.string=t;var e=i("LoadAtlas"),n="";1==t?n="rank_2":2==t?n="rank_3":3==t&&(n="rank_1"),""==n?this.levelIcon.setVisible(!1):(this.levelIcon.setVisible(!0),this.levelIcon.spriteFrame=e.getSpriteFrameFromName("textures/gridItem/items",n))}}),cc._RF.pop()},{LoadAtlas:"LoadAtlas"}],rankUI:[function(t,e,n){"use strict";cc._RF.push(e,"7c4f6Im+E9CPLgq3LIDqUzw","rankUI"),cc.Class({extends:cc.Component,properties:{rankPrefab:{default:null,type:cc.Prefab},content:{default:null,type:cc.Node},entries:null,itemHeight:30,arrItems:[]},start:function(){},initData:function(){if(0==this.arrItems.length)for(var t=0;t<10;t++){var e=cc.instantiate(this.rankPrefab);e.setPosition(cc.p(0,-35-t*this.itemHeight)),this.arrItems[t]=e,this.content.addChild(e)}for(var n=0;n<this.arrItems.length;n++){this.arrItems[n].getComponent("rankItem").hideAll()}this.getRank()},getRank:function(){if("undefined"!=typeof FBInstant){var e=this;FBInstant.getLeaderboardAsync("my_allrank").then(function(t){return t.getEntriesAsync()}).then(function(t){e.updateContent(t),e.getMyRank()}).catch(function(t){})}},updateContent:function(t){this.entries=t;for(var e=0;e<this.entries.length;e++){var n=this.arrItems[e],i=this.entries[e];n.getComponent("rankItem").setScore(i.getScore()),n.getComponent("rankItem").setlevel(i.getRank()),n.getComponent("rankItem").setNameAndPhoto(i.getExtraData())}},updateMyContent:function(t){if(!(parseInt(t.getRank())<=10)){var e=this.entries.length;10==e&&(e=9);var n=this.arrItems[e];n.getComponent("rankItem").setScore(t.getScore()),n.getComponent("rankItem").setlevel(t.getRank()),n.getComponent("rankItem").setNameAndPhoto(t.getExtraData())}},getMyRank:function(){if("undefined"!=typeof FBInstant){var e=this;FBInstant.getLeaderboardAsync("my_allrank").then(function(t){return t.getPlayerEntryAsync()}).then(function(t){e.updateMyContent(t)}).catch(function(t){})}},closeThis:function(){this.node.parent.removeChild(this.node)}}),cc._RF.pop()},{}],score:[function(t,e,n){"use strict";cc._RF.push(e,"125abOQvTlEBpdqjY3ndlF5","score"),cc.Class({extends:cc.Component,properties:{curLabel:{default:null,type:cc.Label},scoreNum:0,showScore:0},start:function(){this.reset()},addScore:function(t){this.scoreNum+=t},update:function(t){this.showScore>=this.scoreNum||(this.scoreNum>this.showScore+20?this.showScore+=10:this.showScore+=1,this.curLabel.string=this.showScore)},reset:function(){this.scoreNum=0,this.showScore=-1}}),cc._RF.pop()},{}],shareUI:[function(t,e,n){"use strict";cc._RF.push(e,"ab6408y4ihGvpo29uPO2m4E","shareUI"),cc.Class({extends:cc.Component,properties:{score:{default:null,type:cc.Label},isStart:!1},start:function(){Global.shareUI=this.getComponent("shareUI"),this.isStart=!0,this.showEffect(),this.updateMaxLabel()},showEffect:function(){if(this.isStart){this.node.setPosition(cc.p(-640,0));var t=cc.moveTo(.6,cc.p(0,0));this.node.runAction(t)}},updateMaxLabel:function(t){(this.score.string=t)>Global.fbScore?(this.score.string=t,Global.dataScript.saveScore(t)):this.score.string=Global.fbScore},play:function(){Global.game.enterScene()},showRankUI:function(){Global.game.showRank()},onShareGame:function(){"undefined"!=typeof FBInstant&&FBInstant.shareAsync({intent:"SHARE",image:this.getImgBase64(),text:"Protect watermelon！",data:{myReplayData:"..."}}).then(function(){})},onChallenge:function(){var t=this.getImgBase64();"undefined"!=typeof FBInstant&&FBInstant.shareAsync({intent:"INVITE",image:t,text:"I just challenged Watermelon ,Join me!",data:{myReplayData:"..."}}).then(function(){})},getImgBase64:function(){var t=cc.find("Canvas"),e=1136,n=new cc.RenderTexture(640,e);n.begin(),t._sgNode.visit(),n.end();var i=document.createElement("canvas"),o=i.getContext("2d");if(i.width=640,i.height=e,cc._renderType===cc.game.RENDER_TYPE_CANVAS){var r=n.getSprite().getTexture().getHtmlElementObj();o.drawImage(r,0,0)}else if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var a=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,a);var s=n.getSprite().getTexture()._glID;gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,s,0);var l=new Uint8Array(2908160);gl.readPixels(0,0,640,e,gl.RGBA,gl.UNSIGNED_BYTE,l),gl.bindFramebuffer(gl.FRAMEBUFFER,null);for(var c=0;c<e;c++){var d=1135-c,u=new Uint8ClampedArray(l.buffer,640*d*4,2560),h=new ImageData(u,640,1);o.putImageData(h,0,c)}}return cc.log("to share"),i.toDataURL("image/png")}}),cc._RF.pop()},{}],startUI:[function(t,e,n){"use strict";cc._RF.push(e,"bca9aXCN59LNZb12NxU6UO1","startUI"),cc.Class({extends:cc.Component,properties:{score:{default:null,type:cc.Label}},start:function(){this.updateBestScore()},updateBestScore:function(){this.score.string="BEST SCORE : "+Global.fbScore},play:function(){Global.game.enterScene()},showRankUI:function(){Global.game.showRank()},onChallenge:function(){Global.shareUI.onChallenge()}}),cc._RF.pop()},{}],uiRoot:[function(t,e,n){"use strict";cc._RF.push(e,"84c41LsrfFPsriorNv8+hdx","uiRoot"),cc.Class({extends:cc.Component,properties:{startUI:{default:null,type:cc.Node},shareUI:{default:null,type:cc.Node}},start:function(){Global.startUI=this.startUI.getComponent("startUI"),Global.shareUI=this.shareUI.getComponent("shareUI")},showStartUI:function(){this.startUI.active=!0,this.shareUI.active=!1},showShareUI:function(){this.startUI.active=!1,this.shareUI.active=!0,Global.shareUI.showEffect()}}),cc._RF.pop()},{}]},{},["Game","Global","LoadAtlas","Util","dataScript","gridController","battleRoot","rankItem","rankUI","shareUI","startUI","uiRoot","gridView","itemView","score"]);
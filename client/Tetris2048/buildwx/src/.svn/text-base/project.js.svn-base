require=function a(r,s,l){function c(o,e){if(!s[o]){if(!r[o]){var t="function"==typeof require&&require;if(!e&&t)return t(o,!0);if(d)return d(o,!0);var n=new Error("Cannot find module '"+o+"'");throw n.code="MODULE_NOT_FOUND",n}var i=s[o]={exports:{}};r[o][0].call(i.exports,function(e){var t=r[o][1][e];return c(t||e)},i,i.exports,a,r,s,l)}return s[o].exports}for(var d="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({Game:[function(t,e,o){"use strict";cc._RF.push(e,"41a6d+zz9JLm6SvBYPugiIf","Game");var n=t("./common/ThirdAPI");cc.Class({extends:cc.Component,properties:{girdRoot:{default:null,type:cc.Prefab},bg:{default:null,type:cc.Sprite},btnSound:{default:null,type:cc.Prefab},battleRootPrefab:{default:null,type:cc.Prefab},uiRootPrefab:{default:null,type:cc.Prefab},rankPrefab:{default:null,type:cc.Prefab},storePrefab:{default:null,type:cc.Prefab},revivePrefab:{default:null,type:cc.Prefab},titlePrefab:{default:null,type:cc.Prefab},titleInfoPrefab:{default:null,type:cc.Prefab}},onLoad:function(){cc._renderType,cc.game.RENDER_TYPE_CANVAS;var e=this;Global.LoadAtlas=t("LoadAtlas"),Global.LoadAtlas.loadAtlasRes("textures/gridItem/skins",function(){}),Global.LoadAtlas.loadAtlasRes("textures/gridItem/items",function(){e.startGame()}),Global.game=this.getComponent("Game")},startGame:function(){Global.uiScript||(Global.uiScript=cc.instantiate(this.uiRootPrefab).getComponent("uiRoot")),Global.uiScript.node.parent&&Global.uiScript.node.parent.removeChild(Global.uiScript.node),Global.uiScript.showStartUI(),this.node.addChild(Global.uiScript.node),this.initStoreData(),this.initTitleData(),this.initUIData()},showShareUI:function(){Global.uiScript||(Global.uiScript=cc.instantiate(this.uiRootPrefab).getComponent("uiRoot")),Global.uiScript.node.parent&&Global.uiScript.node.parent.removeChild(Global.uiScript.node),this.node.addChild(Global.uiScript.node),Global.uiScript.showShareUI()},showRank:function(){Global.rankui||(Global.rankui=cc.instantiate(this.rankPrefab).getComponent("rankUI")),Global.rankui.node.parent&&Global.rankui.node.parent.removeChild(Global.rankui.node),this.node.addChild(Global.rankui.node),Global.rankui.initData()},showStore:function(){Global.storeUI||(Global.storeUI=cc.instantiate(this.storePrefab).getComponent("UIStore")),Global.storeUI.node.parent&&Global.storeUI.node.parent.removeChild(Global.storeUI.node),this.node.addChild(Global.storeUI.node),Global.storeUI.initData()},showRevive:function(){Global.reviveUI||(Global.reviveUI=cc.instantiate(this.revivePrefab).getComponent("reviveUI")),Global.reviveUI.node.parent&&Global.reviveUI.node.parent.removeChild(Global.reviveUI.node),this.node.addChild(Global.reviveUI.node),Global.reviveUI.initData()},showTitle:function(){Global.titleUI||(Global.titleUI=cc.instantiate(this.titlePrefab).getComponent("UITitle")),Global.titleUI.node.parent&&Global.titleUI.node.parent.removeChild(Global.titleUI.node),this.node.addChild(Global.titleUI.node),Global.titleUI.initData()},showTitleInfo:function(){Global.titleInfoUI||(Global.titleInfoUI=cc.instantiate(this.titleInfoPrefab).getComponent("UITitleInfo")),Global.titleInfoUI.node.parent&&Global.titleInfoUI.node.parent.removeChild(Global.titleInfoUI.node),this.node.addChild(Global.titleInfoUI.node),Global.titleInfoUI.initData()},initUIData:function(){this.showStore(),Global.storeUI&&Global.storeUI.onClose(),this.showTitle(),Global.titleUI&&Global.titleUI.onClose()},initStoreData:function(){Global.storeData=n.loadInfo("skinstore"),null==Global.storeData&&(Global.storeData=[]),Global.skinIndex=n.loadCurrentSkin()},initTitleData:function(){null==Global.titleData&&(Global.titleData=[]),null==Global.titleDateData&&(Global.titleDateData=[]),null==Global.titleUnlockData&&(Global.titleUnlockData=[]),Global.shareData=n.loadShareData();var e=new Date(Date.now());if(Global.shareData)Global.shareData.shareDate!=e.toDateString()&&(Global.shareData={shareTimes:0,shareDate:e.toDateString()},n.saveShareData(Global.shareData.shareTimes,Global.shareData.shareDate));else{var t=new Date(Date.now());Global.shareData={shareTimes:0,shareDate:t.toDateString()},n.saveShareData(Global.shareData.shareTimes,Global.shareData.shareDate)}},saveScore:function(){if("undefined"!=typeof wx){var e=n.loadLocalScore(),o=parseInt(e.maxscore);parseInt(e.gold);n.loadScore(function(e,t){o=parseInt(e),t=parseInt(t)}),n.saveScore(o,Global.wxGold)}},playSound:function(e,i){if(Global.isBGMPlaying){var a=this;cc.loader.loadRes("audio/"+e,cc.AudioClip,function(e,t){var o=cc.instantiate(a.btnSound);a.node.addChild(o);var n=o.getComponent(cc.AudioSource);n.clip=t,n.volume=i,n.play()})}},restart:function(){this.enterScene()},enterScene:function(){Global.gridController||(Global.gridController=cc.instantiate(this.girdRoot)),Global.gridController.parent&&Global.gridController.parent.removeChild(Global.gridController),this.node.addChild(Global.gridController),Global.gridController.getComponent("gridController").initGridData()}}),cc._RF.pop()},{"./common/ThirdAPI":"ThirdApi",LoadAtlas:"LoadAtlas"}],Global:[function(e,t,o){"use strict";cc._RF.push(t,"706f3NfOLBHb7CfrXxA4ezP","Global"),window.Global={hNum:5,vNum:8,itemSize:100,soonItemSize:70,itemSplit:0,screenWidth:960,screenHeight:640,paddingButtom:-100,gridNumSize:24,bornXgridNum:2,weightScores:[{id:2,weight:11/60},{id:4,weight:11/60},{id:8,weight:11/60},{id:16,weight:11/60},{id:32,weight:11/60},{id:64,weight:5/60}],weightScores2:[{id:2,weight:16/70},{id:4,weight:15/70},{id:8,weight:12/70},{id:16,weight:12/70},{id:32,weight:5/70},{id:64,weight:5/70},{id:128,weight:5/70}],gridRandomScores:[2,4,8,16,32,64],gridRandomScores2:[],joinRandomScores:[],gridDownSpeed:1700,gridQuickDownSpeed:5e3,gridCombineDownSpeed:600,moveThreshold:125,moveDownThreshold:150,gridMaxScore:1024,combineTime:2e3,gridDownDelayTime:1,shareImages:["weixin_fenxiang-2.png","weixin_fenxiang-3.png","weixin_fenxiang-4.png","weixin_fenxiang-5.png"],shareTexts:["这游戏玩不到2万分的自己退群吧","方块界最好玩的2048，2048界最好玩的俄罗斯方块","朋友圈智商最高的一群人，已经悄悄玩起了这个","本以为，这波我必不会死，结果……","欧美玩家已经玩疯了！国内终于开放了，点击查看","来自战斗民族的游戏!","8090的回忆，俄罗斯方块重磅回归","玩这个坐过了3站，但是合成了3个2048这波不亏！","我已凑齐7个2048，来一起召唤神龙吧！","智慧与美貌并存，俄罗斯与2048双飞。","白富美都去约会了，剩下矮穷矬的我还在这里玩这个！","加班这辈子不可能加班，只能玩这个勉强维持生活酱紫"],canFlyNums:[4,8,16,32,64,128,256,512,1024,2048,4096],canFlyGolds:[1024,2048,4096],addGold:{1024:1,2048:1,4096:2},flyNumPools:[],costGold:15,LoadAtlas:null,isBGMPlaying:!0,isPaused:!1,game:null,gridController:null,startUI:null,shareUI:null,battleRootScript:null,uiScript:null,dataScript:null,rankui:null,storeUI:null,reviveUI:null,titleUI:null,titleInfoUI:null,shareReward:10,reviveTimes:0,reviveTotalTimes:1,reviveTodayTimes:10,reviveShareTimes:0,clearVNum:3,combineTimes:0,testEnabled:!1,canTest:!1,accessTime:48e4,addTimes:2,wxScore:0,wxGold:0,fbname:"",fbphoto:"",fbScore:0,skinIndex:0,storeData:null,titleData:null,titleDateData:null,titleUnlockData:null,shareData:null,titleMaxScore:0,waitToDown:.5,forJoin:.2},cc._RF.pop()},{}],LoadAtlas:[function(e,t,o){"use strict";cc._RF.push(t,"e6954PqwupDA68Ay/f/GhDn","LoadAtlas");var n={spriteAtlas:[],loadAtlasRes:function(r,s){if(-1<this.spriteAtlas.indexOf(r))s();else{var l=this;cc.loader.loadRes(r,cc.SpriteAtlas,function(e,t){for(var o=t.getSpriteFrames(),n=[],i=0;i<o.length;i++){var a=o[i];n[a.name]=a}l.spriteAtlas[r]=n,s()})}},getSpriteFrameFromName:function(e,t){return this.spriteAtlas[e][t]}};t.exports=n,cc._RF.pop()},{}],StoreItem:[function(e,t,o){"use strict";cc._RF.push(t,"a4c47PqE5hCjIciwhmBcxrv","StoreItem");var n=e("../common/ThirdAPI"),i=e("LoadAtlas");cc.Class({extends:cc.Component,properties:{bg:{default:null,type:cc.Sprite},front:{default:null,type:cc.Sprite},photo:{default:null,type:cc.Sprite},buttonBuy:{default:null,type:cc.Node},buttonState1:{default:null,type:cc.Node},buttonState2:{default:null,type:cc.Node},buttonState3:{default:null,type:cc.Node},labelname:{default:null,type:cc.Label},price:0,index:0,waretype:1,isHave:!1,isCurrent:!1},hideAll:function(){this.photo.setVisible(!1),this.bg.setVisible(!1)},setPhoto:function(e){this.photo.spriteFrame=e},setButtonState:function(e){this.buttonState1.active=!1,this.buttonState2.active=!1,this.buttonState3.active=!1,1==e?this.buttonState1.active=!0:2==e?this.buttonState2.active=!0:3==e&&(this.buttonState3.active=!0)},updateState:function(){this.isHave||(this.price,Global.wxGold)},setPrice:function(e){this.buttonState1.getChildByName("text").getComponent(cc.Label).string=e,this.price=e,Global.wxGold},setCurrent:function(e){null!=Global.storeUI&&this.isHave&&(this.isCurrent=e,this.setButtonState(e?3:2),this.isCurrent&&1==this.waretype&&(Global.storeUI.getComponent("UIStore").setCurrentItem(this.node),Global.skinIndex=this.index,n.saveCurrentSkin(Global.skinIndex)))},setWareType:function(e){this.waretype=e,this.photo.node.setContentSize(50,50)},setIsHave:function(){this.isHave=!0,this.bg.spriteFrame=i.getSpriteFrameFromName("textures/gridItem/items","skin-bg1"),this.front.spriteFrame=i.getSpriteFrameFromName("textures/gridItem/items","skin-front1"),this.setButtonState(2)},setName:function(e){this.labelname.string=e},start:function(){this.buttonBuy.on("click",this.onButtonBy,this)},onButtonBy:function(){if(Global.game.playSound("btn",.1),this.isHave)this.isCurrent||this.setCurrent(!0);else{if(!(this.price<=Global.wxGold))return void Global.storeUI.getComponent("UIStore").showTipbox("您的钻石数量不够！");Global.storeUI.getComponent("UIStore").showTipbox("购买成功！"),this.isHave=!0;for(var e=!1,t=0;t<Global.storeData.length;t++)this.index+100*this.waretype==Global.storeData[t]&&(e=!0);e||(Global.storeData.push(this.index+100*this.waretype),n.saveInfo("skinstore",Global.storeData)),Global.wxGold-=this.price,Global.storeUI.getComponent("UIStore").propScore.string=Global.wxGold,Global.game.saveScore(),Global.storeUI.getComponent("UIStore").updateStoreItemsState(),this.bg.spriteFrame=i.getSpriteFrameFromName("textures/gridItem/items","skin-bg1"),this.front.spriteFrame=i.getSpriteFrameFromName("textures/gridItem/items","skin-front1"),this.setButtonState(2),Global.titleUI&&Global.titleUI.updateItemsState(2)}}}),cc._RF.pop()},{"../common/ThirdAPI":"ThirdApi",LoadAtlas:"LoadAtlas"}],ThirdApi:[function(e,t,o){"use strict";cc._RF.push(t,"1b608fyKURJppjdi3lNiRrN","ThirdApi");var n=e("./fbAPI"),i=e("./wxAPI"),m="undefined"!=typeof wx?1:"undefined"!=typeof FBInstant?2:0;1===m&&i.initOnEnter();var p={getRank:function(e,t){if(console.log("ThirdAPI getRank",e,t),1===m){if("Friend"===t)return i.getFriendRank(e);if("Group"===t)return i.getGroupRank(e)}else if(2===m)return n.getRank(e)},shakeShort:function(e){1===m?i.shakeShort(e):2===m&&console.log("FB 平台未实现震动")},shakeLong:function(e){1===m?i.shakeLong(e):2===m&&console.log("FB 平台未实现震动")},saveScore:function(e,t){console.log("ThirdAPI saveScore",e,t),1===m?i.saveScore(e,t):2===m&&n.saveFBScore(e,t);try{var o='{ "maxscore": '+e+',\n "gold": '+t+" }";console.log("try save local score",o),cc.sys.localStorage.setItem("triline-data",o)}catch(e){console.error(e)}},loadScore:function(e){if(1===m){var t=this.loadLocalScore();e&&e(t.maxscore,t.gold)}else if(2===m)return n.getFBScore(e)},loadLocalScore:function(){var e={maxscore:0,gold:0};try{var t=cc.sys.localStorage.getItem("triline-data");console.log("storage data : "+t);var o=JSON.parse(t);o&&(e.maxscore=parseInt(o.maxscore)),o.gold&&(e.gold=parseInt(o.gold))}catch(e){console.error(e)}return e},saveReviveData:function(e){try{var t=cc.sys.localStorage.getItem("2048-revive-data"),o=JSON.parse(t);o?o.date&&o.date!=(new Date).toDateString()?(console.log("重新保存数据："+(new Date).toDateString(),Global.reviveTodayTimes),this.clearReviveData(),o={date:(new Date).toDateString(),shareTimes:Global.reviveTodayTimes}):(console.log("更新保存数据"+e),o={date:(new Date).toDateString(),shareTimes:e}):o={date:(new Date).toDateString(),shareTimes:Global.reviveTodayTimes};var n=JSON.stringify(o);console.log("try save local revive",n),cc.sys.localStorage.setItem("2048-revive-data",n)}catch(e){console.error(e)}},loadReviveData:function(){try{var e=cc.sys.localStorage.getItem("2048-revive-data");console.log("revive storage data : "+e);var t=JSON.parse(e);if(t)return t.date&&t.date==(new Date).toDateString()?parseInt(t.shareTimes):Global.reviveTodayTimes}catch(e){console.error(e)}return Global.reviveTodayTimes},clearReviveData:function(){try{cc.sys.localStorage.removeItem("triline-revive-data")}catch(e){console.error(e)}},saveShareData:function(e,t){try{var o={shareDate:t,shareTimes:e},n=JSON.stringify(o);cc.sys.localStorage.setItem("2048-share-data",n)}catch(e){console.error(e)}},loadShareData:function(){var e={shareTimes:0,shareDate:""};try{var t=cc.sys.localStorage.getItem("2048-share-data");if(t){var o=JSON.parse(t);o&&(o.shareDate&&(e.shareDate=o.shareDate),o.shareTimes&&(e.shareTimes=o.shareTimes))}}catch(e){console.error(e)}return e},clearShareData:function(){try{cc.sys.localStorage.removeItem("2048-share-data")}catch(e){console.error(e)}},clearRankData:function(){if(console.log("ThirdAPI ready clearRankData"),1===m){var e=p.loadLocalScore(),o=parseInt(e.maxscore),t=parseInt(e.gold);p.loadScore(function(e,t){o=parseInt(e),t=parseInt(t),console.log("clearRankData on ThirdAPI loadScore",o+" :: "+t)});try{var n=(new Date).getTime(),i=cc.sys.localStorage.getItem("2048-rank-data");if(i){var a=JSON.parse(i),r=parseInt(a.clearTime);if(0==r)console.log("清除排行的时间为0"),cc.sys.localStorage.setItem("2048-rank-data",JSON.stringify({clearTime:parseInt(n)})),p.saveScore(0,t);else{var s=new Date(r),l=0==s.getDay()?7:s.getDay(),c=3600*s.getHours()+60*s.getMinutes()+s.getSeconds(),d=r/1e3-86400*parseInt(l-1)-c,h=r/1e3+86400*(7-l)+(86400-c-1),u=(new Date).getTime();!(parseInt(1e3*d)<=u&&u<=parseInt(1e3*h))&&(console.log("新的一周可以清空排行榜数据"),cc.sys.localStorage.setItem("2048-rank-data",JSON.stringify({clearTime:parseInt(n)})),p.saveScore(0,t))}}else cc.sys.localStorage.setItem("2048-rank-data",JSON.stringify({clearTime:parseInt(n)})),p.saveScore(0,t)}catch(e){console.error(e)}}},clearInfo:function(e){try{cc.sys.localStorage.removeItem("triline-data"+e)}catch(e){}return[]},saveInfo:function(e,t){try{for(var o="[",n=0;n<t.length;n++)0<n&&(o+=","),o+='{"index":"'+t[n]+'"}';o+="]",cc.sys.localStorage.setItem("triline-data"+e,o)}catch(e){}},loadInfo:function(e){var t=[];try{var o=cc.sys.localStorage.getItem("triline-data"+e),n=JSON.parse(o);if(n)for(var i=0;i<n.length;i++)t.push(n[i].index)}catch(e){}return t},clearCurrentSkin:function(){try{cc.sys.localStorage.removeItem("triline-currentskin-data")}catch(e){}return[]},saveCurrentSkin:function(e){try{var t='{ "currentSkin": '+e+" }";cc.sys.localStorage.setItem("triline-currentskin-data",t)}catch(e){}},loadCurrentSkin:function(){var e=0;try{var t=cc.sys.localStorage.getItem("triline-currentskin-data"),o=JSON.parse(t);o&&(e=parseInt(o.currentSkin))}catch(e){}return e},shareGame:function(e,t,o){1===m?(t?console.log("wx has callback"):console.log("wx has no callback"),"screenshot"==e&&(e=i.getShareScreenShot()),i.shareGame(e,t,o)):2===m&&n.onShareGame(e,t)},getShareUserInfo:function(){if(1===m)return i.getShareUserInfo()},exitGame:function(){if(1===m)return i.exit()},getSystemInfo:function(){if(1===m)return i.getSystemInfo()}};t.exports=p,cc._RF.pop()},{"./fbAPI":"fbAPI","./wxAPI":"wxAPI"}],TitleItem:[function(e,t,o){"use strict";cc._RF.push(t,"cfabfmBprhLTLjGCybJs1Ft","TitleItem");var n=e("../common/ThirdAPI");cc.Class({extends:cc.Component,properties:{bg:{default:null,type:cc.Sprite},title:{default:null,type:cc.Label},description:{default:null,type:cc.Label},button:{default:null,type:cc.Node},price:0,reward:0,date:"",titleType:1,index:0,isHave:!1},onLoad:function(){this.button.on("click",this.onButton,this),this.isHave=!1,this.button.getComponent(cc.Button).interactable=!1,this.button.getChildByName("price").getComponent(cc.Label).string="未达成"},setTitle:function(e){this.title.string=e},setDescription:function(e){this.description.string=e},updateState:function(e){return!this.isHave&&(e==this.titleType&&(1==this.titleType?this.price<=Global.titleMaxScore?(this.button.getComponent(cc.Button).interactable=!0,this.button.getChildByName("price").getComponent(cc.Label).string="领取",!0):(this.button.getComponent(cc.Button).interactable=!1,this.button.getChildByName("price").getComponent(cc.Label).string="未达成",!1):2==this.titleType?this.price<=Global.storeData.length?(this.button.getComponent(cc.Button).interactable=!0,this.button.getChildByName("price").getComponent(cc.Label).string="领取",!0):(this.button.getComponent(cc.Button).interactable=!1,this.button.getChildByName("price").getComponent(cc.Label).string="未达成",!1):3==this.titleType?this.price<=Global.titleData.length?(this.button.getComponent(cc.Button).interactable=!0,this.button.getChildByName("price").getComponent(cc.Label).string="领取",!0):(this.button.getComponent(cc.Button).interactable=!1,this.button.getChildByName("price").getComponent(cc.Label).string="未达成",!1):void 0))},setUnlock:function(){this.isHave||(this.button.getComponent(cc.Button).interactable=!0,this.button.getChildByName("price").getComponent(cc.Label).string="领取")},setTitleType:function(e){this.titleType=e},setPrice:function(e){this.price=e},setReward:function(e){this.reward=e},setDate:function(e){this.date=e},setIsHave:function(){this.isHave=!0,this.button.getComponent(cc.Button).interactable=!0,this.button.getChildByName("price").getComponent(cc.Label).string="查看"},onButton:function(){if(Global.game.playSound("btn",.1),this.isHave)Global.game.showTitleInfo(),Global.titleInfoUI&&Global.titleInfoUI.initData(this.title.string,this.description.string,this.reward+"个钻石",this.date);else{this.isHave=!0;for(var e=!1,t=0;t<Global.titleData.length;t++)if(this.index==Global.titleData[t]){e=!0;break}if(!e){Global.titleData.push(this.index),n.saveInfo("title",Global.titleData);var o=new Date(Date.now());this.date=o.getFullYear()+"-"+(o.getMonth()+1)+"-"+o.getDate(),Global.titleDateData.push(this.date),n.saveInfo("title-date",Global.titleDateData),Global.titleUI.updateLabelComplete()}this.button.getChildByName("price").getComponent(cc.Label).string="查看",Global.titleUI&&Global.titleUI.updateItemsState(3),Global.game.showTitleInfo(),Global.titleInfoUI&&(Global.titleInfoUI.initData(this.title.string,this.description.string,this.reward+"个钻石",this.date),Global.titleInfoUI.addPropScore(this.reward))}}}),cc._RF.pop()},{"../common/ThirdAPI":"ThirdApi"}],UIStore:[function(e,t,o){"use strict";cc._RF.push(t,"cac97Boj5tAWr2WGIayXR8o","UIStore");e("../common/ThirdAPI");var n=e("LoadAtlas");cc.Class({extends:cc.Component,properties:{content:{default:null,type:cc.Node},buttonClose:{default:null,type:cc.Node},storeitemPrefab:{default:null,type:cc.Prefab},tipbox:{default:null,type:cc.Node},propScore:{default:null,type:cc.Label},arrItems:[],itemWidth:260,itemHeight:260},start:function(){this.buttonClose.on("click",this.onClose,this),this.initStore()},showTipbox:function(e){this.tipbox.active=!0,this.tipbox.getChildByName("text").getComponent(cc.Label).string=e},onTipButton:function(){this.tipbox.active=!1},initData:function(){this.propScore.string=Global.wxGold,this.updateStoreItemsState()},initStore:function(){this.initStoreList(),this.arrItems[0].getComponent("StoreItem").setIsHave(),console.log("已购商品列表",Global.storeData);for(var e=0;e<Global.storeData.length;e++){var t=Global.storeData[e],o=Math.floor(t/100),n=t%100;console.log("已购商品 type:"+o+"index:"+n),1==o&&this.arrItems[n].getComponent("StoreItem").setIsHave()}this.arrItems[Global.skinIndex].getComponent("StoreItem").setCurrent(!0)},initStoreList:function(){var e=[];e.push({type:1,name:"数字",photo:n.getSpriteFrameFromName("textures/gridItem/items","skin1"),price:0}),e.push({type:1,name:"富豪",photo:n.getSpriteFrameFromName("textures/gridItem/items","skin2"),price:300}),e.push({type:1,name:"甄嬛传",photo:n.getSpriteFrameFromName("textures/gridItem/items","skin3"),price:400}),e.push({type:1,name:"脑残版",photo:n.getSpriteFrameFromName("textures/gridItem/items","skin4"),price:600}),e.push({type:1,name:"扑克版",photo:n.getSpriteFrameFromName("textures/gridItem/skins","skin5"),price:800});for(var t=0;t<e.length;t++){var o=cc.instantiate(this.storeitemPrefab);o.getComponent("StoreItem").setPhoto(e[t].photo),o.getComponent("StoreItem").setWareType(e[t].type),o.getComponent("StoreItem").setPrice(e[t].price),o.getComponent("StoreItem").setName(e[t].name),this.setStoreItemPos(o,t),o.getComponent("StoreItem").index=t,o.getComponent("StoreItem").setCurrent(t==Global.skinIndex),this.content.addChild(o),this.arrItems.push(o)}this.content.height=Math.ceil(e.length/2)*this.itemHeight},updateStoreItemsState:function(){for(var e=this.arrItems,t=0;t<e.length;t++)e[t].getComponent("StoreItem").updateState()},setCurrentItem:function(e){for(var t=0;t<this.arrItems.length;t++){var o=this.arrItems[t];o!=e&&o.getComponent("StoreItem").setCurrent(!1)}},setStoreItemPos:function(e,t){t%2==0?e.setPosition(cc.p(-this.itemWidth/2,-(Math.floor(t/2)+.5)*this.itemHeight)):e.setPosition(cc.p(this.itemWidth/2,-(Math.floor(t/2)+.5)*this.itemHeight))},onClose:function(){Global.game.playSound("btn",.1),this.node.parent&&this.node.parent.removeChild(this.node)}}),cc._RF.pop()},{"../common/ThirdAPI":"ThirdApi",LoadAtlas:"LoadAtlas"}],UITitleInfo:[function(e,t,o){"use strict";cc._RF.push(t,"82a3bIh8aNF6rbVTY8W+Py8","UITitleInfo");var n=e("../common/ThirdAPI");e("LoadAtlas");cc.Class({extends:cc.Component,properties:{buttonFlaunt:{default:null,type:cc.Node},buttonClose:{default:null,type:cc.Node},titleName:{default:null,type:cc.Label},titleDescription:{default:null,type:cc.Label},titleGet:{default:null,type:cc.Label},titleDate:{default:null,type:cc.Label},labelPropScore:{default:null,type:cc.Label},iconPropScore:{default:null,type:cc.Node},goldNum:0,showGold:0},onLoad:function(){this.buttonClose.on("click",this.onClose,this),this.buttonFlaunt.on("click",this.onFlaunt,this),this.reset()},initData:function(e,t,o,n){this.labelPropScore.string=Global.wxGold,this.titleName.string=e,this.titleDescription.string=t,this.titleGet.string="获得"+o,this.titleDate.string="达成日期："+n},addPropScore:function(e){this.showGold=Global.wxGold,Global.wxGold+=e,Global.game.saveScore(),this.goldNum=Global.wxGold,this.schedule(this.updateLabel,.18),this.iconPropScore.runAction(cc.sequence(cc.scaleTo(.5,1.2),cc.scaleTo(.5,1),cc.scaleTo(.5,1.2),cc.scaleTo(.5,1)))},onClose:function(){Global.game.playSound("btn",.1),this.node.parent&&this.node.parent.removeChild(this.node)},onFlaunt:function(){Global.game.playSound("btn",.1),Global.game.playSound("btn",.1),"undefined"!=typeof FBInstant?n.shareGame(this.getImgBase64()):n.shareGame()},updateLabel:function(e){this.showGold>=this.goldNum?this.unschedule(this.updateLabel):(this.showGold+=1,this.labelPropScore.string=this.showGold)},reset:function(){this.goldNum=0,this.showGold=-1},getImgBase64:function(){var e=cc.find("Canvas"),t=parseInt(e.width),o=parseInt(e.height),n=new cc.RenderTexture(t,o);n.begin(),e._sgNode.visit(),n.end();var i=document.createElement("canvas"),a=i.getContext("2d");if(i.width=t,i.height=o,cc._renderType===cc.game.RENDER_TYPE_CANVAS){var r=n.getSprite().getTexture().getHtmlElementObj();a.drawImage(r,0,0)}else if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var s=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,s);var l=n.getSprite().getTexture()._glID;gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,l,0);var c=new Uint8Array(t*o*4);gl.readPixels(0,0,t,o,gl.RGBA,gl.UNSIGNED_BYTE,c),gl.bindFramebuffer(gl.FRAMEBUFFER,null);for(var d=4*t,h=0;h<o;h++){var u=o-1-h,m=new Uint8ClampedArray(c.buffer,u*t*4,d),p=new ImageData(m,t,1);a.putImageData(p,0,h)}}return cc.log("to share"),i.toDataURL("image/png")}}),cc._RF.pop()},{"../common/ThirdAPI":"ThirdApi",LoadAtlas:"LoadAtlas"}],UITitle:[function(e,t,o){"use strict";cc._RF.push(t,"9a2e31K6eJJqZ0x+7kyGj7s","UITitle");var r=e("../common/ThirdAPI");e("LoadAtlas");cc.Class({extends:cc.Component,properties:{content:{default:null,type:cc.Node},buttonClose:{default:null,type:cc.Node},titleitemPrefab:{default:null,type:cc.Prefab},labelComplete:{default:null,type:cc.Label},arrItems:[],itemHeight:100},onLoad:function(){this.buttonClose.on("click",this.onClose,this),this.initStoreList()},initData:function(){this.initStore()},initStore:function(){for(var e=0;e<Global.titleUnlockData.length;e++){var t=Global.titleUnlockData[e];this.arrItems[t].getComponent("TitleItem").setUnlock()}Global.titleUnlockData.length>Global.titleData.length&&Global.uiScript.startUI.getComponent("startUI").showRedDot(!0);for(var o=0;o<Global.titleData.length;o++){t=Global.titleData[o];this.arrItems[t].getComponent("TitleItem").setIsHave(),this.arrItems[t].getComponent("TitleItem").setDate(Global.titleDateData[o])}this.updateLabelComplete()},initStoreList:function(){var e=[];e.push({type:1,name:"分数小白",description:"单局得分达到",price:2e3,reward:2}),e.push({type:1,name:"分数菜鸟",description:"单局得分达到",price:5e3,reward:4}),e.push({type:1,name:"分数达人",description:"单局得分达到",price:8e3,reward:8}),e.push({type:1,name:"分数高手",description:"单局得分达到",price:1e4,reward:16}),e.push({type:1,name:"分数大师",description:"单局得分达到",price:15e3,reward:32}),e.push({type:1,name:"分数王者",description:"单局得分达到",price:2e4,reward:64}),e.push({type:2,name:"皮肤小白",description:"皮肤解锁达到",price:1,reward:1}),e.push({type:2,name:"皮肤菜鸟",description:"皮肤解锁达到",price:3,reward:5}),e.push({type:2,name:"皮肤达人",description:"皮肤解锁达到",price:8,reward:8}),e.push({type:2,name:"皮肤高手",description:"皮肤解锁达到",price:10,reward:10}),e.push({type:2,name:"皮肤大师",description:"皮肤解锁达到",price:15,reward:18}),e.push({type:2,name:"皮肤王者",description:"皮肤解锁达到",price:20,reward:20}),e.push({type:3,name:"成就小白",description:"成就解锁达到",price:1,reward:5}),e.push({type:3,name:"成就达人",description:"成就解锁达到",price:5,reward:10}),e.push({type:3,name:"成就王者",description:"成就解锁达到",price:15,reward:20});for(var t=0;t<e.length;t++){var o=cc.instantiate(this.titleitemPrefab);o.getComponent("TitleItem").setTitle(e[t].name),o.getComponent("TitleItem").setTitleType(e[t].type),o.getComponent("TitleItem").setDescription(e[t].description+e[t].price),o.getComponent("TitleItem").setPrice(e[t].price),o.getComponent("TitleItem").setReward(e[t].reward),o.getComponent("TitleItem").index=t,o.setPosition(0,-1*(t+.5)*this.itemHeight),this.content.addChild(o),this.arrItems.push(o)}this.content.height=e.length*this.itemHeight},updateLabelComplete:function(){this.labelComplete.string="完成数量"+Global.titleData.length+"/"+this.arrItems.length},updateItemsState:function(e){for(var t=this.arrItems,o=0,n=0;n<t.length;n++)if(t[n].getComponent("TitleItem").updateState(e)){o++;for(var i=!1,a=0;a<Global.titleUnlockData.length;a++)if(n==Global.titleUnlockData[a]){i=!0;break}i||(Global.titleUnlockData.push(n),r.saveInfo("title-unlock",Global.titleUnlockData))}0<o?Global.uiScript.startUI.getComponent("startUI").showRedDot(!0):Global.uiScript.startUI.getComponent("startUI").showRedDot(!1)},onClose:function(){Global.game.playSound("btn",.1),this.node.parent&&this.node.parent.removeChild(this.node)}}),cc._RF.pop()},{"../common/ThirdAPI":"ThirdApi",LoadAtlas:"LoadAtlas"}],Util:[function(e,t,o){"use strict";cc._RF.push(t,"907ddwVrcNMFoX1AupADcMj","Util");var n={randomForArray:function(e){return e&&0!=e.length?e[Math.floor(Math.random()*e.length)]:0},randomForMinAndMax:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},clampValue:function(e,t,o){return e<t?t:o<e?o:e},randomForWeight:function(e){for(var t in Global.gridRandomScores=[],e)for(var o=parseInt(1e4*e[t].weight/100),n=0;n<o;n++)Global.gridRandomScores.push(e[t].id)},getPercentString:function(e){return e<1?"0%":e<=1&&e<500?"1%":e<=501&&e<1e3?"3%":e<=1001&&e<1e4?"8%":e<=10001&&e<2e4?"15%":e<=20001&&e<3e4?"30%":e<=30001&&e<4e4?"55%":e<=40001&&e<5e4?"65%":e<=50001&&e<6e4?"75%":e<=60001&&e<7e4?"85%":e<=70001&&e<8e4?"88%":e<=80001&&e<9e4?"90%":e<=90001&&e<1e5?"95%":"99%"},getImgBase64:function(){var e=cc.find("Canvas"),t=parseInt(e.width),o=parseInt(e.height),n=new cc.RenderTexture(t,o);n.begin(),e._sgNode.visit(),n.end();var i=document.createElement("canvas"),a=i.getContext("2d");if(i.width=t,i.height=o,cc._renderType===cc.game.RENDER_TYPE_CANVAS){var r=n.getSprite().getTexture().getHtmlElementObj();a.drawImage(r,0,0)}else if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var s=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,s);var l=n.getSprite().getTexture()._glID;gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,l,0);var c=new Uint8Array(t*o*4);gl.readPixels(0,0,t,o,gl.RGBA,gl.UNSIGNED_BYTE,c),gl.bindFramebuffer(gl.FRAMEBUFFER,null);for(var d=4*t,h=0;h<o;h++){var u=o-1-h,m=new Uint8ClampedArray(c.buffer,u*t*4,d),p=new ImageData(m,t,1);a.putImageData(p,0,h)}}return cc.log("to share"),i.toDataURL("image/png")}};t.exports=n,cc._RF.pop()},{}],battleRoot:[function(e,t,o){"use strict";cc._RF.push(t,"481f1mhoLRAd5RWbtwlzHVf","battleRoot"),cc.Class({extends:cc.Component,properties:{battle:{default:null,type:cc.Node},bg:{default:null,type:cc.Sprite}},enterBattle:function(){}}),cc._RF.pop()},{}],chooseNum:[function(e,t,o){"use strict";cc._RF.push(t,"0131ek9+YdCY7cDr+bbqAsq","chooseNum"),cc.Class({extends:cc.Component,properties:{gridControllerScript:null},start:function(){this.gridControllerScript=Global.gridController.getComponent("gridController")},choose2:function(){this.gridControllerScript.randomScore=2,this.gridControllerScript.createItem2(),this.gridControllerScript.hideChooseNum()},choose4:function(){this.gridControllerScript.randomScore=4,this.gridControllerScript.createItem2(),this.gridControllerScript.hideChooseNum()},choose8:function(){this.gridControllerScript.randomScore=8,this.gridControllerScript.createItem2(),this.gridControllerScript.hideChooseNum()},choose16:function(){this.gridControllerScript.randomScore=16,this.gridControllerScript.createItem2(),this.gridControllerScript.hideChooseNum()},choose32:function(){this.gridControllerScript.randomScore=32,this.gridControllerScript.createItem2(),this.gridControllerScript.hideChooseNum()},choose64:function(){this.gridControllerScript.randomScore=64,this.gridControllerScript.createItem2(),this.gridControllerScript.hideChooseNum()},close:function(){this.gridControllerScript.createItem2(),this.gridControllerScript.hideChooseNum()}}),cc._RF.pop()},{}],dataScript:[function(e,t,o){"use strict";cc._RF.push(t,"191c8YcqW9NYql3hC0bgshx","dataScript"),cc.Class({extends:cc.Component,start:function(){Global.dataScript=this.node.getComponent("dataScript"),this.getScore()},getScore:function(e,t){if("undefined"!=typeof FBInstant){Global.fbname=FBInstant.player.getName(),Global.fbphoto=FBInstant.player.getPhoto();FBInstant.getSDKVersion();FBInstant.player.getDataAsync(["maxscore","starnum"]).then(function(e){void 0!==e.maxscore?Global.fbScore=e.maxscore:Global.fbScore=0,Global.startUI&&Global.startUI.updateBestScore()})}},saveScore:function(t){if("undefined"!=typeof FBInstant&&t>Global.fbScore){FBInstant.player.setDataAsync({maxscore:t}).then(function(){Global.fbScore=maxscore});var o=Global.fbname+"_"+Global.fbphoto;FBInstant.getLeaderboardAsync("my_allrank").then(function(e){return e.setScoreAsync(t,o)}).then(function(e){}).catch(function(e){Global.game.addLogStr(e)})}}}),cc._RF.pop()},{}],fbAPI:[function(e,t,o){"use strict";cc._RF.push(t,"60e89uyP71OPbI1HG8KK8DV","fbAPI");var n={fbname:"noname",fbphoto:null,fbScore:0,crystal:0,debugText:"FB api loaded",getFBScore:function(t){n.debugText="called getFBScore() ","undefined"!=typeof FBInstant&&(n.fbname=FBInstant.player.getName(),n.fbphoto=FBInstant.player.getPhoto(),n.debugText="try get score from fb ",FBInstant.player.getDataAsync(["maxscore"]).then(function(e){n.fbScore=e.maxscore||0,n.crystal=e.crystal||0,t&&t(n.fbScore,n.crystal),n.debugText=" get score from fb :"+n.fbScore+" crystal:"+n.crystal}).catch(function(e){n.debugText=" getDataAsysnc error\n code:"+e.code+"\n msg: "+e.message}))},saveFBScore:function(t,e){if(n.debugText="called saveFBScore() ",t){if(n.fbScore||(n.debugText="FBGlobal.fbScore not exists,return",n.fbScore=0),t=parseInt(t),n.debugText="saveFBScore :"+t,"undefined"!=typeof FBInstant)if(t>n.fbScore){n.debugText="try save score to fb :"+t,FBInstant.player.setDataAsync({maxscore:t,crystal:e}).then(function(){n.fbScore=t,n.debugText=" save score to fb player successed"}).catch(function(e){n.debugText=" setDataAsync error\n code:"+e.code+"\n msg: "+e.message});var o=n.fbname+"_"+n.fbphoto;FBInstant.getLeaderboardAsync("my_linerank").then(function(e){return n.debugText=" save score to fb successed on setScoreAsync",e.setScoreAsync(t,o)}).then(function(e){n.debugText=" save score to fb successed get entry"}).catch(function(e){n.debugText=" save score to fb rank error setScoreAsync\n code:"+e.code+"\n msg: "+e.message})}else n.debugText="not saved ,old highscore is :"+n.fbScore}else n.debugText="params maxScore not exists,return"},getRank:function(t){if(n.debugText="called getRank()","undefined"!=typeof FBInstant){n.debugText="try get fb rank",FBInstant.getLeaderboardAsync("my_linerank").then(function(e){return n.debugText=" get fb rank leaderboard",e.getEntriesAsync()}).then(function(e){n.debugText=e?" get fb rank entries :"+e.length:" no entries ",t&&t(e)}).catch(function(e){n.debugText="getLeaderboardAsync error\n code:"+e.code+"\n msg:"+e.message})}},onShareGame:function(e){n.debugText="called onShareGame()",e&&(n.debugText="get screenshot :"+e.length,"undefined"!=typeof FBInstant&&FBInstant.shareAsync({intent:"SHARE",image:e,text:"Look my score!",data:{myReplayData:"..."}}).then(function(){}).catch(function(e){n.debugText=" shareAsync error\n code:"+e.code+"\n msg: "+e.message}))},onChallenge:function(e){n.debugText="called onChallenge()",e&&(n.debugText="get screenshot :"+e.length,"undefined"!=typeof FBInstant&&FBInstant.shareAsync({intent:"INVITE",image:e,text:"I just challenged Watermelon ,Join me!",data:{myReplayData:"..."}}).then(function(){}).catch(function(e){n.debugText=" challenge shareAsync\n code:"+e.code+"\n msg: "+e.message}))}};t.exports=n,cc._RF.pop()},{}],flyGold:[function(e,t,o){"use strict";cc._RF.push(t,"3e754b7ty1Lnr0FUnSfrDyx","flyGold"),cc.Class({extends:cc.Component,properties:{num:0,Sprite:{default:null,type:cc.Sprite}},start:function(){},toPosition:function(e,t){this.num=t,this.node.stopAllActions();var o=cc.callFunc(this.finished,this),n=cc.spawn(cc.moveTo(.5,cc.p(e.x,e.y)),cc.rotateBy(.5,0)),i=cc.scaleTo(.3,2,2),a=cc.callFunc(this.updateGold,this),r=cc.sequence(n,i,a,o);this.node.runAction(r),this.node.setLocalZOrder(10)},finished:function(){this.node.stopAllActions(),this.node.parent.removeChild(this.node),this.node.destroy(),Global.gridController.getComponent("gridController").updateGold(this.num)}}),cc._RF.pop()},{}],flyNum:[function(e,t,o){"use strict";cc._RF.push(t,"13c8bLoIxNJd6hxiaJl5vN4","flyNum"),cc.Class({extends:cc.Component,properties:{num:0,numlabel:{default:null,type:cc.Label}},start:function(){},toPosition:function(e){this.node.getPosition();this.node.stopAllActions(),this.node.setScale(.5,.5);var t=cc.scaleTo(.3,1,1);this.node.runAction(t);var o=cc.callFunc(this.finished,this),n=cc.moveTo(.5,cc.p(this.node.getPosition().x,this.node.getPosition().y+150)),i=cc.sequence(n,o);this.node.runAction(i),this.node.setLocalZOrder(1e4)},setNum:function(e){this.num=e;var t="";1<Global.combineTimes&&(t="x"+Global.combineTimes),this.numlabel.string=e+""+t},finished:function(){this.node.stopAllActions(),this.node.parent.removeChild(this.node),this.node.destroy()}}),cc._RF.pop()},{}],gridController:[function(r,e,t){"use strict";cc._RF.push(e,"1ba5537UdpN/4pRkFoExyPm","gridController");var s=r("../common/ThirdAPI");cc.Class({extends:cc.Component,properties:{handLine1:{default:null,type:cc.Node},handLine2:{default:null,type:cc.Node},gridPrefab:{default:null,type:cc.Prefab},pauseNode:{default:null,type:cc.Node},chooseNode:{default:null,type:cc.Node},test_btnNode:{default:null,type:cc.Node},itemPrefab:{default:null,type:cc.Prefab},randomScore:0,soonGridNum:{default:null,type:cc.Prefab},soonGridInstance:null,startX:0,startY:0,allGrids:[],bornGrid:null,startTouchPosition:null,deleteGrids:[],joinGrids:[],targetGrid:{default:null,type:cc.Node},line:{default:null,type:cc.Sprite},goldNode:{default:null,type:cc.Node},prop:{default:null,type:cc.Node},nodesGroup:{default:null,type:cc.Node},fitOffsetY:0,propClearTime:0,score:{default:null,type:cc.Node},downGrids:[],scoreScript:null,isClickBomming:!1,clickGridNum:0,createItemIndex:0,moveItemIndex:0,startTime:0,addTimes:0},initGridData:function(){var e=cc.winSize.width/cc.winSize.height<=.56;this.fitOffsetY=0,e&&(this.fitOffsetY=40,this.nodesGroup.setPosition(0,-this.fitOffsetY),this.nodesGroup.getComponent(cc.Widget).top=this.fitOffsetY);var t=Global.hNum*Global.itemSize+(Global.hNum-1)*Global.itemSplit,o=Global.vNum*Global.itemSize+(Global.vNum-1)*Global.itemSplit;(this.startX=-Global.screenWidth/2+(Global.screenWidth-t)/2+Global.itemSize/2,this.startY=-Global.screenHeight/2+Global.paddingButtom+o-Global.itemSize+30-this.fitOffsetY,this.scoreScript=this.score.getComponent("score"),this.setHandWidthAndHeight(),this.reset(),this.createAllGrid(),this.setTouchControl(),this.process(),this.updateGold(),this.setLine(t,o),this.pauseNode.active=!1,this.chooseNode.active=!1,this.test_btnNode.active=Global.canTest,Global.canTest)&&(this.test_btnNode.getChildByName("Label").getComponent(cc.Label).string="测试 "+(Global.testEnabled?"开":"关"))},setHandWidthAndHeight:function(){var e=cc.find("Canvas");this.handLine1.width=.5*e.width,this.handLine2.width=.5*e.width},setLine:function(e,t){this.line.node.width=e+20,this.line.node.height=t+20;var o=t/2-this.startY-Global.itemSize/2;this.line.node.setPosition(cc.p(0,-o))},process:function(){this.down(),this.checkGridJoin()},down:function(){this.isDown=!1,this.downGrids=[];for(var e=0;e<Global.hNum;e++)for(var t=0;t<Global.vNum;t++)this.resetItemAction(e,t,!1)&&(this.isDown=!0);this.bornGrid&&0<this.bornGrid.getComponent("itemView").curState&&(this.isDown=!0)},checkGridJoin:function(){for(var e=this,t=0,o=0;o<this.downGrids.length;o++){0<this.downGrids[o].curState&&t++}null!=this.bornGrid&&0<this.bornGrid.getComponent("itemView").curState&&t++,null!=this.bornGrid&&0!=this.bornGrid.getComponent("itemView").curState||0!=t?this.node.runAction(cc.sequence(cc.delayTime(.5),cc.callFunc(function(){e.checkGridJoin()}))):this.gridJoin()},gridJoin:function(){var e=this;if(0<e.clickGridNum)return e.process(),void(e.clickGridNum=0);e.clearAllJoin();for(var t=!1,o=0;o<Global.hNum;o++)for(var n=0;n<Global.vNum;n++){var i=e.allGrids[o][n].getComponent("gridView");(!e.findDownNum()||e.findDownNum()&&i.isDown)&&i.startBianli()&&(t=!0)}if(t)Global.combineTimes++,console.log("要开始合并啦,combineTimes:"+Global.combineTimes),this.checkJoin();else{if(null!=e.allGrids[Global.bornXgridNum][0].getComponent("gridView").item&&!e.isDown){var a=this;return void a.node.runAction(cc.sequence(cc.delayTime(.5),cc.callFunc(function(){a.gameOver()})))}e.isDown?e.process():(Global.combineTimes=0,e.bornGrid=null,e.createItem())}},checkJoin:function(){var n=this;n.node.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){for(var e=!1,t=0;t<Global.hNum;t++)for(var o=0;o<Global.vNum;o++){if(n.allGrids[t][o].getComponent("gridView").actionJoin){e=!0;break}}e?n.checkJoin():n.joinComplete()})))},joinComplete:function(){null!=this.allGrids[Global.bornXgridNum][0].getComponent("gridView").item&&(this.isDown=!0),this.gridJoin()},findDownNum:function(){for(var e=0;e<Global.hNum;e++)for(var t=0;t<Global.vNum;t++){if(this.allGrids[e][t].getComponent("gridView").isDown)return!0}return!1},clearAllJoin:function(){for(var e=0;e<Global.hNum;e++)for(var t=0;t<Global.vNum;t++){this.allGrids[e][t].getComponent("gridView").isJoin=!1}},createItem:function(){var e=r("Util");0==this.randomScore&&(this.randomScore=e.randomForArray(Global.gridRandomScores)),Global.testEnabled?this.showChooseNum():this.createItem2()},createItem2:function(){var e=cc.instantiate(this.itemPrefab);e.setPosition(cc.p(this.allGrids[Global.bornXgridNum][0].getPosition().x,this.allGrids[Global.bornXgridNum][0].getPosition().y+Global.itemSize)),e.getComponent("itemView").initData(this.randomScore,!1),this.node.addChild(e),this.bornGrid=e;var t=Global.gridDownSpeed,o=this.getStopPosition(Global.bornXgridNum,0),n=this.allGrids[Global.bornXgridNum][o];this.bornGrid.getComponent("itemView").targetGrid=n,e.getComponent("itemView").startDownForBorn(t),this.setSoonGrid(),this.process(),this.createItemIndex++},setSoonGrid:function(){var e=r("Util"),t=Global.gridRandomScores.concat(Global.joinRandomScores);this.randomScore=e.randomForArray(t),(!this.soonGridInstance||this.soonGridInstance&&!this.soonGridInstance.parent)&&(this.soonGridInstance=cc.instantiate(this.soonGridNum),this.node.addChild(this.soonGridInstance)),this.soonGridInstance.setPosition(0,420-this.fitOffsetY),this.soonGridInstance.getComponent("itemView").initData(this.randomScore,!0)},testEnabled:function(){Global.testEnabled=!Global.testEnabled;var e=this.node.getChildByName("test_btn");e&&(e.getChildByName("Label").getComponent(cc.Label).string="测试 "+(Global.testEnabled?"开":"关"))},closeListen:function(){this.node.off(cc.Node.EventType.TOUCH_START,this.nodeStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.nodeMove,this)},createAllGrid:function(){for(var e=0;e<Global.hNum;e++)for(var t=0;t<Global.vNum;t++){var o={hIndex:e,vIndex:t};this.allGrids[e]||(this.allGrids[e]=[]),this.allGrids[e][t]=this.createGrid(o)}},createGrid:function(e){var t=e.hIndex,o=e.vIndex,n=this.startX+t*Global.itemSize+t*Global.itemSplit,i=this.startY-o*Global.itemSize-o*Global.itemSplit,a=cc.instantiate(this.gridPrefab);a.setPosition(cc.p(n,i)),a.setLocalZOrder(2e4);var r=a.getComponent("gridView");return r.node.setPosition(n,i),r.setIndex(t,o,this),this.node.addChild(a),a},itemClick:function(e){if(this.isClickBomming&&!(1<=this.clickGridNum)){var t=e.getUserData();this.clickGrid=t,this.prop.stopAllActions();var o=cc.scaleTo(.1,1,1);this.prop.runAction(o);this.clickGrid.getComponent("gridView").item.getComponent("itemView").clearItemToRemove();this.clickGrid.getComponent("gridView").item=null;for(var n=this.clickGrid.getComponent("gridView").hIndex,i=this.clickGrid.getComponent("gridView").vIndex-1;0<i;i--)this.resetItemAction(n,i,!0);if(this.clickGridNum++,this.isClickBomming=!1,Global.wxGold-=Global.costGold,"undefined"!=typeof wx){var a=s.loadLocalScore(),r=parseInt(a.maxscore);parseInt(a.gold);s.loadScore(function(e,t){r=parseInt(e),t=parseInt(t),console.log("gridController on ThirdAPI loadScore",r,parseInt(t),Global.wxGold)}),s.saveScore(r,Global.wxGold)}this.goldNode.getChildByName("label").getComponent(cc.Label).string=Global.wxGold}},clickProp:function(){if(Global.wxGold<Global.costGold)console.log("my costGold is "+Global.costGold);else if(this.isClickBomming)this.resetProp();else{var e=cc.scaleBy(.4,1.1,1.1),t=cc.scaleBy(.4,1/1.1,1/1.1),o=cc.repeat(cc.sequence(e,t),99999);this.prop.stopAllActions(),this.prop.runAction(o),this.isClickBomming=!0,this.clickGridNum=0}},resetProp:function(){this.isClickBomming=!1,this.prop.stopAllActions();var e=cc.scaleTo(.1,1,1);this.prop.runAction(e)},getStopPosition:function(e,t){for(var o=0,n=Global.vNum-1;0<=n;n--){var i=this.allGrids[e][n].getComponent("gridView");i&&null==i.item&&i.vIndex>t&&o++}return o},setTouchControl:function(){this.node.parent&&(this.node.on(cc.Node.EventType.TOUCH_START,this.nodeStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.nodeMove,this))},nodeStart:function(e){this.startTouchPosition=e.getLocation(),this.moveItemIndex=this.createItemIndex,this.moveStartX=Math.ceil(Math.abs((this.bornGrid.x-this.startX)/Global.itemSize))},nodeMove:function(e){if(this.moveItemIndex==this.createItemIndex){var t=this;if(this.bornGrid&&this.bornGrid.getComponent("itemView").canMove&&!cc.game.isPaused()&&!this.isClickBomming){var o=e.getLocation(),n=o.x-t.startTouchPosition.x,i=o.y-t.startTouchPosition.y,a=Math.round(n/Global.moveThreshold),r=Math.abs(i)>Global.moveDownThreshold,s=t.canMoveGrid(this.moveStartX+a);if(r){var l=o.y<=t.startTouchPosition.y;if(s=t.canMoveQuickDown(l)){this.bornGrid.x=s.getPosition().x;var c=t.getStopPosition(s.getComponent("gridView").hIndex,s.getComponent("gridView").vIndex),d=t.allGrids[s.getComponent("gridView").hIndex][s.getComponent("gridView").vIndex+c];t.allGrids[s.getComponent("gridView").hIndex][s.getComponent("gridView").vIndex].getComponent("gridView").isDown=!1,d.getComponent("gridView").isDown=!0,this.bornGrid.getComponent("itemView").targetGrid=d,cc.log("quick down:"+c),2!=this.bornGrid.getComponent("itemView").curState&&1!=this.bornGrid.getComponent("itemView").curState||(t.maxDownTime=this.bornGrid.getComponent("itemView").startQuickDownForBorn(Global.gridQuickDownSpeed)),t.node.stopAllActions(),t.checkGridJoin()}}else if(s){this.bornGrid.x=s.getPosition().x,cc.log("change bornGridx:"+this.bornGrid.x);c=t.getStopPosition(s.getComponent("gridView").hIndex,s.getComponent("gridView").vIndex),d=t.allGrids[s.getComponent("gridView").hIndex][s.getComponent("gridView").vIndex+c];t.allGrids[s.getComponent("gridView").hIndex][s.getComponent("gridView").vIndex].getComponent("gridView").isDown=!1,d.getComponent("gridView").isDown=!0,this.bornGrid.getComponent("itemView").targetGrid=d,this.bornGrid.getComponent("itemView").changeStateToWaitDown(Global.gridDownSpeed),t.node.stopAllActions(),t.checkGridJoin()}}}},canMoveGrid:function(e){var t=Math.ceil(Math.abs((this.bornGrid.x-this.startX)/Global.itemSize)),o=Math.ceil(Math.abs((this.bornGrid.y-this.startY)/Global.itemSize));if(e==t)return null;if(e<0||e>=Global.hNum)return null;var n=e+1,i=t-1;for(t<e&&(n=t+1,i=e-1);n<=i;){var a;if(!(a=this.allGrids[n][o])||null!=a.getComponent("gridView").item)return null;n++}return(a=this.allGrids[e][o])&&null==a.getComponent("gridView").item?a:null},canMoveQuickDown:function(e){var t=Math.ceil(Math.abs((this.bornGrid.x-this.startX)/Global.itemSize)),o=Math.ceil(Math.abs((this.bornGrid.y-this.startY)/Global.itemSize));if(!e)return null;if(o>=Global.vNum-1)return null;var n=this.allGrids[t][o+1];return n&&null==n.getComponent("gridView").item?n:null},resetItemAction:function(e,t,o){var n,i=this.allGrids[e][t].getComponent("gridView");if(null==i.item)return!1;if(0==(n=o?1:this.getStopPosition(e,t)))return!1;var a=this.allGrids[e][t+n];a.getComponent("gridView").isDown=!0;var r=i.item.getComponent("itemView");r.targetGrid=a;var s=this.isDown||0<Global.combineTimes?Global.gridCombineDownSpeed:Global.gridDownSpeed;console.log("速度："+s,Global.combineTimes);r.startDownForBorn(s);return i.item=null,i.gridNum=0,this.downGrids.push(r),!0},onPauseOrResume:function(){Global.game.playSound("btn",.1),Global.isPaused?(this.bornGrid&&this.bornGrid.resumeAllActions(),this.node.resumeAllActions(),this.pauseNode.active=!1):(this.isClickBomming&&this.resetProp(),this.bornGrid&&this.bornGrid.pauseAllActions(),this.node.pauseAllActions(),Global.isPaused=!0,this.pauseNode.active=!0,this.pauseNode.setLocalZOrder(10))},showChooseNum:function(){Global.game.playSound("btn",.1),this.chooseNode.active=!0,this.chooseNode.setLocalZOrder(1),this.bornGrid&&this.bornGrid.pauseAllActions(),this.node.pauseAllActions()},hideChooseNum:function(){Global.game.playSound("btn",.1),this.chooseNode.active=!1,this.bornGrid&&this.bornGrid.resumeAllActions(),this.node.resumeAllActions()},onRestart:function(){Global.game.playSound("btn",.1),this.closeListen(),this.reset(),this.bornGrid&&this.bornGrid.parent&&this.bornGrid.parent.removeChild(this.bornGrid),Global.game.restart()},onMainScene:function(){Global.game.playSound("btn",.1),this.closeListen(),this.reset(),this.bornGrid&&this.bornGrid.parent&&this.bornGrid.parent.removeChild(this.bornGrid),Global.game.startGame(),cc.game.isPaused()&&cc.game.resume()},updateGold:function(e){if(this.goldNode.getChildByName("label").getComponent(cc.Label).string=Global.wxGold,void 0!==Global.addGold[e]){if(!(parseInt(Global.addGold[e])<=0)){if(Global.wxGold+=parseInt(Global.addGold[e]),console.log("1 :"+Global.addGold[e]+"goldNum :"+e),"undefined"!=typeof wx){var t=s.loadLocalScore(),o=parseInt(t.maxscore);parseInt(t.gold);s.loadScore(function(e,t){o=parseInt(e),t=parseInt(t),console.log("gridController on ThirdAPI loadScore",o,parseInt(t),Global.wxGold)}),s.saveScore(o,Global.wxGold)}this.goldNode.getChildByName("label").getComponent(cc.Label).string=Global.wxGold}}else cc.log("update gold ")},gameOver:function(){this.node.stopAllActions(),this.closeListen(),Global.reviveShareTimes=s.loadReviveData(),Global.reviveTimes<Global.reviveTotalTimes&&0<Global.reviveShareTimes?(Global.game.showRevive(),Global.reviveUI.setScore(this.scoreScript.scoreNum)):(Global.game.showShareUI(),Global.shareUI.updateMaxLabel(this.scoreScript.scoreNum))},clearGridForRevive:function(){this.node.stopAllActions();for(var e=0;e<Global.hNum;e++)for(var t=0;t<Global.vNum;t++){(a=this.allGrids[e][t].getComponent("gridView"))&&null!=a.item&&(a.node.stopAllActions(),a.item.getComponent("itemView").node.stopAllActions())}for(var o=0,n=0;n<Global.hNum;n++)for(var i=0;i<Global.clearVNum;i++){var a;if((a=this.allGrids[n][i].getComponent("gridView"))&&null!=a.item){var r=a.item.getComponent("itemView").toRevive();o<r&&(o=r),a.gridNum=0,a.item=null}}this.clearAllJoin();for(var s=0;s<Global.flyNumPools.length;s++){var l=Global.flyNumPools[s];l&&l.parent&&l.getComponent("flynum").finished()}console.log("clear time:"+o);var c=this;c.node.runAction(cc.sequence(cc.delayTime(o+.1),cc.callFunc(function(){c.bornGrid&&(c.bornGrid.stopAllActions(),c.bornGrid.parent&&c.bornGrid.parent.removeChild(c.bornGrid)),c.bornGrid=null,c.setTouchControl(),c.process()})))},update:function(){(new Date).getTime()>this.startTime+Global.accessTime&&this.addTimes<Global.addTimes&&(this.addTimes++,this.startTime=(new Date).getTime(),Global.gridDownSpeed*=1.2,Global.gridDownSpeed=parseInt(100*Global.gridDownSpeed)/100,Global.waitToDown*=.8,Global.waitToDown=parseInt(100*Global.waitToDown)/100,console.log("加速",Global.gridDownSpeed,Global.waitToDown))},reset:function(){this.node.stopAllActions(),this.startTime=(new Date).getTime(),this.addTimes=0,Global.reviveTimes=0,Global.combineTimes=0,Global.testEnabled=!1,this.randomScore=0,Global.joinRandomScores=[],Global.isPaused=!1,this.isClickBomming=!1,this.propClearTime=0,this.clickGridNum=0,this.createItemIndex=0;for(var e=this.moveItemIndex=0;e<Global.flyNumPools.length;e++){var t=Global.flyNumPools[e];t&&t.parent&&t.getComponent("flynum").finished()}if(this.bornGrid&&(this.bornGrid.stopAllActions(),this.bornGrid.parent&&this.bornGrid.parent.removeChild(this.bornGrid)),0<this.allGrids.length){for(var o=0;o<Global.hNum;o++)for(var n=0;n<Global.vNum;n++){var i=this.allGrids[o][n],a=i.getComponent("gridView");i.stopAllActions(),a&&null!=a.item&&a.item.getComponent("itemView").toRemove(),i.parent&&i.parent.removeChild(i)}this.clearAllJoin()}this.allGrids=[],this.scoreScript.reset(),this.bornGrid=null,this.soonGridInstance&&this.soonGridInstance.parent&&this.soonGridInstance.parent.removeChild(this.soonGridInstance),r("Util").randomForWeight(Global.weightScores)}}),cc._RF.pop()},{"../common/ThirdAPI":"ThirdApi",Util:"Util"}],gridView:[function(e,t,o){"use strict";cc._RF.push(t,"2512d9CR5dPU5PDcD210m/E","gridView"),cc.Class({extends:cc.Component,properties:{combineAudio:{url:cc.AudioClip,default:null},numPrefab:{default:null,type:cc.Prefab},goldPrefab:{default:null,type:cc.Prefab},combineID:0,allGrids:null,hIndex:0,vIndex:0,item:null,gridNum:0,targetGrid:{default:null,type:cc.Node},isDown:!1,moveIndex:0,sameScoreNum:0,deleteGrids:[],isJoin:!1,actionJoin:!1,joinItems:[]},setIndex:function(e,t,o){this.hIndex=e,this.vIndex=t},startBianli:function(){this.joinItems=[];var e=Global.gridController.getComponent("gridController");return this.allGrids=e.allGrids,this.deleteGrids=[],this.bianliForGrid(),this.startJoin(),this.isDown=!1,0<this.joinItems.length},changeScore:function(){var e=this,t=Global.gridController.getComponent("gridController");if(e.isDown=!1,0<e.deleteGrids.length){1==e.deleteGrids.length?e.gridNum*=2:2==e.deleteGrids.length?e.gridNum*=4:3==e.deleteGrids.length&&(e.gridNum*=8),console.log("连击之前的分数："+e.gridNum);var o=0;if(0<Global.combineTimes&&(3<Global.combineTimes&&(Global.combineTimes=3),o=(Global.combineTimes-1)*e.gridNum,console.log("连击加的分数："+o)),console.log("连击之后的分数："+(e.gridNum+o)),4096<e.gridNum&&(e.gridNum=4096),console.log("deleteGrids:"+e.deleteGrids.length),console.log("addScore",e.gridNum),t.scoreScript.addScore(e.gridNum+o),console.log("addScore end,self.item:",e.item),e.item){var n=e.item.getComponent("itemView");n.bornNum=e.gridNum,console.log("updateNum"),n.updateNum(),console.log("updateColor"),n.updateColor(),console.log("playFlyNum"),e.playFlyNum(),console.log("playFlyGold"),e.playFlyGold(),console.log("updateGold")}}},playFlyNum:function(){Global.canFlyNums.indexOf(parseInt(this.gridNum))<=-1||(this.numInstance=cc.instantiate(this.numPrefab),this.numInstance.getComponent("flyNum").setNum(this.gridNum),this.numInstance.setPosition(cc.p(this.node.getPosition().x,this.node.getPosition().y)),this.node.parent.addChild(this.numInstance),this.numInstance.getComponent("flyNum").toPosition(-300))},playFlyGold:function(){if(!(Global.canFlyGolds.indexOf(parseInt(this.gridNum))<=-1)){this.goldInstance=cc.instantiate(this.goldPrefab),this.goldInstance.setPosition(cc.p(this.node.getPosition().x,this.node.getPosition().y)),this.node.parent.addChild(this.goldInstance);var e=Global.gridController.getComponent("gridController");this.goldInstance.getComponent("flyGold").toPosition(e.goldNode.getPosition(),this.gridNum)}},bianliForGrid:function(){var e=this.node.getComponent("gridView"),t=e.hIndex,o=e.vIndex;this.hasSameScore(t-1,o),this.hasSameScore(t+1,o),this.hasSameScore(t,o-1),this.hasSameScore(t,o+1)},hasSameScore:function(e,t){if(!(e<0||e>=Global.hNum||t<0||t>=Global.vNum||e==this.hIndex&&t==this.vIndex)){var o=this.allGrids[e][t];if(!(-1<this.deleteGrids.indexOf(o))){var n=o.getComponent("gridView");if(!(o&&null==n.item||n.gridNum>Global.gridMaxScore||n.isJoin)){var i=this.node.getComponent("gridView");n.gridNum==i.gridNum&&(this.deleteGrids.push(o),n.isDown=!1,this.bianliForGrid(o),n.isJoin=!0)}}}},startJoin:function(){if(this.deleteGrids.length<=0)return 0;this.joinItems=[];for(var e=0;e<this.deleteGrids.length;e++){var t=this.deleteGrids[e].getComponent("gridView"),o=t.item;this.joinItems.push(t.item),o.toJoin(this.node.getPosition()),console.log("删除item："+t.gridNum,t.hIndex,t.vIndex),t.item=null,t.resetData()}this.actionJoin=!0,this.check()},check:function(){var e=this;this.node.runAction(cc.sequence(cc.delayTime(.01),cc.callFunc(function(){e.checkJoinComplete()})))},checkJoinComplete:function(){for(var e=!0,t=0;t<this.joinItems.length;t++){if(0<this.joinItems[t].curState){e=!1;break}}e?(this.changeScore(),this.actionJoin=!1,this.playCombineAudio()):this.check()},playCombineAudio:function(){if(cc.log("play audio"),Global.isBGMPlaying&&null!=this.combineAudio){this.combineID=cc.audioEngine.play(this.combineAudio,!1,1);var e=this;0<e.combineID&&cc.audioEngine.setFinishCallback(e.combineID,function(){e.playAudioEnd()})}},playAudioStart:function(){0!=this.combineID&&cc.audioEngine.resume(this.combineID)},playAudioEnd:function(){cc.audioEngine.uncache(this.combineID)},resetData:function(){this.gridNum=0}}),cc._RF.pop()},{}],itemSound:[function(e,t,o){"use strict";cc._RF.push(t,"27471v/VpNJYrYVSq/9nJTi","itemSound"),cc.Class({extends:cc.Component,properties:{sound:{default:null,type:cc.AudioSource}},start:function(){var e=this;this.node.runAction(cc.sequence(cc.delayTime(2),cc.callFunc(function(){e.destoryThis()})))},destoryThis:function(){this.destroy(),this.node.parent.removeChild(this)}}),cc._RF.pop()},{}],itemView:[function(r,e,t){"use strict";cc._RF.push(e,"01c44mKWW1NGoVqCg7+8euj","itemView"),cc.Class({extends:cc.Component,properties:{itemSprite:{default:null,type:cc.Sprite},itemNum:{default:null,type:cc.Prefab},downAudio:{url:cc.AudioClip,default:null},num1:{default:null,type:cc.Sprite},num2:{default:null,type:cc.Sprite},num3:{default:null,type:cc.Sprite},num4:{default:null,type:cc.Sprite},numPrefab:{default:null,type:cc.Prefab},goldPrefab:{default:null,type:cc.Prefab},isSoonItem:!1,bornNum:0,targetGrid:null,numInstance:null,goldInstance:null,curState:0,canMove:!0},initData:function(e,t){this.isSoonItem=t,this.bornNum=e,this.setSpriteFrame()},setSpriteFrame:function(){this.updateColor(),this.updateNum()},changeStateToWaitDown:function(e){if(cc.log(this.curState),1!=this.curState)if(3!=this.curState){if(!(3<this.curState)&&Global.gridController.getComponent("gridController").bornGrid==this.node&&0<this.curState){this.curState=1,this.node.stopAllActions(),this.forjoinaction=null;var t=this;this.node.runAction(cc.sequence(cc.delayTime(Global.waitToDown),cc.callFunc(function(){t.startDownForBorn(e)})))}}else this.startDownForBorn(e)},canDown:function(){for(var e=this.node.getPosition(),t=this.targetGrid.getPosition(),o=e.y,n=cc.pDistance(e,t),i=Math.floor(n/Global.itemSize),a=this.targetGrid.getComponent("gridView").hIndex,r=this.targetGrid.getComponent("gridView").vIndex,s=i<=1?0:i,l=Global.gridController.getComponent("gridController").allGrids,c=r-s;c<=r;c++){if(o>l[a][c].getPosition().y)return!0}return!1},startDownForBorn:function(e){this.curState=2;for(var t=this.node.getPosition(),o=this.targetGrid.getPosition(),n=cc.pDistance(t,o),i=Math.floor(n/Global.itemSize),a=cc.callFunc(this.callBackForJoin,this),r=this.targetGrid.getComponent("gridView").hIndex,s=this.targetGrid.getComponent("gridView").vIndex,l=t.y,c=[],d=0,h=i<=1?0:i,u=Global.gridController.getComponent("gridController").allGrids,m=s-h;m<=s;m++)if(-1!=m){if(0<c.length){var p=cc.delayTime(Global.gridDownDelayTime);c.push(p),d+=Global.gridDownDelayTime}var g=u[r][m],f=Math.abs(l-g.getPosition().y)/e;if(0!=f){l+=g.getPosition().y-l,d+=f;var b=cc.moveTo(f,g.getPosition());c.push(b)}}if(c.push(a),cc.log(this.curState),c.length<=1)return console.log("处理异常"),null==this.forjoinaction&&(this.curState=4,this.node.runAction(a)),0;console.log("actions.length = 0"),null!=this.forjoinaction&&(console.log("this.forjoinaction != null"+c.length),this.node.stopAction(this.forjoinaction),this.forjoinaction=null);var G=cc.sequence(c);return this.node.runAction(G),d},startQuickDownForBorn:function(e){this.curState=5,this.node.stopAllActions();var t=this.node.getPosition(),o=this.targetGrid.getPosition(),n=cc.pDistance(t,o)/e,i=cc.moveTo(n,o),a=cc.callFunc(this.callBackForJoin,this),r=cc.sequence(i,a);return this.node.runAction(r),n},toRemove:function(){this.node.stopAllActions(),this.node.parent&&this.node.parent.removeChild(this.node),this.node.targetOff(this),this.curState=0},toRevive:function(){this.node.stopAllActions();var e=cc.callFunc(this.toRemove,this),t=cc.blink(1,2),o=cc.sequence(t,e);return this.node.runAction(o),t.getDuration()+.01},clearItemToRemove:function(){this.node.stopAllActions();var e=cc.callFunc(this.toRemove,this),t=cc.spawn(cc.rotateBy(.5,360,360),cc.sequence(cc.scaleTo(.5,.5),cc.scaleTo(.5,0)));return this.node.runAction(cc.sequence(t,e)),500},updateNum:function(){if(0==Global.skinIndex){var e=parseInt(this.bornNum/1e3),t=parseInt(this.bornNum/100%10),o=parseInt(this.bornNum%100/10),n=parseInt(this.bornNum%10);if(0<e&&this.getSpriteNum(this.num1,e),(0<t||0<e)&&this.getSpriteNum(this.num2,t),(0<o||0<e||0<t)&&this.getSpriteNum(this.num3,o),(0<n||0<e||0<t||0<o)&&this.getSpriteNum(this.num4,n),0==e&&this.num1.setVisible(!1),0==e&&0==t&&this.num2.setVisible(!1),0==e&&0==t&&0==o&&this.num3.setVisible(!1),0<this.bornNum&&this.bornNum<9)this.num4.node.x=0;else if(10<=this.bornNum&&this.bornNum<99){var i=this.num3.node.width+this.num4.node.width;this.num3.node.x=-i/2+this.num3.node.width/2,this.num4.node.x=this.num3.node.x+this.num3.node.width/2+this.num4.node.width/2}else if(100<=this.bornNum&&this.bornNum<999){i=this.num2.node.width+this.num3.node.width+this.num4.node.width;this.num2.node.x=-i/2+this.num2.node.width/2,this.num3.node.x=this.num2.node.x+this.num2.node.width/2+this.num3.node.width/2,this.num4.node.x=this.num3.node.x+this.num3.node.width/2+this.num4.node.width/2}else if(1e3<=this.bornNum&&this.bornNum<9999){i=this.num1.node.width+this.num2.node.width+this.num3.node.width+this.num4.node.width;this.num1.node.x=-i/2+this.num1.node.width/2+6,this.num2.node.x=this.num1.node.x+this.num1.node.width/2+this.num2.node.width/2-3,this.num3.node.x=this.num2.node.x+this.num2.node.width/2+this.num3.node.width/2-3,this.num4.node.x=this.num3.node.x+this.num3.node.width/2+this.num4.node.width/2-3}}else{console.log("皮肤",Global.skinIndex,this.bornNum,"skin"+(Global.skinIndex+1)+"_"+this.bornNum);var a=r("LoadAtlas");this.num4.spriteFrame=a.getSpriteFrameFromName("textures/gridItem/skins","skin"+(Global.skinIndex+1)+"_"+this.bornNum),this.num4.node.scaleX=this.isSoonItem?.7:1,this.num4.node.scaleY=this.isSoonItem?.7:1}},getSpriteNum:function(e,t){var o=r("LoadAtlas").getSpriteFrameFromName("textures/gridItem/items",t);e.spriteFrame=o,e.node.width=o.getRect().width,e.node.height=o.getRect().height,e.node.scaleX=999<this.bornNum||this.isSoonItem?.8:1,e.node.scaleY=999<this.bornNum||this.isSoonItem?.8:1,e.setVisible(!0)},updateColor:function(){var o=this;r("LoadAtlas").loadAtlasRes("textures/gridItem/items",function(){var e=r("LoadAtlas");o.itemSprite.spriteFrame=e.getSpriteFrameFromName("textures/gridItem/items","color1_"+o.bornNum);var t=Global.soonItemSize;99<o.bornNum?t=90:999<o.bornNum&&(t=Global.itemSize),o.itemSprite.node.width=o.isSoonItem?t:Global.itemSize,o.itemSprite.node.height=o.isSoonItem?t:Global.itemSize})},callBackForJoin:function(){this.curState<3&&(this.curState=3);var e=this,t=Global.forJoin;this.canMove||(t/=3),this.forjoinaction=cc.sequence(cc.delayTime(t),cc.callFunc(function(){e.forJoin()})),this.node.runAction(this.forjoinaction)},toJoin:function(e){this.curState=4;var t=cc.callFunc(this.toRemove,this),o=cc.pDistance(this.node.getPosition(),e)/Global.combineTime,n=cc.moveTo(o,e),i=cc.delayTime(.1),a=cc.sequence(i,n,t);this.node.runAction(a)},forJoin:function(){if(console.log("forJoin"),this.canDown())this.startDownForBorn(Global.gridDownSpeed);else{this.node.stopAllActions();var e=(o=Global.gridController.getComponent("gridController")).downGrids.indexOf(this.getComponent("itemView"));0<=e&&o.downGrids.splice(e,1);var t=this.targetGrid.getComponent("gridView");(t.item=this).node.setPosition(cc.p(t.node.getPosition())),cc.log("下落停止 item callBackForJoin ："+t.hIndex+" :: "+t.vIndex+"node pos X"+this.node.x+"  node pos Y"+this.node.y),t.gridNum=this.bornNum;var o=Global.gridController.getComponent("gridController");this.node.on("itemclick",o.itemClick,o),this.node.on(cc.Node.EventType.TOUCH_START,this.touchStart,this),this.playDownAudio(),this.canMove=!1,this.curState=0}},touchStart:function(){cc.log("itemclick");var e=new cc.Event.EventCustom("itemclick",!0);e.setUserData(this.targetGrid),this.node.dispatchEvent(e)},playDownAudio:function(){if(cc.log("play down audio"),Global.isBGMPlaying&&null!=this.downAudio){this.combineID=cc.audioEngine.play(this.downAudio,!1,1);var e=this;0<e.combineID&&cc.audioEngine.setFinishCallback(e.combineID,function(){e.playAudioEnd()})}},playAudioStart:function(){0!=this.combineID&&cc.audioEngine.resume(this.combineID)},playAudioEnd:function(){cc.audioEngine.uncache(this.combineID)}}),cc._RF.pop()},{LoadAtlas:"LoadAtlas"}],pauseUI:[function(e,t,o){"use strict";cc._RF.push(t,"96eabSGlhpIBpRDsG7NBH5N","pauseUI"),cc.Class({extends:cc.Component,properties:{soundOnBtn:{default:null,type:cc.Node},soundOffBtn:{default:null,type:cc.Node}},onLoad:function(){this.initAudio()},initAudio:function(){this.soundOnBtn.active=Global.isBGMPlaying,this.soundOffBtn.active=!Global.isBGMPlaying},toHome:function(){Global.game.playSound("btn",.1),Global.isPaused=!1,Global.gridController.getComponent("gridController").onMainScene()},play:function(){Global.game.playSound("btn",.1);var e=Global.gridController.getComponent("gridController");Global.isPaused?(e.bornGrid&&e.bornGrid.resumeAllActions(),e.node.resumeAllActions(),this.node.active=!1,Global.isPaused=!1):(e.bornGrid.pauseAllActions(),e.node.pauseAllActions(),this.node.active=!0,this.node.setLocalZOrder(1))},replay:function(){Global.game.playSound("btn",.1),Global.gridController.getComponent("gridController").onRestart()},close:function(){this.play()},switchBGM:function(){Global.game.playSound("btn",.1),Global.startUI.switchBGM(),this.initAudio()}}),cc._RF.pop()},{}],rankItem:[function(n,e,t){"use strict";cc._RF.push(e,"81f14kuRn5K9LTujk2+2GHB","rankItem"),cc.Class({extends:cc.Component,properties:{bg:{default:null,type:cc.Node},photo:{default:null,type:cc.Sprite},fbname:{default:null,type:cc.Label},score:{default:null,type:cc.Label},level:{default:null,type:cc.Label},levelIcon:{default:null,type:cc.Sprite}},hideAll:function(){this.bg.setCascadeOpacityEnabled(!0),this.bg.setOpacity(76.5),this.score.string="",this.fbname.string="",this.photo.setVisible(!1)},setScore:function(e){this.score.string=e},setNameAndPhoto:function(e){var o=this,t=e.indexOf("_");if(0<t){var n=e.substring(0,t),i=e.substring(t+1);this.photo.setVisible(!0),this.fbname.string=n,cc.loader.load(i,function(e,t){o.photo.spriteFrame=new cc.SpriteFrame(t)})}},setlevel:function(e){this.level.string=e;var t=n("LoadAtlas"),o="";0<e&&e<=3&&(o="rank_"+e),""==o?this.levelIcon.setVisible(!1):(this.levelIcon.setVisible(!0),this.levelIcon.spriteFrame=t.getSpriteFrameFromName("textures/gridItem/items",o))}}),cc._RF.pop()},{LoadAtlas:"LoadAtlas"}],rankUI:[function(e,t,o){"use strict";cc._RF.push(t,"7c4f6Im+E9CPLgq3LIDqUzw","rankUI");var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=e("../common/ThirdAPI");cc.Class({extends:cc.Component,properties:{top1:{default:null,type:cc.Node},top2:{default:null,type:cc.Node},rankPrefab:{default:null,type:cc.Prefab},innerview:{default:null,type:cc.Node},scrollView:{default:null,type:cc.Node},content:{default:null,type:cc.Node},btn_group:{default:null,type:cc.Node},myrankNode:{default:null,type:cc.Node},myrankBg:{default:null,type:cc.Sprite},myrankSpr:{default:null,type:cc.Sprite},entries:null,itemHeight:30,arrItems:[]},start:function(){},onLoad:function(){"undefined"!=typeof wx?(this.lbl_btn_group=this.btn_group.getChildByName("Label").getComponent(cc.Label),this.btn_group.active=!0,this.lbl_btn_group.string="查看群排行",this.showType=1,this.myrankNode.active=!0):(this.btn_group.active=!1,this.myrankNode.active=!1,this.scrollView.height=780,this.scrollView.y=-27),this.setHandWidthAndHeight()},setHandWidthAndHeight:function(){var e=cc.find("Canvas");this.top1.width=.5*e.width,this.top2.width=.5*e.width},onBtnGroupClick:function(){1==this.showType?(this.showType=2,this.lbl_btn_group.string="查看好友排行",this.getGroupRank()):(this.showType=1,this.lbl_btn_group.string="查看群排行",this.getFriendRank())},initData:function(){this.scrollView.getComponent(cc.ScrollView).scrollToTop(0);var e=cc.instantiate(this.rankPrefab).height+5;if(this.content.height=20*e,console.log("content width:"+this.content.width),this.content.getChildByName("sprite").height=20*e,0==this.arrItems.length)for(var t=0;t<20;t++){var o=cc.instantiate(this.rankPrefab);o.setLocalZOrder(-1),o.setPosition(cc.p(0,-.5*e-t*e)),this.arrItems[t]=o,this.content.addChild(o)}for(var n=0;n<this.arrItems.length;n++){var i=this.arrItems[n];i.getComponent("rankItem").setlevel(n+1),i.getComponent("rankItem").hideAll()}if("undefined"!=typeof wx){for(var a=0;a<this.arrItems.length;a++){this.arrItems[a].getComponent("rankItem").level.node.active=!1}this.getFriendRank()}else"undefined"!=typeof FBInstant&&this.getRank()},getFriendRank:function(){var t=this;console.log("getFriendRank");var e=this.content.getChildByName("sprite"),o=e.width,n=e.height,i=this.innerview.x-.5*o,a=this.innerview.y-.5*n;this.drawRect={x:i,y:a,width:o,height:n},console.log("draw rect:",this.drawRect,"this.content.width :"+this.content.width,"this.innerview.width"+this.innerview.width+"sprite.width :"+e.width),s.getRank({rect:this.drawRect,callback:function(e){"object"===(void 0===e?"undefined":r(e))?t.updateContent(e):"string"==typeof e&&(t.updateWxRank=100)}},"Friend")},getGroupRank:function(){var t=this;console.log("getGroupRank");var e=this.content.getChildByName("sprite"),o=e.width,n=e.height,i=this.innerview.x-.5*o,a=this.innerview.y-.5*n;this.drawRect={x:i,y:a,width:o,height:n},console.log("draw rect:",this.drawRect),this.cleanRank(),s.getRank({rect:this.drawRect,callback:function(e){console.log("getGroupRank,oncallback",e),"object"===(void 0===e?"undefined":r(e))?t.updateContent(e):"string"==typeof e&&("success"==e?t.updateWxRank=1:"failed"==e?(t.showType=1,t.lbl_btn_group.string="查看群排行",t.cleanRank(),t.getFriendRank()):t.updateWxRank=1)}},"Group")},getRank:function(){if("undefined"!=typeof FBInstant){var t=this;FBInstant.getLeaderboardAsync("my_allrank").then(function(e){return e.getEntriesAsync()}).then(function(e){t.updateContent(e),t.getMyRank()}).catch(function(e){})}},updateContent:function(e){if(e){this.entries=e;for(var t=0;t<this.entries.length;t++){var o=this.arrItems[t];if(o){var n=this.entries[t];o.getComponent("rankItem").setScore(n.getScore()),o.getComponent("rankItem").setlevel(n.getRank()),o.getComponent("rankItem").setNameAndPhoto(n.getExtraData())}}}else for(var i=0;i<this.arrItems.length;i++){var a=this.arrItems[i];a&&(a.active=fasle)}},updateMyContent:function(e){if(!(parseInt(e.getRank())<=10)){var t=this.entries.length;10==t&&(t=9);var o=this.arrItems[t];o.getComponent("rankItem").setScore(e.getScore()),o.getComponent("rankItem").setlevel(e.getRank()),o.getComponent("rankItem").setNameAndPhoto(e.getExtraData())}},cleanRank:function(){this.content.getChildByName("sprite").getComponent(cc.Sprite).spriteFrame=null},closeThis:function(){this.node.parent&&this.node.parent.removeChild(this.node)},update:function(e){if(this.updateWxRank&&100<this.updateWxRank){console.log("redraw wx rank"),this.updateWxRank=1;var t=wx.getOpenDataContext().canvas,o=new cc.Texture2D;o.initWithElement(t),o.handleLoadedTexture();var n=new cc.SpriteFrame(o);console.log("texture.width :"+o.width,o.height+" :: "+this.content.width);var i=this.content.getChildByName("sprite");i.getComponent(cc.Sprite).type=cc.Sprite.Type.TILED,i.width=o.width,i.height=o.height-90,i.getComponent(cc.Sprite).spriteFrame=n,this.myrankSpr.spriteFrame=n,this.myrankSpr.node.height=o.height}else this.updateWxRank++}}),cc._RF.pop()},{"../common/ThirdAPI":"ThirdApi"}],reviveUI:[function(t,e,o){"use strict";cc._RF.push(e,"02f0eykHTVElayNfHnNwExV","reviveUI");var n=t("../common/ThirdAPI");cc.Class({extends:cc.Component,properties:{sLabel:{default:null,type:cc.Label},lbl_countdown:{default:null,type:cc.Label},tip:{default:null,type:cc.Label},scoreNum:0},start:function(){},initData:function(){this.startContinueConutDown(),this.tip.node.active=!1},startContinueConutDown:function(){var e=this,t=10;this.lbl_countdown.string=t,this.pauseInterval=!1,this.countDownInterval=setInterval(function(){e.pauseInterval||(0<=--t?e.lbl_countdown.string=t:(e.giveUpShare(),clearInterval(e.countDownInterval)))},1e3)},setScore:function(e){this.scoreNum=e,"undefined"!=typeof wx?this.sLabel.string="当前分数："+this.scoreNum:this.sLabel.string="current score:"+this.scoreNum},shareGame:function(){if(Global.game.playSound("btn",.1),this.tip.node.active=!1,this.pauseInterval=!0,"undefined"!=typeof FBInstant){var e=t("Util");n.shareGame(e.getImgBase64(),this.onShareSuccess.bind(this))}else"undefined"!=typeof wx?(console.log("----------------复活分享-----------------"),n.shareGame(null,this.onShareSuccess.bind(this),this.onShareFailed.bind(this))):(console.log("----------------直接复活-----------------"),this.onShareSuccess())},onShareSuccess:function(e){this.node.parent&&this.node.parent.removeChild(this.node),this.pauseInterval=!1,clearInterval(this.countDownInterval),Global.reviveShareTimes--,-1<Global.reviveShareTimes&&n.saveReviveData(Global.reviveShareTimes),Global.reviveTimes++,Global.gridController.getComponent("gridController").clearGridForRevive()},onShareFailed:function(){this.pauseInterval=!1},giveUpShare:function(){Global.game.playSound("btn",.1),this.node.parent&&this.node.parent.removeChild(this.node),this.pauseInterval=!1,clearInterval(this.countDownInterval),Global.game.showShareUI(),Global.shareUI.updateMaxLabel(this.scoreNum)}}),cc._RF.pop()},{"../common/ThirdAPI":"ThirdApi",Util:"Util"}],score:[function(t,e,o){"use strict";cc._RF.push(e,"125abOQvTlEBpdqjY3ndlF5","score");var n=t("../common/ThirdAPI");cc.Class({extends:cc.Component,properties:{curLabel:{default:null,type:cc.Label},scoreNum:0,showScore:0},start:function(){this.reset()},addScore:function(e){(this.scoreNum+=e,this.scoreNum>Global.wxScore&&(console.log("from socre.js add score:",Global.wxScore,Global.wxGold),Global.wxScore=this.scoreNum,n.saveScore(Global.wxScore,Global.wxGold)),1e4<this.scoreNum)&&t("Util").randomForWeight(Global.weightScores2)},update:function(e){this.showScore>=this.scoreNum||(this.scoreNum>this.showScore+100?this.showScore+=20:this.scoreNum>this.showScore+20?this.showScore+=10:this.showScore+=1,this.curLabel.string=this.showScore)},reset:function(){this.scoreNum=0,this.showScore=-1}}),cc._RF.pop()},{"../common/ThirdAPI":"ThirdApi",Util:"Util"}],shareUI:[function(a,e,t){"use strict";cc._RF.push(e,"ab6408y4ihGvpo29uPO2m4E","shareUI");var r=a("../common/ThirdAPI");cc.Class({extends:cc.Component,properties:{bg:{default:null,type:cc.Node},line1:{default:null,type:cc.Node},line2:{default:null,type:cc.Node},currScore:{default:null,type:cc.Label},score:{default:null,type:cc.Label},personPer:{default:null,type:cc.Label},btn_label:{default:null,type:cc.Label},node_gold:{default:null,type:cc.Node},fly_node:{default:null,type:cc.Node},lbl_gold:{default:null,type:cc.Label},lbl_fly:{default:null,type:cc.Label},soundOnBtn:{default:null,type:cc.Node},soundOffBtn:{default:null,type:cc.Node},backgroundAudio:{url:cc.AudioClip,default:null},tipbox:{default:null,type:cc.Node},buttonstate0:{default:null,type:cc.Node},buttonstate1:{default:null,type:cc.Node},hasShardReward:!0,isStart:!1},start:function(){Global.shareUI=this.getComponent("shareUI"),this.setBackground(),this.isStart=!0},initData:function(){this.hasShardReward=!0,this.showEffect(),this.setBackground(),this.buttonstate0.active=!!(this.hasShardReward&&Global.shareData.shareTimes<5),this.buttonstate1.active=!(this.hasShardReward&&Global.shareData.shareTimes<5)},showTipbox:function(){this.tipbox.active=!0},onTipButton:function(){this.tipbox.active=!1},setBackground:function(){var e=cc.find("Canvas");this.bg.width=e.width,this.line1.width=e.width,this.line2.width=e.width,console.log("width:",this.bg.width,this.line1.width,this.line2.width)},switchBGM:function(){Global.startUI.switchBGM()},showEffect:function(){this.node_gold.active=!1,this.fly_node.active=!1,this.node.setPosition(cc.p(-640,0));var e=cc.moveTo(.6,cc.p(0,0));this.node.runAction(e)},updateMaxLabel:function(e){this.currScore.string=e;var t=a("Util");if(this.personPer.string=t.getPercentString(e),this.score.string="历史最高分："+e,"undefined"!=typeof wx){var o=r.loadLocalScore(),n=parseInt(o.maxscore),i=parseInt(o.gold);r.loadScore(function(e,t){n=parseInt(e),t=parseInt(t),console.log("on ThirdAPI loadScore",n,parseInt(t))}),n<e?(r.saveScore(e,i),this.score.string="历史最高分："+e):this.score.string="历史最高分："+n}else"undefined"!=typeof FBInstant&&(e>Global.fbScore?(this.score.string=e,Global.dataScript.saveScore(e)):this.score.string=Global.fbScore);Global.titleMaxScore=e,Global.titleUI&&Global.titleUI.updateItemsState(1)},play:function(){Global.game.playSound("btn",.1),Global.game.enterScene()},gotoHome:function(){Global.game.playSound("btn",.1),Global.game.startGame()},showRankUI:function(){Global.game.playSound("btn",.1),Global.game.showRank()},onShareGame:function(){Global.game.playSound("btn",.1),"undefined"!=typeof FBInstant?r.shareGame(this.getImgBase64(),this.onShareSuccess.bind(this)):r.shareGame("screenshot",this.onShareSuccess.bind(this))},onChallenge:function(){Global.game.playSound("btn",.1);var e=this.getImgBase64();"undefined"!=typeof FBInstant&&FBInstant.shareAsync({intent:"INVITE",image:e,text:"I just challenged Tetris2048,Join me!",data:{myReplayData:"..."}}).then(function(){})},onShareSuccess:function(){if(5<=Global.shareData.shareTimes)return this.buttonstate0.active=!1,void(this.buttonstate1.active=!0);if(this.hasShardReward){if(console.log("分享获得钻石,开始播放动画"),Global.shareData.shareTimes++,r.saveShareData(Global.shareData.shareTimes,Global.shareData.shareDate),Global.wxGold+=parseInt(Global.shareReward),"undefined"!=typeof wx){var e=r.loadLocalScore(),o=parseInt(e.maxscore);parseInt(e.gold);r.loadScore(function(e,t){o=parseInt(e),t=parseInt(t),console.log("shareUI on ThirdAPI loadScore",o,parseInt(t),Global.wxGold)}),r.saveScore(o,Global.wxGold)}this.hasShardReward=!1,this.playGetGoldEffect()}},playGetGoldEffect:function(){var e=this;this.buttonstate0.active=!1,this.buttonstate1.active=!0,this.hasShardReward=!1,this.fly_node.active=!0,this.lbl_fly.string="+"+Global.shareReward;var t=this.fly_node.getComponent(cc.Animation);t.play(),this.node_gold.active=!0,this.lbl_gold.string=Global.wxGold-parseInt(Global.shareReward),this.node_gold.runAction(cc.fadeIn(.5)),t.on("stop",function(){e.node_gold.runAction(cc.sequence(cc.scaleTo(.2,1.2),cc.callFunc(function(){e.lbl_gold.string=Global.wxGold,e.fly_node.active=!1}),cc.scaleTo(.2,1),cc.fadeOut(1)))})},getImgBase64:function(){var e=cc.find("Canvas"),t=parseInt(e.width),o=parseInt(e.height),n=new cc.RenderTexture(t,o);n.begin(),e._sgNode.visit(),n.end();var i=document.createElement("canvas"),a=i.getContext("2d");if(i.width=t,i.height=o,cc._renderType===cc.game.RENDER_TYPE_CANVAS){var r=n.getSprite().getTexture().getHtmlElementObj();a.drawImage(r,0,0)}else if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var s=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,s);var l=n.getSprite().getTexture()._glID;gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,l,0);var c=new Uint8Array(t*o*4);gl.readPixels(0,0,t,o,gl.RGBA,gl.UNSIGNED_BYTE,c),gl.bindFramebuffer(gl.FRAMEBUFFER,null);for(var d=4*t,h=0;h<o;h++){var u=o-1-h,m=new Uint8ClampedArray(c.buffer,u*t*4,d),p=new ImageData(m,t,1);a.putImageData(p,0,h)}}return cc.log("to share"),i.toDataURL("image/png")}}),cc._RF.pop()},{"../common/ThirdAPI":"ThirdApi",Util:"Util"}],startUI:[function(e,t,o){"use strict";cc._RF.push(t,"bca9aXCN59LNZb12NxU6UO1","startUI");var n=e("../common/ThirdAPI");cc.Class({extends:cc.Component,properties:{score:{default:null,type:cc.Label},icon:{default:null,type:cc.Sprite},bg:{default:null,type:cc.Sprite},soundOnBtn:{default:null,type:cc.Node},soundOffBtn:{default:null,type:cc.Node},backgroundAudio:{url:cc.AudioClip,default:null},currentBGM:-1,reddot:{default:null,type:cc.Node}},start:function(){this.init(),this.initAudio()},init:function(){this.updateBestScore(),this.icon.spriteFrame.getTexture().setAliasTexParameters(),this.bg.spriteFrame.getTexture().setAliasTexParameters(),this.soundOnBtn.active=Global.isBGMPlaying,this.soundOffBtn.active=!Global.isBGMPlaying},initAudio:function(){this.currentBGM=cc.audioEngine.play(this.backgroundAudio,!1,.2),cc.audioEngine.setLoop(this.currentBGM,!0),cc.audioEngine.setVolume(this.currentBGM,.2);var e=cc.audioEngine.getVolume(this.currentBGM);console.log("currentBGM volume is "+e),Global.isBGMPlaying=!0},showRedDot:function(e){},updateBestScore:function(){if("undefined"!=typeof wx){var e=n.loadLocalScore();Global.wxScore=parseInt(e.maxscore),Global.wxGold=parseInt(e.gold),n.loadScore(function(e,t){Global.wxScore=parseInt(e),Global.wxGold=parseInt(t),console.log("on ThirdAPI loadScore",Global.wxScore+" :: "+Global.wxGold)}),this.score.string="最高分:"+Global.wxScore}else"undefined"!=typeof FBInstant&&(this.score.string="High score:"+Global.fbScore)},play:function(){Global.game.playSound("btn",.1),Global.game.enterScene()},showRankUI:function(){Global.game.playSound("btn",.1),Global.game.showRank()},onShowStore:function(){Global.game.playSound("btn",.1),Global.game.showStore()},onChallenge:function(){Global.game.playSound("btn",.1),Global.shareUI.onChallenge()},switchBGM:function(){Global.game.playSound("btn",.1),Global.isBGMPlaying?(this.pauseBGM(),this.soundOnBtn.active=!1,this.soundOffBtn.active=!0):(this.playBGM(),this.soundOnBtn.active=!0,this.soundOffBtn.active=!1),Global.isBGMPlaying=!Global.isBGMPlaying},playBGM:function(){-1<this.currentBGM&&cc.audioEngine.resume(this.currentBGM)},pauseBGM:function(){-1<this.currentBGM&&cc.audioEngine.pause(this.currentBGM)}}),cc._RF.pop()},{"../common/ThirdAPI":"ThirdApi"}],uiRoot:[function(e,t,o){"use strict";cc._RF.push(t,"84c41LsrfFPsriorNv8+hdx","uiRoot"),cc.Class({extends:cc.Component,properties:{startUI:{default:null,type:cc.Node},shareUI:{default:null,type:cc.Node}},start:function(){Global.startUI=this.startUI.getComponent("startUI"),Global.shareUI=this.shareUI.getComponent("shareUI")},showStartUI:function(){this.startUI.active=!0,this.shareUI.active=!1,Global.startUI&&Global.startUI.init()},showShareUI:function(){this.startUI.active=!1,this.shareUI.active=!0,null==Global.shareUI&&(Global.shareUI=this.shareUI.getComponent("shareUI")),Global.shareUI.initData()}}),cc._RF.pop()},{}],wxAPI:[function(a,e,t){"use strict";cc._RF.push(e,"7f6f0qagh5LFbhN7qubIwcf","wxAPI");var r={initOnEnter:function(){console.log("get launch options");var e=this.getLaunchOptionsSync();console.log("launch options",e),this.shareTicket=e.shareTicket,this.scene=e.scene,this.query=e.query,this.isSticky=e.isSticky,this.queryString="",this.setShareTicketEnabled(!0),this.showShareMenu(),this.registShare(),this.registOnShow(),this.registOnError(),this.userInfo={nickName:"不愿透露姓名的老王",maxscore:0,gold:0,iv:"",signature:"",gender:1,avatarUrl:"res/raw-assets/resources/textures/gridItem/rank_1.png"}},registOnShow:function(){wx.onShow(function(e){console.log("wx onShow",e),e.shareTicket&&(r.shareTicket=e.shareTicket)})},registOnError:function(){wx.onError(function(e){console.log("wx error:"+e.message+"\nstack:\n"+e.stack)})},getAuth:function(e){wx.getUserInfo({success:function(e){console.log(e),r.userInfo=e.userInfo,r.setUserCloudStorage({KVDataList:[{key:"name",value:e.userInfo.nickName},{key:"gender",value:e.userInfo.gender+""},{key:"avatarUrl",value:e.userInfo.avatarUrl},{key:"iv",value:e.iv},{key:"signature",value:e.signature}],success:function(){console.log("set User Cloud Storage success")}})},fail:function(e){(-1<e.errMsg.indexOf("auth deny")||-1<e.errMsg.indexOf("auth denied"))&&(console.log(e),r.userInfo={nickName:"不愿透露姓名的老王",maxscore:0,gold:0,iv:"",signature:"",gender:1,avatarUrl:"res/raw-assets/resources/textures/gridItem/rank_1.png"},console.log("set UserInfo default"))},complete:function(){e&&e()}})},registShare:function(){this.onShareAppMessage(function(){var e=a("Util").randomForArray(Global.shareTexts);console.log("用户点击了右上按钮并分享,query:",r.queryString," text:"+e);var t=r.getShareScreenShot();r.shareAppMessage({title:e,imageUrl:t,query:r.queryString})})},shareGame:function(e,t,o){var n=a("Util");(console.log("用户点击分享,query:",r.queryString),e)||(e="res/raw-assets/resources/textures/gridItem/"+n.randomForArray(Global.shareImages));var i=n.randomForArray(Global.shareTexts);r.shareAppMessage({title:i,imageUrl:e,query:r.queryString,success:function(e){console.log("wx分享成功",e),e.shareTickets&&(r.shareTicketEnabled=!0,r.shareTicket=e.shareTickets[0]),t&&t(e.shareTickets)},fail:function(){console.log("wx分享失败",o),o&&o()}})},login:function(e){wx.login(e)},setMaxScore:function(e,t){r.queryString="nickName="+r.userInfo.nickName+"&maxscore="+e+"&gold="+t+"&gender="+r.userInfo.gender+"&avatarUrl="+r.userInfo.avatarUrl,console.log("wx setMaxScore, query:",r.queryString)},getLaunchOptionsSync:function(){return wx.getLaunchOptionsSync()},setShareTicketEnabled:function(e){wx.updateShareMenu({withShareTicket:e,success:function(){r.shareTicketEnabled=e}})},getShareInfo:function(e){return wx.getShareInfo(e)},getShareUserInfo:function(){return this.query},showShareMenu:function(){console.log("显示右上菜单的转发按钮"),wx.showShareMenu()},hideShareMenu:function(){console.log("隐藏右上菜单的转发按钮"),wx.hideShareMenu()},onShareAppMessage:function(e){console.log("注册点击转发按钮事件"),wx.onShareAppMessage(e)},shareAppMessage:function(e){console.log("转发:",e),wx.shareAppMessage(e)},getShareScreenShot:function(){return canvas.toTempFilePathSync({x:0,y:.5*canvas.height-.8*.8*canvas.width,width:canvas.width,height:.8*canvas.width,destWidth:500,destHeight:400})},getScreenShot:function(){return canvas.toTempFilePathSync({})},getFriendRank:function(e){var t=wx.getOpenDataContext(),o={type:"getFriendRank",width:e.rect.width,height:e.rect.height};r.shareTicketEnabled&&(o.shareTicket=r.shareTicket),console.log(o),t.postMessage(o),e.callback&&e.callback("wx")},getGroupRank:function(n){var e=a("Util");if(r.shareTicketEnabled&&void 0!==this.shareTicket){var t=wx.getOpenDataContext(),o={type:"getGroupRank",width:n.rect.width,height:n.rect.height,shareTicket:this.shareTicket};console.log(o),t.postMessage(o),n.callback&&n.callback("success")}else{var i=e.randomForArray(Global.shareImages);this.shareGame("res/raw-assets/resources/textures/gridItem/"+i,function(e){if(console.log("on get group rank pre share",e),e){var t=wx.getOpenDataContext(),o={type:"getGroupRank",width:n.rect.width,height:n.rect.height,shareTicket:e[0]};console.log(o),t.postMessage(o),n.callback&&n.callback(e[0])}else n.callback&&n.callback("failed")},function(){n.callback&&n.callback("failed")})}},setUserCloudStorage:function(e){console.log("setUserCloudStorage:",e),wx.setUserCloudStorage(e)},saveScore:function(e,t,o){if("undefined"!=typeof wx){var n={KVDataList:[{key:"maxscore",value:e+""},{key:"gold",value:t+""}],success:o};console.log("wx saveScore:",n),this.setUserCloudStorage(n),this.setMaxScore(e,t)}},loadScore:function(e){},shakeShort:function(e){wx.vibrateShort(e)},shakeLong:function(e){wx.vibrateLong(e)},exit:function(){wx.exitMiniProgram({success:function(e){console.log("exit game:",e)}})},getSystemInfo:function(){return wx.getSystemInfoSync()}};e.exports=r,cc._RF.pop()},{Util:"Util"}]},{},["Game","Global","LoadAtlas","ThirdApi","Util","fbAPI","wxAPI","dataScript","gridController","StoreItem","TitleItem","UIStore","UITitle","UITitleInfo","battleRoot","chooseNum","itemSound","pauseUI","rankItem","rankUI","reviveUI","shareUI","startUI","uiRoot","flyGold","flyNum","gridView","itemView","score"]);
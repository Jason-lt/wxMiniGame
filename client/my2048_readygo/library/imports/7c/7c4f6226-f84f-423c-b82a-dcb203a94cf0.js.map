{"version":3,"sources":["../../../../../assets/Scripts/ui/assets/Scripts/ui/rankUI.js"],"names":["ThirdAPI","require","cc","Class","extends","Component","properties","top1","default","type","Node","top2","rankPrefab","Prefab","innerview","scrollView","content","btn_group","myrankNode","myrankBg","Sprite","myrankSpr","dailyLabel","Label","entries","itemHeight","arrItems","canShowGameClub","lbl_btn_group","start","onLoad","setHandWidthAndHeight","canvas","find","width","setBtnLabel","wx","active","string","showType","dailyType","height","y","onBtnGroupClick","getGroupRank","getFriendRank","onBtnDailyClick","console","log","getDailyRank","initData","biManager","bilog","rank","getChildByName","getComponent","ScrollView","scrollToTop","item","instantiate","itemheight","rankCount","sprite","length","index","setLocalZOrder","setPosition","p","addChild","element","setlevel","hideAll","level","node","FBInstant","getRank","w","h","x","drawRect","rect","callback","updateContent","updateWxRank","initGetGroupRank","cleanRank","groupShare","closeThis","Global","game","showDialogText","dailyRank","self","getLeaderboardAsync","then","leaderboard","getEntriesAsync","getMyRank","catch","fasle","ent","setScore","getScore","setNameAndPhoto","getExtraData","updateMyContent","entri","parseInt","spriteFrame","parent","removeChild","showGameClub","update","dt","openDataContext","getOpenDataContext","sharedCanvas","texture","Texture2D","initWithElement","handleLoadedTexture","sp","SpriteFrame","Type","TILED","error"],"mappings":"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","file":"rankUI.js","sourceRoot":"../../../../../assets/Scripts/ui","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\n// Learn Attribute:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\n\nvar ThirdAPI = require('../common/ThirdAPI')\ncc.Class({\n    extends: cc.Component,\n\n\n    properties: {\n        top1: {\n            default: null,\n            type: cc.Node,\n        },\n        top2: {\n            default: null,\n            type: cc.Node,\n        },\n        rankPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n        innerview: {\n            default: null,\n            type: cc.Node,\n        },\n        scrollView: {\n            default: null,\n            type: cc.Node,\n        },\n        content: {\n            default: null,\n            type: cc.Node,\n        },\n        btn_group: {\n            default: null,\n            type: cc.Node,\n        },\n        myrankNode: {\n            default: null,\n            type: cc.Node,\n        },\n        myrankBg: {\n            default: null,\n            type: cc.Sprite,\n        },\n        myrankSpr: {\n            default: null,\n            type: cc.Sprite,\n        },\n        dailyLabel: {\n            default: null,\n            type: cc.Label,\n        },\n        entries: null,\n        itemHeight: 30,\n        arrItems: [],\n        canShowGameClub: false, //是否可以显示游戏圈\n        lbl_btn_group: null,\n    },\n\n    start() {\n\n    },\n\n    onLoad: function () {\n        /*if (typeof wx !== 'undefined') {\n            this.lbl_btn_group = this.btn_group.getChildByName('Label').getComponent(cc.Label);\n            this.btn_group.active = true;\n            this.lbl_btn_group.string = '查看群排行';\n            this.showType = 1;\n            this.myrankNode.active = true;\n        } else {\n            this.btn_group.active = false;\n            this.myrankNode.active = false;\n            this.scrollView.height = 780;\n            // this.innerview.height = 820;\n            this.scrollView.y = -27;\n        }*/\n        this.setHandWidthAndHeight();\n    },\n\n    //设置头部图片的适配宽高\n    setHandWidthAndHeight: function () {\n        var canvas = cc.find('Canvas');\n        this.top1.width = canvas.width * 0.5;\n        this.top2.width = canvas.width * 0.5;\n    },\n\n    setBtnLabel: function () {\n        if (typeof wx !== 'undefined') {\n            this.btn_group.active = true;\n            this.lbl_btn_group.string = '查看群排行';\n            this.showType = 1;\n            this.dailyLabel.string = \"查看每日排行\";\n            this.dailyType = 0;\n            this.myrankNode.active = true;\n        } else {\n            this.btn_group.active = false;\n            this.myrankNode.active = false;\n            this.scrollView.height = 780;\n            // this.innerview.height = 820;\n            this.scrollView.y = -27;\n        }\n    },\n\n    onBtnGroupClick: function () {\n        if (this.showType == 1) {\n            this.showType = 2;\n            this.lbl_btn_group.string = '查看好友排行';\n            this.getGroupRank();\n        } else {\n            this.showType = 1;\n            this.lbl_btn_group.string = '查看群排行';\n            this.getFriendRank();\n        }\n    },\n\n    //点击每日排行\n    onBtnDailyClick: function () {\n        console.log('点击每日排行');\n        if (this.dailyType == 0) {\n            this.dailyType = -1;\n            this.dailyLabel.string = '查看好友排行';\n            this.getDailyRank();\n        } else {\n            this.dailyType = 0;\n            this.dailyLabel.string = '查看每日排行';\n            this.getFriendRank();\n        }\n    },\n\n    initData: function (canShowGameClub) {\n        //记载成功进入排行榜打点\n        var biManager = require('biManager');\n        biManager.bilog(biManager.rank, null);\n\n        if (typeof wx !== 'undefined') {\n            //this.myrankBg.node.setCascadeOpacityEnabled(true);\n            // this.myrankBg.node.setOpacity(255 * 0.3);\n            //this.myrankBg.node.setLocalZOrder(-1);\n        }\n        this.canShowGameClub = canShowGameClub;\n        this.lbl_btn_group = this.btn_group.getChildByName('Label').getComponent(cc.Label);\n        this.setBtnLabel();\n\n        //每次重进游戏置顶\n        var scrollView = this.scrollView.getComponent(cc.ScrollView).scrollToTop(0);\n\n        var item = cc.instantiate(this.rankPrefab);\n        var itemheight = item.height + 5;\n        var rankCount = 20;\n        this.content.height = itemheight * rankCount;\n        console.log('content width:' + this.content.width);\n        //设置绘制照片姓名的画布\n        var sprite = this.content.getChildByName('sprite');\n        sprite.height = itemheight * rankCount;\n        //this.innerview.height -= 100;\n        //this.innerview.height = itemheight * rankCount;\n        if (this.arrItems.length == 0) {\n            for (var index = 0; index < rankCount; index++) {\n                var item = cc.instantiate(this.rankPrefab);\n                item.setLocalZOrder(-1);\n                item.setPosition(cc.p(0, -0.5 * itemheight - index * itemheight));\n                this.arrItems[index] = item;\n\n                this.content.addChild(item);\n            }\n        }\n\n        for (var index = 0; index < this.arrItems.length; index++) {\n            const element = this.arrItems[index];\n            element.getComponent('rankItem').setlevel(index + 1);\n            element.getComponent('rankItem').hideAll();\n        }\n        //开始获取排行榜\n        if (typeof wx !== 'undefined') {\n            for (var index = 0; index < this.arrItems.length; index++) {\n                const element = this.arrItems[index];\n                element.getComponent('rankItem').level.node.active = false;\n            }\n            this.getFriendRank();\n        } else if (typeof FBInstant !== 'undefined') {\n            this.getRank();\n        }\n    },\n\n    getFriendRank: function () {\n        console.log(\"getFriendRank\");\n        var sprite = this.content.getChildByName('sprite');\n        //sprite.width = this.content.width;\n\n        var w = sprite.width;\n        var h = sprite.height;\n        var x = this.innerview.x - 0.5 * w;\n        var y = this.innerview.y - 0.5 * h;\n        this.drawRect = {\n            x: x,\n            y: y,\n            width: w,\n            height: h\n        };\n        console.log('draw rect:', this.drawRect, \"this.content.width :\" + this.content.width, \"this.innerview.width\" + this.innerview.width + \"sprite.width :\" + sprite.width);\n        ThirdAPI.getRank({\n            rect: this.drawRect,\n            callback: (entries) => {\n                if (typeof entries === 'object') {\n                    this.updateContent(entries);\n                    // this.getMyRank();\n                } else if (typeof entries === 'string') {\n                    this.updateWxRank = 100;\n                }\n            }\n        }, 'Friend')\n    },\n\n\n    //初始化群排行\n    initGetGroupRank: function (canShowGameClub) {\n        console.log(\"getGroupRank\");\n\n        this.canShowGameClub = canShowGameClub;\n        var sprite = this.content.getChildByName('sprite');\n\n        var w = sprite.width; //this.content.width;\n        var h = sprite.height; //this.content.height;\n        var x = this.innerview.x - 0.5 * w;\n        var y = this.innerview.y - 0.5 * h;\n        this.drawRect = {\n            x: x,\n            y: y,\n            width: w,\n            height: h\n        };\n        console.log('draw rect:', this.drawRect);\n\n        this.cleanRank();\n        ThirdAPI.getRank({\n            rect: this.drawRect,\n            callback: (entries) => {\n                console.log('getGroupRank,oncallback', entries);\n                if (typeof entries === 'object') {\n                    this.updateContent(entries);\n                    // this.getMyRank();\n                } else if (typeof entries === 'string') {\n                    if (entries == 'success') {\n                        this.cleanRank();\n                        this.updateWxRank = 1;\n                        //游戏群排行分享成功\n                        var biManager = require('biManager');\n                        biManager.bilog(biManager.groupShare, null);\n                    } else if (entries == 'failed') {\n                        this.closeThis();\n                        Global.game.showDialogText('分享失败！', {\n                            x: 0,\n                            y: 20\n                        });\n                        console.log('查看排行榜，分享到群失败');\n                    } else {\n                        //游戏群排行分享成功\n                        var biManager = require('biManager');\n                        biManager.bilog(biManager.groupShare, null);\n                        this.cleanRank();\n                        this.updateWxRank = 1;\n                    }\n                }\n            }\n        }, 'Group')\n    },\n\n    getGroupRank: function () {\n        console.log(\"getGroupRank\");\n\n        var sprite = this.content.getChildByName('sprite');\n\n        var w = sprite.width; //this.content.width;\n        var h = sprite.height; //this.content.height;\n        var x = this.innerview.x - 0.5 * w;\n        var y = this.innerview.y - 0.5 * h;\n        this.drawRect = {\n            x: x,\n            y: y,\n            width: w,\n            height: h\n        };\n        console.log('draw rect:', this.drawRect);\n\n        this.cleanRank();\n        ThirdAPI.getRank({\n            rect: this.drawRect,\n            callback: (entries) => {\n                console.log('getGroupRank,oncallback', entries);\n                if (typeof entries === 'object') {\n                    this.updateContent(entries);\n                    // this.getMyRank();\n                } else if (typeof entries === 'string') {\n                    if (entries == 'success') {\n                        this.cleanRank();\n                        this.updateWxRank = 1;\n                        //游戏群排行分享成功\n                        var biManager = require('biManager');\n                        biManager.bilog(biManager.groupShare, null);\n                    } else if (entries == 'failed') {\n                        this.showType = 1;\n                        this.lbl_btn_group.string = '查看群排行';\n                        this.cleanRank();\n                        this.getFriendRank();\n                    } else {\n                        //游戏群排行分享成功\n                        var biManager = require('biManager');\n                        biManager.bilog(biManager.groupShare, null);\n                        this.cleanRank();\n                        this.updateWxRank = 1;\n                    }\n                }\n            }\n        }, 'Group')\n    },\n\n    //每日排行榜\n    getDailyRank: function () {\n        console.log(\"getDailyRank\");\n        var sprite = this.content.getChildByName('sprite');\n        //sprite.width = this.content.width;\n\n        var w = sprite.width;\n        var h = sprite.height;\n        var x = this.innerview.x - 0.5 * w;\n        var y = this.innerview.y - 0.5 * h;\n        this.drawRect = {\n            x: x,\n            y: y,\n            width: w,\n            height: h\n        };\n\n        console.log('draw rect:', this.drawRect, \"this.content.width :\" + this.content.width, \"this.innerview.width\" + this.innerview.width + \"sprite.width :\" + sprite.width);\n        ThirdAPI.getRank({\n            rect: this.drawRect,\n            callback: (entries) => {\n                if (typeof entries === 'object') {\n                    this.updateContent(entries);\n                    // this.getMyRank();\n                } else if (typeof entries === 'string') {\n                    if (entries == 'success') {\n                        this.cleanRank();\n                        this.updateWxRank = 1;\n                        //游戏群排行分享成功\n                        var biManager = require('biManager');\n                        biManager.bilog(biManager.dailyRank, null);\n                    } else if (entries == 'failed') {\n                        /*this.showType = 1;\n                        this.lbl_btn_group.string = '查看群排行';\n                        this.cleanRank();\n                        this.getFriendRank();*/\n                    } else {\n                        //游戏群排行分享成功\n                        var biManager = require('biManager');\n                        biManager.bilog(biManager.dailyRank, null);\n                        this.cleanRank();\n                        this.updateWxRank = 1;\n                    }\n                }\n            }\n        }, 'Daily')\n    },\n\n    //从fb上获取排行榜\n    getRank: function () {\n        if (typeof FBInstant === 'undefined') return;\n        var self = this;\n        FBInstant.getLeaderboardAsync('my_allrank')\n            .then(leaderboard => {\n                return leaderboard.getEntriesAsync();\n            })\n            .then(entries => {\n                self.updateContent(entries);\n                self.getMyRank();\n            })\n            .catch(error => {});\n    },\n\n    updateContent: function (entries) {\n        if (!entries) {\n            for (var index = 0; index < this.arrItems.length; index++) {\n                const element = this.arrItems[index];\n                if (element) {\n                    element.active = fasle;\n                }\n            }\n        } else {\n            this.entries = entries;\n            for (var index = 0; index < this.entries.length; index++) {\n                const element = this.arrItems[index];\n                if (element) {\n                    const ent = this.entries[index];\n                    element.getComponent('rankItem').setScore(ent.getScore());\n                    element.getComponent('rankItem').setlevel(ent.getRank());\n                    element.getComponent('rankItem').setNameAndPhoto(ent.getExtraData());\n                    //this.content.addChild(element);\n                }\n            }\n        }\n    },\n\n    updateMyContent: function (entri) {\n        if (parseInt(entri.getRank()) <= 10) {\n            return;\n        }\n\n        var index = this.entries.length;\n        if (index == 10) {\n            index = 9;\n        }\n\n        const element = this.arrItems[index];\n        element.getComponent('rankItem').setScore(entri.getScore());\n        element.getComponent('rankItem').setlevel(entri.getRank());\n        element.getComponent('rankItem').setNameAndPhoto(entri.getExtraData());\n    },\n\n    cleanRank: function () {\n        var sprite = this.content.getChildByName('sprite');\n        sprite.getComponent(cc.Sprite).spriteFrame = null;\n    },\n\n    closeThis: function () {\n        if (this.node.parent) {\n            this.node.parent.removeChild(this.node);\n        }\n        if (this.canShowGameClub) {\n            ThirdAPI.showGameClub(true);\n        }\n    },\n\n    update(dt) {\n        if (this.updateWxRank && this.updateWxRank > 100) {\n            this.updateWxRank = 1;\n            try {\n                var openDataContext = wx.getOpenDataContext();\n                var sharedCanvas = openDataContext.canvas;\n\n                var texture = new cc.Texture2D();\n                texture.initWithElement(sharedCanvas);\n                texture.handleLoadedTexture();\n                var sp = new cc.SpriteFrame(texture);\n\n                var sprite = this.content.getChildByName('sprite');\n                if (sprite) {\n                    sprite.getComponent(cc.Sprite).type = cc.Sprite.Type.TILED;\n\n                    sprite.width = texture.width;\n                    sprite.height = texture.height - 90;\n                    sprite.getComponent(cc.Sprite).spriteFrame = sp;\n                }\n\n                this.myrankSpr.spriteFrame = sp;\n                this.myrankSpr.node.height = texture.height;\n            } catch (error) {\n\n            }\n        } else {\n            this.updateWxRank++;\n        }\n    },\n});"]}
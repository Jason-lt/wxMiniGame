{"version":3,"sources":["../../../../../assets/Scripts/controller/assets/Scripts/controller/gridController.js"],"names":["ThirdAPI","require","cc","Class","extends","Component","properties","nextFriendNode","default","type","Node","nextFriendSp","Sprite","gridPrefab","Prefab","rewardVideoAdBtn","successNode","gainPropName","Label","gainPropIcon","light","pauseNode","chooseNode","test_btnNode","itemPrefab","randomScore","soonGridNum","soonGridInstance","startX","startY","allGrids","bornGrid","startTouchPosition","deleteGrids","joinGrids","targetGrid","line","gemStone","goldNode","prop","nodesGroup","clearPropBtn","clearLabel","clearAdd","clearUseNumNode","clearUseNum","superPropBtn","superLabel","superAdd","superUseNumNode","superUseNum","doublePropBtn","doubleLabel","layoutNode","guideNode","bombNode","bombSurplus","blinkSpr","clearTips","fitOffsetY","propClearTime","score","downGrids","scoreScript","isClickBomming","clickGridNum","createItemIndex","moveItemIndex","startTime","addTimes","usePropTimes","useSuperTimes","useDoubleTimes","useProp","popDialogTimes","bombShareTimes","createItemNum","createItemNum1","start","listenUtil","eventCtrl","addListen","cdnChange","bind","myUtil","isFitIphoneX","isIphoneX","setPosition","getComponent","Widget","top","console","log","setLocalZOrder","params","initGridData","listParma","allWidth","Global","hNum","itemSize","itemSplit","allHeight","vNum","screenWidth","y","reset","createAllGrid","setTouchControl","active","node","setOpacity","cdnGameConfig","string","bombRunAction","isDailyLimit","undefined","startInit","list","addScore","initForDailyLimit","process","updateGold","getNextFriend","director","getScheduler","schedule","setLine","canTest","label","getChildByName","testEnabled","wxBannerAd","createBannerAd","drawRect","x","width","height","rect","scoreNum","callback","entries","setTimeout","openDataContext","wx","getOpenDataContext","sharedCanvas","canvas","texture","Texture2D","initWithElement","handleLoadedTexture","sp","SpriteFrame","spriteFrame","error","unixTime","Date","getTime","today","getDayForYear","startDay","parseInt","dailyStartTime","day","Math","abs","data","self","dailyConfig","gameinfo","dailyTime","saveFriendGenStoneInfo","num","vIndex","hIndex","item","instantiate","pos","getPosition","p","initData","addChild","gridScript","gridNum","linePosY","lineHight","winSize","getWinSize","down","checkGridJoin","isDown","resetItemAction","curState","downNum","index","length","element","gridJoin","runAction","sequence","delayTime","callFunc","clearAllJoin","canJoin","findDownNum","startBianli","combineTimes","checkJoin","hightBornGrid","bornXgridNum","gameOver","createItem","isFind","actionJoin","joinComplete","isJoin","randomForArray","gridRandomScores","showChooseNum","createItem2","dropStone","hasGrid","push","targetPos","upGrid","upGridScript","itemScript","isStone","updateNumForProp","gridController","totalSwith","createGridNumForClear","historyMaxScore","histroyMaxScore","usePropStatus","createGridNumForSuper","updateNum","createDownGrid","onPauseGameForOther","isPropGuide","setSoonGrid","bornXgrid","posX","posY","position","useClear","useDouble","downSpeed","gridDownSpeed","getStopPosition","targetView","startDownForBorn","nextScore","randomScores","concat","joinRandomScores","parent","useClearProp","clearPropNum","game","showDialogPropText","parma","randomPropInfo","limitForGame","setPropSprite","biManager","bilog","useSuperProp","superPropNum","useDoubleProp","doublePropNum","showAddPropDialog","LoadAtlas","setVisible","clearParma","getSpriteFrameFromName","superParma","doubleParma","closeListen","off","EventType","TOUCH_START","nodeStart","TOUCH_MOVE","nodeMove","TOUCH_END","nodeEnd","createGrid","gridItem","gridView","setIndex","itemClick","event","clickGrid","getUserData","stopAllActions","scale1","scaleTo","scaleTime","clearItemToRemove","currHindex","currVindex","downtime","wxGold","costGold","loadLocalScore","maxscore","gold","loadScore","saveScore","goldLabel","onSeeAd","wxRewardVideoAd","initCreateReward","onAdSuccess","onAdFail","destroyBannerAd","find","button","playLightAction","randomIndex","randomPropCode","prop_parma","getClearPropNum","gainAddPropNum","saveClearPropNum","getSuperPropNum","saveSuperPropNum","startUI","showGold","loadAtlasRes","addPropSprite","name","closeTimer","closeSuccessNode","repeatForever","rotateBy","clickProp","resetProp","scaleBy","scale2","repeat","xBorn","yBorn","addIndex","on","getLocation","moveStartX","ceil","canMove","isPaused","moveTemp","dist","downDist","xPadding","round","moveThreshold","isUpOrDown","moveDownThreshold","canMoveGrid","isTouchDown","canMoveQuickDown","priView","maxDownTime","startQuickDownForBorn","gridQuickDownSpeed","changeStateToWaitDown","yDist","hindex","_hIndex","_vIndex","endx","soonMoveGrid","floor","vindex","isClearGrid","gridviewScript","_curitem","gridCombineDownSpeed","curtime","onPauseOrResume","playSound","resumeAllActions","pauseAllActions","hideChooseNum","hidePropTipsNode","onRestart","removeChild","restart","onMainScene","startGame","resume","onShareGame","FBInstant","shareGame","getImgBase64","goldNum","addGold","updateRedDot","rotation","onBombShare","useBomb","pauseInterval","onBombShareSuccess","onBombShareFail","onStartBomb","onBombAdFail","openGId","bombShareSuccess","showDialogText","shareData1","arrOpenGId","indexOf","needBombIndex","grid","blinkPos","myAction","fadeTo","actions","time","itemViewScript","clearTime","currBornXGridNum","msg","clearGameProgressInfo","unschedule","reviveShareTimes","loadReviveData","reviveTimes","reviveTotalTimes","showRevive","showShareUI","clearGridForRevive","clearVNum","toRevive","flyNumPools","finished","reviveSuccess","toRemove","randomForWeight","weightConfig","oneWeightRate","oneTotalWeight"],"mappings":";;;;;;AAAA,IAAIA,WAAWC,QAAQ,oBAAR,CAAf;AACAC,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACR;AACAC,wBAAgB;AACZC,qBAAS,IADG;AAEZC,kBAAMP,GAAGQ;AAFG,SAFR;AAMR;AACAC,sBAAc;AACVH,qBAAS,IADC;AAEVC,kBAAMP,GAAGU;AAFC,SAPN;;AAYRC,oBAAY;AACRL,qBAAS,IADD;AAERC,kBAAMP,GAAGY;AAFD,SAZJ;;AAiBR;AACAC,0BAAkB;AACdP,qBAAS,IADK;AAEdC,kBAAMP,GAAGQ;AAFK,SAlBV;;AAuBRM,qBAAYd,GAAGQ,IAvBP;AAwBRO,sBAAc;AACVT,qBAAS,IADC;AAEVC,kBAAMP,GAAGgB;AAFC,SAxBN;AA4BRC,sBAAc;AACVX,qBAAS,IADC;AAEVC,kBAAMP,GAAGU;AAFC,SA5BN;;AAiCRQ,eAAO;AACHZ,qBAAS,IADN;AAEHC,kBAAMP,GAAGU;AAFN,SAjCC;;AAsCRS,mBAAW;AACPb,qBAAS,IADF;AAEPC,kBAAMP,GAAGQ;AAFF,SAtCH;AA0CRY,oBAAY;AACRd,qBAAS,IADD;AAERC,kBAAMP,GAAGQ;AAFD,SA1CJ;AA8CRa,sBAAc;AACVf,qBAAS,IADC;AAEVC,kBAAMP,GAAGQ;AAFC,SA9CN;;AAmDR;AACAc,oBAAY;AACRhB,qBAAS,IADD;AAERC,kBAAMP,GAAGY;AAFD,SApDJ;;AAyDR;AACAW,qBAAa,CA1DL;AA2DR;AACAC,qBAAa;AACTlB,qBAAS,IADA;AAETC,kBAAMP,GAAGY;AAFA,SA5DL;AAgERa,0BAAkB,IAhEV;;AAkERC,gBAAQ,CAlEA;AAmERC,gBAAQ,CAnEA;AAoER;AACAC,kBAAU,EArEF;AAsER;AACAC,kBAAU,IAvEF;AAwER;AACAC,4BAAoB,IAzEZ;;AA2ER;AACAC,qBAAa,EA5EL;AA6ERC,mBAAW,EA7EH;AA8ER;AACAC,oBAAY;AACR3B,qBAAS,IADD;AAERC,kBAAMP,GAAGQ;AAFD,SA/EJ;;AAoFR0B,cAAM;AACF5B,qBAAS,IADP;AAEFC,kBAAMP,GAAGU;AAFP,SApFE;;AAyFR;AACAyB,kBAAU;AACN7B,qBAAS,IADH;AAENC,kBAAMP,GAAGY;AAFH,SA1FF;;AA+FR;AACAwB,kBAAU;AACN9B,qBAAS,IADH;AAENC,kBAAMP,GAAGQ;AAFH,SAhGF;AAoGR6B,cAAM;AACF/B,qBAAS,IADP;AAEFC,kBAAMP,GAAGQ;AAFP,SApGE;AAwGR8B,oBAAY;AACRhC,qBAAS,IADD;AAERC,kBAAMP,GAAGQ;AAFD,SAxGJ;AA4GR;AACA+B,sBAAc;AACVjC,qBAAS,IADC;AAEVC,kBAAMP,GAAGU;AAFC,SA7GN;AAiHR8B,oBAAY;AACRlC,qBAAS,IADD;AAERC,kBAAMP,GAAGgB;AAFD,SAjHJ;AAqHRyB,kBAAU;AACNnC,qBAAS,IADH;AAENC,kBAAMP,GAAGU;AAFH,SArHF;AAyHR;AACAgC,yBAAiB;AACbpC,qBAAS,IADI;AAEbC,kBAAMP,GAAGQ;AAFI,SA1HT;AA8HRmC,qBAAa;AACTrC,qBAAS,IADA;AAETC,kBAAMP,GAAGgB;AAFA,SA9HL;AAkIR;AACA4B,sBAAc;AACVtC,qBAAS,IADC;AAEVC,kBAAMP,GAAGU;AAFC,SAnIN;AAuIRmC,oBAAY;AACRvC,qBAAS,IADD;AAERC,kBAAMP,GAAGgB;AAFD,SAvIJ;AA2IR8B,kBAAU;AACNxC,qBAAS,IADH;AAENC,kBAAMP,GAAGU;AAFH,SA3IF;AA+IR;AACAqC,yBAAiB;AACbzC,qBAAS,IADI;AAEbC,kBAAMP,GAAGQ;AAFI,SAhJT;AAoJRwC,qBAAa;AACT1C,qBAAS,IADA;AAETC,kBAAMP,GAAGgB;AAFA,SApJL;AAwJR;AACAiC,uBAAe;AACX3C,qBAAS,IADE;AAEXC,kBAAMP,GAAGU;AAFE,SAzJP;AA6JRwC,qBAAa;AACT5C,qBAAS,IADA;AAETC,kBAAMP,GAAGgB;AAFA,SA7JL;AAiKRmC,oBAAY;AACR7C,qBAAS,IADD;AAERC,kBAAMP,GAAGQ;AAFD,SAjKJ;AAqKR4C,mBAAW;AACP9C,qBAAS,IADF;AAEPC,kBAAMP,GAAGQ;AAFF,SArKH;AAyKR6C,kBAAU;AACN/C,qBAAS,IADH;AAENC,kBAAMP,GAAGQ;AAFH,SAzKF;AA6KR8C,qBAAa;AACThD,qBAAS,IADA;AAETC,kBAAMP,GAAGgB;AAFA,SA7KL;AAiLRuC,kBAAU;AACNjD,qBAAS,IADH;AAENC,kBAAMP,GAAGU;AAFH,SAjLF;AAqLR8C,mBAAW;AACPlD,qBAAS,IADF;AAEPC,kBAAMP,GAAGQ;AAFF,SArLH;AAyLRiD,oBAAY,CAzLJ;AA0LRC,uBAAe,CA1LP,EA0LU;;AAElB;AACAC,eAAO;AACHrD,qBAAS,IADN;AAEHC,kBAAMP,GAAGQ;AAFN,SA7LC;AAiMR;AACAoD,mBAAW,EAlMH;;AAoMRC,qBAAa,IApML;AAqMRC,wBAAgB,KArMR;AAsMRC,sBAAc,CAtMN,EAsMS;AACjBC,yBAAiB,CAvMT;AAwMRC,uBAAe,CAxMP;;AA0MRC,mBAAW,CA1MH,EA0MM;AACdC,kBAAU,CA3MF,EA2MK;;AAEbC,sBAAc,CA7MN,EA6MS;AACjBC,uBAAe,CA9MP,EA8MU;AAClBC,wBAAgB,CA/MR,EA+MW;AACnBC,iBAAS,CAAC,CAhNF,EAgNK;;AAEb;AACAC,wBAAgB,CAnNR;AAoNRC,wBAAgB,CApNR,EAoNW;;AAEnBC,uBAAe,CAtNP,EAsNU;AAClBC,wBAAgB,CAvNR,CAuNW;AAvNX,KAHP;;AA6NLC,WAAO,iBAAY;AACfC,mBAAWC,SAAX,CAAqBC,SAArB,CAA+B,WAA/B,EAA4C,KAAKC,SAAL,CAAeC,IAAf,CAAoB,IAApB,CAA5C;AACA;AACA;AACA,YAAIC,SAASnF,QAAQ,QAAR,CAAb;AACA,YAAIoF,eAAeD,OAAOE,SAAP,EAAnB;;AAEA,aAAK3B,UAAL,GAAkB,CAAlB;;AAEA,YAAI0B,YAAJ,EAAkB;AACd,iBAAK1B,UAAL,GAAkB,EAAlB;AACA,iBAAKnB,UAAL,CAAgB+C,WAAhB,CAA4B,CAA5B,EAA+B,CAAC,KAAK5B,UAArC;AACA,iBAAKnB,UAAL,CAAgBgD,YAAhB,CAA6BtF,GAAGuF,MAAhC,EAAwCC,GAAxC,GAA8C,KAAK/B,UAAnD;AACAgC,oBAAQC,GAAR,CAAY,SAAZ,EAAuB,KAAKjC,UAA5B;;AAEA;AACA;;AAEA,iBAAKN,UAAL,CAAgBwC,cAAhB,CAA+B,IAA/B;AACH;AACJ,KAjPI;;AAmPLX,eAAW,mBAAUY,MAAV,EAAkB;AACzBH,gBAAQC,GAAR,CAAY,SAAZ;AACA;AACH,KAtPI;;AAwPLG,kBAAc,sBAAUC,SAAV,EAAqB;AAC/B;AACA;AACA,YAAIZ,SAASnF,QAAQ,QAAR,CAAb;AACA,YAAIoF,eAAeD,OAAOE,SAAP,EAAnB;;AAEA,aAAK3B,UAAL,GAAkB,CAAlB;AACA,YAAI0B,YAAJ,EAAkB;AACd,iBAAK1B,UAAL,GAAkB,EAAlB;AACA;AACA;AACH;;AAED;AACA,YAAIsC,WAAWC,OAAOC,IAAP,GAAcD,OAAOE,QAArB,GAAgC,CAACF,OAAOC,IAAP,GAAc,CAAf,IAAoBD,OAAOG,SAA1E;AACA,YAAIC,YAAYJ,OAAOK,IAAP,GAAcL,OAAOE,QAArB,GAAgC,CAACF,OAAOK,IAAP,GAAc,CAAf,IAAoBL,OAAOG,SAA3E;;AAEA,aAAKzE,MAAL,GAAc,EAAEsE,OAAOM,WAAP,GAAqB,CAAvB,IAA4B,CAACN,OAAOM,WAAP,GAAqBP,QAAtB,IAAkC,CAA9D,GAAkEC,OAAOE,QAAP,GAAkB,CAAlG;AACA,aAAKvE,MAAL,GAAc,MAAM,KAAK8B,UAAzB,CAlB+B,CAkBM;AACrC,aAAK5C,gBAAL,CAAsB0F,CAAtB,GAA0B,KAAK5E,MAAL,GAAc,IAAIqE,OAAOE,QAAzB,GAAoC,IAAIF,OAAOG,SAA/C,GAA2D,GAArF;AACA,aAAKtC,WAAL,GAAmB,KAAKF,KAAL,CAAW2B,YAAX,CAAwB,OAAxB,CAAnB;;AAEA;AACA,aAAKkB,KAAL;;AAEA;AACA,aAAKC,aAAL;AACA;AACA,aAAKC,eAAL;AACA;AACA,aAAKtD,SAAL,CAAeuD,MAAf,GAAwB,IAAxB;AACA;AACA,aAAKpD,QAAL,CAAcqD,IAAd,CAAmBC,UAAnB,CAA8B,CAA9B;AACA,aAAKxD,QAAL,CAAcsD,MAAd,GAAwB,KAAKlC,cAAL,GAAsBuB,OAAOc,aAAP,CAAqBrC,cAA5C,GAA8D,IAA9D,GAAqE,KAA5F;AACA,aAAKnB,WAAL,CAAiByD,MAAjB,GAA0Bf,OAAOc,aAAP,CAAqBrC,cAArB,GAAsC,KAAKA,cAArE;AACA,aAAKuC,aAAL;AACA;AACA,YAAIhB,OAAOiB,YAAP,IAAuBnB,aAAaoB,SAAxC,EAAmD;AAC/C,gBAAIpB,aAAaoB,SAAjB,EAA4B;AACxB,qBAAKC,SAAL,CAAerB,UAAUsB,IAAzB;AACA,qBAAKvD,WAAL,CAAiBwD,QAAjB,CAA0BvB,UAAUnC,KAApC;AACH,aAHD,MAGO;AACH,qBAAK2D,iBAAL;AACH;AAEJ,SARD,MAQO;AACH;AACA,iBAAKC,OAAL;AACH;;AAED;AACA,aAAKC,UAAL;AACA;AACA,aAAKnH,cAAL,CAAoBsG,MAApB,GAA6B,CAACX,OAAOiB,YAArC;AACA,aAAKQ,aAAL;AACAzH,WAAG0H,QAAH,CAAYC,YAAZ,GAA2BC,QAA3B,CAAoC,KAAKH,aAAzC,EAAwD,IAAxD,EAA8D,CAA9D,EAAiE,KAAjE;;AAEA,aAAKI,OAAL,CAAa9B,QAAb,EAAuBK,SAAvB;AACA,aAAKjF,SAAL,CAAewF,MAAf,GAAwB,KAAxB;AACA,aAAKvF,UAAL,CAAgBuF,MAAhB,GAAyB,KAAzB;AACA,aAAKnD,SAAL,CAAemD,MAAf,GAAwB,KAAxB;;AAEA;AACA,aAAKtF,YAAL,CAAkBsF,MAAlB,GAA2BX,OAAO8B,OAAlC;AACA,YAAI9B,OAAO8B,OAAX,EAAoB;AAChB,gBAAIC,QAAQ,KAAK1G,YAAL,CAAkB2G,cAAlB,CAAiC,OAAjC,CAAZ;AACAD,kBAAMzC,YAAN,CAAmBtF,GAAGgB,KAAtB,EAA6B+F,MAA7B,GAAsC,SAASf,OAAOiC,WAAP,GAAqB,GAArB,GAA2B,GAApC,CAAtC;AACH;AACD;AACA,YAAIC,aAAanI,QAAQ,YAAR,CAAjB;AACAmI,mBAAWC,cAAX;;AAEA,aAAKtH,gBAAL,CAAsB8E,cAAtB,CAAqC,IAArC;AACA,aAAK7E,WAAL,CAAiB6E,cAAjB,CAAgC,IAAhC;AACH,KAlUI;;AAoUL8B,mBAAe,yBAAY;AAAA;;AACvB;;AAEA,aAAKW,QAAL,GAAgB;AACZC,eAAG,CADS;AAEZ9B,eAAG,CAFS;AAGZ+B,mBAAO,KAAK7H,YAAL,CAAkBmG,IAAlB,CAAuB0B,KAHlB;AAIZC,oBAAQ,KAAK9H,YAAL,CAAkBmG,IAAlB,CAAuB2B;AAJnB,SAAhB;AAMAzI,iBAAS2H,aAAT,CAAuB;AACnBe,kBAAM,KAAKJ,QADQ;AAEnBzE,mBAAO,KAAKE,WAAL,CAAiB4E,QAFL;AAGnBC,sBAAU,kBAACC,OAAD,EAAa;AACnB;;AAEAC,2BAAW,YAAM;AACb,wBAAI;AACA,4BAAIC,kBAAkBC,GAAGC,kBAAH,EAAtB;AACA,4BAAIC,eAAeH,gBAAgBI,MAAnC;;AAEA,4BAAIC,UAAU,IAAIlJ,GAAGmJ,SAAP,EAAd;AACAD,gCAAQE,eAAR,CAAwBJ,YAAxB;AACAE,gCAAQG,mBAAR;AACA,4BAAIC,KAAK,IAAItJ,GAAGuJ,WAAP,CAAmBL,OAAnB,CAAT;AACA,8BAAKzI,YAAL,CAAkB+I,WAAlB,GAAgCF,EAAhC;AACH,qBATD,CASE,OAAOG,KAAP,EAAc,CAEf;AACJ,iBAbD,EAaG,GAbH;AAcH;AApBkB,SAAvB;AAsBH,KAnWI;;AAqWL;AACAnC,uBAAmB,6BAAY;AAC3B;AACA,YAAIpC,SAASnF,QAAQ,QAAR,CAAb;AACA,YAAI2J,WAAY,IAAIC,IAAJ,EAAD,CAAaC,OAAb,EAAf;AACA,YAAIC,QAAQ3E,OAAO4E,aAAP,CAAqBJ,QAArB,CAAZ;AACA,YAAIK,WAAW7E,OAAO4E,aAAP,CAAqBE,SAAShE,OAAOc,aAAP,CAAqBmD,cAA9B,IAAgD,IAArE,CAAf;AACA,YAAIC,MAAMC,KAAKC,GAAL,CAASP,QAAQE,QAAjB,CAAV;AACA,aAAKM,IAAL,GAAY,IAAZ;AACA,YAAIC,OAAO,IAAX;AACA7E,gBAAQC,GAAR,CAAY,WAAWmE,KAAvB,EAA8B,cAAcE,QAA5C;AACA,YAAI/D,OAAOuE,WAAP,IAAsB,CAACvE,OAAOuE,WAAP,CAAmBL,GAAnB,CAA3B,EAAoD;AAChDzE,oBAAQC,GAAR,CAAY,oBAAZ;AACA4E,iBAAKD,IAAL,GAAYrE,OAAOuE,WAAP,CAAmB,CAAnB,CAAZ;AACH,SAHD,MAGO;AACH9E,oBAAQC,GAAR,CAAY,YAAYwE,GAAZ,GAAkB,GAA9B;AACAI,iBAAKD,IAAL,GAAYrE,OAAOuE,WAAP,CAAmBL,GAAnB,CAAZ;AACH;AACDlE,eAAOwE,QAAP,CAAgBC,SAAhB,GAA6B,IAAId,IAAJ,EAAD,CAAaC,OAAb,EAA5B;AACA9J,iBAAS4K,sBAAT,CAAgC1E,OAAOwE,QAAvC;;AAEAF,aAAKnD,SAAL,CAAemD,KAAKD,IAApB;AACA5E,gBAAQC,GAAR,CAAY4E,KAAKD,IAAjB;AACH,KA5XI;;AA8XLlD,eAAW,mBAAUkD,IAAV,EAAgB;AACvB,YAAIM,MAAM,CAAV;AACA,aAAK,IAAIC,SAAS,CAAlB,EAAqBA,SAAS5E,OAAOK,IAArC,EAA2CuE,QAA3C,EAAqD;AACjD,iBAAK,IAAIC,SAAS,CAAlB,EAAqBA,SAAS7E,OAAOC,IAArC,EAA2C4E,QAA3C,EAAqD;AACjD,oBAAIb,SAASK,KAAKM,GAAL,CAAT,IAAsB,CAA1B,EAA6B;AACzB,wBAAIG,OAAO9K,GAAG+K,WAAH,CAAe,KAAKzJ,UAApB,CAAX;AACA;AACA,wBAAI0J,MAAM,KAAKpJ,QAAL,CAAciJ,MAAd,EAAsBD,MAAtB,EAA8BK,WAA9B,EAAV;AACAH,yBAAKzF,WAAL,CAAiBrF,GAAGkL,CAAH,CAAKF,IAAI3C,CAAT,EAAY2C,IAAIzE,CAAhB,CAAjB;AACAuE,yBAAKxF,YAAL,CAAkB,UAAlB,EAA8B6F,QAA9B,CAAuCd,KAAKM,GAAL,CAAvC,EAAkD,KAAlD;AACA,yBAAK/D,IAAL,CAAUwE,QAAV,CAAmBN,IAAnB;AACA,wBAAIO,aAAa,KAAKzJ,QAAL,CAAciJ,MAAd,EAAsBD,MAAtB,EAA8BtF,YAA9B,CAA2C,UAA3C,CAAjB;AACA+F,+BAAWP,IAAX,GAAkBA,KAAKxF,YAAL,CAAkB,UAAlB,CAAlB;AACA+F,+BAAWC,OAAX,GAAqBjB,KAAKM,GAAL,CAArB;AACH;AACDA;AACH;AACJ;AACD,aAAKvH,SAAL,CAAeuD,MAAf,GAAwB,KAAxB;AACA,aAAKY,OAAL;AACH,KAlZI;;AAoZL;AACAM,aAAS,iBAAUS,KAAV,EAAiBC,MAAjB,EAAyB;AAC9B,aAAKrG,IAAL,CAAU0E,IAAV,CAAe0B,KAAf,GAAuBA,QAAQ,EAA/B;AACA,aAAKpG,IAAL,CAAU0E,IAAV,CAAe2B,MAAf,GAAwBA,SAAS,EAAjC;AACA,YAAIgD,WAAWhD,SAAS,CAAT,GAAa,KAAK5G,MAAlB,GAA2BqE,OAAOE,QAAP,GAAkB,CAA5D;AACA,aAAKhE,IAAL,CAAU0E,IAAV,CAAevB,WAAf,CAA2BrF,GAAGkL,CAAH,CAAK,CAAL,EAAQ,CAACK,QAAT,CAA3B;;AAGA;AACAvF,eAAOwF,SAAP,GAAmB,KAAKtJ,IAAL,CAAU0E,IAAV,CAAe2B,MAAlC;;AAEA;AACAvC,eAAOuF,QAAP,GAAkB,CAACA,QAAnB;AACA9F,gBAAQC,GAAR,CAAY,OAAZ,EAAqB,CAAC6F,QAAtB,EAAgC,KAAKrJ,IAAL,CAAU0E,IAAV,CAAe2B,MAA/C,EAAuDvI,GAAGyL,OAAH,CAAWnD,KAAlE,EAAyEtI,GAAGyL,OAAH,CAAWlD,MAApF,EAA4FvI,GAAG0H,QAAH,CAAYgE,UAAZ,EAA5F;AACH,KAlaI;;AAoaLnE,aAAS,mBAAY;AACjB;AACA,aAAKoE,IAAL;AACA;AACA,aAAKC,aAAL;AACH,KAzaI;;AA2aL;AACAD,UAAM,gBAAY;AACd,aAAKE,MAAL,GAAc,KAAd;AACA,aAAKjI,SAAL,GAAiB,EAAjB;AACA,aAAK,IAAIiH,SAAS,CAAlB,EAAqBA,SAAS7E,OAAOC,IAArC,EAA2C4E,QAA3C,EAAqD;AACjD,iBAAK,IAAID,SAAS,CAAlB,EAAqBA,SAAS5E,OAAOK,IAArC,EAA2CuE,QAA3C,EAAqD;AACjD,oBAAI,KAAKkB,eAAL,CAAqBjB,MAArB,EAA6BD,MAA7B,EAAqC,KAArC,CAAJ,EAAiD;AAC7C,yBAAKiB,MAAL,GAAc,IAAd;AACH;AACJ;AACJ;;AAED,YAAI,KAAKhK,QAAL,IAAiB,KAAKA,QAAL,CAAcyD,YAAd,CAA2B,UAA3B,EAAuCyG,QAAvC,GAAkD,CAAvE,EAA0E;AACtE,iBAAKF,MAAL,GAAc,IAAd;AACH;AACJ,KA1bI;;AA4bLD,mBAAe,yBAAY;AACvB,YAAItB,OAAO,IAAX;AACA,YAAI0B,UAAU,CAAd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK,IAAIC,QAAQ,CAAjB,EAAoBA,QAAQ,KAAKrI,SAAL,CAAesI,MAA3C,EAAmDD,OAAnD,EAA4D;AACxD,gBAAME,UAAU,KAAKvI,SAAL,CAAeqI,KAAf,CAAhB;AACA,gBAAIE,QAAQJ,QAAR,GAAmB,CAAvB,EAA0B;AACtBC;AACH;AACJ;AACD,YAAI,KAAKnK,QAAL,IAAiB,IAAjB,IAAyB,KAAKA,QAAL,CAAcyD,YAAd,CAA2B,UAA3B,EAAuCyG,QAAvC,GAAkD,CAA/E,EAAkF;AAC9EC;AACH;AACD,YAAI,CAAC,KAAKnK,QAAL,IAAiB,IAAjB,IAAyB,KAAKA,QAAL,CAAcyD,YAAd,CAA2B,UAA3B,EAAuCyG,QAAvC,IAAmD,CAA7E,KAAmFC,WAAW,CAAlG,EAAqG;AACjG,iBAAKI,QAAL;AACH,SAFD,MAEO;AACH,iBAAKxF,IAAL,CAAUyF,SAAV,CAAoBrM,GAAGsM,QAAH,CAAYtM,GAAGuM,SAAH,CAAa,GAAb,CAAZ,EAA+BvM,GAAGwM,QAAH,CAAY,YAAY;AACvElC,qBAAKsB,aAAL;AACH,aAFkD,CAA/B,CAApB;AAGH;;AAED;AACH,KAzdI;;AA2dLQ,cAAU,oBAAY;AAClB,YAAI9B,OAAO,IAAX;AACA;AACA;;AAEA;AACA,YAAIA,KAAKvG,YAAL,GAAoB,CAAxB,EAA2B;AACvBuG,iBAAK/C,OAAL;AACA+C,iBAAKvG,YAAL,GAAoB,CAApB;AACA;AACH;;AAEDuG,aAAKmC,YAAL;;AAEA,YAAIC,UAAU,KAAd;AACA,aAAK,IAAI7B,SAAS,CAAlB,EAAqBA,SAAS7E,OAAOC,IAArC,EAA2C4E,QAA3C,EAAqD;AACjD,iBAAK,IAAID,SAAS,CAAlB,EAAqBA,SAAS5E,OAAOK,IAArC,EAA2CuE,QAA3C,EAAqD;AACjD,oBAAIS,aAAaf,KAAK1I,QAAL,CAAciJ,MAAd,EAAsBD,MAAtB,EAA8BtF,YAA9B,CAA2C,UAA3C,CAAjB;AACA,oBAAI,CAACgF,KAAKqC,WAAL,EAAD,IAAwBrC,KAAKqC,WAAL,MAAsBtB,WAAWQ,MAA7D,EAAsE;AAClE;AACA,wBAAIR,WAAWuB,WAAX,EAAJ,EAA8B;AAC1BF,kCAAU,IAAV;AACH;AACJ;AACJ;AACJ;;AAED,YAAIA,OAAJ,EAAa;AACT1G,mBAAO6G,YAAP;AACApH,oBAAQC,GAAR,CAAY,yBAAyBM,OAAO6G,YAA5C;AACA,iBAAKhL,QAAL,GAAgB,IAAhB;AACA,iBAAKiL,SAAL;AACH,SALD,MAKO;AACH,gBAAIC,gBAAgBzC,KAAK1I,QAAL,CAAcoE,OAAOgH,YAArB,EAAmC,CAAnC,CAApB;AACA,gBAAID,cAAczH,YAAd,CAA2B,UAA3B,EAAuCwF,IAAvC,IAA+C,IAA/C,IAAuD,CAACR,KAAKuB,MAAjE,EAAyE;AACrE;AACA,oBAAIvB,QAAO,IAAX;AACAA,sBAAK1D,IAAL,CAAUyF,SAAV,CAAoBrM,GAAGsM,QAAH,CAAYtM,GAAGuM,SAAH,CAAa,GAAb,CAAZ,EAA+BvM,GAAGwM,QAAH,CAAY,YAAY;AACvElC,0BAAK2C,QAAL;AACH,iBAFkD,CAA/B,CAApB;AAGA;AACH;AACD,gBAAI,CAAC3C,KAAKuB,MAAV,EAAkB;AACd7F,uBAAO6G,YAAP,GAAsB,CAAtB;AACAvC,qBAAKzI,QAAL,GAAgB,IAAhB;AACAyI,qBAAK4C,UAAL;AACH,aAJD,MAIO;AACH5C,qBAAK/C,OAAL;AACH;AACJ;AACJ,KA7gBI;;AA+gBL;AACAuF,eAAW,qBAAY;AACnBrH,gBAAQC,GAAR,CAAY,QAAZ;AACA,YAAI4E,OAAO,IAAX;AACAA,aAAK1D,IAAL,CAAUyF,SAAV,CAAoBrM,GAAGsM,QAAH,CAAYtM,GAAGuM,SAAH,CAAa,GAAb,CAAZ,EAA+BvM,GAAGwM,QAAH,CAAY,YAAY;AACvE,gBAAIW,SAAS,KAAb;AACA,iBAAK,IAAItC,SAAS,CAAlB,EAAqBA,SAAS7E,OAAOC,IAArC,EAA2C4E,QAA3C,EAAqD;AACjD,qBAAK,IAAID,SAAS,CAAlB,EAAqBA,SAAS5E,OAAOK,IAArC,EAA2CuE,QAA3C,EAAqD;AACjD,wBAAIS,aAAaf,KAAK1I,QAAL,CAAciJ,MAAd,EAAsBD,MAAtB,EAA8BtF,YAA9B,CAA2C,UAA3C,CAAjB;AACA,wBAAI+F,WAAW+B,UAAf,EAA2B;AACvBD,iCAAS,IAAT;AACA;AACH;AACJ;AACJ;AACD,gBAAI,CAACA,MAAL,EAAa;AACT1H,wBAAQC,GAAR,CAAY,MAAZ;AACA4E,qBAAK+C,YAAL;AACH,aAHD,MAGO;AACH5H,wBAAQC,GAAR,CAAY,YAAZ;AACA4E,qBAAKwC,SAAL;AACH;AACJ,SAlBkD,CAA/B,CAApB;AAmBH,KAtiBI;;AAwiBLO,kBAAc,wBAAY;AACtB,YAAI/C,OAAO,IAAX;AACA;AACA,YAAIyC,gBAAgBzC,KAAK1I,QAAL,CAAcoE,OAAOgH,YAArB,EAAmC,CAAnC,CAApB;AACA,YAAID,cAAczH,YAAd,CAA2B,UAA3B,EAAuCwF,IAAvC,IAA+C,IAAnD,EAAyD;AACrD;AACA;AACAR,iBAAKuB,MAAL,GAAc,IAAd;AACH;AACDvB,aAAK8B,QAAL;AACH,KAljBI;;AAojBLO,iBAAa,uBAAY;AACrB,YAAIrC,OAAO,IAAX;AACA,aAAK,IAAIO,SAAS,CAAlB,EAAqBA,SAAS7E,OAAOC,IAArC,EAA2C4E,QAA3C,EAAqD;AACjD,iBAAK,IAAID,SAAS,CAAlB,EAAqBA,SAAS5E,OAAOK,IAArC,EAA2CuE,QAA3C,EAAqD;AACjD,oBAAIS,aAAaf,KAAK1I,QAAL,CAAciJ,MAAd,EAAsBD,MAAtB,EAA8BtF,YAA9B,CAA2C,UAA3C,CAAjB;AACA,oBAAI+F,WAAWQ,MAAf,EAAuB;AACnB,2BAAO,IAAP;AACH;AACJ;AACJ;AACD,eAAO,KAAP;AACH,KA/jBI;;AAikBL;AACAY,kBAAc,wBAAY;AACtB,aAAK,IAAI5B,SAAS,CAAlB,EAAqBA,SAAS7E,OAAOC,IAArC,EAA2C4E,QAA3C,EAAqD;AACjD,iBAAK,IAAID,SAAS,CAAlB,EAAqBA,SAAS5E,OAAOK,IAArC,EAA2CuE,QAA3C,EAAqD;AACjD,oBAAIS,aAAa,KAAKzJ,QAAL,CAAciJ,MAAd,EAAsBD,MAAtB,EAA8BtF,YAA9B,CAA2C,UAA3C,CAAjB;AACA+F,2BAAWiC,MAAX,GAAoB,KAApB;AACH;AACJ;AACJ,KAzkBI;;AA2kBL;AACAJ,gBAAY,sBAAY;AACpB;AACA;;AAEA,YAAIhI,SAASnF,QAAQ,QAAR,CAAb;AACA,YAAI,KAAKwB,WAAL,IAAoB,CAAxB,EAA2B;AACvB,iBAAKA,WAAL,GAAmB2D,OAAOqI,cAAP,CAAsBvH,OAAOwH,gBAA7B,CAAnB;AACH;;AAED,YAAIxH,OAAOiC,WAAX,EAAwB;AACpB,iBAAKwF,aAAL;AACH,SAFD,MAEO;AACH,iBAAKC,WAAL;AACH;AACJ,KA1lBI;;AA4lBL;AACAC,eAAW,qBAAY;AACnB;;;AAGA;AACA,YAAIvG,OAAO,EAAX,CALmB,CAKJ;AACf,aAAK,IAAIyD,WAAS,CAAlB,EAAqBA,WAAS7E,OAAOC,IAArC,EAA2C4E,UAA3C,EAAqD;AACjD,gBAAI+C,UAAU,KAAd;AACA,iBAAK,IAAIhD,WAAS5E,OAAOK,IAAP,GAAc,CAAhC,EAAmCuE,YAAU,CAA7C,EAAgDA,UAAhD,EAA0D;AACtD,oBAAIS,aAAa,KAAKzJ,QAAL,CAAciJ,QAAd,EAAsBD,QAAtB,EAA8BtF,YAA9B,CAA2C,UAA3C,CAAjB;AACA,oBAAI+F,WAAWP,IAAX,IAAmB,IAAvB,EAA6B;AACzB8C,8BAAU,IAAV;AACH,iBAFD,MAEO;AACH,wBAAIA,OAAJ,EAAa;AACTxG,6BAAKyG,IAAL,CAAU,CAAChD,QAAD,EAASD,QAAT,CAAV;AACA;AACH;AACJ;;AAGD;;;;;;;;AAQH;AACJ;AACDnF,gBAAQC,GAAR,CAAY,OAAZ,EAAqB0B,IAArB;AACA,YAAIA,KAAK8E,MAAL,IAAe,CAAnB,EAAsB;;AAEtB;AACA,YAAIhH,SAASnF,QAAQ,QAAR,CAAb;AACA,YAAI+N,YAAY5I,OAAOqI,cAAP,CAAsBnG,IAAtB,CAAhB;AACA,YAAIyD,SAASiD,UAAU,CAAV,CAAb;AACA,YAAIlD,SAASkD,UAAU,CAAV,CAAb;;AAIA;;;;;;;;;;;;AAaA,YAAIC,SAAS,KAAKnM,QAAL,CAAciJ,MAAd,EAAsBD,MAAtB,CAAb;AACA,YAAIoD,eAAeD,OAAOzI,YAAP,CAAoB,UAApB,CAAnB;AACA;AACA,YAAIwF,OAAO9K,GAAG+K,WAAH,CAAe,KAAKzJ,UAApB,CAAX;AACA;AACAwJ,aAAKzF,WAAL,CAAiB0I,OAAO9C,WAAP,EAAjB;AACA,YAAIgD,aAAanD,KAAKxF,YAAL,CAAkB,UAAlB,CAAjB;AACA2I,mBAAWC,OAAX,GAAqB,IAArB;;AAEAD,mBAAW9C,QAAX,CAAoB,CAApB,EAAuB,KAAvB;AACA8C,mBAAWE,gBAAX;;AAEAnI,eAAOoI,cAAP,CAAsBhD,QAAtB,CAA+BN,IAA/B;AACAkD,qBAAalD,IAAb,GAAoBmD,UAApB;;AAEA;;AAEA;AACA;AACH,KAtqBI;;AAwqBLP,iBAAa,uBAAY;AACrB,aAAKhJ,aAAL;AACA,aAAKC,cAAL;;AAEA,YAAI,KAAKJ,OAAL,IAAgB,CAAC,CAAjB,IAAuB,CAACyB,OAAOiB,YAAR,IAAwBjB,OAAOc,aAAP,CAAqBuH,UAA7C,IAA2D,KAAK3J,aAAL,IAAsBsF,SAAShE,OAAOc,aAAP,CAAqBwH,qBAA9B,CAAjF,IAAyItI,OAAOuI,eAAP,IAA0BvE,SAAShE,OAAOc,aAAP,CAAqB0H,eAA9B,CAA9L,EAA+O;AAC3O/I,oBAAQC,GAAR,CAAY,MAAZ,EAAoB,KAAKnB,OAAzB;AACAyB,mBAAOyI,aAAP,GAAuB,KAAK/J,aAAL,IAAsBsB,OAAOc,aAAP,CAAqBwH,qBAA3C,GAAmE,CAAnE,GAAuE,KAAK/J,OAAnG;AACH,SAHD,MAGO;AACHyB,mBAAOyI,aAAP,GAAuB,CAAC,CAAxB;AACH;AACD,aAAKlK,OAAL,GAAe,CAAC,CAAhB;;AAEA;AACA,YAAI,CAACyB,OAAOiB,YAAR,IAAwBjB,OAAOc,aAAP,CAAqBuH,UAA7C,IAA2DrI,OAAOuI,eAAP,IAA0BvE,SAAShE,OAAOc,aAAP,CAAqB0H,eAA9B,CAArF,KACC,KAAK9J,aAAL,IAAuBsF,SAAShE,OAAOc,aAAP,CAAqBwH,qBAA9B,IAAuD,CAA9E,IACG,KAAK5J,aAAL,IAAsBsF,SAAShE,OAAOc,aAAP,CAAqBwH,qBAA9B,CADzB,IAEG,KAAK5J,aAAL,IAAuBsF,SAAShE,OAAOc,aAAP,CAAqB4H,qBAA9B,IAAuD,CAFjF,IAGG,KAAKhK,aAAL,IAAsBsF,SAAShE,OAAOc,aAAP,CAAqB4H,qBAA9B,CAJ1B,CAAJ,EAIqF;;AAGjF,gBAAI,KAAKhK,aAAL,IAAuBsB,OAAOc,aAAP,CAAqBwH,qBAArB,GAA6C,CAAxE,EAA4E;AACxE,qBAAK7M,gBAAL,CAAsB6D,YAAtB,CAAmC,UAAnC,EAA+CqJ,SAA/C,CAAyD,CAAzD;AACA,qBAAKC,cAAL;AACH,aAHD,MAGO,IAAI,KAAKlK,aAAL,IAAsBsB,OAAOc,aAAP,CAAqBwH,qBAA/C,EAAsE;AACzE,qBAAKO,mBAAL;AACA,qBAAKrL,SAAL,CAAemD,MAAf,GAAwB,IAAxB;AACA,qBAAKnD,SAAL,CAAemC,cAAf,CAA8B,EAA9B;AACH,aAJM,MAIA,IAAI,KAAKjB,aAAL,IAAuBsB,OAAOc,aAAP,CAAqB4H,qBAArB,GAA6C,CAAxE,EAA4E;AAC/E,qBAAKjN,gBAAL,CAAsB6D,YAAtB,CAAmC,UAAnC,EAA+CqJ,SAA/C,CAAyD,CAAzD;AACA,qBAAKC,cAAL;AACH,aAHM,MAGA,IAAI,KAAKlK,aAAL,IAAsBsB,OAAOc,aAAP,CAAqB4H,qBAA/C,EAAsE;AACzE1I,uBAAO8I,WAAP,GAAqB,IAArB;AACA,qBAAKrB,aAAL;AACH;AACJ,SArBD,MAqBO;AACH,iBAAKmB,cAAL;AACA,iBAAKG,WAAL;AACA,iBAAKxH,OAAL;AACA,iBAAKvD,eAAL;AACAgC,mBAAO8I,WAAP,GAAqB,KAArB;AACH;AACJ,KAjtBI;;AAmtBLF,oBAAgB,0BAAY;AACxB,YAAI9D,OAAO9K,GAAG+K,WAAH,CAAe,KAAKzJ,UAApB,CAAX;AACA;AACA,YAAI0N,YAAY,KAAKpN,QAAL,CAAcoE,OAAOgH,YAArB,EAAmC,CAAnC,CAAhB;AACA,YAAIiC,OAAO,CAAX;AACA,YAAIC,OAAO,KAAKvN,MAAhB;AACA,YAAIqN,SAAJ,EAAe;AACX,gBAAIG,WAAWH,UAAU/D,WAAV,EAAf;AACAgE,mBAAOE,SAAS9G,CAAhB;AACA6G,mBAAOC,SAAS5I,CAAhB;AACH;AACDuE,aAAKzF,WAAL,CAAiBrF,GAAGkL,CAAH,CAAK+D,IAAL,EAAWC,OAAOlJ,OAAOE,QAAzB,CAAjB;;AAEA4E,aAAKxF,YAAL,CAAkB,UAAlB,EAA8B6F,QAA9B,CAAuC,KAAK5J,WAA5C,EAAyD,KAAzD;AACAuJ,aAAKxF,YAAL,CAAkB,UAAlB,EAA8B6I,gBAA9B;AACA,YAAInI,OAAOyI,aAAP,IAAwB,CAA5B,EAA+B;AAC3BhJ,oBAAQC,GAAR,CAAY,MAAZ;AACAoF,iBAAKxF,YAAL,CAAkB,UAAlB,EAA8B8J,QAA9B,GAAyC,IAAzC;AACH,SAHD,MAGO,IAAIpJ,OAAOyI,aAAP,IAAwB,CAA5B,EAA+B;AAClChJ,oBAAQC,GAAR,CAAY,QAAZ;AACAoF,iBAAKxF,YAAL,CAAkB,UAAlB,EAA8B+J,SAA9B,GAA0C,IAA1C;AACH;AACD,aAAKzI,IAAL,CAAUwE,QAAV,CAAmBN,IAAnB;;AAEA,aAAKjJ,QAAL,GAAgBiJ,IAAhB;;AAEA,YAAIwE,YAAYtJ,OAAOuJ,aAAvB;AACA,YAAIvD,UAAU,KAAKwD,eAAL,CAAqBxJ,OAAOgH,YAA5B,EAA0C,CAA1C,CAAd;AACA,YAAIyC,aAAa,KAAK7N,QAAL,CAAcoE,OAAOgH,YAArB,EAAmChB,OAAnC,CAAjB;;AAEA,aAAKnK,QAAL,CAAcyD,YAAd,CAA2B,UAA3B,EAAuCrD,UAAvC,GAAoDwN,UAApD;;AAEA3E,aAAKxF,YAAL,CAAkB,UAAlB,EAA8BoK,gBAA9B,CAA+CJ,SAA/C;;AAEA;AACA;;AAEA;;;AAGH,KA3vBI;;AA6vBL;AACAP,iBAAa,qBAAUY,SAAV,EAAqB;AAC9B,YAAIA,cAAczI,SAAlB,EAA6B;AACzB,iBAAK3F,WAAL,GAAmBoO,SAAnB;AACH,SAFD,MAEO;AACH,gBAAIzK,SAASnF,QAAQ,QAAR,CAAb;AACA,gBAAI6P,eAAe5J,OAAOwH,gBAAP,CAAwBqC,MAAxB,CAA+B7J,OAAO8J,gBAAtC,CAAnB;AACA,iBAAKvO,WAAL,GAAmB2D,OAAOqI,cAAP,CAAsBqC,YAAtB,CAAnB;AACH;;AAED,YAAI,CAAC,KAAKnO,gBAAN,IAA2B,KAAKA,gBAAL,IAAyB,CAAC,KAAKA,gBAAL,CAAsBsO,MAA/E,EAAwF;AACpF,iBAAKtO,gBAAL,GAAwBzB,GAAG+K,WAAH,CAAe,KAAKvJ,WAApB,CAAxB;AACA,iBAAKoF,IAAL,CAAUwE,QAAV,CAAmB,KAAK3J,gBAAxB;AACH;AACD,aAAKA,gBAAL,CAAsB4D,WAAtB,CAAkC,CAAlC,EAAqC,MAAM,KAAK5B,UAAhD;AACA,aAAKhC,gBAAL,CAAsB6D,YAAtB,CAAmC,UAAnC,EAA+C6F,QAA/C,CAAwD,KAAK5J,WAA7D,EAA0E,IAA1E;AACH,KA7wBI;;AA+wBLyO,kBAAc,wBAAY;AACtB;AACA,YAAIhK,OAAOwE,QAAP,CAAgByF,YAAhB,IAAgC,CAApC,EAAuC;AACnCjK,mBAAOkK,IAAP,CAAYC,kBAAZ,CAA+B,OAA/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH;AACD,YAAIC,QAAQpK,OAAOqK,cAAP,CAAsB,CAAtB,CAAZ;AACA,YAAID,SAAS,KAAKhM,YAAL,IAAqBgM,MAAME,YAAxC,EAAsD;AAClDtK,mBAAOkK,IAAP,CAAYC,kBAAZ,CAA+B,WAAWC,MAAME,YAAjB,GAAgC,MAA/D;AACA;AACH;AACDtK,eAAOwE,QAAP,CAAgByF,YAAhB;AACA,aAAK7L,YAAL;AACA,aAAKG,OAAL,GAAe,CAAf;AACA;AACA,aAAKgM,aAAL;AACA,YAAI,KAAK9O,gBAAT,EAA2B;AACvB,iBAAKA,gBAAL,CAAsB6D,YAAtB,CAAmC,UAAnC,EAA+CqJ,SAA/C,CAAyD,CAAzD;AACH;AACD7O,iBAAS4K,sBAAT,CAAgC1E,OAAOwE,QAAvC;;AAEA;AACA,YAAIgG,YAAYzQ,QAAQ,WAAR,CAAhB;AACAyQ,kBAAUC,KAAV,CAAgBD,UAAUR,YAA1B,EAAwC,IAAxC;AACH,KA7yBI;;AA+yBL;AACAU,kBAAc,wBAAY;AACtBjL,gBAAQC,GAAR,CAAY,MAAZ,EAAoBM,OAAOyI,aAA3B,EAA0C,KAAKlK,OAA/C;;AAEA,YAAI,KAAKA,OAAL,IAAgB,CAApB,EAAuB;AACnByB,mBAAOkK,IAAP,CAAYC,kBAAZ,CAA+B,iBAA/B;AACA;AACH;;AAED,YAAInK,OAAOwE,QAAP,CAAgBmG,YAAhB,IAAgC,CAApC,EAAuC;AACnC3K,mBAAOkK,IAAP,CAAYC,kBAAZ,CAA+B,OAA/B;AACA;AACA;AACA;AACA;AACA;AACA;AACH;AACD,YAAIC,QAAQpK,OAAOqK,cAAP,CAAsB,CAAtB,CAAZ;AACA,YAAID,SAAS,KAAK/L,aAAL,IAAsB+L,MAAME,YAAzC,EAAuD;AACnDtK,mBAAOkK,IAAP,CAAYC,kBAAZ,CAA+B,WAAWC,MAAME,YAAjB,GAAgC,MAA/D;AACA;AACH;AACD,aAAK7C,aAAL;AACA;AACA;AACA;AACA;AACA;AACA;AACH,KA70BI;;AA+0BL;AACAmD,mBAAe,yBAAY;AACvB5K,eAAOkK,IAAP,CAAYC,kBAAZ,CAA+B,YAA/B;AACA;AACA;AACA,YAAInK,OAAOwE,QAAP,CAAgBqG,aAAhB,IAAiC,CAArC,EAAwC;AACpC7K,mBAAOkK,IAAP,CAAYY,iBAAZ,CAA8B;AAC1B,8BAAc;AADY,aAA9B;AAGA;AACH;AACD,YAAIV,QAAQpK,OAAOqK,cAAP,CAAsB,CAAtB,CAAZ;AACA,YAAID,SAAS,KAAK9L,cAAL,IAAuB8L,MAAME,YAA1C,EAAwD;AACpDtK,mBAAOkK,IAAP,CAAYC,kBAAZ,CAA+B,WAAWC,MAAME,YAAjB,GAAgC,MAA/D;AACA;AACH;AACD,aAAKhM,cAAL;AACA0B,eAAOwE,QAAP,CAAgBqG,aAAhB;AACA,aAAKtM,OAAL,GAAe,CAAf;AACA,aAAKgM,aAAL;AACA,YAAI,KAAK9O,gBAAT,EAA2B;AACvB,iBAAKA,gBAAL,CAAsB6D,YAAtB,CAAmC,UAAnC,EAA+CqJ,SAA/C,CAAyD,CAAzD;AACH;AACD7O,iBAAS4K,sBAAT,CAAgC1E,OAAOwE,QAAvC;AACH,KAv2BI;;AAy2BL+F,mBAAe,yBAAY;AACvB,YAAIQ,YAAYhR,QAAQ,WAAR,CAAhB;AACA;AACA,aAAK0C,QAAL,CAAcuO,UAAd,CAAyB,KAAzB;AACA,aAAKtO,eAAL,CAAqBiE,MAArB,GAA8B,KAA9B;AACA,YAAIsK,aAAajL,OAAOqK,cAAP,CAAsB,CAAtB,CAAjB;AACA,YAAIY,cAAc,KAAK7M,YAAL,IAAqB6M,WAAWX,YAAlD,EAAgE;AAC5D,iBAAK/N,YAAL,CAAkBiH,WAAlB,GAAgCuH,UAAUG,sBAAV,CAAiC,yBAAjC,EAA4D,YAA5D,CAAhC;AACA;AACH,SAHD,MAGO;AACH,iBAAK3O,YAAL,CAAkBiH,WAAlB,GAAgCuH,UAAUG,sBAAV,CAAiC,yBAAjC,EAA4D,WAA5D,CAAhC;AACA;AACA;AACA,gBAAID,UAAJ,EAAgB;AACZ,qBAAKtO,WAAL,CAAiBoE,MAAjB,GAA0BkK,WAAWX,YAAX,GAA0B,KAAKlM,YAAzD;AACH;AACJ;AACD,YAAI4B,OAAOwE,QAAP,CAAgByF,YAAhB,GAA+B,CAAnC,EAAsC;AAClC,iBAAKzN,UAAL,CAAgBuE,MAAhB,GAAyBf,OAAOwE,QAAP,CAAgByF,YAAzC;AACA;AACH,SAHD,MAGO;AACH,iBAAKzN,UAAL,CAAgBuE,MAAhB,GAAyB,GAAzB;AACA;AACH;;AAED;AACA,aAAKhE,eAAL,CAAqB4D,MAArB,GAA8B,KAA9B;AACA,YAAIwK,aAAanL,OAAOqK,cAAP,CAAsB,CAAtB,CAAjB;AACA,YAAIc,cAAc,KAAK9M,aAAL,IAAsB8M,WAAWb,YAAnD,EAAiE;AAC7D,iBAAK1N,YAAL,CAAkB4G,WAAlB,GAAgCuH,UAAUG,sBAAV,CAAiC,yBAAjC,EAA4D,YAA5D,CAAhC;AACA;AACH,SAHD,MAGO;AACH,iBAAKtO,YAAL,CAAkB4G,WAAlB,GAAgCuH,UAAUG,sBAAV,CAAiC,yBAAjC,EAA4D,WAA5D,CAAhC;AACA;AACA,gBAAIC,UAAJ,EAAgB;AACZ,qBAAKnO,WAAL,CAAiB+D,MAAjB,GAA0BoK,WAAWb,YAAX,GAA0B,KAAKjM,aAAzD;AACH;AACJ;AACD,aAAKvB,QAAL,CAAckO,UAAd,CAAyB,KAAzB;AACA,YAAIhL,OAAOwE,QAAP,CAAgBmG,YAAhB,GAA+B,CAAnC,EAAsC;AAClC,iBAAK9N,UAAL,CAAgBkE,MAAhB,GAAyBf,OAAOwE,QAAP,CAAgBmG,YAAzC;AACA;AACH,SAHD,MAGO;AACH,iBAAK9N,UAAL,CAAgBkE,MAAhB,GAAyB,GAAzB;AACA;AACH;AACD;;AAEA;AACA,YAAIqK,cAAcpL,OAAOqK,cAAP,CAAsB,CAAtB,CAAlB;AACA,YAAIe,eAAe,KAAK9M,cAAL,IAAuB8M,YAAYd,YAAtD,EAAoE;AAChE,iBAAKrN,aAAL,CAAmBuG,WAAnB,GAAiCuH,UAAUG,sBAAV,CAAiC,yBAAjC,EAA4D,aAA5D,CAAjC;AACH,SAFD,MAEO;AACH,iBAAKjO,aAAL,CAAmBuG,WAAnB,GAAiCuH,UAAUG,sBAAV,CAAiC,yBAAjC,EAA4D,YAA5D,CAAjC;AACH;AACD,aAAKhO,WAAL,CAAiB6D,MAAjB,GAA0B,MAA1B;AACH,KAj6BI;;AAm6BL;AACAkB,iBAAa,uBAAY;AACrB;;;;;;;AAOH,KA56BI;;AA86BL;AACAoJ,iBAAa,uBAAY;AACrB;AACA,aAAKzK,IAAL,CAAU0K,GAAV,CAActR,GAAGQ,IAAH,CAAQ+Q,SAAR,CAAkBC,WAAhC,EAA6C,KAAKC,SAAlD,EAA6D,IAA7D;AACA;AACA,aAAK7K,IAAL,CAAU0K,GAAV,CAActR,GAAGQ,IAAH,CAAQ+Q,SAAR,CAAkBG,UAAhC,EAA4C,KAAKC,QAAjD,EAA2D,IAA3D;AACA;AACA,aAAK/K,IAAL,CAAU0K,GAAV,CAActR,GAAGQ,IAAH,CAAQ+Q,SAAR,CAAkBK,SAAhC,EAA2C,KAAKC,OAAhD,EAAyD,IAAzD;AACH,KAt7BI;;AAw7BLpL,mBAAe,yBAAY;AACvB,aAAK,IAAIoE,SAAS,CAAlB,EAAqBA,SAAS7E,OAAOC,IAArC,EAA2C4E,QAA3C,EAAqD;AACjD,iBAAK,IAAID,SAAS,CAAlB,EAAqBA,SAAS5E,OAAOK,IAArC,EAA2CuE,QAA3C,EAAqD;AACjD,oBAAIwF,QAAQ;AACRvF,4BAAQA,MADA;AAERD,4BAAQA;AAFA,iBAAZ;AAIA,oBAAI,CAAC,KAAKhJ,QAAL,CAAciJ,MAAd,CAAL,EAA4B;AACxB,yBAAKjJ,QAAL,CAAciJ,MAAd,IAAwB,EAAxB;AACH;AACD,qBAAKjJ,QAAL,CAAciJ,MAAd,EAAsBD,MAAtB,IAAgC,KAAKkH,UAAL,CAAgB1B,KAAhB,CAAhC;AACH;AACJ;AACJ,KAr8BI;;AAu8BL;AACA0B,gBAAY,oBAAU1B,KAAV,EAAiB;AACzB;AACA,YAAIvF,SAASuF,MAAMvF,MAAnB;AACA,YAAID,SAASwF,MAAMxF,MAAnB;AACA,YAAIqE,OAAO,KAAKvN,MAAL,GAAcmJ,SAAS7E,OAAOE,QAA9B,GAAyC2E,SAAS7E,OAAOG,SAApE;AACA,YAAI+I,OAAO,KAAKvN,MAAL,GAAciJ,SAAS5E,OAAOE,QAA9B,GAAyC0E,SAAS5E,OAAOG,SAApE;;AAEA;AACA,YAAI4L,WAAW/R,GAAG+K,WAAH,CAAe,KAAKpK,UAApB,CAAf;AACAoR,iBAAS1M,WAAT,CAAqBrF,GAAGkL,CAAH,CAAK+D,IAAL,EAAWC,IAAX,CAArB;;AAEA6C,iBAASpM,cAAT,CAAwB,EAAxB;;AAEA;AACA,YAAIqM,WAAWD,SAASzM,YAAT,CAAsB,UAAtB,CAAf;AACA0M,iBAASpL,IAAT,CAAcvB,WAAd,CAA0B4J,IAA1B,EAAgCC,IAAhC;AACA8C,iBAASC,QAAT,CAAkBpH,MAAlB,EAA0BD,MAA1B,EAAkC,IAAlC;AACA,aAAKhE,IAAL,CAAUwE,QAAV,CAAmB2G,QAAnB;AACA,eAAOA,QAAP;AACH,KA39BI;;AA69BLG,eAAW,mBAAUC,KAAV,EAAiB;AACxB,YAAI7H,OAAO,IAAX;AACA,YAAI,CAACA,KAAKxG,cAAV,EAA0B;AACtB;AACH;AACD,YAAI,KAAKC,YAAL,IAAqB,CAAzB,EAA4B;AACxB;AACH;AACD,YAAIqO,YAAYD,MAAME,WAAN,EAAhB;AACA/H,aAAK8H,SAAL,GAAiBA,SAAjB;;AAEA;AACA,aAAK/P,IAAL,CAAUiQ,cAAV;AACA,YAAIC,SAASvS,GAAGwS,OAAH,CAAW,GAAX,EAAgB,CAAhB,EAAmB,CAAnB,CAAb;AACA,aAAKnQ,IAAL,CAAUgK,SAAV,CAAoBkG,MAApB;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,YAAIE,YAAY,KAAKL,SAAL,CAAe9M,YAAf,CAA4B,UAA5B,EAAwCwF,IAAxC,CAA6CxF,YAA7C,CAA0D,UAA1D,EAAsEoN,iBAAtE,EAAhB;AACA,aAAKN,SAAL,CAAe9M,YAAf,CAA4B,UAA5B,EAAwCwF,IAAxC,GAA+C,IAA/C;AACA;AACA,YAAI6H,aAAa,KAAKP,SAAL,CAAe9M,YAAf,CAA4B,UAA5B,EAAwCuF,MAAzD;AACA,YAAI+H,aAAa,KAAKR,SAAL,CAAe9M,YAAf,CAA4B,UAA5B,EAAwCsF,MAAzD;AACA,aAAK,IAAIA,SAASgI,aAAa,CAA/B,EAAkChI,SAAS,CAA3C,EAA8CA,QAA9C,EAAwD;AACpD,gBAAIiI,WAAW,KAAK/G,eAAL,CAAqB6G,UAArB,EAAiC/H,MAAjC,EAAyC,IAAzC,CAAf;AACH;;AAED,aAAK7G,YAAL;AACA,aAAKD,cAAL,GAAsB,KAAtB;AACA;AACAkC,eAAO8M,MAAP,IAAiB9M,OAAO+M,QAAxB;AACA;AACA,YAAI,OAAOjK,EAAP,KAAc,WAAlB,EAA+B;AAC3B,gBAAIuB,OAAOvK,SAASkT,cAAT,EAAX;AACA,gBAAIrP,QAAQqG,SAASK,KAAK4I,QAAd,CAAZ;AACA,gBAAIC,OAAOlJ,SAASK,KAAK6I,IAAd,CAAX;AACApT,qBAASqT,SAAT,CAAmB,UAACF,QAAD,EAAWC,IAAX,EAAoB;AACnCvP,wBAAQqG,SAASiJ,QAAT,CAAR;AACAC,uBAAOlJ,SAASkJ,IAAT,CAAP;AACAzN,wBAAQC,GAAR,CAAY,sCAAZ,EAAoD/B,KAApD,EAA2DqG,SAASkJ,IAAT,CAA3D,EAA2ElN,OAAO8M,MAAlF;AACH,aAJD;AAKAhT,qBAASsT,SAAT,CAAmBzP,KAAnB,EAA0BqC,OAAO8M,MAAjC;AACH;AACD;AACA,YAAIO,YAAY,KAAKjR,QAAL,CAAc4F,cAAd,CAA6B,OAA7B,CAAhB;AACAqL,kBAAU/N,YAAV,CAAuBtF,GAAGgB,KAA1B,EAAiC+F,MAAjC,GAA0Cf,OAAO8M,MAAjD;;AAGA;AACA;AACA;AACA;AACH,KAthCI;;AAwhCL;AACAQ,aAAS,mBAAY;AACjB,aAAKzE,mBAAL;AACA,YAAI0E,kBAAkBxT,QAAQ,iBAAR,CAAtB;AACAwT,wBAAgBC,gBAAhB,CAAiC,KAAKC,WAAL,CAAiBxO,IAAjB,CAAsB,IAAtB,CAAjC,EAA8D,KAAKyO,QAAL,CAAczO,IAAd,CAAmB,IAAnB,CAA9D;AACA;AACA,YAAIiD,aAAanI,QAAQ,YAAR,CAAjB;AACAmI,mBAAWyL,eAAX;AACH,KAhiCI;;AAkiCL;AACAF,iBAAa,uBAAY;AAAA;;AACrB;AACA,YAAIxK,SAASjJ,GAAG4T,IAAH,CAAQ,QAAR,CAAb;AACA,YAAIC,SAAS,KAAK/S,WAAL,CAAiBkH,cAAjB,CAAgC,QAAhC,CAAb;AACA,YAAI6L,MAAJ,EAAY;AACRA,mBAAOvL,KAAP,GAAeW,OAAOX,KAAtB;AACAuL,mBAAOvL,KAAP,GAAeW,OAAOX,KAAtB;AACH;AACD,aAAKwL,eAAL;AACA,aAAKhT,WAAL,CAAiB6F,MAAjB,GAA0B,IAA1B;AACA,YAAIzB,SAASnF,QAAQ,QAAR,CAAb;AACA,YAAIgU,cAAc7O,OAAOqI,cAAP,CAAsBvH,OAAOgO,cAA7B,CAAlB;AACA,YAAIC,aAAajO,OAAOqK,cAAP,CAAsB0D,WAAtB,CAAjB;;AAEA;AACA,YAAIE,UAAJ,EAAgB;AACZ,gBAAIF,eAAe,CAAnB,EAAsB;AAClB/N,uBAAOwE,QAAP,CAAgByF,YAAhB,GAA+BnQ,SAASoU,eAAT,EAA/B;AACAlO,uBAAOwE,QAAP,CAAgByF,YAAhB,IAAgCjG,SAASiK,WAAWE,cAApB,CAAhC;AACArU,yBAASsU,gBAAT,CAA0BpO,OAAOwE,QAAP,CAAgByF,YAA1C;AACH,aAJD,MAIO,IAAI8D,eAAe,CAAnB,EAAsB;AACzB/N,uBAAOwE,QAAP,CAAgBmG,YAAhB,GAA+B7Q,SAASuU,eAAT,EAA/B;AACArO,uBAAOwE,QAAP,CAAgBmG,YAAhB,IAAgC3G,SAASiK,WAAWE,cAApB,CAAhC;AACArU,yBAASwU,gBAAT,CAA0BtO,OAAOwE,QAAP,CAAgBmG,YAA1C;AACH,aAJM,MAIA,IAAIoD,eAAe,CAAnB,EAAsB;AACzB/N,uBAAOwE,QAAP,CAAgBqG,aAAhB,IAAiC7G,SAASiK,WAAWE,cAApB,CAAjC;AACH,aAFM,MAEA,IAAIJ,eAAe,CAAnB,EAAsB;AACzB/N,uBAAOuO,OAAP,CAAe/M,UAAf,CAA0BwC,SAASiK,WAAWE,cAApB,CAA1B;AACA,oBAAI/F,iBAAiBpI,OAAOoI,cAAP,CAAsB9I,YAAtB,CAAmC,gBAAnC,CAArB;AACA8I,+BAAeoG,QAAf;AACH;AACJ;;AAGD,YAAIP,UAAJ,EAAgB;AACZ,gBAAI3J,OAAO,IAAX;AACA,gBAAIyG,YAAYhR,QAAQ,WAAR,CAAhB;AACAgR,sBAAU0D,YAAV,CAAuB,yBAAvB,EAAkD,YAAY;AAC1D,oBAAI1D,YAAYhR,QAAQ,WAAR,CAAhB;AACAuK,qBAAKrJ,YAAL,CAAkBuI,WAAlB,GAAgCuH,UAAUG,sBAAV,CAAiC,yBAAjC,EAA4D+C,WAAWS,aAAvE,CAAhC;AACH,aAHD;AAIApK,iBAAKvJ,YAAL,CAAkBgG,MAAlB,GAA2BkN,WAAWU,IAAX,GAAkB,GAAlB,GAAwBV,WAAWE,cAA9D;AACH;AACD;AACArU,iBAAS4K,sBAAT,CAAgC1E,OAAOwE,QAAvC;AACA,YAAIxE,OAAOoI,cAAP,CAAsB9I,YAAtB,CAAmC,gBAAnC,CAAJ,EAA0D;AACtDU,mBAAOoI,cAAP,CAAsB9I,YAAtB,CAAmC,gBAAnC,EAAqDiL,aAArD;AACH;AACD,aAAKqE,UAAL,GAAkBhM,WAAW,YAAM;AAC3B,mBAAKiM,gBAAL;AACX,SAFqB,EAEnB,IAFmB,CAAlB;;AAIA;AACA,YAAI3M,aAAanI,QAAQ,YAAR,CAAjB;AACAmI,mBAAWC,cAAX;;AAEA,aAAK0G,mBAAL;AACH,KA5lCI;;AA8lCL6E,cAAU,oBAAY;AAClB1N,eAAOkK,IAAP,CAAYC,kBAAZ,CAA+B,YAA/B;AACA;AACA,YAAIjI,aAAanI,QAAQ,YAAR,CAAjB;AACAmI,mBAAWC,cAAX;AACH,KAnmCI;;AAqmCL0M,sBAAiB,4BAAU;AACvB,aAAK/T,WAAL,CAAiB6F,MAAjB,GAA0B,KAA1B;AACH,KAvmCI;;AAymCLmN,qBAAiB,2BAAY;AACzB,aAAK5S,KAAL,CAAW0F,IAAX,CAAgByF,SAAhB,CACIrM,GAAG8U,aAAH,CACI9U,GAAGsM,QAAH,CAAYtM,GAAG+U,QAAH,CAAY,GAAZ,EAAiB,CAAC,EAAlB,CAAZ,EAAmC/U,GAAG+U,QAAH,CAAY,GAAZ,EAAiB,CAAC,EAAlB,CAAnC,EAA0D/U,GAAG+U,QAAH,CAAY,GAAZ,EAAiB,CAAC,EAAlB,CAA1D,EAAiF/U,GAAG+U,QAAH,CAAY,GAAZ,EAAiB,CAAC,EAAlB,CAAjF,CADJ,CADJ;AAIH,KA9mCI;;AAgnCL;AACAC,eAAW,qBAAY;AACnB,YAAIhP,OAAO8M,MAAP,GAAgB9M,OAAO+M,QAA3B,EAAqC;AACjCtN,oBAAQC,GAAR,CAAY,oBAAoBM,OAAO+M,QAAvC;AACA;AACH;;AAED,YAAI,KAAKjP,cAAT,EAAyB;AACrB,iBAAKmR,SAAL;AACH,SAFD,MAEO;AACH,gBAAI1C,SAASvS,GAAGkV,OAAH,CAAW,GAAX,EAAgB,GAAhB,EAAqB,GAArB,CAAb;AACA,gBAAIC,SAASnV,GAAGkV,OAAH,CAAW,GAAX,EAAgB,IAAI,GAApB,EAAyB,IAAI,GAA7B,CAAb;AACA,gBAAIE,SAASpV,GAAGoV,MAAH,CAAUpV,GAAGsM,QAAH,CAAYiG,MAAZ,EAAoB4C,MAApB,CAAV,EAAuC,KAAvC,CAAb;AACA,iBAAK9S,IAAL,CAAUiQ,cAAV;AACA,iBAAKjQ,IAAL,CAAUgK,SAAV,CAAoB+I,MAApB;AACA;AACA;AACA;AACA;AACA,iBAAKtR,cAAL,GAAsB,IAAtB;AACA,iBAAKC,YAAL,GAAoB,CAApB;AACH;AACJ,KAtoCI;;AAwoCLkR,eAAW,qBAAY;AACnB,aAAKnR,cAAL,GAAsB,KAAtB;AACA,aAAKzB,IAAL,CAAUiQ,cAAV;AACA,YAAIC,SAASvS,GAAGwS,OAAH,CAAW,GAAX,EAAgB,CAAhB,EAAmB,CAAnB,CAAb;AACA,aAAKnQ,IAAL,CAAUgK,SAAV,CAAoBkG,MAApB;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,KA3pCI;;AA6pCL;AACA/C,qBAAiB,yBAAU6F,KAAV,EAAiBC,KAAjB,EAAwB;AACrC,YAAIC,WAAW,CAAf;AACA,aAAK,IAAItJ,QAAQjG,OAAOK,IAAP,GAAc,CAA/B,EAAkC4F,SAAS,CAA3C,EAA8CA,OAA9C,EAAuD;AACnD,gBAAIrF,OAAO,KAAKhF,QAAL,CAAcyT,KAAd,EAAqBpJ,KAArB,CAAX;AACA,gBAAI+F,WAAWpL,KAAKtB,YAAL,CAAkB,UAAlB,CAAf;AACA,gBAAI0M,YAAYA,SAASlH,IAAT,IAAiB,IAA7B,IAAqCkH,SAASpH,MAAT,GAAkB0K,KAA3D,EAAkE;AAC9DC;AACH;AACJ;AACD,eAAOA,QAAP;AACH,KAxqCI;;AA0qCL;AACA7O,qBAAiB,2BAAY;AACzB,YAAI4D,OAAO,IAAX;AACA,YAAIA,KAAK1D,IAAL,CAAUmJ,MAAd,EAAsB;AAClB;AACAzF,iBAAK1D,IAAL,CAAU4O,EAAV,CAAaxV,GAAGQ,IAAH,CAAQ+Q,SAAR,CAAkBC,WAA/B,EAA4C,KAAKC,SAAjD,EAA4D,IAA5D;AACA;AACAnH,iBAAK1D,IAAL,CAAU4O,EAAV,CAAaxV,GAAGQ,IAAH,CAAQ+Q,SAAR,CAAkBG,UAA/B,EAA2C,KAAKC,QAAhD,EAA0D,IAA1D;AACA;AACArH,iBAAK1D,IAAL,CAAU4O,EAAV,CAAaxV,GAAGQ,IAAH,CAAQ+Q,SAAR,CAAkBK,SAA/B,EAA0C,KAAKC,OAA/C,EAAwD,IAAxD;AACH;AACJ,KArrCI;;AAurCLJ,eAAW,mBAAUU,KAAV,EAAiB;AACxB,YAAI,CAAC,KAAKtQ,QAAV,EAAoB;AACpB,aAAKC,kBAAL,GAA0BqQ,MAAMsD,WAAN,EAA1B;AACA,aAAKxR,aAAL,GAAqB,KAAKD,eAA1B;AACA,aAAK0R,UAAL,GAAkBvL,KAAKwL,IAAL,CAAUxL,KAAKC,GAAL,CAAS,CAAC,KAAKvI,QAAL,CAAcwG,CAAd,GAAkB,KAAK3G,MAAxB,IAAkCsE,OAAOE,QAAlD,CAAV,CAAlB;AACH,KA5rCI;;AA8rCLyL,cAAU,kBAAUQ,KAAV,EAAiB;AACvB,YAAI,CAAC,KAAKtQ,QAAV,EAAoB;AACpB,YAAI,KAAKoC,aAAL,IAAsB,KAAKD,eAA/B,EAAgD;AAC5C;AACH;AACD,YAAIsG,OAAO,IAAX;AACA,YAAI,KAAKzI,QAAL,IAAiB,KAAKA,QAAL,CAAcyD,YAAd,CAA2B,UAA3B,EAAuCsQ,OAAxD,IAAmE,CAAC5V,GAAGkQ,IAAH,CAAQ2F,QAAR,EAApE,IAA0F,CAAC,KAAK/R,cAApG,EAAoH;AAChH,gBAAIgS,WAAW3D,MAAMsD,WAAN,EAAf;AACA,gBAAIM,OAAOD,SAASzN,CAAT,GAAaiC,KAAKxI,kBAAL,CAAwBuG,CAAhD;AACA,gBAAI2N,WAAWF,SAASvP,CAAT,GAAa+D,KAAKxI,kBAAL,CAAwByE,CAApD;;AAEA;AACA,gBAAI0P,WAAW9L,KAAK+L,KAAL,CAAWH,OAAO/P,OAAOmQ,aAAzB,CAAf;AACA,gBAAIC,aAAajM,KAAKC,GAAL,CAAS4L,QAAT,IAAqBhQ,OAAOqQ,iBAA5B,GAAgD,IAAhD,GAAuD,KAAxE;;AAEA;AACA,gBAAIpU,aAAaqI,KAAKgM,WAAL,CAAiB,KAAKZ,UAAL,GAAkBO,QAAnC,CAAjB;AACA,gBAAIG,UAAJ,EAAgB;AACZ3Q,wBAAQC,GAAR,CAAY,aAAZ,EAA2BuQ,QAA3B;AACA;AACA,oBAAIM,cAAcT,SAASvP,CAAT,IAAc+D,KAAKxI,kBAAL,CAAwByE,CAAtC,GAA0C,IAA1C,GAAiD,KAAnE;AACA;AACA,oBAAItE,aAAaqI,KAAKkM,gBAAL,CAAsBD,WAAtB,CAAjB;AACA,oBAAItU,UAAJ,EAAgB;AACZ,yBAAKJ,QAAL,CAAcwG,CAAd,GAAkBpG,WAAWgJ,WAAX,GAAyB5C,CAA3C;AACA,wBAAI2D,UAAU1B,KAAKkF,eAAL,CAAqBvN,WAAWqD,YAAX,CAAwB,UAAxB,EAAoCuF,MAAzD,EAAiE5I,WAAWqD,YAAX,CAAwB,UAAxB,EAAoCsF,MAArG,CAAd;AACA,wBAAI6E,aAAanF,KAAK1I,QAAL,CAAcK,WAAWqD,YAAX,CAAwB,UAAxB,EAAoCuF,MAAlD,EAA0D5I,WAAWqD,YAAX,CAAwB,UAAxB,EAAoCsF,MAApC,GAA6CoB,OAAvG,CAAjB;AACA,wBAAIyK,UAAUnM,KAAK1I,QAAL,CAAcK,WAAWqD,YAAX,CAAwB,UAAxB,EAAoCuF,MAAlD,EAA0D5I,WAAWqD,YAAX,CAAwB,UAAxB,EAAoCsF,MAA9F,CAAd;AACA6L,4BAAQnR,YAAR,CAAqB,UAArB,EAAiCuG,MAAjC,GAA0C,KAA1C;AACA4D,+BAAWnK,YAAX,CAAwB,UAAxB,EAAoCuG,MAApC,GAA6C,IAA7C;;AAEA,yBAAKhK,QAAL,CAAcyD,YAAd,CAA2B,UAA3B,EAAuCrD,UAAvC,GAAoDwN,UAApD;AACA;AACA;AACA,wBAAI,KAAK5N,QAAL,CAAcyD,YAAd,CAA2B,UAA3B,EAAuCyG,QAAvC,IAAmD,CAAnD,IAAwD,KAAKlK,QAAL,CAAcyD,YAAd,CAA2B,UAA3B,EAAuCyG,QAAvC,IAAmD,CAA/G,EAAkH;AAC9GzB,6BAAKoM,WAAL,GAAmB,KAAK7U,QAAL,CAAcyD,YAAd,CAA2B,UAA3B,EAAuCqR,qBAAvC,CAA6D3Q,OAAO4Q,kBAApE,CAAnB;AACH;AACDtM,yBAAK1D,IAAL,CAAU0L,cAAV;AACAhI,yBAAKsB,aAAL;AACH;AACJ,aAvBD,MAuBO,IAAI3J,UAAJ,EAAgB;AACnB,qBAAKJ,QAAL,CAAcwG,CAAd,GAAkBpG,WAAWgJ,WAAX,GAAyB5C,CAA3C;AACArI,mBAAG0F,GAAH,CAAO,sBAAsB,KAAK7D,QAAL,CAAcwG,CAA3C;AACA,oBAAI2D,UAAU1B,KAAKkF,eAAL,CAAqBvN,WAAWqD,YAAX,CAAwB,UAAxB,EAAoCuF,MAAzD,EAAiE5I,WAAWqD,YAAX,CAAwB,UAAxB,EAAoCsF,MAArG,CAAd;AACA,oBAAI6E,aAAanF,KAAK1I,QAAL,CAAcK,WAAWqD,YAAX,CAAwB,UAAxB,EAAoCuF,MAAlD,EAA0D5I,WAAWqD,YAAX,CAAwB,UAAxB,EAAoCsF,MAApC,GAA6CoB,OAAvG,CAAjB;AACA,oBAAIyK,UAAUnM,KAAK1I,QAAL,CAAcK,WAAWqD,YAAX,CAAwB,UAAxB,EAAoCuF,MAAlD,EAA0D5I,WAAWqD,YAAX,CAAwB,UAAxB,EAAoCsF,MAA9F,CAAd;AACA6L,wBAAQnR,YAAR,CAAqB,UAArB,EAAiCuG,MAAjC,GAA0C,KAA1C;AACA4D,2BAAWnK,YAAX,CAAwB,UAAxB,EAAoCuG,MAApC,GAA6C,IAA7C;;AAEA,qBAAKhK,QAAL,CAAcyD,YAAd,CAA2B,UAA3B,EAAuCrD,UAAvC,GAAoDwN,UAApD;AACA,qBAAK5N,QAAL,CAAcyD,YAAd,CAA2B,UAA3B,EAAuCuR,qBAAvC,CAA6D7Q,OAAOuJ,aAApE;AACAjF,qBAAK1D,IAAL,CAAU0L,cAAV;AACAhI,qBAAKsB,aAAL;AACH;AACJ;AACJ,KArvCI;;AAuvCLiG,aAAS,iBAAUM,KAAV,EAAiB;AACtB,YAAI,CAAC,KAAKtQ,QAAV,EAAoB;AACpB;;;;;AAKA,YAAIiV,QAAQ3M,KAAKC,GAAL,CAAS+H,MAAMsD,WAAN,GAAoBlP,CAApB,GAAwB,KAAKzE,kBAAL,CAAwByE,CAAzD,CAAZ;;AAEA,YAAIuQ,SAAS,CAAb,EAAgB;AACZ,gBAAIxM,OAAO,IAAX;AACA;;;;;;;AAUA,gBAAIrI,aAAaqI,KAAKkM,gBAAL,CAAsB,IAAtB,CAAjB;AACA,gBAAIvU,UAAJ,EAAgB;AACZ,qBAAKJ,QAAL,CAAcwG,CAAd,GAAkBpG,WAAWgJ,WAAX,GAAyB5C,CAA3C;AACA,oBAAI2D,UAAU1B,KAAKkF,eAAL,CAAqBvN,WAAWqD,YAAX,CAAwB,UAAxB,EAAoCuF,MAAzD,EAAiE5I,WAAWqD,YAAX,CAAwB,UAAxB,EAAoCsF,MAArG,CAAd;AACA,oBAAI6E,aAAanF,KAAK1I,QAAL,CAAcK,WAAWqD,YAAX,CAAwB,UAAxB,EAAoCuF,MAAlD,EAA0D5I,WAAWqD,YAAX,CAAwB,UAAxB,EAAoCsF,MAApC,GAA6CoB,OAAvG,CAAjB;AACA,oBAAIyK,UAAUnM,KAAK1I,QAAL,CAAcK,WAAWqD,YAAX,CAAwB,UAAxB,EAAoCuF,MAAlD,EAA0D5I,WAAWqD,YAAX,CAAwB,UAAxB,EAAoCsF,MAA9F,CAAd;AACA6L,wBAAQnR,YAAR,CAAqB,UAArB,EAAiCuG,MAAjC,GAA0C,KAA1C;AACA4D,2BAAWnK,YAAX,CAAwB,UAAxB,EAAoCuG,MAApC,GAA6C,IAA7C;;AAEA,qBAAKhK,QAAL,CAAcyD,YAAd,CAA2B,UAA3B,EAAuCrD,UAAvC,GAAoDwN,UAApD;;AAEAzP,mBAAG0F,GAAH,CAAO,gBAAgBsG,OAAvB;AACA;AACA,oBAAI,KAAKnK,QAAL,CAAcyD,YAAd,CAA2B,UAA3B,EAAuCyG,QAAvC,IAAmD,CAAnD,IAAwD,KAAKlK,QAAL,CAAcyD,YAAd,CAA2B,UAA3B,EAAuCyG,QAAvC,IAAmD,CAA/G,EAAkH;AAC9GzB,yBAAKoM,WAAL,GAAmB,KAAK7U,QAAL,CAAcyD,YAAd,CAA2B,UAA3B,EAAuCqR,qBAAvC,CAA6D3Q,OAAO4Q,kBAApE,CAAnB;AACH;AACDtM,qBAAK1D,IAAL,CAAU0L,cAAV;AACAhI,qBAAKsB,aAAL;AACH;AACJ;AACJ,KAhyCI;;AAkyCL;AACA0K,iBAAa,qBAAUS,MAAV,EAAkB;AAC3B;AACA,YAAIC,UAAU7M,KAAKwL,IAAL,CAAUxL,KAAKC,GAAL,CAAS,CAAC,KAAKvI,QAAL,CAAcwG,CAAd,GAAkB,KAAK3G,MAAxB,IAAkCsE,OAAOE,QAAlD,CAAV,CAAd;AACA,YAAI+Q,UAAU9M,KAAKwL,IAAL,CAAUxL,KAAKC,GAAL,CAAS,CAAC,KAAKvI,QAAL,CAAc0E,CAAd,GAAkB,KAAK5E,MAAxB,IAAkCqE,OAAOE,QAAlD,CAAV,CAAd;;AAEA,YAAI6Q,UAAUC,OAAd,EAAuB;AACnB,mBAAO,IAAP;AACH;;AAED,YAAID,SAAS,CAAT,IAAcA,UAAU/Q,OAAOC,IAAnC,EAAyC;AACrC,mBAAO,IAAP;AACH;AACD;AACA;AACA,YAAIvE,SAASqV,SAAS,CAAtB;AACA,YAAIG,OAAOF,UAAU,CAArB;AACA,YAAID,SAASC,OAAb,EAAsB;AAClBtV,qBAASsV,UAAU,CAAnB;AACAE,mBAAOH,SAAS,CAAhB;AACH;AACD,eAAOrV,UAAUwV,IAAjB,EAAuB;AACnB,gBAAIC,eAAe,KAAKvV,QAAL,CAAcF,MAAd,EAAsBuV,OAAtB,CAAnB;AACA,gBAAIE,gBAAgBA,aAAa7R,YAAb,CAA0B,UAA1B,EAAsCwF,IAAtC,IAA8C,IAAlE,EAAwE;AACpEpJ;AACA;AACH;AACD,mBAAO,IAAP;AACH;AACD,YAAIyV,eAAe,KAAKvV,QAAL,CAAcmV,MAAd,EAAsBE,OAAtB,CAAnB;;AAEA,YAAIE,gBAAgBA,aAAa7R,YAAb,CAA0B,UAA1B,EAAsCwF,IAAtC,IAA8C,IAAlE,EAAwE;AACpE,mBAAOqM,YAAP;AACH;AACD,eAAO,IAAP;AACH,KAr0CI;;AAu0CL;AACAX,sBAAkB,0BAAUD,WAAV,EAAuB;AACrC;AACA,YAAI1L,SAASV,KAAKwL,IAAL,CAAUxL,KAAKC,GAAL,CAAS,CAAC,KAAKvI,QAAL,CAAcwG,CAAd,GAAkB,KAAK3G,MAAxB,IAAkCsE,OAAOE,QAAlD,CAAV,CAAb;AACA,YAAI0E,SAAST,KAAKiN,KAAL,CAAWjN,KAAKC,GAAL,CAAS,CAAC,KAAKvI,QAAL,CAAc0E,CAAd,GAAkB,KAAK5E,MAAxB,IAAkCqE,OAAOE,QAAlD,CAAX,CAAb;;AAEA,YAAI,CAACqQ,WAAL,EAAkB;AACd,mBAAO,IAAP;AACH;AACD,YAAI3L,UAAW5E,OAAOK,IAAP,GAAc,CAA7B,EAAiC;AAC7B,mBAAO,IAAP;AACH;;AAED,YAAI8Q,eAAe,KAAKvV,QAAL,CAAciJ,MAAd,EAAsBD,SAAS,CAA/B,CAAnB;AACA,YAAIuM,gBAAgBA,aAAa7R,YAAb,CAA0B,UAA1B,EAAsCwF,IAAtC,IAA8C,IAAlE,EAAwE;AACpE,mBAAOqM,YAAP;AACH;AACD,eAAO,IAAP;AACH,KAz1CI;;AA21CL;AACArL,qBAAiB,yBAAUiL,MAAV,EAAkBM,MAAlB,EAA0BC,WAA1B,EAAuC;AACpD,YAAIC,iBAAiB,KAAK3V,QAAL,CAAcmV,MAAd,EAAsBM,MAAtB,EAA8B/R,YAA9B,CAA2C,UAA3C,CAArB;AACA,YAAIiS,eAAezM,IAAf,IAAuB,IAA3B,EAAiC;AAC7B,mBAAO,KAAP;AACH;AACD,YAAIkB,OAAJ;AACA,YAAIsL,WAAJ,EAAiB;AACbtL,sBAAU,CAAV;AACH,SAFD,MAEO;AACHA,sBAAU,KAAKwD,eAAL,CAAqBuH,MAArB,EAA6BM,MAA7B,CAAV;AACH;AACD;AACA,YAAIrL,WAAW,CAAf,EAAkB;AACd,mBAAO,KAAP;AACH;;AAED,YAAIyD,aAAa,KAAK7N,QAAL,CAAcmV,MAAd,EAAsBM,SAASrL,OAA/B,CAAjB;AACAyD,mBAAWnK,YAAX,CAAwB,UAAxB,EAAoCuG,MAApC,GAA6C,IAA7C;AACA,YAAI2L,WAAWD,eAAezM,IAAf,CAAoBxF,YAApB,CAAiC,UAAjC,CAAf;AACAkS,iBAASvV,UAAT,GAAsBwN,UAAtB;;AAEA,YAAIH,YAAa,KAAKzD,MAAL,IAAe7F,OAAO6G,YAAP,GAAsB,CAAtC,GAA2C7G,OAAOyR,oBAAlD,GAAyEzR,OAAOuJ,aAAhG;AACA9J,gBAAQC,GAAR,CAAY,QAAQ4J,SAApB,EAA+BtJ,OAAO6G,YAAtC;AACA,YAAI6K,UAAUF,SAAS9H,gBAAT,CAA0BJ,SAA1B,CAAd;;AAEAiI,uBAAezM,IAAf,GAAsB,IAAtB;AACA;AACAyM,uBAAejM,OAAf,GAAyB,CAAzB;AACA;AACA,aAAK1H,SAAL,CAAeiK,IAAf,CAAoB2J,QAApB;;AAEA,eAAO,IAAP;AACH,KA53CI;;AA83CL;AACAG,qBAAiB,2BAAY;AACzB3R,eAAOkK,IAAP,CAAY0H,SAAZ,CAAsB,KAAtB,EAA6B,GAA7B;AACA,YAAI5R,OAAO6P,QAAX,EAAqB;AACjB,gBAAI,KAAKhU,QAAT,EAAmB;AACf,qBAAKA,QAAL,CAAcgW,gBAAd;AACH;AACD,iBAAKjR,IAAL,CAAUiR,gBAAV;AACA,iBAAK1W,SAAL,CAAewF,MAAf,GAAwB,KAAxB;AACAX,mBAAO6P,QAAP,GAAkB,KAAlB;AACH,SAPD,MAOO;AACH,gBAAI,KAAK/R,cAAT,EAAyB;AACrB,qBAAKmR,SAAL;AACH;AACD,gBAAI,KAAKpT,QAAT,EAAmB;AACf,qBAAKA,QAAL,CAAciW,eAAd;AACH;AACD,iBAAKlR,IAAL,CAAUkR,eAAV;;AAEA9R,mBAAO6P,QAAP,GAAkB,IAAlB;AACA,iBAAK1U,SAAL,CAAewF,MAAf,GAAwB,IAAxB;AACA,iBAAKxF,SAAL,CAAewE,cAAf,CAA8B,EAA9B;AACH;AACJ,KAr5CI;;AAu5CL;AACAkJ,yBAAqB,+BAAY;AAC7B,YAAI7I,OAAO6P,QAAX,EAAqB;AACjB,gBAAI,KAAKhU,QAAT,EAAmB;AACf,qBAAKA,QAAL,CAAcgW,gBAAd;AACH;AACD,iBAAKjR,IAAL,CAAUiR,gBAAV;AACA7R,mBAAO6P,QAAP,GAAkB,KAAlB;AACH,SAND,MAMO;AACH,gBAAI,KAAK/R,cAAT,EAAyB;AACrB,qBAAKmR,SAAL;AACH;AACD,gBAAI,KAAKpT,QAAT,EAAmB;AACf,qBAAKA,QAAL,CAAciW,eAAd;AACH;AACD,iBAAKlR,IAAL,CAAUkR,eAAV;;AAEA9R,mBAAO6P,QAAP,GAAkB,IAAlB;AACH;AACJ,KA16CI;;AA46CL;AACApI,mBAAe,yBAAY;AACvBzH,eAAOkK,IAAP,CAAY0H,SAAZ,CAAsB,KAAtB,EAA6B,GAA7B;AACA,aAAKxW,UAAL,CAAgBuF,MAAhB,GAAyB,IAAzB;AACA,aAAKvF,UAAL,CAAgBuE,cAAhB,CAA+B,CAA/B;AACA,aAAKkJ,mBAAL;AACH,KAl7CI;;AAo7CL;AACAkJ,mBAAe,yBAAY;AACvB/R,eAAOkK,IAAP,CAAY0H,SAAZ,CAAsB,KAAtB,EAA6B,GAA7B;AACA,aAAKxW,UAAL,CAAgBuF,MAAhB,GAAyB,KAAzB;AACA,aAAKkI,mBAAL;AACH,KAz7CI;;AA27CL;AACAmJ,sBAAkB,4BAAY;AAC1BhS,eAAOkK,IAAP,CAAY0H,SAAZ,CAAsB,KAAtB,EAA6B,GAA7B;AACA,aAAKpU,SAAL,CAAemD,MAAf,GAAwB,KAAxB;AACA,aAAKkI,mBAAL;AACA,aAAKD,cAAL;AACA,aAAKG,WAAL;AACA,aAAKxH,OAAL;AACA,aAAKvD,eAAL;AACH,KAp8CI;;AAs8CL;AACAiU,eAAW,qBAAY;AACnBjS,eAAOkK,IAAP,CAAY0H,SAAZ,CAAsB,KAAtB,EAA6B,GAA7B;AACA,aAAKvG,WAAL;AACA,aAAK7K,KAAL;;AAEA,YAAI,KAAK3E,QAAL,IAAiB,KAAKA,QAAL,CAAckO,MAAnC,EAA2C;AACvC,iBAAKlO,QAAL,CAAckO,MAAd,CAAqBmI,WAArB,CAAiC,KAAKrW,QAAtC;AACH;AACDmE,eAAOkK,IAAP,CAAYiI,OAAZ;AACH,KAh9CI;;AAk9CL;AACAC,iBAAa,uBAAY;AACrBpS,eAAOkK,IAAP,CAAY0H,SAAZ,CAAsB,KAAtB,EAA6B,GAA7B;AACA,aAAKvG,WAAL;AACA,aAAK7K,KAAL;;AAEA,YAAI,KAAK3E,QAAL,IAAiB,KAAKA,QAAL,CAAckO,MAAnC,EAA2C;AACvC,iBAAKlO,QAAL,CAAckO,MAAd,CAAqBmI,WAArB,CAAiC,KAAKrW,QAAtC;AACH;AACDmE,eAAOkK,IAAP,CAAYmI,SAAZ;AACA;AACA,YAAIrY,GAAGkQ,IAAH,CAAQ2F,QAAR,EAAJ,EAAwB;AACpB7V,eAAGkQ,IAAH,CAAQoI,MAAR;AACH;AACJ,KAh+CI;;AAk+CL;AACAC,iBAAa,uBAAY;AACrBvS,eAAOkK,IAAP,CAAY0H,SAAZ,CAAsB,KAAtB,EAA6B,GAA7B;AACA,YAAI,OAAOY,SAAP,KAAqB,WAAzB,EAAsC;AAClC1Y,qBAAS2Y,SAAT,CAAmB,KAAKC,YAAL,EAAnB,EAAwC,IAAxC;AACH,SAFD,MAEO;AACH5Y,qBAAS2Y,SAAT,CAAmB,mBAAnB,EAAwC,IAAxC,EAA8C,IAA9C,EAAoD,KAApD;AACH;AACJ,KA1+CI;;AA4+CL;AACAjR,gBAAY,oBAAUmR,OAAV,EAAmB;AAC3B,YAAItF,YAAY,KAAKjR,QAAL,CAAc4F,cAAd,CAA6B,OAA7B,CAAhB;AACAqL,kBAAU/N,YAAV,CAAuBtF,GAAGgB,KAA1B,EAAiC+F,MAAjC,GAA0Cf,OAAO8M,MAAjD;AACA;AACA,YAAI9M,OAAO4S,OAAP,CAAeD,OAAf,MAA4BzR,SAAhC,EAA2C;AACvClH,eAAG0F,GAAH,CAAO,cAAP;AACA;AACH;AACD,YAAIsE,SAAShE,OAAO4S,OAAP,CAAeD,OAAf,CAAT,KAAqC,CAAzC,EAA4C;AACxC;AACH;AACD;AACA,YAAI3S,OAAOuO,OAAX,EAAoB;AAChBvO,mBAAOuO,OAAP,CAAesE,YAAf,CAA4B7O,SAAShE,OAAO4S,OAAP,CAAeD,OAAf,CAAT,CAA5B;AACH;;AAEDlT,gBAAQC,GAAR,CAAY,QAAQM,OAAO4S,OAAP,CAAeD,OAAf,CAAR,GAAkC,WAAlC,GAAgDA,OAA5D;AACA;AACA,YAAI,OAAO7P,EAAP,KAAc,WAAlB,EAA+B;AAC3B,gBAAIuB,OAAOvK,SAASkT,cAAT,EAAX;AACA,gBAAIrP,QAAQqG,SAASK,KAAK4I,QAAd,CAAZ;AACA,gBAAIC,OAAOlJ,SAASK,KAAK6I,IAAd,CAAX;AACApT,qBAASqT,SAAT,CAAmB,UAACF,QAAD,EAAWC,IAAX,EAAoB;AACnCvP,wBAAQqG,SAASiJ,QAAT,CAAR;AACAC,uBAAOlJ,SAASkJ,IAAT,CAAP;AACAzN,wBAAQC,GAAR,CAAY,sCAAZ,EAAoD/B,KAApD,EAA2DqG,SAASkJ,IAAT,CAA3D,EAA2ElN,OAAO8M,MAAlF;AACH,aAJD;AAKAhT,qBAASsT,SAAT,CAAmBzP,KAAnB,EAA0BqC,OAAO8M,MAAjC;AACH;AACD,aAAK0B,QAAL;AACH,KA3gDI;;AA6gDLA,cAAU,oBAAY;AAClB,YAAInB,YAAY,KAAKjR,QAAL,CAAc4F,cAAd,CAA6B,OAA7B,CAAhB;AACAqL,kBAAU/N,YAAV,CAAuBtF,GAAGgB,KAA1B,EAAiC+F,MAAjC,GAA0Cf,OAAO8M,MAAjD;AACH,KAhhDI;;AAkhDL9L,mBAAe,yBAAY;AACvB,YAAI,KAAK3D,QAAL,CAAcsD,MAAlB,EAA0B;AACtB,iBAAKtD,QAAL,CAAcyV,QAAd,GAAyB,CAAzB;AACA,iBAAKzV,QAAL,CAAciP,cAAd;AACA,iBAAKjP,QAAL,CAAcgJ,SAAd,CACIrM,GAAG8U,aAAH,CACI9U,GAAGsM,QAAH,CAAYtM,GAAG+U,QAAH,CAAY,GAAZ,EAAiB,EAAjB,CAAZ,EAAkC/U,GAAG+U,QAAH,CAAY,GAAZ,EAAiB,CAAC,EAAlB,CAAlC,EAAyD/U,GAAG+U,QAAH,CAAY,GAAZ,EAAiB,EAAjB,CAAzD,EAA+E/U,GAAG+U,QAAH,CAAY,GAAZ,EAAiB,CAAC,EAAlB,CAA/E,EAAsG/U,GAAG+U,QAAH,CAAY,GAAZ,EAAiB,EAAjB,CAAtG,EAA4H/U,GAAGuM,SAAH,CAAa,CAAb,CAA5H,CADJ,CADJ;AAIH;AACJ,KA3hDI;;AA6hDL;AACAwM,iBAAa,uBAAW;AACpB/S,eAAOkK,IAAP,CAAY0H,SAAZ,CAAsB,KAAtB,EAA6B,GAA7B;AACA;AACA,YAAIpH,YAAYzQ,QAAQ,WAAR,CAAhB;AACAyQ,kBAAUC,KAAV,CAAgBD,UAAUwI,OAA1B,EAAmC,IAAnC;;AAEA,aAAKC,aAAL,GAAqB,IAArB;AACA,YAAI,OAAOT,SAAP,KAAqB,WAAzB,EAAsC;AAClC,gBAAItT,SAASnF,QAAQ,QAAR,CAAb;AACAD,qBAAS2Y,SAAT,CAAmBvT,OAAOwT,YAAP,EAAnB,EAA0C,KAAKQ,kBAAL,CAAwBjU,IAAxB,CAA6B,IAA7B,CAA1C;AACH,SAHD,MAGO,IAAI,OAAO6D,EAAP,KAAc,WAAlB,EAA+B;AAClC,gBAAI9C,OAAOc,aAAP,IAAwBd,OAAOc,aAAP,CAAqBuH,UAAjD,EAA6D;AACzDvO,yBAAS2Y,SAAT,CAAmB,WAAnB,EAAgC,KAAKS,kBAAL,CAAwBjU,IAAxB,CAA6B,IAA7B,CAAhC,EAAoE,KAAKkU,eAAL,CAAqBlU,IAArB,CAA0B,IAA1B,CAApE,EAAqG,KAArG;AACH,aAFD,MAEO;AACH,qBAAK4J,mBAAL;AACA,oBAAI0E,kBAAkBxT,QAAQ,iBAAR,CAAtB;AACAwT,gCAAgBC,gBAAhB,CAAiC,KAAK4F,WAAL,CAAiBnU,IAAjB,CAAsB,IAAtB,CAAjC,EAA8D,KAAKoU,YAAL,CAAkBpU,IAAlB,CAAuB,IAAvB,CAA9D;AACH;AACJ,SARM,MAQA;AACH,iBAAKiU,kBAAL;AACH;AACJ,KAnjDI;;AAqjDL;AACAA,wBAAoB,4BAAUI,OAAV,EAAmB;AACnC;AACA,YAAI9I,YAAYzQ,QAAQ,WAAR,CAAhB;AACAyQ,kBAAUC,KAAV,CAAgBD,UAAU+I,gBAA1B,EAA4C,IAA5C;;AAEA,YAAI,OAAOzQ,EAAP,KAAc,WAAlB,EAA+B;AAC3B,gBAAI,CAACwQ,OAAL,EAAc;AACVtT,uBAAOkK,IAAP,CAAYsJ,cAAZ,CAA2B,cAA3B;AACA/T,wBAAQC,GAAR,CAAY,cAAZ;AACA;AACH;AACJ;AACD,YAAIM,OAAOwE,QAAP,CAAgBiP,UAAhB,CAA2BC,UAA3B,CAAsCC,OAAtC,CAA8CL,OAA9C,KAA0D,CAAC,CAA/D,EAAkE;AAC9D7T,oBAAQC,GAAR,CAAY,WAAZ,EAAyB4T,OAAzB;AACAtT,mBAAOkK,IAAP,CAAYsJ,cAAZ,CAA2B,cAA3B;AACA;AACH,SAJD,MAIO;AACH/T,oBAAQC,GAAR,CAAY,QAAZ,EAAsB4T,OAAtB;AACAtT,mBAAOwE,QAAP,CAAgBiP,UAAhB,CAA2BC,UAA3B,CAAsC7L,IAAtC,CAA2CyL,OAA3C;AACAxZ,qBAAS4K,sBAAT,CAAgC1E,OAAOwE,QAAvC;AACH;AACD,aAAK4O,WAAL;AACH,KA5kDI;;AA8kDL;AACAA,iBAAa,uBAAY;AACrB;AACA,YAAIQ,gBAAgB,CAAC,CAArB;AACA,aAAK,IAAIhP,SAAS,CAAlB,EAAqBA,SAAS5E,OAAOK,IAArC,EAA2CuE,QAA3C,EAAqD;AACjD,iBAAK,IAAIC,SAAS,CAAlB,EAAqBA,SAAS7E,OAAOC,IAArC,EAA2C4E,QAA3C,EAAqD;AACjD,oBAAIgP,OAAO,KAAKjY,QAAL,CAAciJ,MAAd,EAAsBD,MAAtB,CAAX;AACA,oBAAIoH,WAAW6H,KAAKvU,YAAL,CAAkB,UAAlB,CAAf;AACA,oBAAI0M,YAAYA,SAASlH,IAAT,IAAiB,IAAjC,EAAuC;AACnC8O,oCAAgBhP,MAAhB;AACA;AACH;AACJ;AACD,gBAAIgP,gBAAgB,CAAC,CAArB,EAAwB;AACpB;AACH;AACJ;;AAED,YAAIA,gBAAgB,CAApB,EAAuB;AACnB,iBAAK/K,mBAAL;AACA;AACH;AACDpJ,gBAAQC,GAAR,CAAY,gBAAZ,EAA8BkU,aAA9B;;AAEA,aAAKnV,cAAL;AACA,aAAKnB,WAAL,CAAiByD,MAAjB,GAA0Bf,OAAOc,aAAP,CAAqBrC,cAArB,GAAsC,KAAKA,cAArE;AACA,aAAKpB,QAAL,CAAcsD,MAAd,GAAuB,KAAKlC,cAAL,GAAsBuB,OAAOc,aAAP,CAAqBrC,cAA3C,GAA4D,IAA5D,GAAmE,KAA1F;AACA,YAAI,CAAC,KAAKpB,QAAL,CAAcsD,MAAnB,EAA2B;AACvB,iBAAKtD,QAAL,CAAciP,cAAd;AACH;;AAED;AACA,aAAK1L,IAAL,CAAU0L,cAAV;AACA,aAAKjB,WAAL;;AAEA,YAAI,KAAKxP,QAAT,EAAmB;AACf,iBAAKA,QAAL,CAAcyQ,cAAd;AACH;;AAED;AACA,aAAK,IAAIzH,WAAS,CAAlB,EAAqBA,WAAS7E,OAAOC,IAArC,EAA2C4E,UAA3C,EAAqD;AACjD,iBAAK,IAAID,WAAS,CAAlB,EAAqBA,WAAS5E,OAAOK,IAArC,EAA2CuE,UAA3C,EAAqD;AACjD,oBAAIiP,OAAO,KAAKjY,QAAL,CAAciJ,QAAd,EAAsBD,QAAtB,CAAX;AACA,oBAAIoH,WAAW6H,KAAKvU,YAAL,CAAkB,UAAlB,CAAf;AACA,oBAAI0M,YAAYA,SAASlH,IAAT,IAAiB,IAAjC,EAAuC;AACnCkH,6BAASpL,IAAT,CAAc0L,cAAd;AACAN,6BAASlH,IAAT,CAAcxF,YAAd,CAA2B,UAA3B,EAAuCsB,IAAvC,CAA4C0L,cAA5C;AACH;AACJ;AACJ;;AAED;AACA,YAAIwH,WAAW,KAAKlY,QAAL,CAAcoE,OAAOgH,YAArB,EAAmC4M,aAAnC,EAAkD3O,WAAlD,EAAf;AACA,aAAK1H,QAAL,CAAcqD,IAAd,CAAmBvB,WAAnB,CAA+ByU,QAA/B;AACA,aAAKvW,QAAL,CAAcqD,IAAd,CAAmB0B,KAAnB,GAA2BtC,OAAOC,IAAP,GAAcD,OAAOE,QAAhD;;AAEA,aAAK3C,QAAL,CAAcqD,IAAd,CAAmB0L,cAAnB;AACA,aAAK/O,QAAL,CAAcqD,IAAd,CAAmBjB,cAAnB,CAAkC,IAAlC;AACA,YAAIoU,WAAW/Z,GAAGsM,QAAH,CAAYtM,GAAGga,MAAH,CAAU,GAAV,EAAe,GAAf,CAAZ,EAAiCha,GAAGga,MAAH,CAAU,GAAV,EAAe,CAAf,CAAjC,EAAoDha,GAAGga,MAAH,CAAU,GAAV,EAAe,GAAf,CAApD,EAAyEha,GAAGga,MAAH,CAAU,GAAV,EAAe,CAAf,CAAzE,EAA4Fha,GAAGga,MAAH,CAAU,GAAV,EAAe,GAAf,CAA5F,EAAiHha,GAAGga,MAAH,CAAU,GAAV,EAAe,CAAf,CAAjH,CAAf;AACA,aAAKzW,QAAL,CAAcqD,IAAd,CAAmByF,SAAnB,CAA6B0N,QAA7B;;AAEA,YAAIE,UAAU,EAAd;AACA,YAAIC,OAAO,GAAX;AACA,aAAK,IAAIrP,WAAS,CAAlB,EAAqBA,WAAS7E,OAAOC,IAArC,EAA2C4E,UAA3C,EAAqD;AACjD,gBAAIgP,OAAO,KAAKjY,QAAL,CAAciJ,QAAd,EAAsB+O,aAAtB,CAAX;AACA,gBAAI5H,WAAW6H,KAAKvU,YAAL,CAAkB,UAAlB,CAAf;AACA,gBAAI0M,YAAYA,SAASlH,IAAT,IAAiB,IAAjC,EAAuC;AACnC,oBAAIqP,iBAAiBnI,SAASlH,IAAT,CAAcxF,YAAd,CAA2B,UAA3B,CAArB;AACA,oBAAI8U,YAAYD,eAAezH,iBAAf,CAAiCwH,IAAjC,CAAhB;AACAA,wBAAQE,SAAR;AACApI,yBAAS1G,OAAT,GAAmB,CAAnB;AACA0G,yBAASlH,IAAT,GAAgB,IAAhB;AACH;AACJ;;AAED,aAAK2B,YAAL;;AAEA,YAAInC,OAAO,IAAX;AACAA,aAAK1D,IAAL,CAAUyF,SAAV,CAAoBrM,GAAGsM,QAAH,CAAYtM,GAAGuM,SAAH,CAAa2N,OAAO,GAApB,CAAZ,EAAsCla,GAAGwM,QAAH,CAAY,YAAY;AAC9ElC,iBAAKuE,mBAAL;AACA;AACAvE,iBAAK5D,eAAL;AACA,gBAAI4D,KAAKzI,QAAT,EAAmB;AACf,oBAAII,aAAaqI,KAAKzI,QAAL,CAAcyD,YAAd,CAA2B,UAA3B,EAAuCrD,UAAxD;AACA,oBAAIoY,mBAAmBpY,WAAWqD,YAAX,CAAwB,UAAxB,EAAoCuF,MAA3D;;AAEA,oBAAImB,UAAU1B,KAAKkF,eAAL,CAAqB6K,gBAArB,EAAuC,CAAvC,CAAd;AACA,oBAAI5K,aAAanF,KAAK1I,QAAL,CAAcyY,gBAAd,EAAgCrO,OAAhC,CAAjB;AACA1B,qBAAKzI,QAAL,CAAcyD,YAAd,CAA2B,UAA3B,EAAuCrD,UAAvC,GAAoDwN,UAApD;AACAnF,qBAAKzI,QAAL,CAAcyD,YAAd,CAA2B,UAA3B,EAAuCoK,gBAAvC,CAAwD1J,OAAOuJ,aAA/D;AACH;AACD;AACAjF,iBAAK/C,OAAL;AACH,SAfyD,CAAtC,CAApB;AAgBH,KA5qDI;;AA8qDL4R,qBAAiB,yBAAUmB,GAAV,EAAe;AAC5B7U,gBAAQC,GAAR,CAAY,OAAZ;AACA,YAAI4U,QAAQpT,SAAZ,EAAuB;AACnBlB,mBAAOkK,IAAP,CAAYsJ,cAAZ,CAA2B,OAA3B;AACH,SAFD,MAEO,IAAIc,OAAO,MAAX,EAAmB;AACtBtU,mBAAOkK,IAAP,CAAYsJ,cAAZ,CAA2B,cAA3B;AACH,SAFM,MAEA,IAAIc,OAAO,QAAX,EAAqB;AACxBtU,mBAAOkK,IAAP,CAAYsJ,cAAZ,CAA2B,OAA3B;AACH,SAFM,MAEA;AACHxT,mBAAOkK,IAAP,CAAYsJ,cAAZ,CAA2B,OAA3B;AACH;AACJ,KAzrDI;;AA2rDL;AACAH,kBAAc,wBAAY;AACtB,aAAKxK,mBAAL;AACA7I,eAAOkK,IAAP,CAAYC,kBAAZ,CAA+B,OAA/B;AACH,KA/rDI;;AAisDL;AACAlD,cAAU,oBAAY;AAClB,aAAKrG,IAAL,CAAU0L,cAAV;AACA,aAAKjB,WAAL;AACAvR,iBAASya,qBAAT;AACA;AACAva,WAAG0H,QAAH,CAAYC,YAAZ,GAA2B6S,UAA3B,CAAsC,KAAK/S,aAA3C,EAA0D,IAA1D;AACA;AACA,YAAIS,aAAanI,QAAQ,YAAR,CAAjB;AACAmI,mBAAWyL,eAAX;;AAEA;AACA3N,eAAOyU,gBAAP,GAA0B3a,SAAS4a,cAAT,EAA1B;;AAEA;AACA,YAAI1U,OAAO2U,WAAP,GAAqB3U,OAAO4U,gBAA5B,IAAgD5U,OAAOyU,gBAAP,GAA0B,CAA9E,EAAiF;AAC7EzU,mBAAOkK,IAAP,CAAY2K,UAAZ;AACA;AACH,SAHD,MAGO;AACH7U,mBAAOkK,IAAP,CAAY4K,WAAZ;AACA;AACH;AACJ,KAvtDI;;AAytDL;AACAC,wBAAoB,8BAAY;AAC5B,aAAKnU,IAAL,CAAU0L,cAAV;AACA;AACAtS,WAAG0H,QAAH,CAAYC,YAAZ,GAA2B6S,UAA3B,CAAsC,KAAK/S,aAA3C,EAA0D,IAA1D;;AAEA;AACA,aAAK,IAAIoD,SAAS,CAAlB,EAAqBA,SAAS7E,OAAOC,IAArC,EAA2C4E,QAA3C,EAAqD;AACjD,iBAAK,IAAID,SAAS,CAAlB,EAAqBA,SAAS5E,OAAOK,IAArC,EAA2CuE,QAA3C,EAAqD;AACjD,oBAAIiP,OAAO,KAAKjY,QAAL,CAAciJ,MAAd,EAAsBD,MAAtB,CAAX;AACA,oBAAIoH,WAAW6H,KAAKvU,YAAL,CAAkB,UAAlB,CAAf;AACA,oBAAI0M,YAAYA,SAASlH,IAAT,IAAiB,IAAjC,EAAuC;AACnCkH,6BAASpL,IAAT,CAAc0L,cAAd;AACAN,6BAASlH,IAAT,CAAcxF,YAAd,CAA2B,UAA3B,EAAuCsB,IAAvC,CAA4C0L,cAA5C;AACH;AACJ;AACJ;;AAED;AACA,YAAI4H,OAAO,CAAX;AACA,aAAK,IAAIrP,WAAS,CAAlB,EAAqBA,WAAS7E,OAAOC,IAArC,EAA2C4E,UAA3C,EAAqD;AACjD,iBAAK,IAAID,WAAS,CAAlB,EAAqBA,WAAS5E,OAAOgV,SAArC,EAAgDpQ,UAAhD,EAA0D;AACtD,oBAAIiP,OAAO,KAAKjY,QAAL,CAAciJ,QAAd,EAAsBD,QAAtB,CAAX;AACA,oBAAIoH,WAAW6H,KAAKvU,YAAL,CAAkB,UAAlB,CAAf;AACA,oBAAI0M,YAAYA,SAASlH,IAAT,IAAiB,IAAjC,EAAuC;AACnC,wBAAIqP,iBAAiBnI,SAASlH,IAAT,CAAcxF,YAAd,CAA2B,UAA3B,CAArB;AACA,wBAAI8U,YAAYD,eAAec,QAAf,EAAhB;AACA,wBAAIb,YAAYF,IAAhB,EAAsB;AAClBA,+BAAOE,SAAP;AACH;AACDpI,6BAAS1G,OAAT,GAAmB,CAAnB;AACA0G,6BAASlH,IAAT,GAAgB,IAAhB;AACH;AACJ;AACJ;;AAED;AACA;;;;;;;;;;;;;;;;;AAiBA,aAAK2B,YAAL;;AAEA;AACA,aAAK,IAAIR,QAAQ,CAAjB,EAAoBA,QAAQjG,OAAOkV,WAAP,CAAmBhP,MAA/C,EAAuDD,OAAvD,EAAgE;AAC5D,gBAAME,UAAUnG,OAAOkV,WAAP,CAAmBjP,KAAnB,CAAhB;AACA,gBAAIE,WAAWA,QAAQ4D,MAAvB,EAA+B;AAC3B5D,wBAAQ7G,YAAR,CAAqB,QAArB,EAA+B6V,QAA/B;AACH;AACJ;;AAED;AACA1V,gBAAQC,GAAR,CAAY,gBAAgBwU,IAA5B;AACA,YAAI5P,OAAO,IAAX;AACAA,aAAK1D,IAAL,CAAUyF,SAAV,CAAoBrM,GAAGsM,QAAH,CAAYtM,GAAGuM,SAAH,CAAa2N,OAAO,GAApB,CAAZ,EAAsCla,GAAGwM,QAAH,CAAY,YAAY;AAC9E;AACA,gBAAIgE,YAAYzQ,QAAQ,WAAR,CAAhB;AACAyQ,sBAAUC,KAAV,CAAgBD,UAAU4K,aAA1B,EAAyC,IAAzC;;AAEA,gBAAI9Q,KAAKzI,QAAT,EAAmB;AACfyI,qBAAKzI,QAAL,CAAcyQ,cAAd;AACA,oBAAIhI,KAAKzI,QAAL,CAAckO,MAAlB,EAA0B;AACtBzF,yBAAKzI,QAAL,CAAckO,MAAd,CAAqBmI,WAArB,CAAiC5N,KAAKzI,QAAtC;AACH;AACJ;AACDyI,iBAAKzI,QAAL,GAAgB,IAAhB;;AAEA;AACA;AACA;AACA;AACA;AACAyI,iBAAK5D,eAAL;AACA;AACA4D,iBAAK/C,OAAL;AACH,SArByD,CAAtC,CAApB;AAsBH,KAlzDI;;AAozDL;;;;;;;;;;;;;;;AAgBA;AACAf,WAAO,iBAAY;AACf,YAAI0B,aAAanI,QAAQ,YAAR,CAAjB;AACAmI,mBAAWyL,eAAX;;AAEA,aAAK/M,IAAL,CAAU0L,cAAV;AACAtS,WAAG0H,QAAH,CAAYC,YAAZ,GAA2B6S,UAA3B,CAAsC,KAAK/S,aAA3C,EAA0D,IAA1D;;AAEA,aAAKjD,cAAL,GAAsB,CAAtB;AACA,aAAKC,cAAL,GAAsB,CAAtB;AACA;AACA,aAAKP,SAAL,GAAkB,IAAIyF,IAAJ,EAAD,CAAaC,OAAb,EAAjB;AACA,aAAKxF,YAAL,GAAoB,CAApB;AACA,aAAKC,aAAL,GAAqB,CAArB;AACA,aAAKC,cAAL,GAAsB,CAAtB;AACA,aAAKC,OAAL,GAAe,CAAC,CAAhB;AACA,aAAKgM,aAAL;AACAvK,eAAOyI,aAAP,GAAuB,CAAC,CAAxB;AACA,aAAKtK,QAAL,GAAgB,CAAhB;AACA6B,eAAO2U,WAAP,GAAqB,CAArB;AACA3U,eAAO6G,YAAP,GAAsB,CAAtB;AACA7G,eAAOiC,WAAP,GAAqB,KAArB;AACA,aAAK1G,WAAL,GAAmB,CAAnB;AACAyE,eAAO8J,gBAAP,GAA0B,EAA1B;AACA9J,eAAO6P,QAAP,GAAkB,KAAlB;AACA,aAAK/R,cAAL,GAAsB,KAAtB;AACA,aAAKJ,aAAL,GAAqB,CAArB;AACA,aAAKK,YAAL,GAAoB,CAApB;AACA,aAAKC,eAAL,GAAuB,CAAvB;AACA,aAAKC,aAAL,GAAqB,CAArB;AACA,aAAKS,aAAL,GAAqB,CAArB;AACA,aAAKC,cAAL,GAAsB,CAAtB;AACAqB,eAAO8I,WAAP,GAAqB,KAArB;AACA;AACA,aAAK,IAAI7C,QAAQ,CAAjB,EAAoBA,QAAQjG,OAAOkV,WAAP,CAAmBhP,MAA/C,EAAuDD,OAAvD,EAAgE;AAC5D,gBAAME,UAAUnG,OAAOkV,WAAP,CAAmBjP,KAAnB,CAAhB;AACA,gBAAIE,WAAWA,QAAQ4D,MAAvB,EAA+B;AAC3B5D,wBAAQ7G,YAAR,CAAqB,QAArB,EAA+B6V,QAA/B;AACH;AACJ;;AAED,YAAI,KAAKtZ,QAAT,EAAmB;AACf,iBAAKA,QAAL,CAAcyQ,cAAd;AACA,gBAAI,KAAKzQ,QAAL,CAAckO,MAAlB,EAA0B;AACtB,qBAAKlO,QAAL,CAAckO,MAAd,CAAqBmI,WAArB,CAAiC,KAAKrW,QAAtC;AACH;AACJ;AACD;AACA,YAAI,KAAKD,QAAL,CAAcsK,MAAd,GAAuB,CAA3B,EAA8B;AAC1B,iBAAK,IAAIrB,SAAS,CAAlB,EAAqBA,SAAS7E,OAAOC,IAArC,EAA2C4E,QAA3C,EAAqD;AACjD,qBAAK,IAAID,SAAS,CAAlB,EAAqBA,SAAS5E,OAAOK,IAArC,EAA2CuE,QAA3C,EAAqD;AACjD,wBAAIiP,OAAO,KAAKjY,QAAL,CAAciJ,MAAd,EAAsBD,MAAtB,CAAX;AACA,wBAAIoH,WAAW6H,KAAKvU,YAAL,CAAkB,UAAlB,CAAf;AACAuU,yBAAKvH,cAAL;AACA,wBAAIN,YAAYA,SAASlH,IAAT,IAAiB,IAAjC,EAAuC;AACnCkH,iCAASlH,IAAT,CAAcxF,YAAd,CAA2B,UAA3B,EAAuC+V,QAAvC;AACH;;AAED;AACA,wBAAIxB,KAAK9J,MAAT,EAAiB;AACb8J,6BAAK9J,MAAL,CAAYmI,WAAZ,CAAwB2B,IAAxB;AACH;AACJ;AACJ;AACD,iBAAKpN,YAAL;AACH;AACD,aAAK7K,QAAL,GAAgB,EAAhB;AACA,aAAKiC,WAAL,CAAiB2C,KAAjB;AACA,aAAK3E,QAAL,GAAgB,IAAhB;AACA,YAAI,KAAKJ,gBAAL,IAAyB,KAAKA,gBAAL,CAAsBsO,MAAnD,EAA2D;AACvD,iBAAKtO,gBAAL,CAAsBsO,MAAtB,CAA6BmI,WAA7B,CAAyC,KAAKzW,gBAA9C;AACH;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,YAAIyD,SAASnF,QAAQ,QAAR,CAAb;AACAmF,eAAOoW,eAAP,CAAuBtV,OAAOuV,YAAP,CAAoBC,aAA3C,EAA0DxV,OAAOuV,YAAP,CAAoBE,cAA9E;AACH;AA15DI,CAAT","file":"gridController.js","sourceRoot":"../../../../../assets/Scripts/controller","sourcesContent":["let ThirdAPI = require('../common/ThirdAPI')\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        //下一个好友的节点\n        nextFriendNode: {\n            default: null,\n            type: cc.Node,\n        },\n        //下一个好友的精灵\n        nextFriendSp: {\n            default: null,\n            type: cc.Sprite,\n        },\n\n        gridPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n\n        //广告按钮\n        rewardVideoAdBtn: {\n            default: null,\n            type: cc.Node\n        },\n\n        successNode:cc.Node,\n        gainPropName: {\n            default: null,\n            type: cc.Label,\n        },\n        gainPropIcon: {\n            default: null,\n            type: cc.Sprite,\n        },\n\n        light: {\n            default: null,\n            type: cc.Sprite,\n        },\n\n        pauseNode: {\n            default: null,\n            type: cc.Node\n        },\n        chooseNode: {\n            default: null,\n            type: cc.Node\n        },\n        test_btnNode: {\n            default: null,\n            type: cc.Node\n        },\n\n        //格子内的item\n        itemPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n\n        //右上角显示即将下落的格子分数\n        randomScore: 0,\n        //即将出现的格子\n        soonGridNum: {\n            default: null,\n            type: cc.Prefab,\n        },\n        soonGridInstance: null,\n\n        startX: 0,\n        startY: 0,\n        //所有格子节点坐标\n        allGrids: [],\n        //出生的格子\n        bornGrid: null,\n        //开始触摸的位置坐标\n        startTouchPosition: null,\n\n        //将要合并的数组\n        deleteGrids: [],\n        joinGrids: [],\n        //目标的格子\n        targetGrid: {\n            default: null,\n            type: cc.Node\n        },\n\n        line: {\n            default: null,\n            type: cc.Sprite,\n        },\n\n        //随机钻石预设\n        gemStone: {\n            default: null,\n            type: cc.Prefab\n        },\n\n        //金币节点\n        goldNode: {\n            default: null,\n            type: cc.Node\n        },\n        prop: {\n            default: null,\n            type: cc.Node\n        },\n        nodesGroup: {\n            default: null,\n            type: cc.Node,\n        },\n        //清除道具\n        clearPropBtn: {\n            default: null,\n            type: cc.Sprite,\n        },\n        clearLabel: {\n            default: null,\n            type: cc.Label,\n        },\n        clearAdd: {\n            default: null,\n            type: cc.Sprite,\n        },\n        //清除道具数量节点\n        clearUseNumNode: {\n            default: null,\n            type: cc.Node\n        },\n        clearUseNum: {\n            default: null,\n            type: cc.Label,\n        },\n        //万能道具\n        superPropBtn: {\n            default: null,\n            type: cc.Sprite,\n        },\n        superLabel: {\n            default: null,\n            type: cc.Label,\n        },\n        superAdd: {\n            default: null,\n            type: cc.Sprite,\n        },\n        //万能道具数量节点\n        superUseNumNode: {\n            default: null,\n            type: cc.Node\n        },\n        superUseNum: {\n            default: null,\n            type: cc.Label,\n        },\n        //双倍道具\n        doublePropBtn: {\n            default: null,\n            type: cc.Sprite,\n        },\n        doubleLabel: {\n            default: null,\n            type: cc.Label,\n        },\n        layoutNode: {\n            default: null,\n            type: cc.Node,\n        },\n        guideNode: {\n            default: null,\n            type: cc.Node,\n        },\n        bombNode: {\n            default: null,\n            type: cc.Node\n        },\n        bombSurplus: {\n            default: null,\n            type: cc.Label,\n        },\n        blinkSpr: {\n            default: null,\n            type: cc.Sprite,\n        },\n        clearTips: {\n            default: null,\n            type: cc.Node\n        },\n        fitOffsetY: 0,\n        propClearTime: 0, //使用道具消除点击格子的动画时间\n\n        //分数\n        score: {\n            default: null,\n            type: cc.Node,\n        },\n        //可下落格子\n        downGrids: [],\n\n        scoreScript: null,\n        isClickBomming: false,\n        clickGridNum: 0, //消除格子数量\n        createItemIndex: 0,\n        moveItemIndex: 0,\n\n        startTime: 0, //开始时间\n        addTimes: 0, //加速次数\n\n        usePropTimes: 0, //使用清除道具次数\n        useSuperTimes: 0, //使用万能道具的次数\n        useDoubleTimes: 0, //使用万能道具的次数\n        useProp: -1, //使用道具，生产下一个生效\n\n        //弹出道具分享的次数\n        popDialogTimes: 0,\n        bombShareTimes: 0, //爆炸可分享的次数\n\n        createItemNum: 0, //生产的第几个格子\n        createItemNum1: 0, //生产的第几个格子\n    },\n\n    start: function () {\n        listenUtil.eventCtrl.addListen('cdnchange', this.cdnChange.bind(this));\n        // 适配\n        //var isFitIphoneX = cc.winSize.width / cc.winSize.height < 0.50;\n        var myUtil = require('myUtil');\n        var isFitIphoneX = myUtil.isIphoneX();\n\n        this.fitOffsetY = 0;\n\n        if (isFitIphoneX) {\n            this.fitOffsetY = 40;\n            this.nodesGroup.setPosition(0, -this.fitOffsetY);\n            this.nodesGroup.getComponent(cc.Widget).top = this.fitOffsetY;\n            console.log('widght:', this.fitOffsetY);\n\n            // this.layoutNode.getPosition().y += 30;\n            // this.layoutNode.getComponent(cc.Widget).top += 30;\n\n            this.layoutNode.setLocalZOrder(1000);\n        }\n    },\n\n    cdnChange: function (params) {\n        console.log('cdn数据变化');\n        // this.layoutNode.active = Global.cdnGameConfig.totalSwith;\n    },\n\n    initGridData: function (listParma) {\n        // 适配\n        //var isFitIphoneX = cc.winSize.width / cc.winSize.height < 0.50;\n        var myUtil = require('myUtil');\n        var isFitIphoneX = myUtil.isIphoneX();\n\n        this.fitOffsetY = 0;\n        if (isFitIphoneX) {\n            this.fitOffsetY = 40;\n            //this.nodesGroup.setPosition(0, -this.fitOffsetY);\n            //this.nodesGroup.getComponent(cc.Widget).top = this.fitOffsetY;\n        }\n\n        //设置位置坐标\n        var allWidth = Global.hNum * Global.itemSize + (Global.hNum - 1) * Global.itemSplit;\n        var allHeight = Global.vNum * Global.itemSize + (Global.vNum - 1) * Global.itemSplit;\n\n        this.startX = -(Global.screenWidth / 2) + (Global.screenWidth - allWidth) / 2 + Global.itemSize / 2;\n        this.startY = 328 - this.fitOffsetY; //-(Global.screenHeight / 2) + Global.paddingButtom + allHeight - Global.itemSize + 30 - this.fitOffsetY; \n        this.rewardVideoAdBtn.y = this.startY - 6 * Global.itemSize - 6 * Global.itemSplit + 100;\n        this.scoreScript = this.score.getComponent(\"score\");\n\n        //重置所有数据\n        this.reset();\n\n        //初始化棋盘\n        this.createAllGrid();\n        //添加触摸侦听\n        this.setTouchControl();\n        //引导节点\n        this.guideNode.active = true;\n        //炸弹\n        this.blinkSpr.node.setOpacity(0);\n        this.bombNode.active = (this.bombShareTimes < Global.cdnGameConfig.bombShareTimes) ? true : false;\n        this.bombSurplus.string = Global.cdnGameConfig.bombShareTimes - this.bombShareTimes;\n        this.bombRunAction();\n        //每日挑战\n        if (Global.isDailyLimit || listParma != undefined) {\n            if (listParma != undefined) {\n                this.startInit(listParma.list);\n                this.scoreScript.addScore(listParma.score);\n            } else {\n                this.initForDailyLimit();\n            }\n\n        } else {\n            //开始处理业务逻辑\n            this.process();\n        }\n\n        //显示星星\n        this.updateGold();\n        //下一个好友\n        this.nextFriendNode.active = !Global.isDailyLimit;\n        this.getNextFriend();\n        cc.director.getScheduler().schedule(this.getNextFriend, this, 1, false);\n\n        this.setLine(allWidth, allHeight);\n        this.pauseNode.active = false;\n        this.chooseNode.active = false;\n        this.clearTips.active = false;\n\n        // this.layoutNode.active = Global.cdnGameConfig.totalSwith;\n        this.test_btnNode.active = Global.canTest;\n        if (Global.canTest) {\n            var label = this.test_btnNode.getChildByName('Label');\n            label.getComponent(cc.Label).string = '测试 ' + (Global.testEnabled ? '开' : '关');\n        }\n        //创建广告\n        var wxBannerAd = require('wxBannerAd');\n        wxBannerAd.createBannerAd();\n\n        this.rewardVideoAdBtn.setLocalZOrder(1000);\n        this.successNode.setLocalZOrder(1000);\n    },\n\n    getNextFriend: function () {\n        //console.log(\"更新即将超越好友信息\", this.scoreScript.scoreNum);\n\n        this.drawRect = {\n            x: 0,\n            y: 0,\n            width: this.nextFriendSp.node.width,\n            height: this.nextFriendSp.node.height\n        };\n        ThirdAPI.getNextFriend({\n            rect: this.drawRect,\n            score: this.scoreScript.scoreNum,\n            callback: (entries) => {\n                //console.log('获取即将超越好友信息成功');\n\n                setTimeout(() => {\n                    try {\n                        let openDataContext = wx.getOpenDataContext();\n                        let sharedCanvas = openDataContext.canvas;\n\n                        let texture = new cc.Texture2D();\n                        texture.initWithElement(sharedCanvas);\n                        texture.handleLoadedTexture();\n                        let sp = new cc.SpriteFrame(texture);\n                        this.nextFriendSp.spriteFrame = sp;\n                    } catch (error) {\n\n                    }\n                }, 500);\n            }\n        });\n    },\n\n    //每日限时初始化格子\n    initForDailyLimit: function () {\n        //根据初始时间来计算到现在多少天\n        var myUtil = require('myUtil');\n        var unixTime = (new Date()).getTime();\n        var today = myUtil.getDayForYear(unixTime);\n        var startDay = myUtil.getDayForYear(parseInt(Global.cdnGameConfig.dailyStartTime) * 1000);\n        var day = Math.abs(today - startDay);\n        this.data = null;\n        var self = this;\n        console.log('today:' + today, \"startDay:\" + startDay);\n        if (Global.dailyConfig && !Global.dailyConfig[day]) {\n            console.log('没有json数据，取json的第一个');\n            self.data = Global.dailyConfig[0];\n        } else {\n            console.log('取json的第' + day + \"个\");\n            self.data = Global.dailyConfig[day];\n        }\n        Global.gameinfo.dailyTime = (new Date()).getTime();\n        ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n\n        self.startInit(self.data);\n        console.log(self.data);\n    },\n\n    startInit: function (data) {\n        var num = 0;\n        for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n            for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n                if (parseInt(data[num]) > 0) {\n                    let item = cc.instantiate(this.itemPrefab);\n                    //限时格子的初始位置\n                    var pos = this.allGrids[hIndex][vIndex].getPosition();\n                    item.setPosition(cc.p(pos.x, pos.y));\n                    item.getComponent('itemView').initData(data[num], false);\n                    this.node.addChild(item);\n                    var gridScript = this.allGrids[hIndex][vIndex].getComponent('gridView');\n                    gridScript.item = item.getComponent('itemView');\n                    gridScript.gridNum = data[num];\n                }\n                num++;\n            }\n        }\n        this.guideNode.active = false;\n        this.process();\n    },\n\n    //设置线的位置和大小\n    setLine: function (width, height) {\n        this.line.node.width = width + 20;\n        this.line.node.height = height + 20;\n        var linePosY = height / 2 - this.startY - Global.itemSize / 2;\n        this.line.node.setPosition(cc.p(0, -linePosY));\n\n\n        //Global.lineHight = 0 - 430 - this.fitOffsetY - Global.itemSize / 2 - height;\n        Global.lineHight = this.line.node.height;\n\n        //Global.lineHight = this.line.node.height;\n        Global.linePosY = -linePosY;\n        console.log('line:', -linePosY, this.line.node.height, cc.winSize.width, cc.winSize.height, cc.director.getWinSize());\n    },\n\n    process: function () {\n        //1.格子下落\n        this.down();\n        //格子合并\n        this.checkGridJoin();\n    },\n\n    //下落\n    down: function () {\n        this.isDown = false;\n        this.downGrids = [];\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                if (this.resetItemAction(hIndex, vIndex, false)) {\n                    this.isDown = true;\n                }\n            }\n        }\n\n        if (this.bornGrid && this.bornGrid.getComponent('itemView').curState > 0) {\n            this.isDown = true;\n        }\n    },\n\n    checkGridJoin: function () {\n        let self = this;\n        let downNum = 0;\n        // for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n        //     for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n        //         var gridScript = self.allGrids[hIndex][vIndex].getComponent('gridView');\n        //         if (gridScript.item && gridScript.item.getComponent('itemView').curState > 0) {\n        //             downNum++;\n        //         }\n        //     }\n        // }\n        for (let index = 0; index < this.downGrids.length; index++) {\n            const element = this.downGrids[index];\n            if (element.curState > 0) {\n                downNum++;\n            }\n        }\n        if (this.bornGrid != null && this.bornGrid.getComponent('itemView').curState > 0) {\n            downNum++;\n        }\n        if ((this.bornGrid == null || this.bornGrid.getComponent('itemView').curState == 0) && downNum == 0) {\n            this.gridJoin();\n        } else {\n            this.node.runAction(cc.sequence(cc.delayTime(0.5), cc.callFunc(function () {\n                self.checkGridJoin();\n            })));\n        }\n\n        //this.gridJoin();\n    },\n\n    gridJoin: function () {\n        var self = this;\n        //2.格子合并\n        //self.bornGrid = null;\n\n        //是否有被删除的格子\n        if (self.clickGridNum > 0) {\n            self.process();\n            self.clickGridNum = 0;\n            return;\n        }\n\n        self.clearAllJoin();\n\n        let canJoin = false;\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                var gridScript = self.allGrids[hIndex][vIndex].getComponent('gridView');\n                if (!self.findDownNum() || (self.findDownNum() && gridScript.isDown)) {\n                    //执行合并\n                    if (gridScript.startBianli()) {\n                        canJoin = true;\n                    }\n                }\n            }\n        }\n\n        if (canJoin) {\n            Global.combineTimes++;\n            console.log('要开始合并啦,combineTimes:' + Global.combineTimes);\n            this.bornGrid = null;\n            this.checkJoin();\n        } else {\n            var hightBornGrid = self.allGrids[Global.bornXgridNum][0];\n            if (hightBornGrid.getComponent('gridView').item != null && !self.isDown) {\n                //gameover\n                let self = this;\n                self.node.runAction(cc.sequence(cc.delayTime(0.5), cc.callFunc(function () {\n                    self.gameOver();\n                })));\n                return;\n            }\n            if (!self.isDown) {\n                Global.combineTimes = 0;\n                self.bornGrid = null;\n                self.createItem();\n            } else {\n                self.process();\n            }\n        }\n    },\n\n    //合并判断\n    checkJoin: function () {\n        console.log('开始检查合并');\n        let self = this;\n        self.node.runAction(cc.sequence(cc.delayTime(0.1), cc.callFunc(function () {\n            let isFind = false;\n            for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n                for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                    var gridScript = self.allGrids[hIndex][vIndex].getComponent('gridView');\n                    if (gridScript.actionJoin) {\n                        isFind = true;\n                        break;\n                    }\n                }\n            }\n            if (!isFind) {\n                console.log('合并结束');\n                self.joinComplete();\n            } else {\n                console.log('开始检查合并2222');\n                self.checkJoin();\n            }\n        })));\n    },\n\n    joinComplete: function () {\n        let self = this;\n        //最高点合并之后重新生产\n        var hightBornGrid = self.allGrids[Global.bornXgridNum][0];\n        if (hightBornGrid.getComponent('gridView').item != null) {\n            //因为在最开始创建的时候下方有物体，所以不能isDown，合并完之后需要重设isDown，\n            //再继续判断是否可以合并，如果没有则再生产一个item，\n            self.isDown = true;\n        }\n        self.gridJoin();\n    },\n\n    findDownNum: function () {\n        var self = this;\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                var gridScript = self.allGrids[hIndex][vIndex].getComponent('gridView');\n                if (gridScript.isDown) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    },\n\n    //清除所有的可合并变量\n    clearAllJoin: function () {\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                var gridScript = this.allGrids[hIndex][vIndex].getComponent('gridView');\n                gridScript.isJoin = false;\n            }\n        }\n    },\n\n    //生产下落的item\n    createItem: function () {\n        //判断是否可以生产钻石\n        //this.dropStone();\n\n        var myUtil = require(\"myUtil\");\n        if (this.randomScore == 0) {\n            this.randomScore = myUtil.randomForArray(Global.gridRandomScores);\n        }\n\n        if (Global.testEnabled) {\n            this.showChooseNum();\n        } else {\n            this.createItem2();\n        }\n    },\n\n    //概率掉落道具(星星)\n    dropStone: function () {\n        //第一次判断分数，之后判断时间\n\n\n        //判断每行是否有空余的格子,并且钻石在格子之上，概率一样\n        var list = []; //格式：[[0,1],[2,4],[hIndex,vIndex]]\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            var hasGrid = false;\n            for (let vIndex = Global.vNum - 1; vIndex >= 0; vIndex--) {\n                var gridScript = this.allGrids[hIndex][vIndex].getComponent('gridView');\n                if (gridScript.item != null) {\n                    hasGrid = true;\n                } else {\n                    if (hasGrid) {\n                        list.push([hIndex, vIndex]);\n                        break;\n                    }\n                }\n\n\n                /*\n                                if (hasGrid && gridScript.item == null) {\n                                    list.push([hIndex, vIndex]);\n                                    break;\n                                } else {\n                                    //再判断\n                                    hasGrid = true;\n                                }*/\n            }\n        }\n        console.log('list:', list);\n        if (list.length <= 0) return;\n\n        //随机产生一个\n        var myUtil = require('myUtil');\n        var targetPos = myUtil.randomForArray(list);\n        var hIndex = targetPos[0];\n        var vIndex = targetPos[1];\n\n\n\n        /*\n                //先判断上方是否有格子存在\n                if (vIndex >= Global.vNum) {\n                    return;\n                }\n                var upGrid = this.allGrids[hIndex][vIndex];\n                if (!upGrid) return;\n                var upGridScript = upGrid.getComponent(\"gridView\");\n\n                //判断是否有item\n                if (upGridScript.item !== null) {\n                    return;\n                }*/\n        var upGrid = this.allGrids[hIndex][vIndex];\n        var upGridScript = upGrid.getComponent(\"gridView\");\n        //开始创建item\n        let item = cc.instantiate(this.itemPrefab);\n        //出生的目标点\n        item.setPosition(upGrid.getPosition());\n        var itemScript = item.getComponent('itemView');\n        itemScript.isStone = true;\n\n        itemScript.initData(0, false);\n        itemScript.updateNumForProp();\n\n        Global.gridController.addChild(item);\n        upGridScript.item = itemScript;\n\n        //var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n\n        //itemScript.targetGrid = this.allGrids[hIndex][vIndex];\n        //Global.candropProp = false;\n    },\n\n    createItem2: function () {\n        this.createItemNum++;\n        this.createItemNum1++;\n        \n        if (this.useProp != -1 || (!Global.isDailyLimit && Global.cdnGameConfig.totalSwith && this.createItemNum == parseInt(Global.cdnGameConfig.createGridNumForClear) && Global.historyMaxScore <= parseInt(Global.cdnGameConfig.histroyMaxScore))) {\n            console.log('生产道具', this.useProp);\n            Global.usePropStatus = this.createItemNum == Global.cdnGameConfig.createGridNumForClear ? 0 : this.useProp;\n        } else {\n            Global.usePropStatus = -1;\n        }\n        this.useProp = -1;\n\n        //生产要下落的格子\n        if (!Global.isDailyLimit && Global.cdnGameConfig.totalSwith && Global.historyMaxScore <= parseInt(Global.cdnGameConfig.histroyMaxScore) &&\n            (this.createItemNum == (parseInt(Global.cdnGameConfig.createGridNumForClear) - 1) ||\n                this.createItemNum == parseInt(Global.cdnGameConfig.createGridNumForClear) ||\n                this.createItemNum == (parseInt(Global.cdnGameConfig.createGridNumForSuper) - 1) ||\n                this.createItemNum == parseInt(Global.cdnGameConfig.createGridNumForSuper))) {\n\n\n            if (this.createItemNum == (Global.cdnGameConfig.createGridNumForClear - 1)) {\n                this.soonGridInstance.getComponent(\"itemView\").updateNum(0);\n                this.createDownGrid();\n            } else if (this.createItemNum == Global.cdnGameConfig.createGridNumForClear) {\n                this.onPauseGameForOther();\n                this.clearTips.active = true;\n                this.clearTips.setLocalZOrder(20);\n            } else if (this.createItemNum == (Global.cdnGameConfig.createGridNumForSuper - 1)) {\n                this.soonGridInstance.getComponent(\"itemView\").updateNum(1);\n                this.createDownGrid();\n            } else if (this.createItemNum == Global.cdnGameConfig.createGridNumForSuper) {\n                Global.isPropGuide = true;\n                this.showChooseNum();\n            }\n        } else {\n            this.createDownGrid();\n            this.setSoonGrid();\n            this.process();\n            this.createItemIndex++;\n            Global.isPropGuide = false;\n        }\n    },\n\n    createDownGrid: function () {\n        let item = cc.instantiate(this.itemPrefab);\n        //出生的目标点\n        var bornXgrid = this.allGrids[Global.bornXgridNum][0];\n        var posX = 0;\n        var posY = this.startY;\n        if (bornXgrid) {\n            var position = bornXgrid.getPosition();\n            posX = position.x;\n            posY = position.y;\n        }\n        item.setPosition(cc.p(posX, posY + Global.itemSize));\n\n        item.getComponent('itemView').initData(this.randomScore, false);\n        item.getComponent('itemView').updateNumForProp();\n        if (Global.usePropStatus == 0) {\n            console.log('锤子道具');\n            item.getComponent('itemView').useClear = true;\n        } else if (Global.usePropStatus == 2) {\n            console.log('设置双倍标识');\n            item.getComponent('itemView').useDouble = true;\n        }\n        this.node.addChild(item);\n\n        this.bornGrid = item;\n\n        var downSpeed = Global.gridDownSpeed;\n        var downNum = this.getStopPosition(Global.bornXgridNum, 0);\n        var targetView = this.allGrids[Global.bornXgridNum][downNum];\n\n        this.bornGrid.getComponent('itemView').targetGrid = targetView;\n\n        item.getComponent('itemView').startDownForBorn(downSpeed);\n\n        //记录生产的第几个格子\n        // this.createItemNum++;\n\n        /* this.setSoonGrid();\n         this.process();\n         this.createItemIndex++;*/\n    },\n\n    //设置即将下落的格子分数\n    setSoonGrid: function (nextScore) {\n        if (nextScore !== undefined) {\n            this.randomScore = nextScore;\n        } else {\n            var myUtil = require(\"myUtil\");\n            var randomScores = Global.gridRandomScores.concat(Global.joinRandomScores);\n            this.randomScore = myUtil.randomForArray(randomScores);\n        }\n\n        if (!this.soonGridInstance || (this.soonGridInstance && !this.soonGridInstance.parent)) {\n            this.soonGridInstance = cc.instantiate(this.soonGridNum);\n            this.node.addChild(this.soonGridInstance);\n        }\n        this.soonGridInstance.setPosition(0, 430 - this.fitOffsetY);\n        this.soonGridInstance.getComponent(\"itemView\").initData(this.randomScore, true);\n    },\n\n    useClearProp: function () {\n        //使用清除道具\n        if (Global.gameinfo.clearPropNum <= 0) {\n            Global.game.showDialogPropText('道具不足！');\n            // console.log('调起道具分享界面');\n            // var parma = {\n            //     'parmaIndex': 0\n            // };\n            // Global.game.showAddPropDialog(parma);\n            //Global.game.showPropDialog(false, \"\", 0);\n            return;\n        }\n        var parma = Global.randomPropInfo[0];\n        if (parma && this.usePropTimes >= parma.limitForGame) {\n            Global.game.showDialogPropText('每局只能使用' + parma.limitForGame + '次道具哦');\n            return;\n        }\n        Global.gameinfo.clearPropNum--;\n        this.usePropTimes++;\n        this.useProp = 0;\n        //变灰\n        this.setPropSprite();\n        if (this.soonGridInstance) {\n            this.soonGridInstance.getComponent(\"itemView\").updateNum(0);\n        }\n        ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n\n        //记载使用消除锤锤打点\n        var biManager = require('biManager');\n        biManager.bilog(biManager.useClearProp, null);\n    },\n\n    //使用万能道具\n    useSuperProp: function () {\n        console.log('aaa:', Global.usePropStatus, this.useProp);\n\n        if (this.useProp == 1) {\n            Global.game.showDialogPropText('这一次道具使用完才能再次使用！');\n            return;\n        }\n\n        if (Global.gameinfo.superPropNum <= 0) {\n            Global.game.showDialogPropText('道具不足！');\n            //console.log('调起道具分享界面');\n            // Global.game.showAddPropDialog({\n            //     'parmaIndex': 1\n            // });\n            //Global.game.showPropDialog(false, \"\", 1);\n            return;\n        }\n        var parma = Global.randomPropInfo[1];\n        if (parma && this.useSuperTimes >= parma.limitForGame) {\n            Global.game.showDialogPropText('每局只能使用' + parma.limitForGame + '次道具哦');\n            return;\n        }\n        this.showChooseNum();\n        // this.useSuperTimes++;\n        // Global.gameinfo.superPropNum--;\n        //this.useProp = 1;\n        // this.setPropSprite();\n        // this.soonGridInstance.getComponent(\"itemView\").updateNum(1);\n        // ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n    },\n\n    //使用双倍道具\n    useDoubleProp: function () {\n        Global.game.showDialogPropText('正在努力开发中...');\n        return;\n        //使用清除道具\n        if (Global.gameinfo.doublePropNum <= 0) {\n            Global.game.showAddPropDialog({\n                'parmaIndex': 2\n            });\n            return;\n        }\n        var parma = Global.randomPropInfo[2];\n        if (parma && this.useDoubleTimes >= parma.limitForGame) {\n            Global.game.showDialogPropText('每局只能使用' + parma.limitForGame + '次道具哦');\n            return;\n        }\n        this.useDoubleTimes++;\n        Global.gameinfo.doublePropNum--;\n        this.useProp = 2;\n        this.setPropSprite();\n        if (this.soonGridInstance) {\n            this.soonGridInstance.getComponent(\"itemView\").updateNum(2);\n        }\n        ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n    },\n\n    setPropSprite: function () {\n        var LoadAtlas = require(\"LoadAtlas\");\n        //清除\n        this.clearAdd.setVisible(false);\n        this.clearUseNumNode.active = false;\n        var clearParma = Global.randomPropInfo[0];\n        if (clearParma && this.usePropTimes >= clearParma.limitForGame) {\n            this.clearPropBtn.spriteFrame = LoadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'clear_spr1');\n            //this.clearUseNumNode.active = false;\n        } else {\n            this.clearPropBtn.spriteFrame = LoadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'clear_spr');\n            //剩余可使用道具显示\n            //this.clearUseNumNode.active = true;\n            if (clearParma) {\n                this.clearUseNum.string = clearParma.limitForGame - this.usePropTimes;\n            }\n        }\n        if (Global.gameinfo.clearPropNum > 0) {\n            this.clearLabel.string = Global.gameinfo.clearPropNum;\n            //this.clearAdd.setVisible(false);\n        } else {\n            this.clearLabel.string = '0';\n            //this.clearAdd.setVisible(true);\n        }\n\n        //万能\n        this.superUseNumNode.active = false;\n        var superParma = Global.randomPropInfo[1];\n        if (superParma && this.useSuperTimes >= superParma.limitForGame) {\n            this.superPropBtn.spriteFrame = LoadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'super_spr1');\n            //this.superUseNumNode.active = false;\n        } else {\n            this.superPropBtn.spriteFrame = LoadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'super_spr');\n            //this.superUseNumNode.active = true;\n            if (superParma) {\n                this.superUseNum.string = superParma.limitForGame - this.useSuperTimes;\n            }\n        }\n        this.superAdd.setVisible(false);\n        if (Global.gameinfo.superPropNum > 0) {\n            this.superLabel.string = Global.gameinfo.superPropNum;\n            //this.superAdd.setVisible(false);\n        } else {\n            this.superLabel.string = '0';\n            //this.superAdd.setVisible(true);\n        }\n        //this.superLabel.string = '万能方块 x' + Global.gameinfo.superPropNum;\n\n        //双倍\n        var doubleParma = Global.randomPropInfo[2];\n        if (doubleParma && this.useDoubleTimes >= doubleParma.limitForGame) {\n            this.doublePropBtn.spriteFrame = LoadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'double_spr1');\n        } else {\n            this.doublePropBtn.spriteFrame = LoadAtlas.getSpriteFrameFromName('textures/gridItem/items', 'double_spr');\n        }\n        this.doubleLabel.string = '双倍方块';\n    },\n\n    //测试开关是否开启\n    testEnabled: function () {\n        /* Global.testEnabled = !Global.testEnabled;\n         var btn_node = this.node.getChildByName('test_btn');\n         if (btn_node) {\n             var label = btn_node.getChildByName('Label');\n             label.getComponent(cc.Label).string = '测试 ' + (Global.testEnabled ? '开' : '关');\n         }*/\n\n    },\n\n    //关闭监听\n    closeListen: function () {\n        //关闭触摸\n        this.node.off(cc.Node.EventType.TOUCH_START, this.nodeStart, this);\n        //关闭移动\n        this.node.off(cc.Node.EventType.TOUCH_MOVE, this.nodeMove, this);\n        //关闭结束\n        this.node.off(cc.Node.EventType.TOUCH_END, this.nodeEnd, this);\n    },\n\n    createAllGrid: function () {\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                var parma = {\n                    hIndex: hIndex,\n                    vIndex: vIndex,\n                };\n                if (!this.allGrids[hIndex]) {\n                    this.allGrids[hIndex] = [];\n                }\n                this.allGrids[hIndex][vIndex] = this.createGrid(parma);\n            }\n        }\n    },\n\n    //创建格子\n    createGrid: function (parma) {\n        //参数\n        var hIndex = parma.hIndex;\n        var vIndex = parma.vIndex;\n        var posX = this.startX + hIndex * Global.itemSize + hIndex * Global.itemSplit;\n        var posY = this.startY - vIndex * Global.itemSize - vIndex * Global.itemSplit;\n\n        //设置格子的坐标\n        var gridItem = cc.instantiate(this.gridPrefab);\n        gridItem.setPosition(cc.p(posX, posY));\n\n        gridItem.setLocalZOrder(20);\n\n        //设置索引和位置\n        var gridView = gridItem.getComponent(\"gridView\");\n        gridView.node.setPosition(posX, posY);\n        gridView.setIndex(hIndex, vIndex, this);\n        this.node.addChild(gridItem);\n        return gridItem;\n    },\n\n    itemClick: function (event) {\n        var self = this;\n        if (!self.isClickBomming) {\n            return;\n        }\n        if (this.clickGridNum >= 1) {\n            return;\n        }\n        var clickGrid = event.getUserData();\n        self.clickGrid = clickGrid;\n\n        //道具缩放动画停止\n        this.prop.stopAllActions();\n        var scale1 = cc.scaleTo(0.1, 1, 1);\n        this.prop.runAction(scale1);\n\n        //停止生产下落的格子\n        // if (this.bornGrid) {\n        //     this.bornGrid.pauseAllActions();\n        // }\n        //this.node.stopAllActions();\n\n        //消除格子\n        var scaleTime = this.clickGrid.getComponent('gridView').item.getComponent(\"itemView\").clearItemToRemove();\n        this.clickGrid.getComponent('gridView').item = null;\n        //将上方的格子下落\n        var currHindex = this.clickGrid.getComponent('gridView').hIndex;\n        var currVindex = this.clickGrid.getComponent('gridView').vIndex;\n        for (let vIndex = currVindex - 1; vIndex > 0; vIndex--) {\n            var downtime = this.resetItemAction(currHindex, vIndex, true);\n        }\n\n        this.clickGridNum++;\n        this.isClickBomming = false;\n        //消耗金币\n        Global.wxGold -= Global.costGold;\n        //更新金币并存储\n        if (typeof wx !== 'undefined') {\n            let data = ThirdAPI.loadLocalScore();\n            var score = parseInt(data.maxscore);\n            var gold = parseInt(data.gold);\n            ThirdAPI.loadScore((maxscore, gold) => {\n                score = parseInt(maxscore);\n                gold = parseInt(gold);\n                console.log('gridController on ThirdAPI loadScore', score, parseInt(gold), Global.wxGold);\n            });\n            ThirdAPI.saveScore(score, Global.wxGold);\n        }\n        //更新分数\n        var goldLabel = this.goldNode.getChildByName('label');\n        goldLabel.getComponent(cc.Label).string = Global.wxGold;\n\n\n        //console.log('scaleTime:' + scaleTime);\n        //缩放动画播完后再继续下落合并的逻辑(马上按下暂停这里时间就会出现问题)\n        // this.node.stopAllActions();\n        // this.node.runAction(cc.sequence(cc.delayTime(scaleTime / 1000), cc.callFunc(self.process, self)));\n    },\n\n    //游戏内看广告广告\n    onSeeAd: function () {\n        this.onPauseGameForOther();\n        var wxRewardVideoAd = require('wxRewardVideoAd');\n        wxRewardVideoAd.initCreateReward(this.onAdSuccess.bind(this), this.onAdFail.bind(this));\n        //销毁banner广告\n        var wxBannerAd = require('wxBannerAd');\n        wxBannerAd.destroyBannerAd();\n    },\n\n    //看视频成功得道具\n    onAdSuccess: function () {\n        //设置全屏的按钮\n        let canvas = cc.find('Canvas');\n        var button = this.successNode.getChildByName('button');\n        if (button) {\n            button.width = canvas.width;\n            button.width = canvas.width;\n        }\n        this.playLightAction();\n        this.successNode.active = true;\n        var myUtil = require('myUtil');\n        var randomIndex = myUtil.randomForArray(Global.randomPropCode);\n        var prop_parma = Global.randomPropInfo[randomIndex];\n\n        //增加道具\n        if (prop_parma) {\n            if (randomIndex == 0) {\n                Global.gameinfo.clearPropNum = ThirdAPI.getClearPropNum();\n                Global.gameinfo.clearPropNum += parseInt(prop_parma.gainAddPropNum);\n                ThirdAPI.saveClearPropNum(Global.gameinfo.clearPropNum);\n            } else if (randomIndex == 1) {\n                Global.gameinfo.superPropNum = ThirdAPI.getSuperPropNum();\n                Global.gameinfo.superPropNum += parseInt(prop_parma.gainAddPropNum);\n                ThirdAPI.saveSuperPropNum(Global.gameinfo.superPropNum);\n            } else if (randomIndex == 2) {\n                Global.gameinfo.doublePropNum += parseInt(prop_parma.gainAddPropNum);\n            } else if (randomIndex == 4) {\n                Global.startUI.updateGold(parseInt(prop_parma.gainAddPropNum));\n                var gridController = Global.gridController.getComponent('gridController');\n                gridController.showGold();\n            }\n        }\n\n\n        if (prop_parma) {\n            var self = this;\n            var LoadAtlas = require(\"LoadAtlas\");\n            LoadAtlas.loadAtlasRes(\"textures/gridItem/items\", function () {\n                var LoadAtlas = require(\"LoadAtlas\");\n                self.gainPropIcon.spriteFrame = LoadAtlas.getSpriteFrameFromName(\"textures/gridItem/items\", prop_parma.addPropSprite);\n            });\n            self.gainPropName.string = prop_parma.name + 'x' + prop_parma.gainAddPropNum;\n        }\n        //存储本地数据\n        ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n        if (Global.gridController.getComponent(\"gridController\")) {\n            Global.gridController.getComponent(\"gridController\").setPropSprite();\n        }\n        this.closeTimer = setTimeout(() => {\n                this.closeSuccessNode();\n    }, 2000);\n\n        //创建广告\n        var wxBannerAd = require('wxBannerAd');\n        wxBannerAd.createBannerAd();\n\n        this.onPauseGameForOther();\n    },\n\n    onAdFail: function () {\n        Global.game.showDialogPropText('观看完整视频获得道具');\n        //创建广告\n        var wxBannerAd = require('wxBannerAd');\n        wxBannerAd.createBannerAd();\n    },\n\n    closeSuccessNode:function(){\n        this.successNode.active = false;\n    },\n\n    playLightAction: function () {\n        this.light.node.runAction(\n            cc.repeatForever(\n                cc.sequence(cc.rotateBy(0.3, -90), cc.rotateBy(0.3, -90), cc.rotateBy(0.3, -90), cc.rotateBy(0.3, -90)))\n        );\n    },\n    \n    //点击道具\n    clickProp: function () {\n        if (Global.wxGold < Global.costGold) {\n            console.log('my costGold is ' + Global.costGold);\n            return;\n        }\n\n        if (this.isClickBomming) {\n            this.resetProp();\n        } else {\n            var scale1 = cc.scaleBy(0.4, 1.1, 1.1);\n            var scale2 = cc.scaleBy(0.4, 1 / 1.1, 1 / 1.1);\n            var repeat = cc.repeat(cc.sequence(scale1, scale2), 99999);\n            this.prop.stopAllActions();\n            this.prop.runAction(repeat);\n            // if (this.bornGrid) {\n            //     this.bornGrid.pauseAllActions();\n            // }\n            // this.node.stopAllActions();\n            this.isClickBomming = true;\n            this.clickGridNum = 0;\n        }\n    },\n\n    resetProp: function () {\n        this.isClickBomming = false;\n        this.prop.stopAllActions();\n        var scale1 = cc.scaleTo(0.1, 1, 1);\n        this.prop.runAction(scale1);\n\n\n        // if (this.bornGrid) {\n        //恢复下落格子的动作，将当前格子的item置为下落格子item\n        // var bornGridhIndex = Math.ceil(Math.abs((this.bornGrid.x - this.startX) / Global.itemSize));\n        // var bornGridvIndex = Math.ceil(Math.abs((this.bornGrid.y - this.startY) / Global.itemSize));\n        // this.allGrids[bornGridhIndex][bornGridvIndex].getComponent('gridView').item = this.bornGrid;\n        // this.isClickBomming = false;\n        //this.propClearTime = 0;\n        // this.process();\n        //     console.log('还可以继续下落');\n        // } else {\n        //     console.log('没有下落的格子');\n        // }\n    },\n\n    //先获取出生点那一列最终的目标点\n    getStopPosition: function (xBorn, yBorn) {\n        var addIndex = 0;\n        for (let index = Global.vNum - 1; index >= 0; index--) {\n            var node = this.allGrids[xBorn][index];\n            var gridView = node.getComponent(\"gridView\");\n            if (gridView && gridView.item == null && gridView.vIndex > yBorn) {\n                addIndex++;\n            }\n        }\n        return addIndex;\n    },\n\n    //设置鼠标或者手势操作动作\n    setTouchControl: function () {\n        var self = this;\n        if (self.node.parent) {\n            //开始触摸\n            self.node.on(cc.Node.EventType.TOUCH_START, this.nodeStart, this);\n            //触摸移动\n            self.node.on(cc.Node.EventType.TOUCH_MOVE, this.nodeMove, this);\n            //结束\n            self.node.on(cc.Node.EventType.TOUCH_END, this.nodeEnd, this);\n        }\n    },\n\n    nodeStart: function (event) {\n        if (!this.bornGrid) return;\n        this.startTouchPosition = event.getLocation();\n        this.moveItemIndex = this.createItemIndex;\n        this.moveStartX = Math.ceil(Math.abs((this.bornGrid.x - this.startX) / Global.itemSize));\n    },\n\n    nodeMove: function (event) {\n        if (!this.bornGrid) return;\n        if (this.moveItemIndex != this.createItemIndex) {\n            return;\n        }\n        var self = this;\n        if (this.bornGrid && this.bornGrid.getComponent('itemView').canMove && !cc.game.isPaused() && !this.isClickBomming) {\n            var moveTemp = event.getLocation();\n            var dist = moveTemp.x - self.startTouchPosition.x;\n            var downDist = moveTemp.y - self.startTouchPosition.y;\n\n            //左右移动\n            var xPadding = Math.round(dist / Global.moveThreshold);\n            var isUpOrDown = Math.abs(downDist) > Global.moveDownThreshold ? true : false;\n\n            //self.startTouchPosition = moveTemp;\n            var targetGrid = self.canMoveGrid(this.moveStartX + xPadding);\n            if (isUpOrDown) {\n                console.log('xPadding---', xPadding);\n                //上下移动\n                var isTouchDown = moveTemp.y <= self.startTouchPosition.y ? true : false;\n                //self.startTouchPosition = moveTemp;\n                var targetGrid = self.canMoveQuickDown(isTouchDown);\n                if (targetGrid) {\n                    this.bornGrid.x = targetGrid.getPosition().x;\n                    var downNum = self.getStopPosition(targetGrid.getComponent('gridView').hIndex, targetGrid.getComponent('gridView').vIndex);\n                    var targetView = self.allGrids[targetGrid.getComponent('gridView').hIndex][targetGrid.getComponent('gridView').vIndex + downNum];\n                    var priView = self.allGrids[targetGrid.getComponent('gridView').hIndex][targetGrid.getComponent('gridView').vIndex];\n                    priView.getComponent('gridView').isDown = false;\n                    targetView.getComponent('gridView').isDown = true;\n\n                    this.bornGrid.getComponent('itemView').targetGrid = targetView;\n                    //快速开始进行从出生点到最终位置的动作\n                    //cc.log('quick down:' + downNum);\n                    if (this.bornGrid.getComponent('itemView').curState == 2 || this.bornGrid.getComponent('itemView').curState == 1) {\n                        self.maxDownTime = this.bornGrid.getComponent('itemView').startQuickDownForBorn(Global.gridQuickDownSpeed);\n                    }\n                    self.node.stopAllActions();\n                    self.checkGridJoin();\n                }\n            } else if (targetGrid) {\n                this.bornGrid.x = targetGrid.getPosition().x;\n                cc.log('change bornGridx:' + this.bornGrid.x);\n                var downNum = self.getStopPosition(targetGrid.getComponent('gridView').hIndex, targetGrid.getComponent('gridView').vIndex);\n                var targetView = self.allGrids[targetGrid.getComponent('gridView').hIndex][targetGrid.getComponent('gridView').vIndex + downNum];\n                var priView = self.allGrids[targetGrid.getComponent('gridView').hIndex][targetGrid.getComponent('gridView').vIndex];\n                priView.getComponent('gridView').isDown = false;\n                targetView.getComponent('gridView').isDown = true;\n\n                this.bornGrid.getComponent('itemView').targetGrid = targetView;\n                this.bornGrid.getComponent('itemView').changeStateToWaitDown(Global.gridDownSpeed);\n                self.node.stopAllActions();\n                self.checkGridJoin();\n            }\n        }\n    },\n\n    nodeEnd: function (event) {\n        if (!this.bornGrid) return;\n        /* if (this.moveItemIndex != this.createItemIndex) {\n             console.log('同一个格子');\n             return;\n         }*/\n\n        var yDist = Math.abs(event.getLocation().y - this.startTouchPosition.y);\n\n        if (yDist == 0) {\n            var self = this;\n            /*  console.log(\"currStatus:\", this.bornGrid.getComponent('itemView').curState, this.bornGrid.getComponent('itemView').canMove);\n              if (this.bornGrid.getComponent('itemView').curState == 3 || this.bornGrid.getComponent('itemView').curState == 4 || this.bornGrid.getComponent('itemView').curState == 5) {\n                  console.log('到达格子最顶部');\n                  return;\n              }\n\n              console.log('actionJoin', this.bornGrid);*/\n\n\n\n            var targetGrid = self.canMoveQuickDown(true);\n            if (targetGrid) {\n                this.bornGrid.x = targetGrid.getPosition().x;\n                var downNum = self.getStopPosition(targetGrid.getComponent('gridView').hIndex, targetGrid.getComponent('gridView').vIndex);\n                var targetView = self.allGrids[targetGrid.getComponent('gridView').hIndex][targetGrid.getComponent('gridView').vIndex + downNum];\n                var priView = self.allGrids[targetGrid.getComponent('gridView').hIndex][targetGrid.getComponent('gridView').vIndex];\n                priView.getComponent('gridView').isDown = false;\n                targetView.getComponent('gridView').isDown = true;\n\n                this.bornGrid.getComponent('itemView').targetGrid = targetView;\n\n                cc.log('quick down:' + downNum);\n                //快速开始进行从出生点到最终位置的动作\n                if (this.bornGrid.getComponent('itemView').curState == 2 || this.bornGrid.getComponent('itemView').curState == 1) {\n                    self.maxDownTime = this.bornGrid.getComponent('itemView').startQuickDownForBorn(Global.gridQuickDownSpeed);\n                }\n                self.node.stopAllActions();\n                self.checkGridJoin();\n            }\n        }\n    },\n\n    /*是否可左右移动 */\n    canMoveGrid: function (hindex) {\n        //横、纵坐标的索引,向下取整\n        var _hIndex = Math.ceil(Math.abs((this.bornGrid.x - this.startX) / Global.itemSize));\n        var _vIndex = Math.ceil(Math.abs((this.bornGrid.y - this.startY) / Global.itemSize));\n\n        if (hindex == _hIndex) {\n            return null;\n        }\n\n        if (hindex < 0 || hindex >= Global.hNum) {\n            return null;\n        }\n        //即将移动到的gird位置\b\n        //中间元素是否可以移动\n        let startX = hindex + 1;\n        let endx = _hIndex - 1;\n        if (hindex > _hIndex) {\n            startX = _hIndex + 1;\n            endx = hindex - 1;\n        }\n        while (startX <= endx) {\n            var soonMoveGrid = this.allGrids[startX][_vIndex];\n            if (soonMoveGrid && soonMoveGrid.getComponent(\"gridView\").item == null) {\n                startX++;\n                continue;\n            }\n            return null;\n        }\n        var soonMoveGrid = this.allGrids[hindex][_vIndex];\n\n        if (soonMoveGrid && soonMoveGrid.getComponent(\"gridView\").item == null) {\n            return soonMoveGrid;\n        }\n        return null;\n    },\n\n    /*是否可以向下移动 */\n    canMoveQuickDown: function (isTouchDown) {\n        //横、纵坐标的索引,向上取整\n        var hIndex = Math.ceil(Math.abs((this.bornGrid.x - this.startX) / Global.itemSize));\n        var vIndex = Math.floor(Math.abs((this.bornGrid.y - this.startY) / Global.itemSize));\n\n        if (!isTouchDown) {\n            return null;\n        }\n        if (vIndex >= (Global.vNum - 1)) {\n            return null;\n        }\n\n        var soonMoveGrid = this.allGrids[hIndex][vIndex + 1];\n        if (soonMoveGrid && soonMoveGrid.getComponent(\"gridView\").item == null) {\n            return soonMoveGrid;\n        }\n        return null;\n    },\n\n    //重设动作目标\n    resetItemAction: function (hindex, vindex, isClearGrid) {\n        var gridviewScript = this.allGrids[hindex][vindex].getComponent('gridView');\n        if (gridviewScript.item == null) {\n            return false;\n        }\n        var downNum;\n        if (isClearGrid) {\n            downNum = 1;\n        } else {\n            downNum = this.getStopPosition(hindex, vindex);\n        }\n        //设置索引\n        if (downNum == 0) {\n            return false;\n        }\n\n        var targetView = this.allGrids[hindex][vindex + downNum];\n        targetView.getComponent('gridView').isDown = true;\n        var _curitem = gridviewScript.item.getComponent('itemView');\n        _curitem.targetGrid = targetView;\n\n        var downSpeed = (this.isDown || Global.combineTimes > 0) ? Global.gridCombineDownSpeed : Global.gridDownSpeed;\n        console.log('速度：' + downSpeed, Global.combineTimes);\n        var curtime = _curitem.startDownForBorn(downSpeed);\n\n        gridviewScript.item = null;\n        //targetView.getComponent('gridView').item = _curitem;\n        gridviewScript.gridNum = 0;\n        //加入下落格子数组\n        this.downGrids.push(_curitem);\n\n        return true;\n    },\n\n    //游戏中暂停游戏\n    onPauseOrResume: function () {\n        Global.game.playSound('btn', 0.1);\n        if (Global.isPaused) {\n            if (this.bornGrid) {\n                this.bornGrid.resumeAllActions();\n            }\n            this.node.resumeAllActions();\n            this.pauseNode.active = false;\n            Global.isPaused = false;\n        } else {\n            if (this.isClickBomming) {\n                this.resetProp();\n            }\n            if (this.bornGrid) {\n                this.bornGrid.pauseAllActions();\n            }\n            this.node.pauseAllActions();\n\n            Global.isPaused = true;\n            this.pauseNode.active = true;\n            this.pauseNode.setLocalZOrder(10);\n        }\n    },\n\n    //游戏其他功能需要暂停游戏\n    onPauseGameForOther: function () {\n        if (Global.isPaused) {\n            if (this.bornGrid) {\n                this.bornGrid.resumeAllActions();\n            }\n            this.node.resumeAllActions();\n            Global.isPaused = false;\n        } else {\n            if (this.isClickBomming) {\n                this.resetProp();\n            }\n            if (this.bornGrid) {\n                this.bornGrid.pauseAllActions();\n            }\n            this.node.pauseAllActions();\n\n            Global.isPaused = true;\n        }\n    },\n\n    //显示数字选择\n    showChooseNum: function () {\n        Global.game.playSound('btn', 0.1);\n        this.chooseNode.active = true;\n        this.chooseNode.setLocalZOrder(1);\n        this.onPauseGameForOther();\n    },\n\n    //隐藏数字选择\n    hideChooseNum: function () {\n        Global.game.playSound('btn', 0.1);\n        this.chooseNode.active = false;\n        this.onPauseGameForOther();\n    },\n\n    //隐藏消除锤锤提示界面\n    hidePropTipsNode: function () {\n        Global.game.playSound('btn', 0.1);\n        this.clearTips.active = false;\n        this.onPauseGameForOther();\n        this.createDownGrid();\n        this.setSoonGrid();\n        this.process();\n        this.createItemIndex++;\n    },\n\n    //重新开始\n    onRestart: function () {\n        Global.game.playSound('btn', 0.1);\n        this.closeListen();\n        this.reset();\n\n        if (this.bornGrid && this.bornGrid.parent) {\n            this.bornGrid.parent.removeChild(this.bornGrid);\n        }\n        Global.game.restart();\n    },\n\n    //返回主界面\n    onMainScene: function () {\n        Global.game.playSound('btn', 0.1);\n        this.closeListen();\n        this.reset();\n\n        if (this.bornGrid && this.bornGrid.parent) {\n            this.bornGrid.parent.removeChild(this.bornGrid);\n        }\n        Global.game.startGame();\n        //返回主界面的时间如果是暂停状态那就恢复游戏\n        if (cc.game.isPaused()) {\n            cc.game.resume();\n        }\n    },\n\n    //分享\n    onShareGame: function () {\n        Global.game.playSound('btn', 0.1);\n        if (typeof FBInstant !== 'undefined') {\n            ThirdAPI.shareGame(this.getImgBase64(), null);\n        } else {\n            ThirdAPI.shareGame('screenshotForDown', null, null, '244');\n        }\n    },\n\n    //更新星星的数量\n    updateGold: function (goldNum) {\n        var goldLabel = this.goldNode.getChildByName('label');\n        goldLabel.getComponent(cc.Label).string = Global.wxGold;\n        //判断是否可以存储和飞入\n        if (Global.addGold[goldNum] === undefined) {\n            cc.log('update gold ');\n            return;\n        }\n        if (parseInt(Global.addGold[goldNum]) <= 0) {\n            return;\n        }\n        //Global.wxGold += parseInt(Global.addGold[goldNum]);\n        if (Global.startUI) {\n            Global.startUI.updateRedDot(parseInt(Global.addGold[goldNum]));\n        }\n        \n        console.log('1 :' + Global.addGold[goldNum] + \"goldNum :\" + goldNum);\n        //更新并存储\n        if (typeof wx !== 'undefined') {\n            let data = ThirdAPI.loadLocalScore();\n            var score = parseInt(data.maxscore);\n            var gold = parseInt(data.gold);\n            ThirdAPI.loadScore((maxscore, gold) => {\n                score = parseInt(maxscore);\n                gold = parseInt(gold);\n                console.log('gridController on ThirdAPI loadScore', score, parseInt(gold), Global.wxGold);\n            });\n            ThirdAPI.saveScore(score, Global.wxGold);\n        }\n        this.showGold();\n    },\n\n    showGold: function () {\n        var goldLabel = this.goldNode.getChildByName('label');\n        goldLabel.getComponent(cc.Label).string = Global.wxGold;\n    },\n\n    bombRunAction: function () {\n        if (this.bombNode.active) {\n            this.bombNode.rotation = 0;\n            this.bombNode.stopAllActions();\n            this.bombNode.runAction(\n                cc.repeatForever(\n                    cc.sequence(cc.rotateBy(0.1, 10), cc.rotateBy(0.2, -20), cc.rotateBy(0.2, 20), cc.rotateBy(0.2, -20), cc.rotateBy(0.1, 10), cc.delayTime(2)))\n            );\n        }\n    },\n\n    //拉起分享炸最上面的一行\n    onBombShare: function() {\n        Global.game.playSound('btn', 0.1);\n        //记载点击'炸'按钮打点\n        var biManager = require('biManager');\n        biManager.bilog(biManager.useBomb, null);\n\n        this.pauseInterval = true;\n        if (typeof FBInstant !== 'undefined') {\n            var myUtil = require('myUtil');\n            ThirdAPI.shareGame(myUtil.getImgBase64(), this.onBombShareSuccess.bind(this));\n        } else if (typeof wx !== 'undefined') {\n            if (Global.cdnGameConfig && Global.cdnGameConfig.totalSwith) {\n                ThirdAPI.shareGame('randomImg', this.onBombShareSuccess.bind(this), this.onBombShareFail.bind(this), '253');\n            } else {\n                this.onPauseGameForOther();\n                var wxRewardVideoAd = require('wxRewardVideoAd');\n                wxRewardVideoAd.initCreateReward(this.onStartBomb.bind(this), this.onBombAdFail.bind(this));\n            }\n        } else {\n            this.onBombShareSuccess();\n        }\n    },\n\n    //使用炸弹炸一行\n    onBombShareSuccess: function (openGId) {\n        //炸分享成功打点\n        var biManager = require('biManager');\n        biManager.bilog(biManager.bombShareSuccess, null);\n\n        if (typeof wx !== 'undefined') {\n            if (!openGId) {\n                Global.game.showDialogText('分享失败，分享到群才有效');\n                console.log('分享失败，分享到群才有效');\n                return;\n            }\n        }\n        if (Global.gameinfo.shareData1.arrOpenGId.indexOf(openGId) != -1) {\n            console.log('该群今日已经分享过', openGId);\n            Global.game.showDialogText('分享失败，请分享到不同群');\n            return;\n        } else {\n            console.log('该群未分享过', openGId);\n            Global.gameinfo.shareData1.arrOpenGId.push(openGId);\n            ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n        }\n        this.onStartBomb();\n    },\n\n    //可以执行炸效果\n    onStartBomb: function () {\n        //查找出需要炸掉的哪一行\n        var needBombIndex = -1;\n        for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n            for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n                var grid = this.allGrids[hIndex][vIndex];\n                var gridView = grid.getComponent(\"gridView\");\n                if (gridView && gridView.item != null) {\n                    needBombIndex = vIndex;\n                    break;\n                }\n            }\n            if (needBombIndex > -1) {\n                break;\n            }\n        }\n\n        if (needBombIndex < 0) {\n            this.onPauseGameForOther();\n            return;\n        }\n        console.log('needBombIndex:', needBombIndex);\n\n        this.bombShareTimes++;\n        this.bombSurplus.string = Global.cdnGameConfig.bombShareTimes - this.bombShareTimes;\n        this.bombNode.active = this.bombShareTimes < Global.cdnGameConfig.bombShareTimes ? true : false;\n        if (!this.bombNode.active) {\n            this.bombNode.stopAllActions();\n        }\n\n        // this.onPauseGameForOther();\n        this.node.stopAllActions();\n        this.closeListen();\n\n        if (this.bornGrid) {\n            this.bornGrid.stopAllActions();\n        }\n\n        //暂停所有的格子动作\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                var grid = this.allGrids[hIndex][vIndex];\n                var gridView = grid.getComponent(\"gridView\");\n                if (gridView && gridView.item != null) {\n                    gridView.node.stopAllActions();\n                    gridView.item.getComponent(\"itemView\").node.stopAllActions();\n                }\n            }\n        }\n\n        //闪烁效果\n        var blinkPos = this.allGrids[Global.bornXgridNum][needBombIndex].getPosition();\n        this.blinkSpr.node.setPosition(blinkPos);\n        this.blinkSpr.node.width = Global.hNum * Global.itemSize;\n\n        this.blinkSpr.node.stopAllActions();\n        this.blinkSpr.node.setLocalZOrder(2000);\n        var myAction = cc.sequence(cc.fadeTo(0.3, 255), cc.fadeTo(0.3, 0), cc.fadeTo(0.3, 255), cc.fadeTo(0.3, 0), cc.fadeTo(0.3, 255), cc.fadeTo(0.3, 0));\n        this.blinkSpr.node.runAction(myAction);\n\n        var actions = [];\n        var time = 1.8;\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            var grid = this.allGrids[hIndex][needBombIndex];\n            var gridView = grid.getComponent(\"gridView\");\n            if (gridView && gridView.item != null) {\n                var itemViewScript = gridView.item.getComponent(\"itemView\");\n                var clearTime = itemViewScript.clearItemToRemove(time);\n                time += clearTime;\n                gridView.gridNum = 0;\n                gridView.item = null;\n            }\n        }\n\n        this.clearAllJoin();\n\n        var self = this;\n        self.node.runAction(cc.sequence(cc.delayTime(time + 0.1), cc.callFunc(function () {\n            self.onPauseGameForOther();\n            //添加触摸侦听\n            self.setTouchControl();\n            if (self.bornGrid) {\n                var targetGrid = self.bornGrid.getComponent('itemView').targetGrid;\n                var currBornXGridNum = targetGrid.getComponent('gridView').hIndex;\n\n                var downNum = self.getStopPosition(currBornXGridNum, 0);\n                var targetView = self.allGrids[currBornXGridNum][downNum];\n                self.bornGrid.getComponent('itemView').targetGrid = targetView;\n                self.bornGrid.getComponent('itemView').startDownForBorn(Global.gridDownSpeed);\n            }\n            //开始处理业务逻辑\n            self.process();\n        })));\n    },\n\n    onBombShareFail: function (msg) {\n        console.log('分享失败！');\n        if (msg === undefined) {\n            Global.game.showDialogText('分享失败！');\n        } else if (msg == 'fail') {\n            Global.game.showDialogText('分享失败，分享到群才有效');\n        } else if (msg == 'cancel') {\n            Global.game.showDialogText('分享失败！');\n        } else {\n            Global.game.showDialogText('分享失败！');\n        }\n    },\n\n    //炸观看激励视频失败\n    onBombAdFail: function () {\n        this.onPauseGameForOther();\n        Global.game.showDialogPropText('获得失败！');\n    },\n\n    //游戏结束\n    gameOver: function () {\n        this.node.stopAllActions();\n        this.closeListen();\n        ThirdAPI.clearGameProgressInfo();\n        //取消定时器\n        cc.director.getScheduler().unschedule(this.getNextFriend, this);\n        //销毁banner广告\n        var wxBannerAd = require('wxBannerAd');\n        wxBannerAd.destroyBannerAd();\n\n        //获取复活次数\n        Global.reviveShareTimes = ThirdAPI.loadReviveData();\n\n        //判断当局的次数和当天的复活次数\n        if (Global.reviveTimes < Global.reviveTotalTimes && Global.reviveShareTimes > 0) {\n            Global.game.showRevive();\n            // Global.reviveUI.setScore(this.scoreScript.scoreNum);\n        } else {\n            Global.game.showShareUI();\n            //Global.shareUI.updateMaxLabel(this.scoreScript.scoreNum);\n        }\n    },\n\n    //复活消除几行\n    clearGridForRevive: function () {\n        this.node.stopAllActions();\n        //取消定时器\n        cc.director.getScheduler().unschedule(this.getNextFriend, this);\n\n        //暂停所有的格子动作\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                var grid = this.allGrids[hIndex][vIndex];\n                var gridView = grid.getComponent(\"gridView\");\n                if (gridView && gridView.item != null) {\n                    gridView.node.stopAllActions();\n                    gridView.item.getComponent(\"itemView\").node.stopAllActions();\n                }\n            }\n        }\n\n        //开始销毁行数\n        var time = 0;\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.clearVNum; vIndex++) {\n                var grid = this.allGrids[hIndex][vIndex];\n                var gridView = grid.getComponent(\"gridView\");\n                if (gridView && gridView.item != null) {\n                    var itemViewScript = gridView.item.getComponent(\"itemView\");\n                    var clearTime = itemViewScript.toRevive();\n                    if (clearTime > time) {\n                        time = clearTime;\n                    }\n                    gridView.gridNum = 0;\n                    gridView.item = null;\n                }\n            }\n        }\n\n        //开始销毁小于64的格子\n        /*var time = 0;\n        for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n            for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                var grid = this.allGrids[hIndex][vIndex];\n                var gridView = grid.getComponent(\"gridView\");\n                if (gridView && gridView.item != null && gridView.gridNum < 64) {\n                    var itemViewScript = gridView.item.getComponent(\"itemView\");\n                    var clearTime = itemViewScript.toRevive();\n                    if (clearTime > time) {\n                        time = clearTime;\n                    }\n                    gridView.gridNum = 0;\n                    gridView.item = null;\n                }\n            }\n        }*/\n\n        this.clearAllJoin();\n\n        //销毁所有数字\n        for (let index = 0; index < Global.flyNumPools.length; index++) {\n            const element = Global.flyNumPools[index];\n            if (element && element.parent) {\n                element.getComponent('flynum').finished();\n            }\n        }\n\n        //添加触摸侦听\n        console.log('clear time:' + time);\n        var self = this;\n        self.node.runAction(cc.sequence(cc.delayTime(time + 0.1), cc.callFunc(function () {\n            //记载复活成功打点\n            var biManager = require('biManager');\n            biManager.bilog(biManager.reviveSuccess, null);\n\n            if (self.bornGrid) {\n                self.bornGrid.stopAllActions();\n                if (self.bornGrid.parent) {\n                    self.bornGrid.parent.removeChild(self.bornGrid);\n                }\n            }\n            self.bornGrid = null;\n\n            //重置所有数据\n            //self.reset();\n            //初始化棋盘\n            //self.createAllGrid();\n            //添加触摸侦听\n            self.setTouchControl();\n            //开始处理业务逻辑\n            self.process();\n        })));\n    },\n\n    /*\n    //时间判断加速\n    update: function () {\n        var unixTime = (new Date()).getTime();\n        if (unixTime > (this.startTime + Global.accessTime) && this.addTimes < Global.addTimes) {\n            this.addTimes++;\n            this.startTime = (new Date()).getTime();\n\n            Global.gridDownSpeed *= 1.2;\n            Global.gridDownSpeed = parseInt(Global.gridDownSpeed * 100) / 100;\n            Global.waitToDown *= 0.8;\n            Global.waitToDown = parseInt(Global.waitToDown * 100) / 100;\n            console.log('加速', Global.gridDownSpeed, Global.waitToDown);\n        }\n    },*/\n\n    //重置\n    reset: function () {\n        var wxBannerAd = require('wxBannerAd');\n        wxBannerAd.destroyBannerAd();\n\n        this.node.stopAllActions();\n        cc.director.getScheduler().unschedule(this.getNextFriend, this);\n\n        this.popDialogTimes = 0;\n        this.bombShareTimes = 0;\n        //初始时间\n        this.startTime = (new Date()).getTime();\n        this.usePropTimes = 0;\n        this.useSuperTimes = 0;\n        this.useDoubleTimes = 0;\n        this.useProp = -1;\n        this.setPropSprite();\n        Global.usePropStatus = -1;\n        this.addTimes = 0;\n        Global.reviveTimes = 0;\n        Global.combineTimes = 0;\n        Global.testEnabled = false;\n        this.randomScore = 0;\n        Global.joinRandomScores = [];\n        Global.isPaused = false;\n        this.isClickBomming = false;\n        this.propClearTime = 0;\n        this.clickGridNum = 0;\n        this.createItemIndex = 0;\n        this.moveItemIndex = 0;\n        this.createItemNum = 0;\n        this.createItemNum1 = 0;\n        Global.isPropGuide = false;\n        //销毁所有数字\n        for (let index = 0; index < Global.flyNumPools.length; index++) {\n            const element = Global.flyNumPools[index];\n            if (element && element.parent) {\n                element.getComponent('flynum').finished();\n            }\n        }\n\n        if (this.bornGrid) {\n            this.bornGrid.stopAllActions();\n            if (this.bornGrid.parent) {\n                this.bornGrid.parent.removeChild(this.bornGrid);\n            }\n        }\n        //销毁所有格子\n        if (this.allGrids.length > 0) {\n            for (let hIndex = 0; hIndex < Global.hNum; hIndex++) {\n                for (let vIndex = 0; vIndex < Global.vNum; vIndex++) {\n                    var grid = this.allGrids[hIndex][vIndex];\n                    var gridView = grid.getComponent(\"gridView\");\n                    grid.stopAllActions();\n                    if (gridView && gridView.item != null) {\n                        gridView.item.getComponent(\"itemView\").toRemove();\n                    }\n\n                    //销毁grid\n                    if (grid.parent) {\n                        grid.parent.removeChild(grid);\n                    }\n                }\n            }\n            this.clearAllJoin();\n        }\n        this.allGrids = [];\n        this.scoreScript.reset();\n        this.bornGrid = null;\n        if (this.soonGridInstance && this.soonGridInstance.parent) {\n            this.soonGridInstance.parent.removeChild(this.soonGridInstance);\n        }\n        // //重置道具数量\n        // if (Global.gameinfo && (Global.gameinfo.clearPropNum > 1 || Global.gameinfo.superPropNum > 1)) {\n        //     if (Global.gameinfo.clearPropNum > 1) {\n        //         Global.gameinfo.clearPropNum = 1;\n        //     }\n        //     if (Global.gameinfo.superPropNum > 1) {\n        //         Global.gameinfo.superPropNum = 1;\n        //     }\n        //     ThirdAPI.saveFriendGenStoneInfo(Global.gameinfo);\n        // }\n\n        //设置概率\n        var myUtil = require('myUtil');\n        myUtil.randomForWeight(Global.weightConfig.oneWeightRate, Global.weightConfig.oneTotalWeight);\n    },\n});"]}
{"version":3,"sources":["../../../../../assets/Scripts/common/assets/Scripts/common/wxBannerAd.js"],"names":["wxBannerAd","bannerAd","bannerAdTimer","isScale","createBannerAd","console","log","Global","myUtil","require","wx","sysInfo","getSystemInfoSync","SDKVersion","replace","slice","destroyBannerAd","adUnitId","style","left","top","width","screenWidth","isFitIphoneX","isIphoneX","show","addBannerAdTimer","winSize","cc","director","getWinSize","fitOffsetY","tywx","LOGE","startY","vNum","itemSize","itemSplit","height","Math","abs","onResize","realHeight","screenHeight","_inter","res","error","hideBannerAd","hide","showBannerAd","clearTimeout","bannerAdConfig","swith","that","setTimeout","interval","module","exports"],"mappings":"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","file":"wxBannerAd.js","sourceRoot":"../../../../../assets/Scripts/common","sourcesContent":["// banner广告接入\n\nvar wxBannerAd = {\n    bannerAd: null,\n    bannerAdTimer: null,\n\n    isScale: false,\n\n    createBannerAd: function () {\n        console.log('call initBannerAd');\n        if (!Global.myUtil) {\n            Global.myUtil = require('myUtil');\n        }\n\n        if (typeof wx !== 'undefined') {\n            var sysInfo = wx.getSystemInfoSync();\n            console.log('sysinfo: ', sysInfo);\n            if (sysInfo && sysInfo.SDKVersion && sysInfo.SDKVersion !== '') {\n                console.log('sysinfo---: ', sysInfo.SDKVersion.replace(/\\./g, \"\"));\n            }\n            if (sysInfo && sysInfo.SDKVersion && sysInfo.SDKVersion !== '' && sysInfo.SDKVersion.slice(0, 5).replace(/\\./g, \"\") >= 204) {\n                this.destroyBannerAd();\n                try {\n                    if (!this.bannerAd) {\n                        this.bannerAd = wx.createBannerAd({\n                            adUnitId: 'adunit-b4b17fafcb3b6c17',\n                            style: {\n                                left: 0,\n                                top: 0,\n                                width: sysInfo.screenWidth\n                            }\n                        });\n                    }\n\n                    this.isScale = false;\n                    // var myUtil = require('myUtil');\n                    var isFitIphoneX = Global.myUtil.isIphoneX();\n                    if (this.bannerAd) {\n                        this.bannerAd.show();\n                        this.addBannerAdTimer();\n                        var winSize = cc.director.getWinSize();\n                        // 适配iphoneX\n\n                        var fitOffsetY = 0;\n                        if (isFitIphoneX) {\n                            fitOffsetY = 40;\n                        }\n                        tywx.LOGE(\"\",\"file = [wxBannerAd] fun = [createBannerAd] 111  \");\n                        var startY = 328 - fitOffsetY - (Global.vNum - 1) * Global.itemSize - (Global.vNum - 1) * Global.itemSplit -(Global.itemSize + Global.itemSplit)/2;\n                        startY = winSize.height/2 - Math.abs(startY);\n\n                        this.bannerAd.onResize(res => {\n                            if (this.bannerAd && this.bannerAd.style) {\n                            tywx.LOGE(\"\",\"file = [wxBannerAd] fun = [createBannerAd] isFitIphoneX =  \" + isFitIphoneX);\n\n                            console.log(\"bannerAd....\",this.bannerAd);\n                            if (this.bannerAd && this.bannerAd.style) {\n                                if (this.bannerAd.style.realHeight >= ((sysInfo.screenHeight/winSize.height)*Math.abs(startY) - fitOffsetY)) {\n                                    console.log('重设宽度');\n                                    this.bannerAd.style.width = 300;\n                                }\n                                var _inter = 0;\n                                // if (isFitIphoneX && this.bannerAd.style.width == 300) {\n                                //     // _inter = (1 - 300/sysInfo.screenWidth) * res.height/(300/sysInfo.screenWidth) + 22;\n                                //     _inter = 26.5;\n                                // }\n                                // tywx.LOGE(\"\",\"file = [wxBannerAd] fun = [createBannerAd] _inter = \" + _inter);\n                                this.bannerAd.style.left = (sysInfo.screenWidth - res.width) / 2;\n                                this.bannerAd.style.top = sysInfo.screenHeight - (sysInfo.screenHeight/winSize.height)*Math.abs(startY);\n\n                            }\n                        }\n                    })\n                    }\n                } catch (error) {\n                    console.log(\"banner创建失败\",error);\n                }\n            } else {\n                console.log('SDKVersion 判断基础库版本号 >= 2.0.4 后再使用该 API');\n            }\n        }\n    },\n\n    hideBannerAd: function () {\n        console.log('call hideBannerAd');\n\n        if (this.bannerAd) {\n            this.bannerAd.hide();\n        }\n    },\n\n    showBannerAd: function () {\n        console.log('call showBannerAd');\n\n        if (this.bannerAd) {\n            this.bannerAd.show();\n        }\n    },\n\n    //销毁广告\n    destroyBannerAd: function () {\n        console.log('call destroyBannerAd');\n\n        if (this.bannerAd) {\n            try {\n                this.bannerAd.hide();\n                // this.bannerAd.destroy();\n                // this.bannerAd = null;\n            } catch (error) {\n                // this.bannerAd = null;\n            }\n        }\n        clearTimeout(this.bannerAdTimer);\n    },\n\n    //增加广告计时器\n    addBannerAdTimer: function () {\n        console.log('addBannerAdTimer');\n        if (!Global.bannerAdConfig.swith) {\n            console.log('关闭每60s刷新banner广告机制');\n            clearTimeout(this.bannerAdTimer);\n            return;\n        }\n        var that = this;\n        this.bannerAdTimer = setTimeout(function() {\n            that.createBannerAd();\n        }, Global.bannerAdConfig.interval);\n    },\n}\n\nmodule.exports = wxBannerAd;"]}
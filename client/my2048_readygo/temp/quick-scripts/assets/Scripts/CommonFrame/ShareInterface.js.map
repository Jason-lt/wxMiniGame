{"version":3,"sources":["ShareInterface.js"],"names":["tywx","ShareInterface","OnShareAppMessageInfo","setOnShareAppMessageInfo","title","imageUrl","sharePointId","shareSchemeId","getOnShareAppMessageInfo","getRandomOnShareAppMessageInfo","shareKeys","_key","PropagateInterface","ShareConfig","push","length","randomIndex","Math","floor","random","sharePointKey","sharePointInfo","config","shareContent","sharePicUrl","share","successCallback","failCallback","extraParam","IsWechatPlatform","BiLog","clickStat","clickStatEventType","clickStatEventTypeUserShare","wx","shareAppMessage","query","UserInfo","userId","userName","success","result","fail","complete","onShareAppMessageInit","onShareAppMessage","shareTickets","groupMsgInfos"],"mappings":"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","file":"ShareInterface.js","sourceRoot":"../../../../../assets/Scripts/CommonFrame","sourcesContent":["/**\n * Created by xiaochuntian on 2018/5/3.\n */\n\ntywx.ShareInterface = {\n    OnShareAppMessageInfo: null, //右上角转发对应的分享点信息\n\n    /**\n     * 设置右上角\"转发\"对应的分享信息\n     * @param title\n     * @param imageUrl\n     * @param sharePointId\n     * @param shareSchemeId\n     */\n    setOnShareAppMessageInfo: function (title, imageUrl, sharePointId, shareSchemeId) {\n        this.OnShareAppMessageInfo = {\n            title: title,\n            imageUrl: imageUrl,\n            sharePointId: sharePointId,\n            shareSchemeId: shareSchemeId\n        }\n    },\n\n    /**\n     * 获取右上角\"转发\"对应的分享信息\n     * @returns {null}\n     */\n    getOnShareAppMessageInfo: function () {\n        return this.OnShareAppMessageInfo;\n    },\n\n    /**\n     * 随机获取一个分享点作为\"转发\"对应的分享信息\n     * @returns {*}\n     */\n    getRandomOnShareAppMessageInfo: function () {\n        var shareKeys = [];\n\n        for (var _key in tywx.PropagateInterface.ShareConfig) {\n            shareKeys.push(_key);\n        }\n        if (shareKeys && shareKeys.length > 0) {\n            var randomIndex = (Math.floor(Math.random() * 10000)) % shareKeys.length;\n            var sharePointKey = shareKeys[randomIndex];\n            var sharePointInfo = tywx.PropagateInterface.ShareConfig[sharePointKey];\n            if (sharePointInfo && sharePointInfo.length > 0) {\n                randomIndex = (Math.floor(Math.random() * 10000)) % sharePointInfo.length;\n                var config = {\n                    title: sharePointInfo[randomIndex].shareContent,\n                    imageUrl: sharePointInfo[randomIndex].sharePicUrl,\n                    sharePointId: sharePointInfo[randomIndex].sharePointId,\n                    shareSchemeId: sharePointInfo[randomIndex].shareSchemeId\n                }\n                return config;\n            }\n        }\n        return null;\n    },\n\n    /**\n     * 根据分享信息调用分享接口,并封装了必要的打点和处理\n     * @param title\n     * @param imageUrl\n     * @param sharePointId\n     * @param shareSchemeId\n     * @param successCallback\n     * @param failCallback\n     */\n    share: function (title, imageUrl, sharePointId, shareSchemeId, successCallback, failCallback, extraParam) {\n        if (tywx.IsWechatPlatform()) {\n\n            tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare, [sharePointId, 1, shareSchemeId]);\n\n            wx.shareAppMessage({\n                title: title,\n                imageUrl: imageUrl,\n                query: 'inviteCode=' + tywx.UserInfo.userId + '&sourceCode=' + sharePointId + \"&inviteName=\" + tywx.UserInfo.userName + \"&imageType=\" + shareSchemeId+ \"&extraParam=\" + extraParam,\n                success: function (result) {\n                    //分享成功相关处理\n                    if (successCallback) {\n                        successCallback(result);\n                    }\n                    tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare, [sharePointId, 2, shareSchemeId]);\n                },\n                fail: function (result) {\n                    //分享失败相关处理\n                    if (failCallback) {\n                        failCallback(result);\n                    }\n                },\n                complete: function () {}\n            });\n        }\n    }\n};\n\ntywx.onShareAppMessageInit = function () {\n    if (tywx.IsWechatPlatform()) {\n        wx.onShareAppMessage(function (result) {\n            /**\n             * 获取转发信息,手动设置过则使用设置信息,否则随机获取一个分享点信息\n             */\n            var config = tywx.ShareInterface.getOnShareAppMessageInfo();\n            if (config == null) {\n                config = tywx.ShareInterface.getRandomOnShareAppMessageInfo();\n            }\n            tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare, [config.sharePointId, 1, config.shareSchemeId]);\n            return {\n                title: config.title,\n                imageUrl: config.imageUrl,\n                query: \"inviteCode=\" + tywx.UserInfo.userId + \"&sourceCode=\" + config.sharePointId + \"&inviteName=\" + tywx.UserInfo.userName + \"&imageType=\" + config.shareSchemeId,\n                success: function (shareTickets, groupMsgInfos) {\n                    tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserShare, [config.sharePointId, 2, config.shareSchemeId]);\n                },\n                fail: function () {\n\n                },\n                complete: function () {}\n            }\n        });\n    };\n};\n\ntywx.onShareAppMessageInit();"]}
{"version":3,"sources":["gridView.js"],"names":["cc","Class","extends","Component","properties","combineAudio","url","AudioClip","default","numPrefab","type","Prefab","goldPrefab","itemPrefab","combineID","allGrids","hIndex","vIndex","item","gridNum","targetGrid","Node","isDown","moveIndex","sameScoreNum","deleteGrids","isJoin","actionJoin","joinItems","canDrop","isMarkGrid","setIndex","gridController","startBianli","self","gridControllerScript","Global","getComponent","bianliForGrid","startJoin","length","changeScore","console","log","extraNum","combineTimes","doubleNum","usePropStatus","scoreScript","addScore","itemViewScript","bornNum","random","Math","popDialogTimes","cdnGameConfig","popPropTotalTimes","createItemNum1","itemNumber","markScoreEquals","indexOf","hasMark","updateNum","updateColor","playFlyNum","playFlyGold","scoreEquals","wxBannerAd","require","createBannerAd","flyIndex","canFlyNums","parseInt","numInstance","instantiate","setNum","setPosition","p","node","getPosition","x","y","parent","addChild","toPosition","playFlyNumToItem","num","bombDoubleRate","toItemPosition","score","canFlyGolds","goldInstance","goldNode","gridViewScript","bianliHIndex","bianliVIndex","hasSameScore","hNum","vNum","compareGrid","compareGridScript","compareItem","useClear","gridMaxScore","gridScript","isDropProp","push","index","deleteGrid","deleteGridScript","deleteItem","useDouble","isStone","itemMerge","resetData","check","runAction","sequence","delayTime","callFunc","checkJoinComplete","isComplete","curState","candropProp","playCombineAudio","isSoundPlaying","audioEngine","play","setFinishCallback","playAudioEnd","playAudioStart","resume","uncache","dropStone"],"mappings":"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","file":"gridView.js","sourceRoot":"../../../../../assets/Scripts/view","sourcesContent":["/*\n    合并触发判断，递归\n*/\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        combineAudio: {\n            url: cc.AudioClip,\n            default: null\n        },\n\n        numPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n        goldPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n\n        itemPrefab: {\n            default: null,\n            type: cc.Prefab,\n        },\n\n\n        combineID: 0,\n        allGrids: null, //所有的格子信息\n        hIndex: 0,\n        vIndex: 0,\n        item: null,\n\n        //格子上的分数\n        gridNum: 0, //2  4 8  16\n\n        //目标格子\n        targetGrid: {\n            default: null,\n            type: cc.Node\n        },\n\n        isDown: false, //是否是下落的格子\n\n        moveIndex: 0, //下方的格子被消灭后，移动的距离\n        sameScoreNum: 0, //合并时记录相同的分数格子数量\n\n        deleteGrids: [], //存储即将合并的格子\n        isJoin: false,\n        actionJoin: false,\n        joinItems: [],\n\n        canDrop: false,\n        isMarkGrid: false, //是带有标识的格子\n    },\n\n    //设置索引index\n    setIndex: function (hIndex, vIndex, gridController) {\n        this.hIndex = hIndex;\n        this.vIndex = vIndex;\n    },\n\n    //开始遍历\n    startBianli: function () {\n        var self = this;\n        this.joinItems = [];\n\n        var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n        this.allGrids = gridControllerScript.allGrids;\n        //将要合并的数组\n        this.deleteGrids = [];\n\n        this.bianliForGrid();\n        //开始执行合并动作\n        this.startJoin();\n        //改变分数\n        this.isDown = false;\n\n        return (this.joinItems.length > 0);\n    },\n\n    //改变分数\n    changeScore: function () {\n        var self = this;\n        var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n        self.isDown = false;\n        //改变分数\n        if (self.deleteGrids.length > 0) {\n            if (self.deleteGrids.length == 1) {\n                self.gridNum *= 2;\n            } else if (self.deleteGrids.length == 2) {\n                self.gridNum *= 4;\n            } else if (self.deleteGrids.length == 3) {\n                self.gridNum *= 8;\n            }\n\n            //判断是否是有角标的道具\n            /* var canShowDialog = false;\n             for (var index = 0; index < self.deleteGrids.length; index++) {\n                 var deleteGrid = self.deleteGrids[index];\n                 var deleteGridScript = deleteGrid.getComponent(\"gridView\");\n                 //销毁的item\n                 var deleteItem = deleteGridScript.item;\n                 if (deleteItem && deleteItem.hasMark) {\n                     canShowDialog = true;\n                 }\n             }*/\n\n\n            //弹出宝箱分享弹框\n            /*if (self.deleteGrids.length >= 2) {\n                var random = Math.random();\n                console.log('随机宝箱的概率：' + random);\n                if (!Global.propInfoUI && random <= Global.randomChestWeight) {\n                    setTimeout(() => {\n                        Global.game.showPropDialog(true);\n                    }, 300);\n                }\n            }*/\n\n            //combine加分\n            console.log('连击之前的分数：' + self.gridNum);\n            var extraNum = 0;\n            if (Global.combineTimes > 0) {\n                if (Global.combineTimes > 4) {\n                    Global.combineTimes = 4;\n                }\n                /*\n                if (Global.combineTimes > 1) {\n                    //合并数大于2\n                    console.log('删除的格子数量：' + self.deleteGrids.length);\n                    if (self.deleteGrids.length > 1) {\n                        Global.combineTimes = self.deleteGrids.length + 1;\n                    }\n                }*/\n                extraNum = (Global.combineTimes - 1) * self.gridNum;\n                console.log('连击加的分数：' + extraNum);\n            }\n            console.log('连击之后的分数：' + (self.gridNum + extraNum));\n\n            var doubleNum = 0;\n            if (Global.usePropStatus == 2) {\n                console.log('使用了双倍道具,加分之前的分数：', self.gridNum + extraNum);\n                doubleNum = self.gridNum * (2 - 1);\n                console.log('双倍道具使用之后的分数:' + self.gridNum + extraNum + doubleNum);\n                Global.usePropStatus = -1;\n            }\n\n            if (self.gridNum > 4096) {\n                self.gridNum = 4096;\n            }\n\n            //弹出道具分享\n            /*if (Global.cdnGameConfig.totalSwith) {\n                var currTime = (new Date()).getTime();\n                if (Global.wxScore < Global.cdnGameConfig.newUserScore) {\n                    if ((currTime - gridControllerScript.popDialogTimes) > Global.cdnGameConfig.newUserPropCd) {\n                        if (Global.cdnGameConfig.newUserEquals && Global.cdnGameConfig.newUserEquals.indexOf(self.gridNum) > -1) {\n                            //Global.game.showPropDialog(true);\n                            gridControllerScript.popDialogTimes = currTime;\n                        }\n                    }\n                } else {\n                    var random = Math.random();\n                    if (gridControllerScript.popDialogTimes < Global.cdnGameConfig.popPropTotalTimes || random <= Global.cdnGameConfig.weightRate) {\n                        if (self.gridNum == 1024) {\n                            //Global.game.showPropDialog(true);\n                            gridControllerScript.popDialogTimes++;\n                            itemViewScript.hasMark = true;\n                        }\n                    }\n                }\n            }*/\n\n\n            console.log('deleteGrids:' + self.deleteGrids.length);\n\n            console.log('addScore', self.gridNum);\n            gridControllerScript.scoreScript.addScore(self.gridNum + extraNum + doubleNum);\n            console.log('addScore end,self.item:', self.item);\n            if (self.item) {\n                var itemViewScript = self.item.getComponent('itemView');\n                itemViewScript.bornNum = self.gridNum;\n                //缩放动画\n                var random = Math.random();\n                console.log('设置item格子的标志概率：', random, gridControllerScript.popDialogTimes, Global.cdnGameConfig.popPropTotalTimes, self.gridNum);\n                //if (gridControllerScript.popDialogTimes < Global.cdnGameConfig.popPropTotalTimes || random <= Global.cdnGameConfig.weightRate) {\n                if (gridControllerScript.popDialogTimes < Global.cdnGameConfig.popPropTotalTimes || gridControllerScript.createItemNum1 >= Global.cdnGameConfig.itemNumber) {\n                    console.log('查找mark标识', Global.cdnGameConfig.markScoreEquals, self.gridNum);\n                    if (Global.cdnGameConfig.markScoreEquals.indexOf(self.gridNum) > -1) {\n                        //Global.game.showPropDialog(true);\n                        gridControllerScript.popDialogTimes++;\n                        gridControllerScript.createItemNum1 = 0;\n                        itemViewScript.hasMark = true;\n                        console.log('设置item格子的标志：', self.gridNum);\n                    }\n                }\n\n                console.log('updateNum');\n                itemViewScript.updateNum(-1);\n                console.log('updateColor');\n                itemViewScript.updateColor();\n                console.log('playFlyNum');\n                //飞入动画\n                self.playFlyNum();\n                console.log('playFlyGold');\n                //飞入金币\n                self.playFlyGold();\n                console.log('updateGold');\n                //gridControllerScript.updateGold(self.gridNum);\n\n                //判断是否是有角标的道具\n                //var canShowDialog = false;\n                /* for (var index = 0; index < self.deleteGrids.length; index++) {\n                     var deleteGrid = self.deleteGrids[index];\n                     var deleteGridScript = deleteGrid.getComponent(\"gridView\");\n                     //销毁的item\n                     var deleteItem = deleteGridScript.item;\n                     if (deleteItem && deleteItem.hasMark) {\n                         console.log('弹出宝箱');\n                         Global.game.showPropDialog(true);\n                     }\n                 }*/\n\n                console.log('设置item格子的合成宝箱：', self.isMarkGrid, self.gridNum);\n                if (self.isMarkGrid && Global.cdnGameConfig.scoreEquals.indexOf(self.gridNum) > -1) {\n\n                    // if (Global.cdnGameConfig.coolingTime) {\n                    //     if (Global.popBoxTimer == 0) {\n                    //         Global.popBoxTimer = new Date().getTime();\n                    //         Global.game.showPropDialog(true);\n                    //     }else {\n                    //         var interval = new Date().getTime() - Global.popBoxTimer;\n                    //         if (interval > Global.cdnGameConfig.coolingTime) {\n                    //             Global.game.showPropDialog(true);\n                    //         }\n                    //         Global.popBoxTimer = new Date().getTime();\n                    //     }\n                    //     tywx.LOGD(\"\",\"file = [gridView] fun = [changeScore] Global.popBoxTimer = \" + Global.popBoxTimer);\n                    // }else {\n                    //     Global.game.showPropDialog(true);\n                    // }\n                    //弹宝箱\n                    // Global.game.showPropDialogWindow(true);\n                    //创建广告\n                    var wxBannerAd = require('wxBannerAd');\n                    wxBannerAd.createBannerAd();\n                }\n            }\n        }\n    },\n\n    //开始播放飞入动画\n    playFlyNum: function () {\n        //合成一个512或者2048就播放数字向上飘的动画\n        var flyIndex = Global.canFlyNums.indexOf(parseInt(this.gridNum));\n        if (flyIndex <= -1) {\n            return;\n        }\n        // if (this.numInstance == null) {\n        this.numInstance = cc.instantiate(this.numPrefab);\n        // }\n        // if (this.numInstance.parent) {\n        //     this.numInstance.parent.removeChild(this.numInstance);\n        // }\n        this.numInstance.getComponent('flyNum').setNum(this.gridNum, Global.combineTimes);\n        this.numInstance.setPosition(cc.p(this.node.getPosition().x, this.node.getPosition().y));\n        this.node.parent.addChild(this.numInstance);\n        this.numInstance.getComponent('flyNum').toPosition(-300);\n    },\n\n    //开始播放飞入动画\n    playFlyNumToItem: function (num) {\n        var numInstance = cc.instantiate(this.numPrefab);\n\n        numInstance.getComponent('flyNum').setNum(num, Global.cdnGameConfig.bombDoubleRate);\n        numInstance.setPosition(cc.p(this.node.getPosition().x, this.node.getPosition().y));\n        this.node.parent.addChild(numInstance);\n        var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n        numInstance.getComponent('flyNum').toItemPosition(gridControllerScript.score.getPosition());\n    },\n\n    //播放星星动画\n    playFlyGold: function () {\n        //合成一个512或者2048就播放数字向上飘的动画\n        var flyIndex = Global.canFlyGolds.indexOf(parseInt(this.gridNum));\n        if (flyIndex <= -1) {\n            return;\n        }\n        this.goldInstance = cc.instantiate(this.goldPrefab);\n        this.goldInstance.setPosition(cc.p(this.node.getPosition().x, this.node.getPosition().y));\n        this.node.parent.addChild(this.goldInstance);\n        //金币飞入到gridControllder的金币位置\n        var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n        this.goldInstance.getComponent('flyGold').toPosition(gridControllerScript.goldNode.getPosition(), this.gridNum);\n    },\n\n    //从当前的格子开始遍历\n    bianliForGrid: function () {\n        var gridViewScript = this.node.getComponent(\"gridView\");\n        //将要遍历格子的横向索引\n        var bianliHIndex = gridViewScript.hIndex;\n        //将要遍历格子的纵向索引\n        var bianliVIndex = gridViewScript.vIndex;\n\n        //遍历左边\n        this.hasSameScore(bianliHIndex - 1, bianliVIndex);\n        //遍历右边\n        this.hasSameScore(bianliHIndex + 1, bianliVIndex);\n        //遍历上边\n        this.hasSameScore(bianliHIndex, bianliVIndex - 1);\n        //遍历下边\n        this.hasSameScore(bianliHIndex, bianliVIndex + 1);\n    },\n\n    //判断是否有相同分数的格子,如果有就进行合并\n    hasSameScore: function (hIndex, vIndex) {\n        //判断是否是边界\n        if (hIndex < 0 || hIndex >= Global.hNum || vIndex < 0 || vIndex >= Global.vNum) {\n            return;\n        }\n\n        if (hIndex == this.hIndex && vIndex == this.vIndex) {\n            return;\n        }\n\n        var compareGrid = this.allGrids[hIndex][vIndex];\n        if (this.deleteGrids.indexOf(compareGrid) > -1) {\n            return;\n        }\n        var compareGridScript = compareGrid.getComponent(\"gridView\");\n\n        //判断是否有item\n        if (compareGrid && compareGridScript.item == null) {\n            return;\n        }\n\n        //判断是否是锤子道具\n        var compareItem = compareGridScript.item;\n        if (compareItem.getComponent(\"itemView\").useClear) {\n            console.log('匹配项是锤子道具111');\n            return;\n        }\n\n        //达到最大分数\n        if (compareGridScript.gridNum > Global.gridMaxScore) {\n            return;\n        }\n        if (compareGridScript.isJoin) {\n            return;\n        }\n        var gridScript = this.node.getComponent(\"gridView\");\n        if (gridScript.item && gridScript.item.getComponent(\"itemView\").useClear) {\n            console.log('当前项是锤子道具222');\n            return;\n        }\n        //星星道具\n        var isDropProp = false;\n        // if (compareItem.getComponent(\"itemView\").isStone) {\n        //     isDropProp = true;\n        // }\n        if (compareGridScript.gridNum == gridScript.gridNum || isDropProp) {\n            this.deleteGrids.push(compareGrid);\n            compareGridScript.isDown = false;\n            this.bianliForGrid(compareGrid);\n            compareGridScript.isJoin = true;\n        }\n    },\n\n    //开始合并动作    \n    startJoin: function () {\n        var self = this;\n        self.isMarkGrid = false;\n        if (self.deleteGrids.length <= 0) {\n            return 0;\n        }\n\n        this.joinItems = [];\n        for (var index = 0; index < self.deleteGrids.length; index++) {\n            var deleteGrid = self.deleteGrids[index];\n            var deleteGridScript = deleteGrid.getComponent(\"gridView\");\n            //销毁的item\n            var deleteItem = deleteGridScript.item;\n            this.joinItems.push(deleteGridScript.item);\n\n            //判断被销毁对格子是否是加倍道具\n            if (deleteItem.useDouble) {\n                console.log('加倍道具1' + deleteGridScript.gridNum);\n                deleteItem.useDouble = false;\n                Global.usePropStatus = 2;\n            }\n            //判断自己格子是否是加倍道具\n            /*if (this.item.useDouble) {\n                console.log('加倍道具2' + this.gridNum);\n                this.item.useDouble = false;\n                Global.usePropStatus = 2;\n            }*/\n\n            //判断是否是星星道具\n            if (deleteItem.isStone) {\n                this.goldInstance = cc.instantiate(this.goldPrefab);\n                this.goldInstance.setPosition(cc.p(this.node.getPosition().x, this.node.getPosition().y));\n                this.node.parent.addChild(this.goldInstance);\n                //金币飞入到gridControllder的金币位置\n                var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n                this.goldInstance.getComponent('flyGold').toPosition(gridControllerScript.goldNode.getPosition(), this.gridNum);\n\n                console.log('删除项是星星道具');\n            }\n\n            if (deleteItem.hasMark) {\n                console.log('有标志');\n                self.isMarkGrid = true;\n            }\n            deleteItem.hasMark = false;\n\n            deleteItem.itemMerge(this.node.getPosition());\n\n            console.log('删除item：' + deleteGridScript.gridNum, deleteGridScript.hIndex, deleteGridScript.vIndex);\n            deleteGridScript.item = null;\n            deleteGridScript.resetData();\n        }\n        //播放合并的声音\n        this.actionJoin = true;\n        this.check();\n    },\n\n    check: function () {\n        console.log('gridView check');\n        var self = this;\n        this.node.runAction(cc.sequence(cc.delayTime(0.01), cc.callFunc(function () {\n            self.checkJoinComplete();\n        })));\n    },\n\n    checkJoinComplete: function () {\n        var isComplete = true;\n        for (var index = 0; index < this.joinItems.length; index++) {\n            var deleteItem = this.joinItems[index];\n            if (deleteItem.curState > 0) {\n                isComplete = false;\n                break;\n            }\n        }\n        if (isComplete) {\n            if (this.joinItems.length > 0) {\n                Global.candropProp = true;\n            }\n            console.log('合并结束，加分数');\n            this.changeScore();\n            this.actionJoin = false;\n            this.playCombineAudio();\n        } else {\n            console.log('检查合并结束，重新check');\n            this.check();\n        }\n    },\n\n    playCombineAudio: function () {\n        cc.log('play audio');\n        if (Global.isSoundPlaying && this.combineAudio != null) {\n            this.combineID = cc.audioEngine.play(this.combineAudio, false, 1);\n            //回调\n            var self = this;\n            if (self.combineID > 0) {\n                cc.audioEngine.setFinishCallback(self.combineID, function () {\n                    self.playAudioEnd();\n                });\n            }\n        }\n    },\n    //播放声音\n    playAudioStart: function () {\n        if (this.combineID != 0) {\n            cc.audioEngine.resume(this.combineID);\n        }\n    },\n\n    //暂停声音声音\n    playAudioEnd: function () {\n        cc.audioEngine.uncache(this.combineID);\n    },\n\n    //重置数据\n    resetData: function () {\n        this.gridNum = 0;\n    },\n\n    //概率掉落道具(星星)\n    dropStone: function (hIndex, vIndex) {\n        /*   //先判断上方是否有格子存在\n           if (vIndex >= Global.vNum) {\n               return;\n           }\n           var upGrid = this.allGrids[hIndex][vIndex];\n           if (!upGrid) return;\n           var upGridScript = upGrid.getComponent(\"gridView\");\n\n           //判断是否有item\n           if (upGridScript.item !== null) {\n               return;\n           }\n           //开始创建item\n           var item = cc.instantiate(this.itemPrefab);\n           //出生的目标点\n           item.setPosition(upGrid.getPosition());\n           var itemScript = item.getComponent('itemView');\n           itemScript.isStone = true;\n\n           itemScript.initData(0, false);\n           itemScript.updateNumForProp();\n\n           Global.gridController.addChild(item);\n           upGridScript.item = itemScript;\n\n           var gridControllerScript = Global.gridController.getComponent(\"gridController\");\n\n           itemScript.targetGrid = this.allGrids[hIndex][vIndex];\n           Global.candropProp = false;\n\n           console.log('drop---------:', this.hIndex, this.vIndex,this.allGrids);*/\n\n\n        //itemScript.targetGrid = upGrid;\n\n        //itemScript.startDownForBorn(Global.gridDownSpeed);\n    },\n\n\n\n});"]}
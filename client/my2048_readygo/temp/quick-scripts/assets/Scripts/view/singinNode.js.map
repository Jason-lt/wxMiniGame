{"version":3,"sources":["singinNode.js"],"names":["ThirdAPI","require","cc","Class","extends","Component","properties","getRewardBtn","Node","pageBg","layout_1","layout_2","dayNode","Prefab","shareBtn","onLoad","active","_getRewardList","loadGetRewardList","indexOf","Global","accumulateSingin","cdnGameConfig","totalSwith","size","director","getWinSize","scene_scale","width","setScale","createDataNode","i","instantiate","com","getComponent","setDayIndex","addChild","onClickGetReward","singinRewardConfig","key","index","length","push","number","numer","des","skipList","money","storeData","saveInfo","tips","skin_money","startUI","updateGold","shareDouble","game","showDialogPropText","saveGetRewardList","listenUtil","eventCtrl","trigger","onShareDouble","shareGame","onShareSuccess","bind","onShareFail","openGId","wx","showDialogText","console","log","gameinfo","shareData1","arrOpenGId","msg","undefined","onClose","node","destroy","singinUI"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAIA,WAAWC,QAAQ,oBAAR,CAAf;AACAC,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,sBAAaL,GAAGM,IADR;AAERC,gBAAOP,GAAGM,IAFF;AAGRE,kBAASR,GAAGM,IAHJ;AAIRG,kBAAST,GAAGM,IAJJ;AAKRI,iBAAQV,GAAGW,MALH;AAMRC,kBAASZ,GAAGM;AANJ,KAHP;;AAYLO,YAAO,kBAAU;AACb,aAAKR,YAAL,CAAkBS,MAAlB,GAA2B,KAA3B;AACA,aAAKF,QAAL,CAAcE,MAAd,GAAuB,KAAvB;AACA,YAAIC,iBAAiBjB,SAASkB,iBAAT,EAArB;AACA,YAAID,eAAeE,OAAf,CAAuBC,OAAOC,gBAA9B,KAAmD,CAAC,CAAxD,EAA0D;AACtD,iBAAKd,YAAL,CAAkBS,MAAlB,GAA2B,IAA3B;AACA,gBAAII,OAAOE,aAAP,IAAwBF,OAAOE,aAAP,CAAqBC,UAAjD,EAA6D;AACzD,qBAAKT,QAAL,CAAcE,MAAd,GAAuB,IAAvB;AACH,aAFD,MAEM;AACF,qBAAKF,QAAL,CAAcE,MAAd,GAAuB,KAAvB;AACH;AACJ;;AAED,YAAIQ,OAAOtB,GAAGuB,QAAH,CAAYC,UAAZ,EAAX;AACA,YAAIC,cAAcH,KAAKI,KAAL,GAAW,GAA7B;AACA,aAAKnB,MAAL,CAAYoB,QAAZ,CAAqBF,WAArB;AACA,aAAKG,cAAL;AACH,KA7BI;;AA+BLA,oBAAe,0BAAU;AACrB,aAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAI,CAApB,EAAuBA,GAAvB,EAA4B;AACxB,gBAAInB,UAAUV,GAAG8B,WAAH,CAAe,KAAKpB,OAApB,CAAd;AACA,gBAAIqB,MAAMrB,QAAQsB,YAAR,CAAqB,SAArB,CAAV;AACAD,gBAAIE,WAAJ,CAAgBJ,CAAhB;AACA,gBAAIA,IAAI,CAAR,EAAU;AACN,qBAAKrB,QAAL,CAAc0B,QAAd,CAAuBxB,OAAvB;AACH,aAFD,MAEM;AACF,qBAAKD,QAAL,CAAcyB,QAAd,CAAuBxB,OAAvB;AACH;AACJ;AACJ,KA1CI;;AA4CLyB,sBAAiB,4BAAU;AACvB,YAAIjB,OAAOkB,kBAAX,EAA8B;AAC1B,iBAAK,IAAIC,GAAT,IAAgBnB,OAAOkB,kBAAvB,EAA0C;AACtC,oBAAIrB,iBAAiBjB,SAASkB,iBAAT,EAArB;AACA,oBAAIE,OAAOkB,kBAAP,CAA0BC,GAA1B,EAA+BC,KAA/B,IAAwCvB,eAAewB,MAAf,GAAwB,CAApE,EAAsE;AAClE,wBAAIxB,iBAAiBjB,SAASkB,iBAAT,EAArB;AACAD,mCAAeyB,IAAf,CAAoBtB,OAAOC,gBAA3B;AACA,wBAAIsB,SAASvB,OAAOkB,kBAAP,CAA0BC,GAA1B,EAA+BK,KAA5C;AACA;AACA,wBAAGxB,OAAOkB,kBAAP,CAA0BC,GAA1B,EAA+BM,GAA/B,CAAmC1B,OAAnC,CAA2C,IAA3C,KAAoD,CAAvD,EAAyD;AACrD,4BAAI2B,WAAW,CAAC,MAAD,EAAQ,MAAR,EAAe,OAAf,EAAuB,OAAvB,EAA+B,OAA/B,EAAuC,OAAvC,CAAf;AACA,4BAAIC,QAAQ,CAAC,CAAD,EAAG,EAAH,EAAM,GAAN,EAAU,GAAV,EAAc,GAAd,EAAkB,GAAlB,CAAZ;AACA,4BAAIP,QAAQM,SAAS3B,OAAT,CAAiBC,OAAOkB,kBAAP,CAA0BC,GAA1B,EAA+BM,GAAhD,CAAZ;;AAEA,4BAAIzB,OAAO4B,SAAP,CAAiB7B,OAAjB,CAAyBqB,QAAM,GAA/B,KAAuC,CAAC,CAA5C,EAA8C;AAC1CpB,mCAAO4B,SAAP,CAAiBN,IAAjB,CAAsBF,QAAQ,IAAI,GAAlC;AACAxC,qCAASiD,QAAT,CAAkB,WAAlB,EAA+B7B,OAAO4B,SAAtC;AACA,gCAAIE,OAAO,SAASjC,eAAewB,MAAxB,GAAiC,GAAjC,GAAuC,MAAvC,GAAgDrB,OAAOkB,kBAAP,CAA0BC,GAA1B,EAA+BM,GAA1F;AACH,yBAJD,MAIM;AACF,gCAAIM,aAAaJ,MAAMP,KAAN,KAAgB,CAAjC;AACA,gCAAIU,OAAO,SAASjC,eAAewB,MAAxB,GAAiC,GAAjC,GAAuC,YAAvC,GAAsDU,UAAjE;AACA/B,mCAAOgC,OAAP,CAAeC,UAAf,CAA0BF,UAA1B;AACH;AACJ,qBAdD,MAcM;AACF,4BAAI,KAAKG,WAAT,EAAqB;AACjBX,qCAASA,SAAO,CAAhB;AACH;AACD,4BAAIO,OAAO,SAASjC,eAAewB,MAAxB,GAAiC,GAAjC,GAAuC,QAAvC,GAAkDE,MAA7D;AACAvB,+BAAOgC,OAAP,CAAeC,UAAf,CAA0BV,MAA1B;AACH;AACDvB,2BAAOmC,IAAP,CAAYC,kBAAZ,CAA+BN,IAA/B;AACA,yBAAK3C,YAAL,CAAkBS,MAAlB,GAA2B,KAA3B;AACA,yBAAKF,QAAL,CAAcE,MAAd,GAAuB,KAAvB;;AAEAhB,6BAASyD,iBAAT,CAA2BxC,cAA3B;;AAEAyC,+BAAWC,SAAX,CAAqBC,OAArB,CAA6B,aAA7B,EAA4C,IAA5C;AACA;AACH;AACJ;AACJ;;AAED,aAAKN,WAAL,GAAmB,KAAnB;AACH,KAvFI;;AAyFLO,mBAAc,yBAAU;AACpB,aAAKP,WAAL,GAAmB,KAAnB;AACA,YAAIlC,OAAOE,aAAP,IAAwBF,OAAOE,aAAP,CAAqBC,UAAjD,EAA6D;AACzDvB,qBAAS8D,SAAT,CAAmB,WAAnB,EAAgC,KAAKC,cAAL,CAAoBC,IAApB,CAAyB,IAAzB,CAAhC,EAAgE,KAAKC,WAAL,CAAiBD,IAAjB,CAAsB,IAAtB,CAAhE,EAA6F,KAA7F;AACH,SAFD,MAEO;AACH,iBAAK3B,gBAAL;AACH;AACJ,KAhGI;;AAkGL0B,oBAAe,wBAASG,OAAT,EAAiB;AAC5B,YAAI,OAAOC,EAAP,KAAc,WAAlB,EAA+B;AAC3B,gBAAI,CAACD,OAAL,EAAc;AACV9C,uBAAOmC,IAAP,CAAYa,cAAZ,CAA2B,cAA3B;AACAC,wBAAQC,GAAR,CAAY,cAAZ;AACA;AACH;AACJ;AACD,YAAIlD,OAAOmD,QAAP,CAAgBC,UAAhB,CAA2BC,UAA3B,CAAsCtD,OAAtC,CAA8C+C,OAA9C,KAA0D,CAAC,CAA/D,EAAkE;AAC9DG,oBAAQC,GAAR,CAAY,WAAZ,EAAyBJ,OAAzB;AACA9C,mBAAOmC,IAAP,CAAYa,cAAZ,CAA2B,cAA3B;AACA;AACH,SAJD,MAIO;AACHC,oBAAQC,GAAR,CAAY,QAAZ,EAAsBJ,OAAtB;AACA,iBAAKZ,WAAL,GAAmB,IAAnB;AACA,iBAAKjB,gBAAL;AACH;AACJ,KAnHI;;AAqHL4B,iBAAY,qBAASS,GAAT,EAAa;AACrB,YAAIA,QAAQC,SAAZ,EAAuB;AACnBvD,mBAAOmC,IAAP,CAAYa,cAAZ,CAA2B,OAA3B;AACH,SAFD,MAEO,IAAIM,OAAO,MAAX,EAAmB;AACtBtD,mBAAOmC,IAAP,CAAYa,cAAZ,CAA2B,cAA3B;AACH,SAFM,MAEA,IAAIM,OAAO,QAAX,EAAqB;AACxBtD,mBAAOmC,IAAP,CAAYa,cAAZ,CAA2B,OAA3B;AACH,SAFM,MAEA;AACHhD,mBAAOmC,IAAP,CAAYa,cAAZ,CAA2B,OAA3B;AACH;AACJ,KA/HI;;AAiILQ,aAAQ,mBAAU;AACd,aAAKC,IAAL,CAAUC,OAAV;AACA1D,eAAO2D,QAAP,GAAkB,IAAlB;AACH;;AAED;AAtIK,CAAT","file":"singinNode.js","sourceRoot":"../../../../../assets/Scripts/view","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nvar ThirdAPI = require('../common/ThirdAPI');\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        getRewardBtn:cc.Node,\n        pageBg:cc.Node,\n        layout_1:cc.Node,\n        layout_2:cc.Node,\n        dayNode:cc.Prefab,\n        shareBtn:cc.Node,\n    },\n\n    onLoad:function(){\n        this.getRewardBtn.active = false;\n        this.shareBtn.active = false;\n        var _getRewardList = ThirdAPI.loadGetRewardList();\n        if (_getRewardList.indexOf(Global.accumulateSingin) == -1){\n            this.getRewardBtn.active = true;\n            if (Global.cdnGameConfig && Global.cdnGameConfig.totalSwith) {\n                this.shareBtn.active = true;\n            }else {\n                this.shareBtn.active = false;\n            }\n        }\n\n        var size = cc.director.getWinSize();\n        var scene_scale = size.width/640;\n        this.pageBg.setScale(scene_scale);\n        this.createDataNode();\n    },\n    \n    createDataNode:function(){\n        for (var i = 0; i < 7; i++) {\n            var dayNode = cc.instantiate(this.dayNode);\n            var com = dayNode.getComponent(\"dayNode\");\n            com.setDayIndex(i);\n            if (i < 3){\n                this.layout_1.addChild(dayNode);\n            }else {\n                this.layout_2.addChild(dayNode);\n            }\n        }\n    },\n    \n    onClickGetReward:function(){\n        if (Global.singinRewardConfig){\n            for (var key in Global.singinRewardConfig){\n                var _getRewardList = ThirdAPI.loadGetRewardList();\n                if (Global.singinRewardConfig[key].index == _getRewardList.length + 1){\n                    var _getRewardList = ThirdAPI.loadGetRewardList();\n                    _getRewardList.push(Global.accumulateSingin);\n                    var number = Global.singinRewardConfig[key].numer;\n                    //领取当天奖励\n                    if(Global.singinRewardConfig[key].des.indexOf(\"皮肤\") >= 0){\n                        var skipList = [\"数字皮肤\",\"富豪皮肤\",\"甄嬛传皮肤\",\"脑残版皮肤\",\"扑克版皮肤\",\"复仇版皮肤\"];\n                        var money = [0,50,150,300,500,850];\n                        var index = skipList.indexOf(Global.singinRewardConfig[key].des);\n\n                        if (Global.storeData.indexOf(index+100) == -1){\n                            Global.storeData.push(index + 1 * 100);\n                            ThirdAPI.saveInfo('skinstore', Global.storeData);\n                            var tips = \"累积登录\" + _getRewardList.length + \"天\" + \"恭喜获得\" + Global.singinRewardConfig[key].des;\n                        }else {\n                            var skin_money = money[index] || 0;\n                            var tips = \"累积登录\" + _getRewardList.length + \"天\" + \"奖励已自动转换为星星\" + skin_money;\n                            Global.startUI.updateGold(skin_money);\n                        }\n                    }else {\n                        if (this.shareDouble){\n                            number = number*2;\n                        }\n                        var tips = \"累积登录\" + _getRewardList.length + \"天\" + \"恭喜获得星星\" + number;\n                        Global.startUI.updateGold(number);\n                    }\n                    Global.game.showDialogPropText(tips);\n                    this.getRewardBtn.active = false;\n                    this.shareBtn.active = false;\n\n                    ThirdAPI.saveGetRewardList(_getRewardList);\n\n                    listenUtil.eventCtrl.trigger('updateState', null);\n                    break;\n                }\n            }\n        }\n\n        this.shareDouble = false;\n    },\n\n    onShareDouble:function(){\n        this.shareDouble = false;\n        if (Global.cdnGameConfig && Global.cdnGameConfig.totalSwith) {\n            ThirdAPI.shareGame('randomImg', this.onShareSuccess.bind(this), this.onShareFail.bind(this), '247');\n        } else {\n            this.onClickGetReward();\n        }\n    },\n\n    onShareSuccess:function(openGId){\n        if (typeof wx !== 'undefined') {\n            if (!openGId) {\n                Global.game.showDialogText('分享失败，分享到群才有效');\n                console.log('分享失败，分享到群才有效');\n                return;\n            }\n        }\n        if (Global.gameinfo.shareData1.arrOpenGId.indexOf(openGId) != -1) {\n            console.log('该群今日已经分享过', openGId);\n            Global.game.showDialogText('分享失败，请分享到不同群');\n            return;\n        } else {\n            console.log('该群未分享过', openGId);\n            this.shareDouble = true;\n            this.onClickGetReward();\n        }\n    },\n\n    onShareFail:function(msg){\n        if (msg === undefined) {\n            Global.game.showDialogText('分享失败！');\n        } else if (msg == 'fail') {\n            Global.game.showDialogText('分享失败，分享到群才有效');\n        } else if (msg == 'cancel') {\n            Global.game.showDialogText('分享失败！');\n        } else {\n            Global.game.showDialogText('分享失败！');\n        }\n    },\n\n    onClose:function(){\n        this.node.destroy();\n        Global.singinUI = null;\n    },\n\n    // update (dt) {},\n});\n"]}
{"version":3,"sources":["TitleItem.js"],"names":["ThirdAPI","require","cc","Class","extends","Component","properties","bg","default","type","Sprite","title","Label","description","button","Node","price","reward","date","titleType","index","isHave","onLoad","on","onButton","getComponent","Button","interactable","getChildByName","string","setTitle","setDescription","updateState","Global","titleMaxScore","storeData","length","titleData","setUnlock","setTitleType","setPrice","setReward","setDate","setIsHave","game","playSound","repeat","i","push","saveInfo","d","Date","now","getFullYear","getMonth","getDate","titleDateData","titleUI","updateLabelComplete","updateItemsState","showTitleInfoWindow","titleInfoUI","initData","addPropScore"],"mappings":";;;;;;AAAA,IAAIA,WAAWC,QAAQ,oBAAR,CAAf;;AAEAC,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,YAAI;AACAC,qBAAS,IADT;AAEAC,kBAAMP,GAAGQ;AAFT,SADI;AAKRC,eAAO;AACHH,qBAAS,IADN;AAEHC,kBAAMP,GAAGU;AAFN,SALC;AASRC,qBAAa;AACTL,qBAAS,IADA;AAETC,kBAAMP,GAAGU;AAFA,SATL;AAaRE,gBAAQ;AACJN,qBAAS,IADL;AAEJC,kBAAMP,GAAGa;AAFL,SAbA;AAiBR;AACAC,eAAO,CAlBC;AAmBR;AACAC,gBAAQ,CApBA;AAqBR;AACAC,cAAM,EAtBE;AAuBR;AACA;AACA;AACA;AACAC,mBAAW,CA3BH;AA4BRC,eAAO,CA5BC;AA6BR;AACAC,gBAAQ;AA9BA,KAHP;;AAoCLC,UApCK,oBAoCI;AACL,aAAKR,MAAL,CAAYS,EAAZ,CAAe,OAAf,EAAwB,KAAKC,QAA7B,EAAuC,IAAvC;AACA,aAAKH,MAAL,GAAc,KAAd;AACA;;AAEA,aAAKP,MAAL,CAAYW,YAAZ,CAAyBvB,GAAGwB,MAA5B,EAAoCC,YAApC,GAAmD,KAAnD;AACA,aAAKb,MAAL,CAAYc,cAAZ,CAA2B,OAA3B,EAAoCH,YAApC,CAAiDvB,GAAGU,KAApD,EAA2DiB,MAA3D,GAAoE,KAApE;AACH,KA3CI;;;AA6CL;AACAC,cAAU,kBAAUnB,KAAV,EAAiB;AACvB,aAAKA,KAAL,CAAWkB,MAAX,GAAoBlB,KAApB;AACH,KAhDI;;AAkDL;AACAoB,oBAAgB,wBAAUlB,WAAV,EAAuB;AACnC,aAAKA,WAAL,CAAiBgB,MAAjB,GAA0BhB,WAA1B;AACH,KArDI;;AAuDL;AACAmB,iBAAa,qBAASb,SAAT,EAAoB;AAC7B,YAAI,KAAKE,MAAT,EAAiB,OAAO,KAAP;AACjB,YAAIF,aAAa,KAAKA,SAAtB,EAAiC,OAAO,KAAP;;AAEjC,YAAI,KAAKA,SAAL,IAAkB,CAAtB,EAAyB;AACrB;AACA,gBAAI,KAAKH,KAAL,IAAciB,OAAOC,aAAzB,EAAwC;AACpC,qBAAKpB,MAAL,CAAYW,YAAZ,CAAyBvB,GAAGwB,MAA5B,EAAoCC,YAApC,GAAmD,IAAnD;AACA,qBAAKb,MAAL,CAAYc,cAAZ,CAA2B,OAA3B,EAAoCH,YAApC,CAAiDvB,GAAGU,KAApD,EAA2DiB,MAA3D,GAAoE,IAApE;AACA,uBAAO,IAAP;AACH;AACD;AALA,iBAMK;AACD,yBAAKf,MAAL,CAAYW,YAAZ,CAAyBvB,GAAGwB,MAA5B,EAAoCC,YAApC,GAAmD,KAAnD;AACA,yBAAKb,MAAL,CAAYc,cAAZ,CAA2B,OAA3B,EAAoCH,YAApC,CAAiDvB,GAAGU,KAApD,EAA2DiB,MAA3D,GAAoE,KAApE;AACA,2BAAO,KAAP;AACH;AACJ,SAbD,MAcK,IAAI,KAAKV,SAAL,IAAkB,CAAtB,EAAyB;AAC1B;AACA,gBAAI,KAAKH,KAAL,IAAciB,OAAOE,SAAP,CAAiBC,MAAnC,EAA2C;AACvC,qBAAKtB,MAAL,CAAYW,YAAZ,CAAyBvB,GAAGwB,MAA5B,EAAoCC,YAApC,GAAmD,IAAnD;AACA,qBAAKb,MAAL,CAAYc,cAAZ,CAA2B,OAA3B,EAAoCH,YAApC,CAAiDvB,GAAGU,KAApD,EAA2DiB,MAA3D,GAAoE,IAApE;AACA,uBAAO,IAAP;AACH;AACD;AALA,iBAMK;AACD,yBAAKf,MAAL,CAAYW,YAAZ,CAAyBvB,GAAGwB,MAA5B,EAAoCC,YAApC,GAAmD,KAAnD;AACA,yBAAKb,MAAL,CAAYc,cAAZ,CAA2B,OAA3B,EAAoCH,YAApC,CAAiDvB,GAAGU,KAApD,EAA2DiB,MAA3D,GAAoE,KAApE;AACA,2BAAO,KAAP;AACH;AACJ,SAbI,MAcA,IAAI,KAAKV,SAAL,IAAkB,CAAtB,EAAyB;AAC1B;AACA;AACA,gBAAI,KAAKH,KAAL,IAAciB,OAAOI,SAAP,CAAiBD,MAAnC,EAA2C;AACvC,qBAAKtB,MAAL,CAAYW,YAAZ,CAAyBvB,GAAGwB,MAA5B,EAAoCC,YAApC,GAAmD,IAAnD;AACA,qBAAKb,MAAL,CAAYc,cAAZ,CAA2B,OAA3B,EAAoCH,YAApC,CAAiDvB,GAAGU,KAApD,EAA2DiB,MAA3D,GAAoE,IAApE;AACA,uBAAO,IAAP;AACH;AACD;AALA,iBAMK;AACD,yBAAKf,MAAL,CAAYW,YAAZ,CAAyBvB,GAAGwB,MAA5B,EAAoCC,YAApC,GAAmD,KAAnD;AACA,yBAAKb,MAAL,CAAYc,cAAZ,CAA2B,OAA3B,EAAoCH,YAApC,CAAiDvB,GAAGU,KAApD,EAA2DiB,MAA3D,GAAoE,KAApE;AACA,2BAAO,KAAP;AACH;AACJ;AACJ,KAvGI;;AAyGL;AACAS,eAAW,qBAAW;AAClB,YAAI,KAAKjB,MAAT,EAAiB;;AAEjB,aAAKP,MAAL,CAAYW,YAAZ,CAAyBvB,GAAGwB,MAA5B,EAAoCC,YAApC,GAAmD,IAAnD;AACA,aAAKb,MAAL,CAAYc,cAAZ,CAA2B,OAA3B,EAAoCH,YAApC,CAAiDvB,GAAGU,KAApD,EAA2DiB,MAA3D,GAAoE,IAApE;AACH,KA/GI;;AAiHL;AACAU,kBAAc,sBAAUpB,SAAV,EAAqB;AAC/B,aAAKA,SAAL,GAAiBA,SAAjB;AACH,KApHI;;AAsHL;AACAqB,cAAU,kBAAUxB,KAAV,EAAiB;AACvB,aAAKA,KAAL,GAAaA,KAAb;AACH,KAzHI;;AA2HL;AACAyB,eAAW,mBAAUxB,MAAV,EAAkB;AACzB,aAAKA,MAAL,GAAcA,MAAd;AACA;AACH,KA/HI;;AAiIL;AACAyB,aAAS,iBAAUxB,IAAV,EAAgB;AACrB,aAAKA,IAAL,GAAYA,IAAZ;AACH,KApII;;AAsIL;AACAyB,eAAW,qBAAY;AACnB,aAAKtB,MAAL,GAAc,IAAd;AACA,aAAKP,MAAL,CAAYW,YAAZ,CAAyBvB,GAAGwB,MAA5B,EAAoCC,YAApC,GAAmD,IAAnD;AACA,aAAKb,MAAL,CAAYc,cAAZ,CAA2B,OAA3B,EAAoCH,YAApC,CAAiDvB,GAAGU,KAApD,EAA2DiB,MAA3D,GAAoE,IAApE;AACH,KA3II;;AA6IL;AACAL,cAAU,oBAAY;AAClBS,eAAOW,IAAP,CAAYC,SAAZ,CAAsB,KAAtB,EAA6B,GAA7B;AACA,YAAI,CAAC,KAAKxB,MAAV,EAAkB;AACd,iBAAKA,MAAL,GAAc,IAAd;AACA,gBAAIyB,SAAS,KAAb;AACA,iBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAId,OAAOI,SAAP,CAAiBD,MAArC,EAA6CW,GAA7C,EAAkD;AAC9C,oBAAI,KAAK3B,KAAL,IAAca,OAAOI,SAAP,CAAiBU,CAAjB,CAAlB,EAAuC;AACnCD,6BAAS,IAAT;AACA;AACH;AACJ;AACD,gBAAI,CAACA,MAAL,EAAa;AACTb,uBAAOI,SAAP,CAAiBW,IAAjB,CAAsB,KAAK5B,KAA3B;AACApB,yBAASiD,QAAT,CAAkB,OAAlB,EAA2BhB,OAAOI,SAAlC;;AAEA,oBAAIa,IAAI,IAAIC,IAAJ,CAASA,KAAKC,GAAL,EAAT,CAAR;AACA,qBAAKlC,IAAL,GAAYgC,EAAEG,WAAF,KAAkB,GAAlB,IAAyBH,EAAEI,QAAF,KAAa,CAAtC,IAA2C,GAA3C,GAAiDJ,EAAEK,OAAF,EAA7D;AACAtB,uBAAOuB,aAAP,CAAqBR,IAArB,CAA0B,KAAK9B,IAA/B;AACAlB,yBAASiD,QAAT,CAAkB,YAAlB,EAAgChB,OAAOuB,aAAvC;AACA;;AAEAvB,uBAAOwB,OAAP,CAAeC,mBAAf;AACH;;AAED,iBAAK5C,MAAL,CAAYc,cAAZ,CAA2B,OAA3B,EAAoCH,YAApC,CAAiDvB,GAAGU,KAApD,EAA2DiB,MAA3D,GAAoE,IAApE;;AAEA,gBAAII,OAAOwB,OAAX,EACIxB,OAAOwB,OAAP,CAAeE,gBAAf,CAAgC,CAAhC;;AAEJ;AACA;AACA1B,mBAAOW,IAAP,CAAYgB,mBAAZ;AACA,gBAAI3B,OAAO4B,WAAX,EAAwB;AACpB;AACA5B,uBAAO4B,WAAP,CAAmBC,QAAnB,CAA4B,KAAKnD,KAAL,CAAWkB,MAAvC,EAA+C,KAAKhB,WAAL,CAAiBgB,MAAhE,EAAwE,KAAKZ,MAAL,GAAY,KAApF,EAA2F,KAAKC,IAAhG;AACAe,uBAAO4B,WAAP,CAAmBE,YAAnB,CAAgC,KAAK9C,MAArC;AACH;AACJ,SAnCD,MAoCK;AACD;AACA;AACAgB,mBAAOW,IAAP,CAAYgB,mBAAZ;AACA,gBAAI3B,OAAO4B,WAAX,EAAuB;AACnB;AACA5B,uBAAO4B,WAAP,CAAmBC,QAAnB,CAA4B,KAAKnD,KAAL,CAAWkB,MAAvC,EAA+C,KAAKhB,WAAL,CAAiBgB,MAAhE,EAAwE,KAAKZ,MAAL,GAAY,KAApF,EAA2F,KAAKC,IAAhG;AACH;AACJ;AACJ;;AAED;AA/LK,CAAT","file":"TitleItem.js","sourceRoot":"../../../../../assets/Scripts/ui","sourcesContent":["var ThirdAPI = require('../common/ThirdAPI')\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        bg: {\n            default: null,\n            type: cc.Sprite,\n        },\n        title: {\n            default: null,\n            type: cc.Label,\n        },\n        description: {\n            default: null,\n            type: cc.Label,\n        },\n        button: {\n            default: null,\n            type: cc.Node,\n        },\n        // 达成条件\n        price: 0,\n        // 奖励\n        reward: 0,\n        // 达成日期\n        date: '',\n        // 成就类型\n        // 1 单局分数达到n\n        // 2 解锁皮肤达到n个\n        // 3 解锁成就达到n个\n        titleType: 1,\n        index: 0,\n        // 此皮肤是否已经拥有\n        isHave: false,\n    },\n\n    onLoad() {\n        this.button.on('click', this.onButton, this);\n        this.isHave = false;\n        //this.reward = 0;\n\n        this.button.getComponent(cc.Button).interactable = false;\n        this.button.getChildByName(\"price\").getComponent(cc.Label).string = \"未达成\";\n    },\n\n    // 设置名字\n    setTitle: function (title) {\n        this.title.string = title;\n    },\n\n    // 设置描述\n    setDescription: function (description) {\n        this.description.string = description;\n    },    \n\n    // 更新状态，如果可以解锁，返回true\n    updateState: function(titleType) {\n        if (this.isHave) return false;\n        if (titleType != this.titleType) return false;\n\n        if (this.titleType == 1) {\n            // 可以购买\n            if (this.price <= Global.titleMaxScore) {\n                this.button.getComponent(cc.Button).interactable = true;\n                this.button.getChildByName(\"price\").getComponent(cc.Label).string = \"领取\";\n                return true;\n            }\n            // 不可以购买\n            else {\n                this.button.getComponent(cc.Button).interactable = false;\n                this.button.getChildByName(\"price\").getComponent(cc.Label).string = \"未达成\";\n                return false;\n            }\n        }\n        else if (this.titleType == 2) {\n            // 可以购买\n            if (this.price <= Global.storeData.length) {\n                this.button.getComponent(cc.Button).interactable = true;\n                this.button.getChildByName(\"price\").getComponent(cc.Label).string = \"领取\";\n                return true;\n            }\n            // 不可以购买\n            else {\n                this.button.getComponent(cc.Button).interactable = false;\n                this.button.getChildByName(\"price\").getComponent(cc.Label).string = \"未达成\";\n                return false;\n            }\n        }\n        else if (this.titleType == 3) {\n            //console.log('解锁第三种道具', this.price, Global.titleData.length);\n            // 可以购买\n            if (this.price <= Global.titleData.length) {\n                this.button.getComponent(cc.Button).interactable = true;\n                this.button.getChildByName(\"price\").getComponent(cc.Label).string = \"领取\";\n                return true;\n            }\n            // 不可以购买\n            else {\n                this.button.getComponent(cc.Button).interactable = false;\n                this.button.getChildByName(\"price\").getComponent(cc.Label).string = \"未达成\";\n                return false;\n            }\n        }\n    },\n\n    // 设置为达成未解锁\n    setUnlock: function() {\n        if (this.isHave) return;\n\n        this.button.getComponent(cc.Button).interactable = true;\n        this.button.getChildByName(\"price\").getComponent(cc.Label).string = \"领取\";\n    },\n\n    // 设置成就类型\n    setTitleType: function (titleType) {\n        this.titleType = titleType;\n    },\n\n    // 设置数值\n    setPrice: function (price) {\n        this.price = price;\n    },\n\n    // 奖励\n    setReward: function (reward) {\n        this.reward = reward;\n        //console.log('奖励星星个数：', this.reward);\n    },\n\n    // 设置日期\n    setDate: function (date) {\n        this.date = date;\n    },\n\n    // 设置是否拥有\n    setIsHave: function () {\n        this.isHave = true;\n        this.button.getComponent(cc.Button).interactable = true;\n        this.button.getChildByName(\"price\").getComponent(cc.Label).string = \"查看\";\n    },\n\n    // 按钮回调：购买\n    onButton: function () {\n        Global.game.playSound('btn', 0.1);\n        if (!this.isHave) {\n            this.isHave = true;\n            var repeat = false;\n            for (var i = 0; i < Global.titleData.length; i++) {\n                if (this.index == Global.titleData[i]) {\n                    repeat = true;\n                    break;\n                }\n            }\n            if (!repeat) {\n                Global.titleData.push(this.index);\n                ThirdAPI.saveInfo('title', Global.titleData);\n\n                var d = new Date(Date.now());\n                this.date = d.getFullYear() + '-' + (d.getMonth()+1) + '-' + d.getDate();\n                Global.titleDateData.push(this.date);\n                ThirdAPI.saveInfo('title-date', Global.titleDateData);\n                //console.log('get title date : ' ,this.date);\n\n                Global.titleUI.updateLabelComplete();\n            }\n\n            this.button.getChildByName(\"price\").getComponent(cc.Label).string = \"查看\";       \n\n            if (Global.titleUI)\n                Global.titleUI.updateItemsState(3);\n\n            // 查看\n            //console.log('查看成就：', this.index);\n            Global.game.showTitleInfoWindow();\n            if (Global.titleInfoUI) {\n                //console.log('奖励星星个数：', this.reward);\n                Global.titleInfoUI.initData(this.title.string, this.description.string, this.reward+'个星星', this.date);\n                Global.titleInfoUI.addPropScore(this.reward);\n            }                \n        }\n        else {\n            // 查看\n            //console.log('查看成就：', this.index);\n            Global.game.showTitleInfoWindow();\n            if (Global.titleInfoUI){\n                //console.log('奖励星星个数：', this.reward);\n                Global.titleInfoUI.initData(this.title.string, this.description.string, this.reward+'个星星', this.date);\n            }\n        }\n    },\n\n    // update (dt) {},\n});\n"]}